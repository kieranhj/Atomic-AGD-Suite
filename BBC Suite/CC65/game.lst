ca65 V2.17 - Git cc5c093
Main file   : game.asm
Current file: game.asm

000000r 1               ;----------------------------------------------
000000r 1               ; BBC AGD Engine
000000r 1               ; Z80 conversion by Kees van Oss 2017
000000r 1               ; BBC Micro version by Kieran Connell 2018
000000r 1               ;----------------------------------------------
000000r 1               
000000r 1               .DEFINE asm_code $0e00		; assembly address _BEEB
000000r 1               .DEFINE load_address $1200	; load address _BEEB
000000r 1               .DEFINE data_address $8000	; data address _SWRAM
000000r 1               
000000r 1               ;----------------------------------------------------------------------
000000r 1               ; BBC MICRO PLATFORM DEFINES
000000r 1               ;----------------------------------------------------------------------
000000r 1               
000000r 1               ; _BEEB MOS calls
000000r 1               
000000r 1               	OSBYTE	 = $fff4
000000r 1               	OSFILE	 = $ffdd
000000r 1               	OSWRCH	 = $ffee
000000r 1               	OSASCI	 = $ffe3
000000r 1               	OSWORD	 = $fff1
000000r 1               	OSFIND	 = $ffce
000000r 1               	OSGBPB	 = $ffd1
000000r 1               	OSARGS	 = $ffda
000000r 1               
000000r 1               	EVENTV	 = $0220
000000r 1               
000000r 1               	PAL_black = 0 ^ 7
000000r 1               	PAL_red = 1 ^ 7
000000r 1               	PAL_green = 2 ^ 7
000000r 1               	PAL_yellow = 3 ^ 7
000000r 1               	PAL_blue = 4 ^ 7
000000r 1               	PAL_magenta = 5 ^ 7
000000r 1               	PAL_cyan = 6 ^ 7
000000r 1               	PAL_white = 7 ^ 7
000000r 1               
000000r 1               ; System constants
000000r 1               
000000r 1               	ScreenSize  = $3000	; Startaddress video RAM _BEEB
000000r 1               	ScreenAddr 	= $8000 - ScreenSize	; Screen size bytes _BEEB
000000r 1               	ScreenRowBytes = 512				; 40 columns
000000r 1               
000000r 1               	SpriteMaxY	= 177	; used for clipping bottom of screen
000000r 1               
000000r 1               ; AGD Engine Workspace
000000r 1               
000000r 1               	MAP 		= $300				; properties map buffer (3x256 bytes)
000000r 1               	SCADTB_lb	= MAP + $300
000000r 1               	SCADTB_hb	= SCADTB_lb + $100
000000r 1               
000000r 1               .if pflag
000000r 1                   SHRAPN 		= $B00 - (NUMSHR * SHRSIZ)	; shrapnel table (55x6 bytes)
000000r 1               .endif
000000r 1               
000000r 1               	sprtab		= $B00				; NUMSPR*TABSIZ
000000r 1               
000000r 1               	.macro DEBUG_PAL pal
000000r 1               	;	SET_PAL pal
000000r 1               	.endmacro
000000r 1               
000000r 1               	.macro SET_PAL pal
000000r 1               		lda #$00+pal
000000r 1               		sta $fe21
000000r 1               		lda #$10+pal
000000r 1               		sta $fe21
000000r 1               ;		lda #$20+pal
000000r 1               ;		sta $fe21
000000r 1               ;		lda #$30+pal
000000r 1               ;		sta $fe21
000000r 1               		lda #$40+pal
000000r 1               		sta $fe21
000000r 1               		lda #$50+pal
000000r 1               		sta $fe21
000000r 1               ;		lda #$60+pal
000000r 1               ;		sta $fe21
000000r 1               ;		lda #$70+pal
000000r 1               ;		sta $fe21
000000r 1               	.endmacro
000000r 1               
000000r 1               ;----------------------------------------------------------------------
000000r 1               ; ZERO PAGE SEGMENT
000000r 1               ;----------------------------------------------------------------------
000000r 1               
000000r 1               .segment "ZEROPAGE"
000000r 1               
000000r 1               .include "z80-zp.inc"
000000r 2               ;ws	 = $60
000000r 2               
000000r 2  xx           z80_f: .res 1;	 = ws+$00
000001r 2  xx           z80_a: .res 1;	 = ws+$01
000002r 2               z80_af	 = z80_f
000002r 2               
000002r 2  xx           z80_c: .res 1;	 = ws+$02
000003r 2  xx           z80_b: .res 1;	 = ws+$03
000004r 2               z80_bc	 = z80_c
000004r 2               
000004r 2  xx           z80_e: .res 1;	 = ws+$04
000005r 2  xx           z80_d: .res 1;	 = ws+$05
000006r 2               z80_de	 = z80_e
000006r 2               
000006r 2  xx           z80_l: .res 1;	 = ws+$06
000007r 2  xx           z80_h: .res 1;	 = ws+$07
000008r 2               z80_hl	 = z80_l
000008r 2               
000008r 2  xx           z80_x: .res 1;    = ws+$08
000009r 2  xx           z80_i: .res 1;    = ws+$09
00000Ar 2               z80_ix	 = z80_x
00000Ar 2               
00000Ar 2  xx xx        z80_iy: .res 2;	 = ws+$0a
00000Cr 2               
00000Cr 2  xx           z80_fp: .res 1;	 = ws+$0c
00000Dr 2  xx           z80_ap: .res 1;	 = ws+$0d
00000Er 2               
00000Er 2  xx           z80_cp: .res 1;	 = ws+$0e
00000Fr 2  xx           z80_bp: .res 1;	 = ws+$0f
000010r 2               z80_bcp	 = z80_cp
000010r 2               
000010r 2  xx           z80_ep: .res 1;	 = ws+$10
000011r 2  xx           z80_dp: .res 1;	 = ws+$11
000012r 2               z80_dep	 = z80_ep
000012r 2               
000012r 2  xx           z80_lp: .res 1;	 = ws+$12
000013r 2  xx           z80_hp: .res 1;	 = ws+$13
000014r 2               z80_hlp	 = z80_lp
000014r 2               
000014r 2  xx xx        z80_sp: .res 2;   = ws+$14
000016r 2               
000016r 2  xx           z80_reg0: .res 1; = ws+$16
000017r 2  xx           z80_reg1: .res 1; = ws+$17
000018r 2  xx           z80_reg2: .res 1; = ws+$18
000019r 2  xx           z80_reg3: .res 1; = ws+$19
00001Ar 2               
00001Ar 2               ;z80_r: .res 1;	 = ws+$1a
00001Ar 2               
00001Ar 1               .include "engine-zp.inc"
00001Ar 2               ;----------------------------------------------------------------------
00001Ar 2               ; AGD 6502 Engine Zero Page Variables
00001Ar 2               ;----------------------------------------------------------------------
00001Ar 2               
00001Ar 2               ; Variables start here.
00001Ar 2               
00001Ar 2  xx           scno:	.res 1			; present screen number.
00001Br 2  xx           numlif:	.res 1			; number of lives.
00001Cr 2               
00001Cr 2  xx           vara:	.res 1			; general-purpose variable.
00001Dr 2  xx           varb:	.res 1			; general-purpose variable.
00001Er 2  xx           varc:	.res 1			; general-purpose variable.
00001Fr 2  xx           vard:	.res 1			; general-purpose variable.
000020r 2  xx           vare:	.res 1			; general-purpose variable.
000021r 2  xx           varf:	.res 1			; general-purpose variable.
000022r 2  xx           varg:	.res 1			; general-purpose variable.
000023r 2  xx           varh:	.res 1			; general-purpose variable.
000024r 2  xx           vari:	.res 1			; general-purpose variable.
000025r 2  xx           varj:	.res 1			; general-purpose variable.
000026r 2  xx           vark:	.res 1			; general-purpose variable.
000027r 2  xx           varl:	.res 1			; general-purpose variable.
000028r 2  xx           varm:	.res 1			; general-purpose variable.
000029r 2  xx           varn:	.res 1			; general-purpose variable.
00002Ar 2  xx           varo:	.res 1			; general-purpose variable.
00002Br 2  xx           varp:	.res 1			; general-purpose variable.
00002Cr 2  xx           varq:	.res 1			; general-purpose variable.
00002Dr 2  xx           varr:	.res 1			; general-purpose variable.
00002Er 2  xx           vars:	.res 1			; general-purpose variable.
00002Fr 2  xx           vart:	.res 1			; general-purpose variable.
000030r 2  xx           varu:	.res 1			; general-purpose variable.
000031r 2  xx           varv:	.res 1			; general-purpose variable.
000032r 2  xx           varw:	.res 1			; general-purpose variable.
000033r 2  xx           varz:	.res 1			; general-purpose variable.
000034r 2               
000034r 2  xx           charx:	.res 1			; cursor x position.
000035r 2  xx           chary:	.res 1			; cursor y position.
000036r 2               
000036r 2  xx           clock:	.res 1			; last clock reading.
000037r 2  xx           varrnd:	.res 1	        ; last random number.
000038r 2  xx           varobj:	.res 1  	    ; last object number.
000039r 2  xx           varopt:	.res 1     		; last option chosen from menu.
00003Ar 2  xx           varblk:	.res 1  		; block type.
00003Br 2  xx           nexlev:	.res 1			; next level flag.
00003Cr 2  xx           restfl:	.res 1			; restart screen flag.
00003Dr 2  xx           deadf:	.res 1			; dead flag.
00003Er 2  xx           gamwon:	.res 1			; game won flag.
00003Fr 2  xx           dispx:	.res 1			; cursor x position.
000040r 2  xx           dispy:	.res 1			; cursor y position.
000041r 2               
000041r 2  xx           contrl:	.res 1			; control = keyboard, 1 = Kempston, 2 = Sinclair, 3 = Mouse.
000042r 2  xx           joyval:	.res 1			; joystick reading.
000043r 2  xx           frmno:	.res 1			; selected frame.
000044r 2               
000044r 2               ;----------------------------------------------------
000044r 2               ; Missing vars
000044r 2               ;----------------------------------------------------
000044r 2               
000044r 2  xx           loopa:		.res 1
000045r 2  xx           loopb:		.res 1
000046r 2  xx           loopc:		.res 1
000047r 2  xx xx        FontPtr:    .res 2
000049r 2               
000049r 2               ; Local vars
000049r 2               
000049r 2  xx xx        scraddr:    .res 2
00004Br 2  xx xx        fntaddr:    .res 2
00004Dr 2  xx xx        tileaddr:   .res 2
00004Fr 2  xx xx        bufaddr:    .res 2
000051r 2               
000051r 2  xx xx        tmp:        .res 2
000053r 2  xx xx        scr_l:      .res 2
000055r 2  xx xx        scr_r:      .res 2
000057r 2  xx xx        scr_txt:    .res 2
000059r 2               
000059r 2  xx           xtmp:	    .res 1
00005Ar 2  xx           spcnt:	    .res 1
00005Br 2  xx xx        spptr:	    .res 2		; spawned sprite pointer.
00005Dr 2  xx           seed:	    .res 1		; seed for random numbers.
00005Er 2               
00005Er 2  xx           ccnt:       .res 1
00005Fr 2  xx           flag:	    .res 1
000060r 2  xx           rcol:	    .res 1
000061r 2  xx           rrow:	    .res 1
000062r 2               
000062r 2  xx           combyt:	    .res 1		; byte type compressed.
000063r 2  xx           comcnt:	    .res 1		; compression counter.
000064r 2  xx           prtmod:	    .res 1      ; print mode, 0 = standard, 1 = double-height.
000065r 2  xx           qscnt:	    .res 1
000066r 2               
000066r 2  xx           sprptr:	    .res 1      ; not a ptr
000067r 2  xx           sprcnt:	    .res 1
000068r 2               
000068r 2  xx xx        skptr:	    .res 2		; search pointer.
00006Ar 2  xx           sktptr:	    .res 1      ; not a ptr
00006Br 2  xx           tmproom:	.res 1
00006Cr 2  xx xx        ogptr:	    .res 2		; original sprite pointer.
00006Er 2               
00006Er 2  xx xx xx     spr:	    .res 3      ; static sprite data
000071r 2  xx           vsync_count:.res 1
000072r 2  xx           colpatt:	.res 1
000073r 2  xx           sprtmp:     .res 1
000074r 2  xx           sprtmp2:    .res 1
000075r 2  xx           sprshft:    .res 1
000076r 2               
000076r 2  xx           spriteink:  .res 1
000077r 2  xx           colour_byte:.res 1
000078r 2  xx           colour_xor: .res 1
000079r 2               
000079r 2               .if mflag
000079r 2  xx xx        TmpAddr:	.res 2
00007Br 2  xx           bwid:	    .res 1     ; box/menu width.
00007Cr 2  xx           blen:	    .res 1     ; box/menu height.
00007Dr 2  xx           btop:	    .res 1     ; box coordinates.
00007Er 2  xx           blft:	    .res 1
00007Fr 2               .endif
00007Fr 2               
00007Fr 2               .if pflag
00007Fr 2               shrctr:	    .res 1
00007Fr 2               explcnt:	.res 1
00007Fr 2               seed3:	    .res 1
00007Fr 2               .endif
00007Fr 2               
00007Fr 2               .if aflag
00007Fr 2               pbptr:      .res 2
00007Fr 2               .endif
00007Fr 2               
00007Fr 1               
00007Fr 1               ;----------------------------------------------------------------------
00007Fr 1               ; ZCODE SEGMENT
00007Fr 1               ;----------------------------------------------------------------------
00007Fr 1               
00007Fr 1               .segment "CODE"
000000r 1               .org asm_code
000E00  1               
000E00  1               start_asm:
000E00  1               
000E00  1  4C CA 78     	jmp relocate + load_address - asm_code
000E03  1               
000E03  1               boot_game:
000E03  1               
000E03  1               ; Zero ZP vars
000E03  1               
000E03  1               clear_zp:
000E03  1  A2 00        	ldx #0
000E05  1  8A           	txa
000E06  1               	:
000E06  1  95 00        	sta $00, x
000E08  1  E8           	inx
000E09  1  E0 A0        	cpx #$a0
000E0B  1  D0 F9        	bne :-
000E0D  1               
000E0D  1               	; Init non-zero vars
000E0D  1  A9 03        	lda #3
000E0F  1  85 rr        	sta numlif
000E11  1               
000E11  1  A2 FF        	ldx #255
000E13  1  86 rr        	stx varrnd
000E15  1  86 rr        	stx varopt
000E17  1  86 rr        	stx varblk
000E19  1  CA           	dex
000E1A  1  86 rr        	stx varobj
000E1C  1               
000E1C  1               	; TEMP
000E1C  1  A9 FF        	lda #$ff
000E1E  1  85 rr        	sta colour_byte
000E20  1  A9 07        	lda #7
000E22  1  85 rr        	sta spriteink
000E24  1               
000E24  1  20 88 0E     	jsr bbcinit
000E27  1               
000E27  1               	; Call AGD Engine start game
000E27  1  20 00 18     	jsr start_game
000E2A  1               
000E2A  1  20 A7 0E     	jsr bbckill
000E2D  1               
000E2D  1                   ; Wait for keypress
000E2D  1  A2 FF        	ldx #$ff
000E2F  1  A0 7F        	ldy #$7f
000E31  1  A9 81        	lda #$81
000E33  1  20 F4 FF     	jsr OSBYTE
000E36  1               
000E36  1               	; Restart or exit
000E36  1  4C 03 0E     	jmp boot_game
000E39  1               
000E39  1               ;----------------------------------------------------------------------
000E39  1               ; PLATFORM SPECIFIC ENGINE CODE
000E39  1               ;----------------------------------------------------------------------
000E39  1               
000E39  1               	.include "z80.asm"
000E39  2               ;------------------------------------------------------
000E39  2               ; z80.asm
000E39  2               ; spectrum stuff
000E39  2               ; adresses
000E39  2               
000E39  2               ;ws	 = $60
000E39  2               
000E39  2               ;z80_f	 = ws+$00
000E39  2               ;z80_a	 = ws+$01
000E39  2               ;z80_af	 = z80_f
000E39  2               
000E39  2               ;z80_c	 = ws+$02
000E39  2               ;z80_b	 = ws+$03
000E39  2               ;z80_bc	 = z80_c
000E39  2               
000E39  2               ;z80_e	 = ws+$04
000E39  2               ;z80_d	 = ws+$05
000E39  2               ;z80_de	 = z80_e
000E39  2               
000E39  2               ;z80_l	 = ws+$06
000E39  2               ;z80_h	 = ws+$07
000E39  2               ;z80_hl	 = z80_l
000E39  2               
000E39  2               ;z80_x    = ws+$08
000E39  2               ;z80_i    = ws+$09
000E39  2               ;z80_ix	 = z80_x
000E39  2               
000E39  2               ;z80_iy	 = ws+$0a
000E39  2               
000E39  2               ;z80_fp	 = ws+$0c
000E39  2               ;z80_ap	 = ws+$0d
000E39  2               
000E39  2               ;z80_cp	 = ws+$0e
000E39  2               ;z80_bp	 = ws+$0f
000E39  2               ;z80_bcp = z80_cp
000E39  2               
000E39  2               ;z80_ep	 = ws+$10
000E39  2               ;z80_dp	 = ws+$11
000E39  2               ;z80_dep = z80_ep
000E39  2               
000E39  2               ;z80_lp	 = ws+$12
000E39  2               ;z80_hp	 = ws+$13
000E39  2               ;z80_hlp = z80_lp
000E39  2               
000E39  2               ;z80_sp   = ws+$14
000E39  2               
000E39  2               ;z80_reg0 = ws+$16
000E39  2               ;z80_reg1 = ws+$17
000E39  2               ;z80_reg2 = ws+$18
000E39  2               ;z80_reg3 = ws+$19
000E39  2               
000E39  2               ;z80_r	 = ws+$1a
000E39  2               
000E39  2               ; Contains seperatly 1 bit set
000E39  2               ; _BEEB this is not safe memory to use as required by MOS
000E39  2               
000E39  2               _bitmem0	= $f8
000E39  2               _bitmem1	= $f9
000E39  2               _bitmem2	= $fa
000E39  2               _bitmem3	= $fb
000E39  2               _bitmem4	= $fc
000E39  2               _bitmem5	= $fd
000E39  2               _bitmem6	= $fe
000E39  2               _bitmem7	= $ff
000E39  2               
000E39  2               ; constants
000E39  2               _bitvalue0	= $01
000E39  2               _bitvalue1	= $02
000E39  2               _bitvalue2	= $04
000E39  2               _bitvalue3	= $08
000E39  2               _bitvalue4	= $10
000E39  2               _bitvalue5	= $20
000E39  2               _bitvalue6	= $40
000E39  2               _bitvalue7	= $80
000E39  2               
000E39  2               _notbitvalue0	= $fe
000E39  2               _notbitvalue1	= $fd
000E39  2               _notbitvalue2	= $fb
000E39  2               _notbitvalue3	= $f7
000E39  2               _notbitvalue4	= $ef
000E39  2               _notbitvalue5	= $df
000E39  2               _notbitvalue6	= $bf
000E39  2               _notbitvalue7	= $7f
000E39  2               
000E39  2               
000E39  2               ;add_hl_bc:
000E39  2               ;		lda z80_l
000E39  2               ;		clc
000E39  2               ;		adc z80_c
000E39  2               ;		sta z80_l
000E39  2               ;		lda z80_h
000E39  2               ;		adc z80_b
000E39  2               ;		sta z80_h
000E39  2               ;		rts
000E39  2               ;
000E39  2               ;add_ix_de:
000E39  2               ;		lda z80_ix
000E39  2               ;		clc
000E39  2               ;		adc z80_e
000E39  2               ;		sta z80_ix
000E39  2               ;		lda z80_ix+1
000E39  2               ;		adc z80_d
000E39  2               ;		sta z80_ix+1
000E39  2               ;		rts
000E39  2               ;
000E39  2               ;add_iy_de:
000E39  2               ;		lda z80_iy
000E39  2               ;		clc
000E39  2               ;		adc z80_e
000E39  2               ;		sta z80_iy
000E39  2               ;		lda z80_iy+1
000E39  2               ;		adc z80_d
000E39  2               ;		sta z80_iy+1
000E39  2               ;		rts
000E39  2               ;
000E39  2               ;add_hl_de:
000E39  2               ;		lda z80_l
000E39  2               ;		clc
000E39  2               ;		adc z80_e
000E39  2               ;		sta z80_l
000E39  2               ;		lda z80_h
000E39  2               ;		adc z80_d
000E39  2               ;		sta z80_h
000E39  2               ;		rts
000E39  2               ;
000E39  2               ;add_ix_bc:
000E39  2               ;		lda z80_ix
000E39  2               ;		clc
000E39  2               ;		adc z80_c
000E39  2               ;		sta z80_ix
000E39  2               ;		lda z80_ix+1
000E39  2               ;		adc z80_b
000E39  2               ;		sta z80_ix+1
000E39  2               ;		rts
000E39  2               ;
000E39  2               ;add_iy_bc:
000E39  2               ;		lda z80_iy
000E39  2               ;		clc
000E39  2               ;		adc z80_c
000E39  2               ;		sta z80_iy
000E39  2               ;		lda z80_iy+1
000E39  2               ;		adc z80_b
000E39  2               ;		sta z80_iy+1
000E39  2               ;		rts
000E39  2               ;
000E39  2               ;sbc_hl_de:
000E39  2               ;		lda z80_l
000E39  2               ;		sbc z80_e
000E39  2               ;		sta z80_l
000E39  2               ;		lda z80_h
000E39  2               ;		sbc z80_d
000E39  2               ;		sta z80_h
000E39  2               ;		rts
000E39  2               ;
000E39  2               ;sbc_hl_bc:
000E39  2               ;		lda z80_l
000E39  2               ;		sbc z80_c
000E39  2               ;		sta z80_l
000E39  2               ;		lda z80_h
000E39  2               ;		sbc z80_b
000E39  2               ;		sta z80_h
000E39  2               ;		rts
000E39  2               ;
000E39  2               ;cmp_hl_bc:
000E39  2               ;		lda z80_l
000E39  2               ;		cmp z80_c
000E39  2               ;		bne cmp_hl_bc_end
000E39  2               ;		lda z80_h
000E39  2               ;		cmp z80_b
000E39  2               ;cmp_hl_bc_end:
000E39  2               ;		rts
000E39  2               ;
000E39  2               ;cmp_iy_ix:
000E39  2               ;		lda z80_iy
000E39  2               ;		cmp z80_ix
000E39  2               ;		bne cmp_iy_ix_end
000E39  2               ;		lda z80_iy+1
000E39  2               ;		cmp z80_ix+1
000E39  2               ;cmp_iy_ix_end:
000E39  2               ;		rts
000E39  2               ;
000E39  2               ;dec_hl:
000E39  2               ;		lda z80_l
000E39  2               ;		bne dec_hl_no_dec_h
000E39  2               ;		dec z80_h
000E39  2               ;dec_hl_no_dec_h:
000E39  2               ;		dec z80_l
000E39  2               ;		rts
000E39  2               ;
000E39  2               ;dec_ix:
000E39  2               ;		lda z80_ix
000E39  2               ;		bne dec_ix_no_dec_h
000E39  2               ;		dec z80_ix+1
000E39  2               ;dec_ix_no_dec_h:
000E39  2               ;		dec z80_ix
000E39  2               ;		rts
000E39  2               ;
000E39  2               ;dec_bc:
000E39  2               ;		lda z80_c
000E39  2               ;		bne dec_bc_no_dec_b
000E39  2               ;		dec z80_b
000E39  2               ;dec_bc_no_dec_b:
000E39  2               ;		dec z80_c
000E39  2               ;		rts
000E39  2               ;
000E39  2               ;dec_de:
000E39  2               ;		lda z80_e
000E39  2               ;		bne dec_de_no_dec_d
000E39  2               ;		dec z80_d
000E39  2               ;dec_de_no_dec_d:
000E39  2               ;		dec z80_e
000E39  2               ;		rts
000E39  2               ;
000E39  2               ;ex_af_afs:
000E39  2               ;	rts
000E39  2               ;ex_de_hl:
000E39  2               ;		lda z80_e
000E39  2               ;		ldx z80_l
000E39  2               ;		stx z80_e
000E39  2               ;		sta z80_l
000E39  2               ;		lda z80_d
000E39  2               ;		ldx z80_h
000E39  2               ;		stx z80_d
000E39  2               ;		sta z80_h
000E39  2               ;		rts
000E39  2               ;
000E39  2               exx:
000E39  2  A5 rr        		lda z80_c
000E3B  2  A4 rr        		ldy z80_cp
000E3D  2  84 rr        		sty z80_c
000E3F  2  85 rr        		sta z80_cp
000E41  2  A5 rr        		lda z80_b
000E43  2  A4 rr        		ldy z80_bp
000E45  2  84 rr        		sty z80_b
000E47  2  85 rr        		sta z80_bp
000E49  2  A5 rr        		lda z80_e
000E4B  2  A4 rr        		ldy z80_ep
000E4D  2  84 rr        		sty z80_e
000E4F  2  85 rr        		sta z80_ep
000E51  2  A5 rr        		lda z80_d
000E53  2  A4 rr        		ldy z80_dp
000E55  2  84 rr        		sty z80_d
000E57  2  85 rr        		sta z80_dp
000E59  2  A5 rr        		lda scraddr
000E5B  2  A4 rr        		ldy z80_lp
000E5D  2  84 rr        		sty scraddr
000E5F  2  85 rr        		sta z80_lp
000E61  2  A5 rr        		lda scraddr+1
000E63  2  A4 rr        		ldy z80_hp
000E65  2  84 rr        		sty scraddr+1
000E67  2  85 rr        		sta z80_hp
000E69  2  60           		rts
000E6A  2               
000E6A  2               ;ex_sp_hl:
000E6A  2               ;		tsx
000E6A  2               ;		lda $0103,x
000E6A  2               ;		ldy z80_h
000E6A  2               ;		sta z80_h
000E6A  2               ;		tya
000E6A  2               ;		sta $0103,x
000E6A  2               ;		lda $0104,x
000E6A  2               ;		ldy z80_l
000E6A  2               ;		sta z80_l
000E6A  2               ;		tya
000E6A  2               ;		sta $104,x
000E6A  2               ;		rts
000E6A  2               ;
000E6A  2               ;ldi:
000E6A  2               ;	rts
000E6A  2               ;ldir:
000E6A  2               ;		ldy #$00
000E6A  2               ;		ldx z80_b
000E6A  2               ;		beq ldir_last_page
000E6A  2               ;ldir_loop:
000E6A  2               ;		lda (z80_hl),y
000E6A  2               ;		sta (z80_de),y
000E6A  2               ;		iny
000E6A  2               ;		bne ldir_loop
000E6A  2               ;		inc z80_h
000E6A  2               ;		inc z80_d
000E6A  2               ;		dex
000E6A  2               ;		bne ldir_loop
000E6A  2               ;ldir_last_page:
000E6A  2               ;		lda z80_c
000E6A  2               ;		beq ldir_end
000E6A  2               ;ldir_last_page_loop:
000E6A  2               ;		lda (z80_hl),y
000E6A  2               ;		sta (z80_de),y
000E6A  2               ;		iny
000E6A  2               ;		cpy z80_c
000E6A  2               ;		bne ldir_last_page_loop
000E6A  2               ;ldir_end:
000E6A  2               ;		stx z80_c
000E6A  2               ;		stx z80_b
000E6A  2               ;		tya
000E6A  2               ;		clc
000E6A  2               ;		adc z80_l
000E6A  2               ;		sta z80_l
000E6A  2               ;		bcc *+4
000E6A  2               ;		inc z80_h
000E6A  2               ;		tya
000E6A  2               ;		clc
000E6A  2               ;		adc z80_e
000E6A  2               ;		sta z80_e
000E6A  2               ;		bcc *+4
000E6A  2               ;		inc z80_d
000E6A  2               ;		rts
000E6A  2               ;
000E6A  2               ;lddr:		ldy #$00
000E6A  2               ;lddr_loop:
000E6A  2               ;		lda (z80_hl),y
000E6A  2               ;		sta (z80_de),y
000E6A  2               ;		jsr dec_hl
000E6A  2               ;		jsr dec_de
000E6A  2               ;		jsr dec_bc
000E6A  2               ;		lda z80_b
000E6A  2               ;		ora z80_c
000E6A  2               ;		bne lddr_loop
000E6A  2               ;		rts
000E6A  2               ;ei:
000E6A  2               ;		rts
000E6A  2               ;di:
000E6A  2               ;		rts
000E6A  2               
000E6A  2               ;-------------------------------------------------------------
000E6A  2               ; Set bits in bitmem
000E6A  2               ;-------------------------------------------------------------
000E6A  2               
000E6A  2               .if 0
000E6A  2               z80_init:
000E6A  2               	ldx #$00
000E6A  2               	lda #$01
000E6A  2               z80_init_loop:
000E6A  2               	sta _bitmem0,x
000E6A  2               	inx
000E6A  2               	asl a
000E6A  2               	bne z80_init_loop
000E6A  2               	rts
000E6A  2               .endif
000E6A  2               
000E6A  2               push_af:
000E6A  2               push_bc:
000E6A  2               push_de:
000E6A  2               push_hl:
000E6A  2               
000E6A  2               pop_af:
000E6A  2               pop_bc:
000E6A  2               pop_de:
000E6A  2               pop_ix:
000E6A  2               pop_hl:
000E6A  2               
000E6A  2               add_hl_hl:
000E6A  2               
000E6A  2               inc_bc:
000E6A  2               inc_de:
000E6A  2               inc_hl:
000E6A  2               inc_ix:
000E6A  2               inc_sp:
000E6A  2               
000E6A  2               cpir:
000E6A  2               
000E6A  2               ex_af_af:
000E6A  2               ;	rts
000E6A  2               
000E6A  1               	.include "bbc.inc"
000E6A  2               ;----------------------------------------------------------------------
000E6A  2               ; BBC Platform Specific functions
000E6A  2               ;----------------------------------------------------------------------
000E6A  2               
000E6A  2               ;--------------------------------------------------------
000E6A  2               ; Keys
000E6A  2               ;
000E6A  2               ; Out: joyval=x65FUDLR (bit cleared if key pressed)
000E6A  2               ;             ||||||||
000E6A  2               ;             |||||||+> Right    KEY 0  - X
000E6A  2               ;             ||||||+-> Left     KEY 1  - Z
000E6A  2               ;             |||||+--> Down     KEY 2  - .
000E6A  2               ;             ||||+---> Up       KEY 3  - ;
000E6A  2               ;             |||+----> Fire1    KEY 4  - SPC
000E6A  2               ;             ||+-----> Fire2    KEY 5  - Q
000E6A  2               ;             |+------> Fire3    KEY 6  - P
000E6A  2               ;             +-------> Not used
000E6A  2               ;
000E6A  2               ;                       Option1  KEY 7  - 1
000E6A  2               ;                       Option2  KEY 8  - 2
000E6A  2               ;                       Option3  KEY 9  - 3
000E6A  2               ;                       Option4  KEY 10 - 4
000E6A  2               ;--------------------------------------------------------
000E6A  2               
000E6A  2               ;              X   Z   .   ;  SPC  Q   P
000E6A  2               ;keys:   .byte $42,$61,$68,$48,$62,$10,$37       ; Keys defined by game designer.
000E6A  2               ;        .byte $30,$31,$11,$12                   ; menu options.
000E6A  2               
000E6A  2  42 61 68 48  jkeys:  .byte $42,$61,$68,$48,$49,$10,$37       ; Keys defined by game designer.
000E6E  2  49 10 37     
000E71  2  30 31 11 12          .byte $30,$31,$11,$12                   ; menu options.
000E75  2               
000E75  2               ;----------------------------------------------------
000E75  2               ; Wait for keypress.
000E75  2               ;----------------------------------------------------
000E75  2               
000E75  2               prskey:
000E75  2  8A           	txa
000E76  2  48           	pha
000E77  2               prsloop:
000E77  2  20 16 0F     	jsr vsync
000E7A  2               
000E7A  2  A9 79        	lda #$79
000E7C  2  A2 01        	ldx #$01
000E7E  2  20 F4 FF     	jsr OSBYTE
000E81  2               
000E81  2  E0 FF        	cpx #$ff
000E83  2  F0 F2        	beq prsloop		; wait until key pressed
000E85  2  68           	pla
000E86  2  AA           	tax
000E87  2  60           	rts
000E88  2               
000E88  2               bbcinit:
000E88  2  78           	sei
000E89  2  AD 20 02     	lda EVENTV
000E8C  2  8D BC 0E     	sta old_eventv
000E8F  2  AD 21 02     	lda EVENTV+1
000E92  2  8D BD 0E     	sta old_eventv+1
000E95  2               
000E95  2  A9 BE        	lda #<event_handler
000E97  2  8D 20 02     	sta EVENTV
000E9A  2  A9 0E        	lda #>event_handler
000E9C  2  8D 21 02     	sta EVENTV+1
000E9F  2  58           	cli
000EA0  2               
000EA0  2               	; Enable VSYNC event.
000EA0  2  A9 0E        	lda #14
000EA2  2  A2 04        	ldx #4
000EA4  2  4C F4 FF     	jmp OSBYTE
000EA7  2               
000EA7  2               bbckill:
000EA7  2  78           	sei
000EA8  2  AD BC 0E     	lda old_eventv
000EAB  2  8D 20 02     	sta EVENTV
000EAE  2  AD BD 0E     	lda old_eventv+1
000EB1  2  8D 21 02     	sta EVENTV+1
000EB4  2  58           	cli
000EB5  2               
000EB5  2               	; Disable VSYNC event.
000EB5  2  A9 0D        	lda #13
000EB7  2  A2 04        	ldx #4
000EB9  2  4C F4 FF     	jmp OSBYTE
000EBC  2               
000EBC  2               
000EBC  2               old_eventv:
000EBC  2  xx xx        	.res 2
000EBE  2               
000EBE  2               event_handler:
000EBE  2  08           	php
000EBF  2  C9 04        	cmp #4
000EC1  2  D0 02        	bne not_vsync
000EC3  2               
000EC3  2  E6 rr        	inc vsync_count
000EC5  2               
000EC5  2               not_vsync:
000EC5  2  28           	plp
000EC6  2  6C BC 0E     	jmp (old_eventv)
000EC9  2               
000EC9  2               bbcsync:
000EC9  2  A5 rr        	lda vsync_count
000ECB  2  C9 02        	cmp #2
000ECD  2  90 FA        	bcc bbcsync
000ECF  2  A9 00        	lda #0
000ED1  2  85 rr        	sta vsync_count
000ED3  2  60           	rts
000ED4  2               
000ED4  2               ;--------------------------------------------------------
000ED4  2               ; Keyboard test routine.
000ED4  2               ;
000ED4  2               ; Input:
000ED4  2               ;  A = key to read, high nibble=row and low nibble=col
000ED4  2               ;
000ED4  2               ; Output:
000ED4  2               ;  carry clr = key pressed
000ED4  2               ;  carry set = key not pressed
000ED4  2               ;--------------------------------------------------------
000ED4  2               
000ED4  2               ktest:
000ED4  2  85 rr        	sta z80_a		; save key
000ED6  2  98           	tya
000ED7  2  48           	pha
000ED8  2               
000ED8  2               ; _BEEB keyboard read
000ED8  2  A5 rr        	lda z80_a
000EDA  2  49 80        	eor #$80		; _BEEB just look for this key
000EDC  2  AA           	tax
000EDD  2               
000EDD  2  A9 79        	lda #$79
000EDF  2  20 F4 FF     	jsr OSBYTE
000EE2  2               
000EE2  2  8A           	txa
000EE3  2  30 04        	bmi pressed 	; _BEEB X is negative if key is pressed
000EE5  2               
000EE5  2  38           	sec			; key not pressed
000EE6  2  68           	pla
000EE7  2  A8           	tay
000EE8  2  60           	rts
000EE9  2               
000EE9  2               pressed:
000EE9  2  18           	clc			; key pressed
000EEA  2  68           	pla
000EEB  2  A8           	tay
000EEC  2  60           	rts
000EED  2               
000EED  2               ;---------------------------------------------------------------
000EED  2               ; Getkey in column,row format
000EED  2               ;
000EED  2               ; Output:
000EED  2               ;  A = high nibble=row and low nibble=column key in matrix
000EED  2               ;---------------------------------------------------------------
000EED  2               
000EED  2               kget:
000EED  2  86 rr        	stx xtmp
000EEF  2               
000EEF  2               kget1:
000EEF  2  A9 79        	lda #$79			; _BEEB read keyboard with OSBYTE &79
000EF1  2  A2 01        	ldx #$01
000EF3  2  20 F4 FF     	jsr OSBYTE
000EF6  2               
000EF6  2  E0 FF        	cpx #$ff
000EF8  2  F0 F5        	beq kget1
000EFA  2               
000EFA  2  8A           	txa
000EFB  2               
000EFB  2  A6 rr        	ldx xtmp
000EFD  2  60           	rts
000EFE  2               
000EFE  2               ;----------------------------------------------------
000EFE  2               ; AtoMMC joystick controls.
000EFE  2               ; _BEEB TODO
000EFE  2               ;----------------------------------------------------
000EFE  2               
000EFE  2               joyinit:
000EFE  2               joysin:
000EFE  2  60           	rts
000EFF  2               
000EFF  2               
000EFF  2               ;----------------------------------------------------
000EFF  2               ; Delay routine 1/50 sec
000EFF  2               ;
000EFF  2               ; Wait 1/60 sec = 16666 usec
000EFF  2               ; Wait 208 x 16 =  3328 usec
000EFF  2               ;                 19994 usec
000EFF  2               ; rts           =     6 usec
000EFF  2               ; Total         = 20000 usec
000EFF  2               ;----------------------------------------------------
000EFF  2               
000EFF  2               delay:
000EFF  2  85 rr        	sta xtmp
000F01  2               del_loop:
000F01  2  A9 13        	lda #19
000F03  2  20 F4 FF     	jsr OSBYTE		; wait for vsync _BEEB
000F06  2               
000F06  2  A0 D0        	ldy #208		; wait 208 x 16 = 3328 usec
000F08  2               delay1:
000F08  2  61 80        	adc ($80,x)		;	 6 usec
000F0A  2  61 80        	adc ($80,x)		;	 6 usec
000F0C  2  88           	dey			;	 2 usec
000F0D  2  D0 F9        	bne delay1		;	 2 usec
000F0F  2  EA           	nop			; 2 usec
000F10  2  EA           	nop			; 2 usec
000F11  2               				; tot: 20000 usec
000F11  2  C6 rr        	dec xtmp
000F13  2  D0 EC        	bne del_loop
000F15  2  60           	rts
000F16  2               
000F16  2               ;-------------------------------------------------------------
000F16  2               ; Screen synchronisation.
000F16  2               ;
000F16  2               ;  - read joystick/keyboard
000F16  2               ;  - handle sound
000F16  2               ;  - sync framerate with clock
000F16  2               ;  - handle shrapnel every even frame
000F16  2               ;-------------------------------------------------------------
000F16  2               
000F16  2               vsync:
000F16  2  48           	pha
000F17  2  98           	tya
000F18  2  48           	pha
000F19  2  8A           	txa
000F1A  2  48           	pha
000F1B  2  20 A1 23     	jsr joykey		; read joystick/keyboard.
000F1E  2               vsync1:
000F1E  2               ; Don't sync to vsync here - we can sync to every other vsync in main loop
000F1E  2               ;	lda #19
000F1E  2               ;	jsr OSBYTE		; _BEEB vsync
000F1E  2               
000F1E  2  A5 rr        	lda clock
000F20  2  29 01        	and #1
000F22  2  D0 03        	bne:+
000F24  2  20 26 1B     	jsr proshr		; handle shrapnel every even frame
000F27  2               :
000F27  2  AD 32 0F     	lda sndtyp
000F2A  2  F0 00        	beq sndskip
000F2C  2               
000F2C  2               ; _BEEB TODO SOUND
000F2C  2               ;sndloop:
000F2C  2               ;	lda SpeakerBit		; handle sound
000F2C  2               ;	ldy sndtyp
000F2C  2               ;sndwait:
000F2C  2               ;	dey
000F2C  2               ;	bne sndwait
000F2C  2               ;	eor #4
000F2C  2               ;	sta SpeakerBit
000F2C  2               ;	dec sndtyp
000F2C  2               ;	bne sndloop
000F2C  2               
000F2C  2               sndskip:
000F2C  2  68           	pla
000F2D  2  AA           	tax
000F2E  2  68           	pla
000F2F  2  A8           	tay
000F30  2  68           	pla
000F31  2  60           	rts
000F32  2               
000F32  2  00           sndtyp:	.byte 0
000F33  2               
000F33  2               ;----------------------------------------------------------------------
000F33  2               ; BBC video hardware fns
000F33  2               ;----------------------------------------------------------------------
000F33  2               
000F33  2               screeninit:
000F33  2  A2 0D        	ldx #13
000F35  2               crtcloop:
000F35  2  8E 00 FE     	stx $FE00
000F38  2  BD 55 0F     	lda crtc_regs_high,x
000F3B  2  8D 01 FE     	sta $FE01
000F3E  2  CA           	dex
000F3F  2  10 F4        	bpl crtcloop
000F41  2               
000F41  2                   ; Set ULA
000F41  2  A9 D8            lda #$D8            ; MODE 4=$88 MODE 1=$D8
000F43  2  8D 48 02         sta $248            ; Tell the OS or it will mess with ULA settings at vsync
000F46  2  8D 20 FE         sta $FE20
000F49  2               
000F49  2               ; fall through to palette
000F49  2               
000F49  2               setpal:
000F49  2  A2 0F        	ldx #15
000F4B  2               palloop:
000F4B  2  BD 63 0F     	lda ula_pal,x
000F4E  2  8D 21 FE     	sta $fe21
000F51  2  CA           	dex
000F52  2  10 F7        	bpl palloop
000F54  2  60           	rts
000F55  2               
000F55  2               crtc_regs_high:
000F55  2  7F           	.byte 127				; R0  horizontal total
000F56  2  40           	.byte 64				; R1  horizontal displayed
000F57  2  62           	.byte 98				; R2  horizontal position
000F58  2  28           	.byte $28				; R3  sync width 40 = &28
000F59  2  26           	.byte 38				; R4  vertical total
000F5A  2  00           	.byte 0					; R5  vertical total adjust
000F5B  2  18           	.byte 24				; R6  vertical displayed
000F5C  2  23           	.byte 35				; R7  vertical position; 35=top of screen
000F5D  2  00           	.byte $00				; R8  interlace
000F5E  2  07           	.byte 7					; R9  scanlines per row
000F5F  2  20           	.byte 32				; R10 cursor start
000F60  2  08           	.byte 8					; R11 cursor end
000F61  2  0A           	.byte >(ScreenAddr/8)	; R12 screen start address, high
000F62  2  00           	.byte <(ScreenAddr/8)	; R13 screen start address, low
000F63  2               
000F63  2               ula_pal:
000F63  2  07           	.byte $00 + PAL_black
000F64  2  17           	.byte $10 + PAL_black
000F65  2  23           	.byte $20 + PAL_blue
000F66  2  33           	.byte $30 + PAL_blue
000F67  2  47           	.byte $40 + PAL_black
000F68  2  57           	.byte $50 + PAL_black
000F69  2  63           	.byte $60 + PAL_blue
000F6A  2  73           	.byte $70 + PAL_blue
000F6B  2  86           	.byte $80 + PAL_red
000F6C  2  96           	.byte $90 + PAL_red
000F6D  2  A0           	.byte $a0 + PAL_white
000F6E  2  B0           	.byte $b0 + PAL_white
000F6F  2  C6           	.byte $c0 + PAL_red
000F70  2  D6           	.byte $d0 + PAL_red
000F71  2  E0           	.byte $e0 + PAL_white
000F72  2  F0           	.byte $f0 + PAL_white
000F73  2               
000F73  2               ;----------------------------------------------------
000F73  2               ; Draw sprite
000F73  2               ;----------------------------------------------------
000F73  2               
000F73  2               sprite:
000F73  2  86 rr        	stx xtmp		; Save X-reg
000F75  2  20 1C 10     	jsr scadd 		; get screen address in scraddr.
000F78  2               
000F78  2  A5 rr        	lda dispx 		; x position.
000F7A  2  29 07        	and #7 			; position straddling cells.
000F7C  2  85 rr        	sta z80_b		; store in b register.
000F7E  2               
000F7E  2  A5 rr        	lda z80_l		; store sprite graphic address.
000F80  2  8D 91 0F     	sta sprit1+1
000F83  2  8D 97 0F     	sta sprit2+1
000F86  2  A5 rr        	lda z80_h
000F88  2  8D 92 0F     	sta sprit1+2
000F8B  2  8D 98 0F     	sta sprit2+2
000F8E  2               .if 0
000F8E  2               	lda spriteink
000F8E  2               ;	and #7
000F8E  2               	asl a
000F8E  2               	tax
000F8E  2               	lda ink_to_mode1,x
000F8E  2               	sta colour_byte
000F8E  2               	lda ink_to_mode1 + 1,x
000F8E  2               	sta colour_xor
000F8E  2               .endif
000F8E  2  A2 00        	ldx #0				; pixel height.
000F90  2               sprit1:
000F90  2  BD D6 B2     	lda objdta + data_address - data_start,x		; fetch first byte.
000F93  2  85 rr        	sta spr
000F95  2  E8           	inx
000F96  2               sprit2:
000F96  2  BD D6 B2     	lda objdta + data_address - data_start,x
000F99  2  85 rr        	sta spr+1
000F9B  2               
000F9B  2  A9 00        	lda #0
000F9D  2  85 rr        	sta spr+2
000F9F  2  20 3B 20     	jsr sprit7			; shift sprite
000FA2  2               
000FA2  2  A5 rr        	lda spr				; fetch graphic.
000FA4  2  4A           	lsr a				; top nibble
000FA5  2  4A           	lsr a
000FA6  2  4A           	lsr a
000FA7  2  4A           	lsr a
000FA8  2  A8           	tay
000FA9  2  B9 E0 13     	lda pixels_to_mode1,y
000FAC  2  25 rr        	and colour_byte
000FAE  2               
000FAE  2  A0 00        	ldy #0				; _BEEB
000FB0  2  51 rr        	eor (scraddr),y		; merge with screen image.
000FB2  2  91 rr        	sta (scraddr),y		; write to screen.
000FB4  2               
000FB4  2  A5 rr        	lda spr				; fetch graphic.
000FB6  2  29 0F        	and #$0f
000FB8  2  A8           	tay
000FB9  2  B9 E0 13     	lda pixels_to_mode1,y
000FBC  2  25 rr        	and colour_byte
000FBE  2               
000FBE  2  A0 08        	ldy #8				; _BEEB
000FC0  2  51 rr        	eor (scraddr),y		; merge with screen image.
000FC2  2  91 rr        	sta (scraddr),y		; write to screen.
000FC4  2               
000FC4  2  A5 rr        	lda spr+1			; fetch graphic.
000FC6  2  4A           	lsr a				; top nibble
000FC7  2  4A           	lsr a
000FC8  2  4A           	lsr a
000FC9  2  4A           	lsr a
000FCA  2  A8           	tay
000FCB  2  B9 E0 13     	lda pixels_to_mode1,y
000FCE  2  25 rr        	and colour_byte
000FD0  2               
000FD0  2  A0 10        	ldy #16				; _BEEB
000FD2  2  51 rr        	eor (scraddr),y		; merge with screen image.
000FD4  2  91 rr        	sta (scraddr),y		; write to screen.
000FD6  2               
000FD6  2  A5 rr        	lda spr+1			; fetch graphic.
000FD8  2  29 0F        	and #$0f
000FDA  2  A8           	tay
000FDB  2  B9 E0 13     	lda pixels_to_mode1,y
000FDE  2  25 rr        	and colour_byte
000FE0  2  A0 18        	ldy #24				; _BEEB
000FE2  2  51 rr        	eor (scraddr),y		; merge with screen image.
000FE4  2  91 rr        	sta (scraddr),y		; write to screen.
000FE6  2               
000FE6  2  A5 rr        	lda spr+2			; fetch graphic.
000FE8  2  4A           	lsr a				; top nibble
000FE9  2  4A           	lsr a
000FEA  2  4A           	lsr a
000FEB  2  4A           	lsr a
000FEC  2  A8           	tay
000FED  2  B9 E0 13     	lda pixels_to_mode1,y
000FF0  2  25 rr        	and colour_byte
000FF2  2               
000FF2  2  A0 20        	ldy #32				; _BEEB
000FF4  2  51 rr        	eor (scraddr),y		; merge with screen image.
000FF6  2  91 rr        	sta (scraddr),y		; write to screen.
000FF8  2               
000FF8  2  A5 rr        	lda spr+2			; fetch graphic.
000FFA  2  29 0F        	and #$0f
000FFC  2  A8           	tay
000FFD  2  B9 E0 13     	lda pixels_to_mode1,y
001000  2  25 rr        	and colour_byte
001002  2  A0 28        	ldy #40				; _BEEB
001004  2  51 rr        	eor (scraddr),y		; merge with screen image.
001006  2  91 rr        	sta (scraddr),y		; write to screen.
001008  2               
001008  2  20 5F 11     	jsr nline
00100B  2               
00100B  2  A5 rr        	lda colour_byte
00100D  2  45 rr        	eor colour_xor
00100F  2  85 rr        	sta colour_byte		; toggle colour mask each line
001011  2               
001011  2  E8           	inx					; next source byte.
001012  2  E0 20        	cpx #32
001014  2  B0 03        	bcs :+				; repeat
001016  2  4C 90 0F     	jmp sprit1
001019  2               :
001019  2  A6 rr        	ldx xtmp			; retreive X-reg
00101B  2  60           	rts
00101C  2               
00101C  2               ;------------------------------------------------------------------
00101C  2               ; This routine returns a screen address for (dispx, dispy) in scraddr.
00101C  2               ;------------------------------------------------------------------
00101C  2               
00101C  2               scadd:
00101C  2  A6 rr        	ldx dispy
00101E  2               
00101E  2  A9 00        	lda #0
001020  2  85 rr        	sta scraddr+1
001022  2               
001022  2  A5 rr        	lda dispx		; x*2
001024  2  29 F8        	and #$f8
001026  2  0A           	asl a
001027  2  26 rr        	rol scraddr+1
001029  2               
001029  2  18           	clc
00102A  2  7D 00 06     	adc SCADTB_lb,x
00102D  2  85 rr        	sta scraddr
00102F  2  BD 00 07     	lda SCADTB_hb,x
001032  2  65 rr        	adc scraddr+1
001034  2  85 rr        	sta scraddr+1
001036  2  60           	rts
001037  2               
001037  2               ;-----------------------------------------------------------------
001037  2               ; These are the sprite routines.
001037  2               ; sspria = single sprite, old (ix).
001037  2               ; ssprib = single sprite, new (ix+5).
001037  2               ; sspric = both sprites, old (ix) and new (ix+5).
001037  2               ;-----------------------------------------------------------------
001037  2               
001037  2               sspria:
001037  2  20 EF 26     	jsr gsprad		; get old sprite address.
00103A  2               sspri2:
00103A  2               
00103A  2  A5 rr        	lda z80_e				; 3c
00103C  2  8D D2 10     	sta dline_spraddr1+1	; 4c
00103F  2  8D 05 11     	sta dline_spraddr2+1	; 4c
001042  2               
001042  2  A5 rr        	lda z80_d				; 3c
001044  2  8D D3 10     	sta dline_spraddr1+2	; 4c
001047  2  8D 06 11     	sta dline_spraddr2+2	; 4c
00104A  2               
00104A  2  A6 rr        	ldx sprshft
00104C  2  BD C9 10     	lda shift_table,x
00104F  2  8D D5 10     	sta dline_shift1+1
001052  2  8D 08 11     	sta dline_shift2+1
001055  2  BD CA 10     	lda shift_table+1,x
001058  2  8D D6 10     	sta dline_shift1+2
00105B  2  8D 09 11     	sta dline_shift2+2
00105E  2               
00105E  2               .if 0
00105E  2               	lda spriteink
00105E  2               ;	and #7
00105E  2               	asl a
00105E  2               	tax
00105E  2               	lda ink_to_mode1,x
00105E  2               	sta colour_byte
00105E  2               	lda ink_to_mode1 + 1,x
00105E  2               	sta colour_xor
00105E  2               .endif
00105E  2               
00105E  2  A2 00        	ldx #0			; vertical lines.
001060  2               sspri0:
001060  2  20 D1 10     	jsr dline		; draw a line.
001063  2  E0 20        	cpx #32
001065  2  D0 F9        	bne sspri0		; repeat 16 times x 2 bytes
001067  2  60           	rts
001068  2               
001068  2               ;-----------------------------------------------------------------
001068  2               
001068  2               ssprib:
001068  2  20 D0 26     	jsr gspran 		; get new sprite address.
00106B  2  4C 3A 10     	jmp sspri2
00106E  2               
00106E  2               ;-----------------------------------------------------------------
00106E  2               
00106E  2               sspric:
00106E  2  20 EF 26     	jsr gsprad 		; get old sprite address.
001071  2               
001071  2  A5 rr        	lda z80_e				; 3c
001073  2  8D 1A 12     	sta ddline_spraddr3+1	; 4c
001076  2  8D 4D 12     	sta ddline_spraddr4+1	; 4c
001079  2               
001079  2  A5 rr        	lda z80_d				; 3c
00107B  2  8D 1B 12     	sta ddline_spraddr3+2	; 4c
00107E  2  8D 4E 12     	sta ddline_spraddr4+2	; 4c
001081  2               
001081  2  A6 rr        	ldx sprshft
001083  2  BD C9 10     	lda shift_table,x
001086  2  8D 1D 12     	sta ddline_shift3+1
001089  2  8D 50 12     	sta ddline_shift4+1
00108C  2  BD CA 10     	lda shift_table+1,x
00108F  2  8D 1E 12     	sta ddline_shift3+2
001092  2  8D 51 12     	sta ddline_shift4+2
001095  2               
001095  2               .if 0
001095  2               	lda spriteink
001095  2               ;	and #7
001095  2               	asl a
001095  2               	tax
001095  2               	lda ink_to_mode1,x
001095  2               	sta colour_byte
001095  2               	lda ink_to_mode1 + 1,x
001095  2               	sta colour_xor
001095  2               .endif
001095  2               
001095  2  20 39 0E     	jsr exx  		; store addresses.
001098  2  20 D0 26     	jsr gspran 		; get new sprite addresses.
00109B  2               
00109B  2  A5 rr        	lda z80_e				; 3c
00109D  2  8D 79 11     	sta ddline_spraddr1+1	; 4c
0010A0  2  8D AC 11     	sta ddline_spraddr2+1	; 4c
0010A3  2               
0010A3  2  A5 rr        	lda z80_d				; 3c
0010A5  2  8D 7A 11     	sta ddline_spraddr1+2	; 4c
0010A8  2  8D AD 11     	sta ddline_spraddr2+2	; 4c
0010AB  2               
0010AB  2  A6 rr        	ldx sprshft
0010AD  2  BD C9 10     	lda shift_table,x
0010B0  2  8D 7C 11     	sta ddline_shift1+1
0010B3  2  8D AF 11     	sta ddline_shift2+1
0010B6  2  BD CA 10     	lda shift_table+1,x
0010B9  2  8D 7D 11     	sta ddline_shift1+2
0010BC  2  8D B0 11     	sta ddline_shift2+2
0010BF  2               
0010BF  2  A2 00        	ldx #0
0010C1  2               lloop:
0010C1  2  20 78 11     	jsr ddline 		; draw a line.
0010C4  2  E0 20        	cpx #32
0010C6  2  D0 F9        	bne lloop
0010C8  2  60           	rts
0010C9  2               
0010C9  2               shift_table:
0010C9  2  00 14        .word shift0
0010CB  2  00 15        .word shift2
0010CD  2  00 16        .word shift4
0010CF  2  00 17        .word shift6
0010D1  2               
0010D1  2               ;-------------------------------------------------------------
0010D1  2               ; Drop through.
0010D1  2               ; Line drawn, now work out next target address.
0010D1  2               ;
0010D1  2               ; Input:
0010D1  2               ;  B  = right mask
0010D1  2               ;  C  = left mask
0010D1  2               ;  DE = spriteaddress
0010D1  2               ;  scraddr = screen address
0010D1  2               ;-------------------------------------------------------------
0010D1  2               
0010D1  2               dline:
0010D1  2               
0010D1  2               ; first screen byte
0010D1  2               
0010D1  2               dline_spraddr1:
0010D1  2  BC FF FF     	ldy $ffff,x 		; graphic data.
0010D4  2               dline_shift1:
0010D4  2  B9 FF FF     	lda $ffff,y
0010D7  2  85 rr        	sta sprtmp
0010D9  2  25 rr        	and z80_c 			; mask away what's not needed.
0010DB  2               
0010DB  2  4A           	lsr a				; top nibble
0010DC  2  4A           	lsr a
0010DD  2  4A           	lsr a
0010DE  2  4A           	lsr a
0010DF  2  A8           	tay
0010E0  2  B9 E0 13     	lda pixels_to_mode1,y
0010E3  2  25 rr        	and colour_byte
0010E5  2               
0010E5  2  A0 00        	ldy #0
0010E7  2  51 rr        	eor (scraddr),y 	; XOR with what's there.
0010E9  2  91 rr        	sta (scraddr),y 	; bung it in.
0010EB  2               
0010EB  2  A5 rr        	lda sprtmp			; fetch data.
0010ED  2  25 rr        	and z80_c 			; mask away what's not needed.
0010EF  2  29 0F        	and #$f				; bottom nibble
0010F1  2  A8           	tay
0010F2  2  B9 E0 13     	lda pixels_to_mode1,y
0010F5  2  25 rr        	and colour_byte
0010F7  2  A0 08        	ldy #8
0010F9  2  51 rr        	eor (scraddr),y 	; XOR with what's there.
0010FB  2  91 rr        	sta (scraddr),y 	; bung it in.
0010FD  2               
0010FD  2               ; carry to next screen byte
0010FD  2               
0010FD  2  A5 rr        	lda sprtmp			; fetch data.
0010FF  2  25 rr        	and z80_b 			; mask away unwanted
001101  2  85 rr        	sta sprtmp
001103  2               
001103  2               ; middle screen byte
001103  2               
001103  2  E8           	inx
001104  2               dline_spraddr2:
001104  2  BC FF FF     	ldy $ffff,x 		; second bit of data.
001107  2               dline_shift2:
001107  2  B9 FF FF     	lda $ffff,y
00110A  2  85 rr        	sta sprtmp2
00110C  2  25 rr        	and z80_c 			; mask away what's not needed.
00110E  2  05 rr        	ora sprtmp
001110  2  85 rr        	sta sprtmp
001112  2               
001112  2  4A           	lsr a				; top nibble
001113  2  4A           	lsr a
001114  2  4A           	lsr a
001115  2  4A           	lsr a
001116  2  A8           	tay
001117  2  B9 E0 13     	lda pixels_to_mode1,y
00111A  2  25 rr        	and colour_byte
00111C  2               
00111C  2  A0 10        	ldy #16
00111E  2  51 rr        	eor (scraddr),y 	; XOR with what's there.
001120  2  91 rr        	sta (scraddr),y 	; bung it in.
001122  2               
001122  2  A5 rr        	lda sprtmp			; fetch data.
001124  2  29 0F        	and #$f				; bottom nibble
001126  2  A8           	tay
001127  2  B9 E0 13     	lda pixels_to_mode1,y
00112A  2  25 rr        	and colour_byte
00112C  2  A0 18        	ldy #24
00112E  2  51 rr        	eor (scraddr),y 	; XOR with what's there.
001130  2  91 rr        	sta (scraddr),y 	; bung it in.
001132  2               
001132  2               ; carry to last screen byte
001132  2               
001132  2  A5 rr        	lda sprtmp2
001134  2  25 rr        	and z80_b 			; mask away unwanted
001136  2               
001136  2  4A           	lsr a				; top nibble
001137  2  4A           	lsr a
001138  2  4A           	lsr a
001139  2  4A           	lsr a
00113A  2  A8           	tay
00113B  2  B9 E0 13     	lda pixels_to_mode1,y
00113E  2  25 rr        	and colour_byte
001140  2               
001140  2  A0 20        	ldy #32
001142  2  51 rr        	eor (scraddr),y 	; XOR with what's there.
001144  2  91 rr        	sta (scraddr),y 	; bung it in.
001146  2               
001146  2  A5 rr        	lda sprtmp2
001148  2  25 rr        	and z80_b 			; mask away unwanted
00114A  2  29 0F        	and #$f				; bottom nibble
00114C  2  A8           	tay
00114D  2  B9 E0 13     	lda pixels_to_mode1,y
001150  2  25 rr        	and colour_byte
001152  2  A0 28        	ldy #40
001154  2  51 rr        	eor (scraddr),y 	; XOR with what's there.
001156  2  91 rr        	sta (scraddr),y 	; bung it in.
001158  2               
001158  2  A5 rr        	lda colour_byte
00115A  2  45 rr        	eor colour_xor
00115C  2  85 rr        	sta colour_byte
00115E  2               
00115E  2  E8           	inx
00115F  2               
00115F  2               ;----------------------------------------------------------------------
00115F  2               ; Line drawn, now work out next target address.
00115F  2               ;----------------------------------------------------------------------
00115F  2               
00115F  2               ; _BEEB screen arrangement
00115F  2               
00115F  2               nline:
00115F  2  A5 rr        	lda scraddr 		; get low byte of address.
001161  2  29 07        	and #7
001163  2  C9 07        	cmp #7				; is this last line of row?
001165  2  F0 03        	beq beeb_next_row
001167  2               
001167  2               	; within same row
001167  2  E6 rr        	inc scraddr			; new low byte of address.
001169  2               ;	bne :+
001169  2               ;	inc scraddr+1		; new high byte of address.
001169  2               :
001169  2  60           	rts
00116A  2               
00116A  2               beeb_next_row:
00116A  2  18           	clc
00116B  2  A5 rr        	lda scraddr
00116D  2  69 F9        	adc #<(ScreenRowBytes-7)
00116F  2  85 rr        	sta scraddr			; new low byte of address.
001171  2  A5 rr        	lda scraddr+1
001173  2  69 01        	adc #>(ScreenRowBytes-7)
001175  2  85 rr        	sta scraddr+1		; new high byte of address.
001177  2  60           	rts
001178  2               
001178  2               ;-------------------------------------------------------------
001178  2               ; Drop through.
001178  2               ; Line drawn, now work out next target address.
001178  2               ;
001178  2               ; Input:
001178  2               ;  B  = right mask
001178  2               ;  C  = left mask
001178  2               ;  DE = spriteaddress
001178  2               ;  scraddr = screen address
001178  2               ;-------------------------------------------------------------
001178  2               
001178  2               ddline:
001178  2               
001178  2               ; NEW SPRITE
001178  2               
001178  2               ; first screen byte
001178  2               
001178  2               ddline_spraddr1:
001178  2  BC FF FF     	ldy $ffff,x 		; graphic data.
00117B  2               ddline_shift1:
00117B  2  B9 FF FF     	lda $ffff,y
00117E  2  85 rr        	sta sprtmp
001180  2  25 rr        	and z80_c 			; mask away what's not needed.
001182  2               
001182  2  4A           	lsr a				; top nibble
001183  2  4A           	lsr a
001184  2  4A           	lsr a
001185  2  4A           	lsr a
001186  2  A8           	tay
001187  2  B9 E0 13     	lda pixels_to_mode1,y
00118A  2  25 rr        	and colour_byte
00118C  2               
00118C  2  A0 00        	ldy #0
00118E  2  51 rr        	eor (scraddr),y 	; XOR with what's there.
001190  2  91 rr        	sta (scraddr),y 	; bung it in.
001192  2               
001192  2  A5 rr        	lda sprtmp
001194  2  25 rr        	and z80_c 			; mask away what's not needed.
001196  2  29 0F        	and #$f				; bottom nibble
001198  2  A8           	tay
001199  2  B9 E0 13     	lda pixels_to_mode1,y
00119C  2  25 rr        	and colour_byte
00119E  2  A0 08        	ldy #8
0011A0  2  51 rr        	eor (scraddr),y 	; XOR with what's there.
0011A2  2  91 rr        	sta (scraddr),y 	; bung it in.
0011A4  2               
0011A4  2               ; carry to next screen byte
0011A4  2               
0011A4  2  A5 rr        	lda sprtmp			; fetch data.
0011A6  2  25 rr        	and z80_b 			; mask away unwanted
0011A8  2  85 rr        	sta sprtmp
0011AA  2               
0011AA  2               ; middle screen byte
0011AA  2               
0011AA  2  E8           	inx
0011AB  2               ddline_spraddr2:
0011AB  2  BC FF FF     	ldy $ffff,x 		; second bit of data.
0011AE  2               ddline_shift2:
0011AE  2  B9 FF FF     	lda $ffff,y
0011B1  2  85 rr        	sta sprtmp2
0011B3  2  25 rr        	and z80_c 			; mask away what's not needed.
0011B5  2  05 rr        	ora sprtmp
0011B7  2  85 rr        	sta sprtmp
0011B9  2               
0011B9  2  4A           	lsr a				; top nibble
0011BA  2  4A           	lsr a
0011BB  2  4A           	lsr a
0011BC  2  4A           	lsr a
0011BD  2  A8           	tay
0011BE  2  B9 E0 13     	lda pixels_to_mode1,y
0011C1  2  25 rr        	and colour_byte
0011C3  2               
0011C3  2  A0 10        	ldy #16
0011C5  2  51 rr        	eor (scraddr),y 	; XOR with what's there.
0011C7  2  91 rr        	sta (scraddr),y 	; bung it in.
0011C9  2               
0011C9  2  A5 rr        	lda sprtmp
0011CB  2  29 0F        	and #$f				; bottom nibble
0011CD  2  A8           	tay
0011CE  2  B9 E0 13     	lda pixels_to_mode1,y
0011D1  2  25 rr        	and colour_byte
0011D3  2  A0 18        	ldy #24
0011D5  2  51 rr        	eor (scraddr),y 	; XOR with what's there.
0011D7  2  91 rr        	sta (scraddr),y 	; bung it in.
0011D9  2               
0011D9  2               ; carry to last screen byte
0011D9  2               
0011D9  2  A5 rr        	lda sprtmp2
0011DB  2  25 rr        	and z80_b 			; mask away unwanted
0011DD  2               
0011DD  2  4A           	lsr a				; top nibble
0011DE  2  4A           	lsr a
0011DF  2  4A           	lsr a
0011E0  2  4A           	lsr a
0011E1  2  A8           	tay
0011E2  2  B9 E0 13     	lda pixels_to_mode1,y
0011E5  2  25 rr        	and colour_byte
0011E7  2               
0011E7  2  A0 20        	ldy #32
0011E9  2  51 rr        	eor (scraddr),y 	; XOR with what's there.
0011EB  2  91 rr        	sta (scraddr),y 	; bung it in.
0011ED  2               
0011ED  2  A5 rr        	lda sprtmp2
0011EF  2  25 rr        	and z80_b 			; mask away unwanted
0011F1  2  29 0F        	and #$f				; bottom nibble
0011F3  2  A8           	tay
0011F4  2  B9 E0 13     	lda pixels_to_mode1,y
0011F7  2  25 rr        	and colour_byte
0011F9  2  A0 28        	ldy #40
0011FB  2  51 rr        	eor (scraddr),y 	; XOR with what's there.
0011FD  2  91 rr        	sta (scraddr),y 	; bung it in.
0011FF  2               
0011FF  2               ; _BEEB next row
0011FF  2               
0011FF  2  A5 rr        	lda scraddr 		; get low byte of address.
001201  2  29 07        	and #7
001203  2  C9 07        	cmp #7				; is this last line of row?
001205  2  F0 04        	beq :+
001207  2               
001207  2               	; within same row can't increment page
001207  2  E6 rr        	inc scraddr			; new low byte of address.
001209  2  D0 0D        	bne ddline2
00120B  2               
00120B  2               :
00120B  2  18           	clc
00120C  2  A5 rr        	lda scraddr
00120E  2  69 F9        	adc #<(ScreenRowBytes-7)
001210  2  85 rr        	sta scraddr			; new low byte of address.
001212  2  A5 rr        	lda scraddr+1
001214  2  69 01        	adc #>(ScreenRowBytes-7)
001216  2  85 rr        	sta scraddr+1		; new high byte of address.
001218  2               
001218  2               ; OLD SPRITE
001218  2               
001218  2               ddline2:
001218  2               
001218  2               ; still first row but different data!
001218  2               
001218  2  CA           	dex
001219  2               
001219  2               ; first screen byte
001219  2               
001219  2               ddline_spraddr3:
001219  2  BC FF FF     	ldy $ffff,x			; graphic data.
00121C  2               ddline_shift3:
00121C  2  B9 FF FF     	lda $ffff,y
00121F  2  85 rr        	sta sprtmp
001221  2  25 rr        	and z80_cp 			; mask away what's not needed.
001223  2               
001223  2  4A           	lsr a				; top nibble
001224  2  4A           	lsr a
001225  2  4A           	lsr a
001226  2  4A           	lsr a
001227  2  A8           	tay
001228  2  B9 E0 13     	lda pixels_to_mode1,y
00122B  2  25 rr        	and colour_byte
00122D  2               
00122D  2  A0 00        	ldy #0
00122F  2  51 rr        	eor (z80_hlp),y 	; XOR with what's there.
001231  2  91 rr        	sta (z80_hlp),y 	; bung it in.
001233  2               
001233  2  A5 rr        	lda sprtmp
001235  2  25 rr        	and z80_cp 			; mask away what's not needed.
001237  2  29 0F        	and #$f				; bottom nibble
001239  2  A8           	tay
00123A  2  B9 E0 13     	lda pixels_to_mode1,y
00123D  2  25 rr        	and colour_byte
00123F  2  A0 08        	ldy #8
001241  2  51 rr        	eor (z80_hlp),y 	; XOR with what's there.
001243  2  91 rr        	sta (z80_hlp),y 	; bung it in.
001245  2               
001245  2               ; carry to next screen byte
001245  2               
001245  2  A5 rr        	lda sprtmp			; fetch data.
001247  2  25 rr        	and z80_bp 			; mask away unwanted
001249  2  85 rr        	sta sprtmp
00124B  2               
00124B  2               ; middle screen byte
00124B  2               
00124B  2  E8           	inx
00124C  2               ddline_spraddr4:
00124C  2  BC FF FF     	ldy $ffff,x 		; second bit of data.
00124F  2               ddline_shift4:
00124F  2  B9 FF FF     	lda $ffff,y
001252  2  85 rr        	sta sprtmp2
001254  2  25 rr        	and z80_cp 			; mask away what's not needed.
001256  2  05 rr        	ora sprtmp
001258  2  85 rr        	sta sprtmp
00125A  2               
00125A  2  4A           	lsr a				; top nibble
00125B  2  4A           	lsr a
00125C  2  4A           	lsr a
00125D  2  4A           	lsr a
00125E  2  A8           	tay
00125F  2  B9 E0 13     	lda pixels_to_mode1,y
001262  2  25 rr        	and colour_byte
001264  2               
001264  2  A0 10        	ldy #16
001266  2  51 rr        	eor (z80_hlp),y 	; XOR with what's there.
001268  2  91 rr        	sta (z80_hlp),y 	; bung it in.
00126A  2               
00126A  2  A5 rr        	lda sprtmp
00126C  2  29 0F        	and #$f				; bottom nibble
00126E  2  A8           	tay
00126F  2  B9 E0 13     	lda pixels_to_mode1,y
001272  2  25 rr        	and colour_byte
001274  2  A0 18        	ldy #24
001276  2  51 rr        	eor (z80_hlp),y 	; XOR with what's there.
001278  2  91 rr        	sta (z80_hlp),y 	; bung it in.
00127A  2               
00127A  2               ; last screen byte
00127A  2               
00127A  2  A5 rr        	lda sprtmp2			; fetch data.
00127C  2  25 rr        	and z80_bp 			; mask away unwanted
00127E  2               
00127E  2  4A           	lsr a				; top nibble
00127F  2  4A           	lsr a
001280  2  4A           	lsr a
001281  2  4A           	lsr a
001282  2  A8           	tay
001283  2  B9 E0 13     	lda pixels_to_mode1,y
001286  2  25 rr        	and colour_byte
001288  2               
001288  2  A0 20        	ldy #32
00128A  2  51 rr        	eor (z80_hlp),y 	; XOR with what's there.
00128C  2  91 rr        	sta (z80_hlp),y 	; bung it in.
00128E  2               
00128E  2  A5 rr        	lda sprtmp2			; fetch data.
001290  2  25 rr        	and z80_bp 			; mask away unwanted
001292  2  29 0F        	and #$f				; bottom nibble
001294  2  A8           	tay
001295  2  B9 E0 13     	lda pixels_to_mode1,y
001298  2  25 rr        	and colour_byte
00129A  2  A0 28        	ldy #40
00129C  2  51 rr        	eor (z80_hlp),y 	; XOR with what's there.
00129E  2  91 rr        	sta (z80_hlp),y 	; bung it in.
0012A0  2               
0012A0  2               ; next row of sprite data
0012A0  2               
0012A0  2  E8           	inx
0012A1  2               
0012A1  2  A5 rr        	lda colour_byte
0012A3  2  45 rr        	eor colour_xor
0012A5  2  85 rr        	sta colour_byte
0012A7  2               
0012A7  2               ; _BEEB screen arrangement
0012A7  2               
0012A7  2  A5 rr        	lda z80_lp 			; get low byte of address.
0012A9  2  29 07        	and #7
0012AB  2  C9 07        	cmp #7				; is this last line of row?
0012AD  2  F0 03        	beq :+
0012AF  2               
0012AF  2               	; within same row can't increment page
0012AF  2  E6 rr        	inc z80_lp			; new low byte of address.
0012B1  2  60           	rts
0012B2  2               
0012B2  2               :
0012B2  2  18           	clc
0012B3  2  A5 rr        	lda z80_lp
0012B5  2  69 F9        	adc #<(ScreenRowBytes-7)
0012B7  2  85 rr        	sta z80_lp			; new low byte of address.
0012B9  2  A5 rr        	lda z80_lp+1
0012BB  2  69 01        	adc #>(ScreenRowBytes-7)
0012BD  2  85 rr        	sta z80_lp+1		; new high byte of address.
0012BF  2  60           	rts
0012C0  2               
0012C0  2               ;----------------------------------------------------
0012C0  2               ; Display character in A at dispx,dispy.
0012C0  2               ;
0012C0  2               ; Input:
0012C0  2               ;  A 	   = character to print
0012C0  2               ;----------------------------------------------------
0012C0  2               
0012C0  2               pchar:
0012C0  2  85 rr        	sta fntaddr
0012C2  2  A9 00        	lda #0
0012C4  2  85 rr        	sta fntaddr+1
0012C6  2  06 rr        	asl fntaddr  		; multiply char by 8.
0012C8  2  26 rr        	rol fntaddr+1
0012CA  2  06 rr        	asl fntaddr
0012CC  2  26 rr        	rol fntaddr+1
0012CE  2  06 rr        	asl fntaddr
0012D0  2  26 rr        	rol fntaddr+1
0012D2  2               
0012D2  2  A5 rr        	lda fntaddr
0012D4  2  18           	clc
0012D5  2  65 rr        	adc FontPtr
0012D7  2  85 rr        	sta fntaddr		; that's the low byte.
0012D9  2  A5 rr        	lda fntaddr+1
0012DB  2  65 rr        	adc FontPtr+1
0012DD  2  85 rr        	sta fntaddr+1		; add displacement.
0012DF  2               pchark:
0012DF  2  20 0E 13     	jsr gprad		; get screen address.
0012E2  2  A0 00        	ldy #0
0012E4  2  A2 00        	ldx #0
0012E6  2               
0012E6  2               pchar0:
0012E6  2  8A           	txa
0012E7  2  A8           	tay
0012E8  2  B1 rr        	lda (fntaddr),y 	; get image byte.
0012EA  2  49 00        	eor #TxtInvert		; Invert
0012EC  2  85 rr        	sta tmp
0012EE  2               
0012EE  2  4A           	lsr a
0012EF  2  4A           	lsr a
0012F0  2  4A           	lsr a
0012F1  2  4A           	lsr a
0012F2  2  A8           	tay
0012F3  2  B9 E0 13     	lda pixels_to_mode1,y
0012F6  2  A0 00        	ldy #0
0012F8  2  91 rr        	sta (scraddr),y 	; copy to screen.
0012FA  2               
0012FA  2  A5 rr        	lda tmp
0012FC  2  29 0F        	and #$0f
0012FE  2  A8           	tay
0012FF  2  B9 E0 13     	lda pixels_to_mode1,y
001302  2  A0 08        	ldy #8
001304  2  91 rr        	sta (scraddr),y 	; copy to screen.
001306  2               
001306  2  E6 rr        	inc scraddr
001308  2               
001308  2  E8           	inx					; next screen row down.
001309  2  E0 08        	cpx #8				; number lines
00130B  2  90 D9        	bcc pchar0			; repeat.
00130D  2  60           	rts
00130E  2               
00130E  2               ;----------------------------------------------------
00130E  2               ; Get print address.
00130E  2               ;----------------------------------------------------
00130E  2               
00130E  2               gprad:
00130E  2  98           	tya
00130F  2  48           	pha
001310  2               
001310  2  A5 rr        	lda dispx 		; x coordinate.
001312  2  85 rr        	sta scraddr
001314  2  A9 00        	lda #0
001316  2  85 rr        	sta scraddr+1
001318  2  06 rr        	asl scraddr  	; multiply char by 16
00131A  2  26 rr        	rol scraddr+1
00131C  2  06 rr        	asl scraddr
00131E  2  26 rr        	rol scraddr+1
001320  2  06 rr        	asl scraddr
001322  2  26 rr        	rol scraddr+1
001324  2  06 rr        	asl scraddr
001326  2  26 rr        	rol scraddr+1
001328  2               
001328  2  A5 rr        	lda dispy		; y coordinate.
00132A  2  0A           	asl a
00132B  2  0A           	asl a
00132C  2  0A           	asl a			; multiply char by 8
00132D  2  A8           	tay
00132E  2               
00132E  2  18           	clc
00132F  2  A5 rr        	lda scraddr
001331  2  79 00 06     	adc SCADTB_lb,y
001334  2  85 rr        	sta scraddr
001336  2  A5 rr        	lda scraddr+1
001338  2  79 00 07     	adc SCADTB_hb,y
00133B  2  85 rr        	sta scraddr+1
00133D  2               
00133D  2  68           	pla
00133E  2  A8           	tay
00133F  2  60           	rts
001340  2               
001340  2               ;--------------------------------------------------------------
001340  2               ; Get property buffer address of char at (dispx, dispy) in hl.
001340  2               ;
001340  2               ; Output:
001340  2               ;  bufaddr = MAP + dispy*32 + dispx
001340  2               ;--------------------------------------------------------------
001340  2               
001340  2               pradd:
001340  2  A5 rr        	lda dispy 		; y coordinate.
001342  2  85 rr        	sta bufaddr
001344  2  A9 00        	lda #0
001346  2  85 rr        	sta bufaddr+1
001348  2  06 rr        	asl bufaddr  		; multiply char by 32
00134A  2  26 rr        	rol bufaddr+1
00134C  2  06 rr        	asl bufaddr
00134E  2  26 rr        	rol bufaddr+1
001350  2  06 rr        	asl bufaddr
001352  2  26 rr        	rol bufaddr+1
001354  2  06 rr        	asl bufaddr
001356  2  26 rr        	rol bufaddr+1
001358  2  06 rr        	asl bufaddr
00135A  2  26 rr        	rol bufaddr+1
00135C  2  18           	clc			; add address of MAP graphics.
00135D  2  A5 rr        	lda bufaddr
00135F  2  65 rr        	adc dispx
001361  2  69 00        	adc #<MAP
001363  2  85 rr        	sta bufaddr
001365  2  A5 rr        	lda bufaddr+1
001367  2  69 03        	adc #>MAP
001369  2  85 rr        	sta bufaddr+1
00136B  2  60           	rts
00136C  2               
00136C  2               ;----------------------------------------------
00136C  2               ; Print attributes, properties and pixels.
00136C  2               ;
00136C  2               ; Input:
00136C  2               ;  A	= tile number
00136C  2               ;----------------------------------------------
00136C  2               
00136C  2               pattr:
00136C  2               ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
00136C  2               .if aflag
00136C  2               	pha
00136C  2               	jsr wbloc		; save blockinfo
00136C  2               	pla
00136C  2               .endif
00136C  2               ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
00136C  2               
00136C  2               pattr2:
00136C  2  85 rr        	sta z80_b		; store cell in b register for now.
00136E  2  AA           	tax
00136F  2  BD 1E 89     	lda bprop + data_address - data_start,x 		; block properties.
001372  2  85 rr        	sta z80_c
001374  2  C9 08        	cmp #COLECT
001376  2  D0 04        	bne :+
001378  2  A5 rr        	lda z80_b
00137A  2  85 rr        	sta colpatt
00137C  2               :
00137C  2  20 40 13     	jsr pradd 		; get property buffer address.
00137F  2  A5 rr        	lda z80_c
001381  2  A0 00        	ldy #0
001383  2  91 rr        	sta (bufaddr),y 	; write property.
001385  2  A5 rr        	lda z80_b 		; restore cell.
001387  2               
001387  2               ; Print attributes, no properties.
001387  2               
001387  2               panp:
001387  2  85 rr        	sta z80_e		; displacement in e.
001389  2  A9 00        	lda #0
00138B  2  85 rr        	sta z80_d		; no high byte.
00138D  2  06 rr        	asl z80_e  		; multiply char by 16.
00138F  2  26 rr        	rol z80_d
001391  2  06 rr        	asl z80_e
001393  2  26 rr        	rol z80_d
001395  2  06 rr        	asl z80_e
001397  2  26 rr        	rol z80_d
001399  2  06 rr        	asl z80_e
00139B  2  26 rr        	rol z80_d
00139D  2  18           	clc
00139E  2  A5 rr        	lda z80_e
0013A0  2  69 2E        	adc #<(chgfx + data_address - data_start) 		; address of graphics.
0013A2  2  85 rr        	sta tileaddr
0013A4  2  A5 rr        	lda z80_d
0013A6  2  69 84        	adc #>(chgfx + data_address - data_start)
0013A8  2  85 rr        	sta tileaddr+1
0013AA  2               
0013AA  2  20 0E 13     	jsr gprad 		; get screen address.
0013AD  2  A2 00        	ldx #0			; number of pixel rows to write.
0013AF  2               
0013AF  2               panp0:
0013AF  2  8A           	txa
0013B0  2  A8           	tay
0013B1  2  B1 rr        	lda (tileaddr),y 	; get image byte.
0013B3  2  49 00        	eor #TxtInvert		; Invert
0013B5  2  A0 00        	ldy #0
0013B7  2  91 rr        	sta (scraddr),y 	; copy to screen.
0013B9  2               
0013B9  2  E8           	inx
0013BA  2  8A           	txa
0013BB  2  A8           	tay
0013BC  2  B1 rr        	lda (tileaddr),y 	; get image byte.
0013BE  2  49 00        	eor #TxtInvert		; Invert
0013C0  2  A0 08        	ldy #8
0013C2  2  91 rr        	sta (scraddr),y 	; copy to screen.
0013C4  2               
0013C4  2  E6 rr        	inc scraddr			; within char
0013C6  2  E8           	inx	 		; repeat for 8 pixel rows.
0013C7  2  E0 10        	cpx #16
0013C9  2  90 E4        	bcc panp0
0013CB  2  E6 rr        	inc dispx 		; move along one.
0013CD  2  E6 rr        	inc charx
0013CF  2  60           	rts
0013D0  2               
0013D0  2               ;----------------------------------------------------
0013D0  2               ; MODE 1 Colour Lookups
0013D0  2               ;----------------------------------------------------
0013D0  2               
0013D0  2               ink_to_mode1:
0013D0  2  00 00        	.byte $00, $00 ^ $00 ; solid 0
0013D2  2  0F 00        	.byte $0f, $0f ^ $0f ; solid 1
0013D4  2  F0 00        	.byte $f0, $f0 ^ $f0 ; solid 2
0013D6  2  5A FF        	.byte $5a, $a5 ^ $5a ; stipple 1,2
0013D8  2  DA 7D        	.byte $da, $a7 ^ $da ; stripple 1,2,3
0013DA  2  5F F0        	.byte $5f, $af ^ $5f ; stipple 1,3
0013DC  2  F5 0F        	.byte $f5, $fa ^ $f5 ; stipple 2,3
0013DE  2  FF 00        	.byte $ff, $ff ^ $ff ; solid 3
0013E0  2               
0013E0  2               pixels_to_mode1:
0013E0  2  00 11 22 33  	.byte $00,$11,$22,$33,$44,$55,$66,$77
0013E4  2  44 55 66 77  
0013E8  2  88 99 AA BB  	.byte $88,$99,$aa,$bb,$cc,$dd,$ee,$ff
0013EC  2  CC DD EE FF  
0013F0  2               
0013F0  2               ;----------------------------------------------------
0013F0  2               ; Shift tables
0013F0  2               ;----------------------------------------------------
0013F0  2               
0013F0  2               .if 1
0013F0  2  xx xx xx xx  .align 256
0013F4  2  xx xx xx xx  
0013F8  2  xx xx xx xx  
001400  2               shift0:
001400  2  00 01 02 03  .repeat 256, i
001404  2  04 05 06 07  
001408  2  08 09 0A 0B  
001500  2               	.byte i
001500  2               .endrep
001500  2               
001500  2               shift2:
001500  2  00 40 80 C0  .repeat 256, i
001504  2  01 41 81 C1  
001508  2  02 42 82 C2  
001600  2               	.byte (i >> 2) | (i << 6) & $c0
001600  2               .endrep
001600  2               
001600  2               shift4:
001600  2  00 10 20 30  .repeat 256, i
001604  2  40 50 60 70  
001608  2  80 90 A0 B0  
001700  2               	.byte (i >> 4) | ((i << 4) & $f0)
001700  2               .endrep
001700  2               
001700  2               shift6:
001700  2  00 04 08 0C  .repeat 256, i
001704  2  10 14 18 1C  
001708  2  20 24 28 2C  
001800  2               	.byte (i >> 6) | ((i << 2) & $fc)
001800  2               .endrep
001800  2               .align 1
001800  2               .endif
001800  2               
001800  1               
001800  1               ;----------------------------------------------------------------------
001800  1               ; AGD 6502 ENGINE CODE + COMPILED GAME SCRIPT
001800  1               ;----------------------------------------------------------------------
001800  1               
001800  1               start_game:
001800  1               
001800  1               	.include "game.inc"
001800  2               .include "foggy.inc"
001800  3               ; Game engine code --------------------------------------------------------------
001800  3               
001800  3               ; Arcade Game Designer.
001800  3               ; (C) 2008 Jonathan Cauldwell.
001800  3               ; ZX Spectrum Next Engine v0.1.
001800  3               
001800  3               ; Global definitions ------------------------------------------------------------
001800  3               
001800  3               	FONT = font + data_address - data_start			; Font address
001800  3               
001800  3               ; Block characteristics.
001800  3               
001800  3               	PLATFM = 1			; platform.
001800  3               	WALL = PLATFM + 1	; solid wall.
001800  3               	LADDER = WALL + 1	; ladder.
001800  3               	FODDER = LADDER + 1	; fodder block.
001800  3               	DEADLY = FODDER + 1	; deadly block.
001800  3               	CUSTOM = DEADLY + 1	; custom block.
001800  3               	WATER  = CUSTOM + 1	; water block.
001800  3                   COLECT = WATER + 1      ; collectable block.
001800  3                   NUMTYP = COLECT + 1     ; number of types.
001800  3               
001800  3               ; Sprites.
001800  3               
001800  3               	NUMSPR = 12			; number of sprites.
001800  3               	TABSIZ = 17			; size of each entry.
001800  3               	SPRBUF = NUMSPR * TABSIZ; size of entire table.
001800  3               	NMESIZ = 4			; bytes stored in nmetab for each sprite.
001800  3               
001800  3               ; Sprite table variable offsets.
001800  3               
001800  3               	var_Type = 0		; sprite type
001800  3               	var_Image = 1		; sprite time number
001800  3               	var_Frame = 2		; sprite frame
001800  3               	var_Y = 3			; sprite y coordinate
001800  3               	var_X = 4			; sprite X coordinate
001800  3               
001800  3               	var_newType = 5		; sprite new type
001800  3               	var_newImage = 6	; sprite new image number
001800  3               	var_newFrame = 7	; sprite new frame
001800  3               	var_newY = 8		; sprite new y coordinate
001800  3               	var_newX = 9		; sprite new x coordinate
001800  3               
001800  3               	var_Direction = 10	; sprite direction
001800  3               	var_Param1 = 11		; sprite parameter 1
001800  3               	var_Param2 = 12		; sprite parameter 2
001800  3               
001800  3               	var_jumpLo = 13		; sprite jump ptr low
001800  3               	var_jumpHi = 14		; sprite jump ptr high
001800  3               	var_dataLo = 15		; sprite data ptr low
001800  3               	var_dataHi = 16		; sprite data ptr high
001800  3               
001800  3               ; Particle engine.
001800  3               
001800  3               	NUMSHR = 55			; pieces of shrapnel.
001800  3               	SHRSIZ = 6			; bytes per particle.
001800  3               
001800  3               ; Conditional compilation flags
001800  3               ; Flags are set in commandline assembly
001800  3               
001800  3               ;	mflag = 0 		; MENU + INV
001800  3               ;	pflag = 0		; Particle engine
001800  3               ;	sflag = 0		; scrollytext
001800  3               ;	fflag = 1		; Fontflag
001800  3               
001800  3               .if iflag
001800  3               	TxtInvert   = $ff	; Invert byte for character printing
001800  3               	ScrFillByte = $ff	; Screen fill byte for CLS
001800  3               .else
001800  3               	TxtInvert   = $00	; Invert byte for character printing
001800  3               	ScrFillByte = $00	; Screen fill byte for CLS
001800  3               .endif
001800  3               
001800  3               	ASCII_NEWLINE = 13
001800  3               
001800  3               ;===============================================================
001800  3               ; Game starts here
001800  3               ;===============================================================
001800  3               
001800  3               ;--------------------------------------------------------------
001800  3               ; If a font is required...
001800  3               ;--------------------------------------------------------------
001800  3               
001800  3  A9 CE        	lda #<(FONT-256)	; address of font.
001802  3  85 rr        	sta FontPtr
001804  3  A9 B4        	lda #>(FONT-256)
001806  3  85 rr        	sta FontPtr+1
001808  3               
001808  3  20 27 1B     	jsr game	 		; start the game.
00180B  3  60           	rts
00180C  3               
00180C  3               ; Don't change the order of these four.
00180C  3               ; Menu routine relies on winlft following wintop.
00180C  3               
00180C  3  00           wintop:	.byte WINDOWTOP		; top of window.
00180D  3  02           winlft:	.byte WINDOWLFT		; left edge.
00180E  3  14           winhgt:	.byte WINDOWHGT		; window height.
00180F  3  1C           winwid:	.byte WINDOWWID		; window width.
001810  3  14           numob:	.byte NUMOBJ		; number of objects in game.
001811  3               
001811  3               ; Pixel versions of wintop, winlft, winhgt, winwid.
001811  3               
001811  3  00           wntopx:	.byte (8 * WINDOWTOP)
001812  3  10           wnlftx:	.byte (8 * WINDOWLFT)
001813  3  90           wnbotx:	.byte ((WINDOWTOP * 8) + (WINDOWHGT * 8) - 16)
001814  3  DE           wnrgtx:	.byte ((WINDOWLFT * 8) + (WINDOWWID * 8) - 16)-2
001815  3               
001815  3               ; Make sure pointers are arranged in the same order as the data itself.
001815  3               
001815  3  4D 8E        frmptr:	.word frmlst + data_address - data_start         ; sprite frames.
001817  3               
001817  3               ; Assorted game routines which can go in contended memory.
001817  3               
001817  3               ;--------------------------------------------------------------
001817  3               ; Modify for inventory.
001817  3               ; called by the INV command
001817  3               ;
001817  3               ; Input:
001817  3               ;  X   = message nr with objects seperated with ,
001817  3               ;
001817  3               ; Output:
001817  3               ;  OPT = selected line nr of INV menu
001817  3               ;--------------------------------------------------------------
001817  3               
001817  3               .if mflag
001817  3               minve:
001817  3  A9 22        	lda #<(invdis)		; routine address.
001819  3  8D FB 18     	sta mod0+1		; set up menu routine.
00181C  3  8D 70 18     	sta mod2+1		; set up count routine.
00181F  3  A9 1A        	lda #>(invdis)
001821  3  8D FC 18     	sta mod0+2
001824  3  8D 71 18     	sta mod2+2
001827  3  A9 38        	lda #<(fopt)		; find option from available objects.
001829  3  8D 96 19     	sta mod1+1		; set up routine.
00182C  3  A9 1A        	lda #>(fopt)
00182E  3  8D 97 19     	sta mod1+1+1
001831  3  4C 4E 18     	jmp dbox		; do menu routine.
001834  3               
001834  3               ;--------------------------------------------------------------
001834  3               ; Modify for menu.
001834  3               ; called by the MENU command
001834  3               ;
001834  3               ; Input:
001834  3               ;  X   = message nr with menu items seperated with ,
001834  3               ;
001834  3               ; Output:
001834  3               ;  OPT = selected line nr of MENU menu
001834  3               ;--------------------------------------------------------------
001834  3               
001834  3               mmenu:
001834  3  A9 E7        	lda #<(always)		; routine address.
001836  3  8D FB 18     	sta mod0+1		; set up routine.
001839  3  8D 70 18     	sta mod2+1		; set up count routine.
00183C  3  A9 21        	lda #>(always)
00183E  3  8D FC 18     	sta mod0+2
001841  3  8D 71 18     	sta mod2+2
001844  3               
001844  3  A9 C2        	lda #<(fstd)		; standard option selection.
001846  3  8D 96 19     	sta mod1+1		; set up routine.
001849  3  A9 19        	lda #>(fstd)
00184B  3  8D 97 19     	sta mod1+2
00184E  3               
00184E  3               ; Drop through into box routine.
00184E  3               
00184E  3               ;--------------------------------------------------------------
00184E  3               ; Work out size of box for message or menu.
00184E  3               ;--------------------------------------------------------------
00184E  3               
00184E  3               dbox:
00184E  3  A9 00        	lda #<(msgdat + data_address - data_start)		; pointer to messages.
001850  3  85 rr        	sta z80_l
001852  3  A9 80        	lda #>(msgdat + data_address - data_start)
001854  3  85 rr        	sta z80_h
001856  3               
001856  3  20 FA 24     	jsr getwrd		; get message number.
001859  3               
001859  3  A5 rr        	lda z80_h		; store pointer to message.
00185B  3  85 rr        	sta TmpAddr
00185D  3  A5 rr        	lda z80_l
00185F  3  85 rr        	sta TmpAddr+1
001861  3               
001861  3  A9 01        	lda #1			; height.
001863  3  85 rr        	sta z80_d
001865  3  A9 00        	lda #0			; start at object zero.
001867  3  85 rr        	sta combyt		; store number of object in combyt.
001869  3  85 rr        	sta z80_e		; maximum width.
00186B  3               dbox5:
00186B  3  A9 00        	lda #0			; this line"s width.
00186D  3  85 rr        	sta z80_b
00186F  3               mod2:
00186F  3  20 E7 21     	jsr always		; item in player"s possession?
001872  3  C9 FF        	cmp #255
001874  3  D0 02        	bne dbox6		; not in inventory, skip this line.
001876  3  E6 rr        	inc z80_d		; add to tally.
001878  3               dbox6:
001878  3  A0 00        	ldy #0			; get character.
00187A  3  B1 rr        	lda (z80_hl),y
00187C  3  85 rr        	sta z80_a
00187E  3  E6 rr        	inc z80_l		; next character.
001880  3  D0 02        	bne :+
001882  3  E6 rr        	inc z80_h
001884  3               :
001884  3  A5 rr        	lda z80_a		; reached end of line?
001886  3  C9 2C        	cmp #','
001888  3  F0 0D        	beq dbox3		; yes.
00188A  3  C9 0D        	cmp #ASCII_NEWLINE
00188C  3  F0 09        	beq dbox3		; yes.
00188E  3  E6 rr        	inc z80_b		; add to this line"s width.
001890  3  A5 rr        	lda z80_a
001892  3  30 10        	bmi dbox4		; end of message? yes, end count.
001894  3  4C 78 18     	jmp dbox6		; repeat until we find the end.
001897  3               dbox3:
001897  3  A5 rr        	lda z80_e		; maximum line width.
001899  3  C5 rr        	cmp z80_b		; have we exceeded longest so far?
00189B  3  10 CE        	bpl dbox5		; no, carry on looking.
00189D  3  A5 rr        	lda z80_b		; make this the widest so far.
00189F  3  85 rr        	sta z80_e
0018A1  3  4C 6B 18     	jmp dbox5		; keep looking.
0018A4  3               dbox4:
0018A4  3  A5 rr        	lda z80_e		; maximum line width.
0018A6  3  C5 rr        	cmp z80_b		; have we exceeded longest so far?
0018A8  3  10 04        	bpl dbox8		; no, carry on looking.
0018AA  3  A5 rr        	lda z80_b		; final line is the longest so far.
0018AC  3  85 rr        	sta z80_e
0018AE  3               dbox8:
0018AE  3  C6 rr        	dec z80_d		; decrement items found.
0018B0  3  D0 03        	bne :+			; total was zero.
0018B2  3  4C EC 19     	jmp dbox15
0018B5  3               :
0018B5  3  A5 rr        	lda z80_e		; longest line.
0018B7  3  D0 03        	bne :+			; was it zero?
0018B9  3  4C EC 19     	jmp dbox15		; total was zero.
0018BC  3               :
0018BC  3  85 rr        	sta bwid		; set up size.
0018BE  3  A5 rr        	lda z80_d
0018C0  3  85 rr        	sta blen
0018C2  3               
0018C2  3               ;--------------------------------------------------------------
0018C2  3               ; That's set up our box size.
0018C2  3               ;--------------------------------------------------------------
0018C2  3               
0018C2  3  AD 0E 18     	lda winhgt		; window height in characters.
0018C5  3  38           	sec
0018C6  3  E5 rr        	sbc z80_d		; subtract height of box.
0018C8  3  4A           	lsr a			; divide by 2.
0018C9  3  18           	clc
0018CA  3  6D 0C 18     	adc wintop		; add top edge of window.
0018CD  3  85 rr        	sta btop		; set up box top.
0018CF  3               
0018CF  3  AD 0F 18     	lda winwid		; window width in characters.
0018D2  3  38           	sec
0018D3  3  E5 rr        	sbc z80_e		; subtract box width.
0018D5  3  4A           	lsr a			; divide by 2.
0018D6  3  18           	clc
0018D7  3  6D 0D 18     	adc winlft		; add left edge of window.
0018DA  3  85 rr        	sta blft		; box left.
0018DC  3               
0018DC  3  A5 rr        	lda FontPtr		; font.
0018DE  3  8D F5 1E     	sta grbase		; set up for text display.
0018E1  3  A5 rr        	lda FontPtr+1
0018E3  3  8D F6 1E     	sta grbase+1
0018E6  3               
0018E6  3  A5 rr        	lda TmpAddr+1		; restore message pointer.
0018E8  3  85 rr        	sta z80_l
0018EA  3  A5 rr        	lda TmpAddr
0018EC  3  85 rr        	sta z80_h
0018EE  3               
0018EE  3  A5 rr        	lda btop		; box top.
0018F0  3  85 rr        	sta dispy		; set display coordinate.
0018F2  3  A9 00        	lda #0			; start at object zero.
0018F4  3  85 rr        	sta combyt		; store number of object in combyt.
0018F6  3               dbox2:
0018F6  3  A5 rr        	lda combyt		; get object number.
0018F8  3  85 rr        	sta z80_a
0018FA  3               mod0:
0018FA  3  20 E7 21     	jsr always		; check inventory for display.
0018FD  3  C9 FF        	cmp #255
0018FF  3  F0 03        	beq :+
001901  3  4C CC 19     	jmp dbox13		; not in inventory, skip this line.
001904  3               :
001904  3  A5 rr        	lda blft		; box left.
001906  3  85 rr        	sta dispx		; set left display position.
001908  3  A5 rr        	lda bwid		; box width.
00190A  3  85 rr        	sta z80_b		; store width.
00190C  3               dbox0:
00190C  3  A0 00        	ldy #0			; get character.
00190E  3  B1 rr        	lda (z80_hl),y
001910  3  C9 2C        	cmp #','		; end of line?
001912  3  F0 50        	beq dbox1		; yes, next one.
001914  3  C9 0D        	cmp #ASCII_NEWLINE			; end of line?
001916  3  F0 4C        	beq dbox1		; yes, next one.
001918  3               
001918  3  C6 rr        	dec z80_b		; one less to display.
00191A  3  29 7F        	and #127		; remove terminator.
00191C  3               
00191C  3  20 35 20     	jsr pchr		; display on screen.
00191F  3               
00191F  3  A0 00        	ldy #0
001921  3  B1 rr        	lda (z80_hl),y		; get character.
001923  3  85 rr        	sta z80_a
001925  3  E6 rr        	inc z80_l		; next character.
001927  3  D0 02        	bne :+
001929  3  E6 rr        	inc z80_h
00192B  3               :
00192B  3  A5 rr        	lda z80_a
00192D  3  C9 80        	cmp #128		; end of message?
00192F  3  30 03        	bmi :+
001931  3  4C 72 19     	jmp dbox7		; yes, job done.
001934  3               :
001934  3  A5 rr        	lda z80_b		; chars remaining.
001936  3  F0 03        	beq :+			; are any left?
001938  3  4C 0C 19     	jmp dbox0		; yes, continue.
00193B  3               :
00193B  3               ;---------------------------------------------------
00193B  3               ; Reached limit of characters per line.
00193B  3               ;---------------------------------------------------
00193B  3               
00193B  3               dbox9:
00193B  3  A0 00        	ldy #0
00193D  3  B1 rr        	lda (z80_hl),y		; get character.
00193F  3  E6 rr        	inc z80_l		; next one.
001941  3  D0 02        	bne :+
001943  3  E6 rr        	inc z80_h
001945  3               :
001945  3  C9 2C        	cmp #','		; another line?
001947  3  F0 24        	beq dbox10		; yes, do next line.
001949  3  C9 0D        	cmp #ASCII_NEWLINE			; another line?
00194B  3  F0 20        	beq dbox10		; yes, do next line.
00194D  3  C9 80        	cmp #128		; end of message?
00194F  3  B0 03        	bcs :+
001951  3  4C 7C 19     	jmp dbox11		; yes, finish message.
001954  3               :
001954  3  4C 3B 19     	jmp dbox9
001957  3               
001957  3               ;---------------------------------------------------
001957  3               ; Fill box to end of line.
001957  3               ;---------------------------------------------------
001957  3               
001957  3               dboxf:
001957  3  A9 20        	lda #32			; space character.
001959  3  20 35 20     	jsr pchr		; display character.
00195C  3  C6 rr        	dec z80_b
00195E  3  F0 03        	beq :+
001960  3  4C 57 19     	jmp dboxf		; repeat for remaining chars on line.
001963  3               :
001963  3  60           	rts
001964  3               dbox1:
001964  3  E6 rr        	inc z80_l		; skip character.
001966  3  D0 02        	bne :+
001968  3  E6 rr        	inc z80_h
00196A  3               :
00196A  3  20 57 19     	jsr dboxf		; fill box out to right side.
00196D  3               dbox10:
00196D  3  E6 rr        	inc dispy		; y coordinate down a line next position.
00196F  3  4C F6 18     	jmp dbox2		; next line.
001972  3               dbox7:
001972  3  A5 rr        	lda z80_b		; chars remaining.
001974  3  D0 03        	bne :+			; are any left?
001976  3  4C 7C 19     	jmp dbox11		; no, nothing to draw.
001979  3               :
001979  3  20 57 19     	jsr dboxf		; fill message to line.
00197C  3               
00197C  3               ;------------------------------------------------------
00197C  3               ; Drawn the box menu, now select option.
00197C  3               ;------------------------------------------------------
00197C  3               
00197C  3               dbox11:
00197C  3  A5 rr        	lda btop		; box top.
00197E  3  85 rr        	sta dispy		; set bar position.
001980  3               dbox14:
001980  3  20 A1 23     	jsr joykey		; get controls.
001983  3  C9 7F        	cmp #$7f		; anything pressed?
001985  3  D0 F9        	bne dbox14		; yes, debounce it.
001987  3  20 F5 19     	jsr dbar		; draw bar.
00198A  3               dbox12:
00198A  3  20 A1 23     	jsr joykey		; get controls.
00198D  3  C9 7F        	cmp #$7f		; anything pressed?
00198F  3  F0 F9        	beq dbox12		; no, nothing.
001991  3  29 10        	and #16			; fire button pressed?
001993  3  D0 03        	bne :+
001995  3               mod1:
001995  3  4C C2 19     	jmp fstd		; yes, job done.
001998  3               :
001998  3  20 F5 19     	jsr dbar		; delete bar.
00199B  3               
00199B  3  A5 rr        	lda joyval		; joystick reading.
00199D  3  29 08        	and #8			; going up?
00199F  3  F0 13        	beq dboxu		; yes, go up.
0019A1  3               
0019A1  3  A6 rr        	ldx dispy		; vertical position of bar.
0019A3  3  E8           	inx			; look down.
0019A4  3  8A           	txa
0019A5  3  38           	sec
0019A6  3  E5 rr        	sbc btop		; find distance from top.
0019A8  3  C5 rr        	cmp blen		; top of box.
0019AA  3  D0 03        	bne :+
0019AC  3  4C 80 19     	jmp dbox14		; yes, go no further.
0019AF  3               :
0019AF  3  E6 rr        	inc dispy		; move bar.
0019B1  3  4C 80 19     	jmp dbox14		; continue.
0019B4  3               dboxu:
0019B4  3  A5 rr        	lda dispy		; vertical position of bar.
0019B6  3  C5 rr        	cmp btop		; are we at the top?
0019B8  3  D0 03        	bne :+
0019BA  3  4C 80 19     	jmp dbox14		; yes, go no further.
0019BD  3               :
0019BD  3  C6 rr        	dec dispy		; move bar.
0019BF  3  4C 80 19     	jmp dbox14		; continue.
0019C2  3               fstd:
0019C2  3  A5 rr        	lda dispy		; bar position.
0019C4  3  38           	sec
0019C5  3  E5 rr        	sbc btop		; find selected option.
0019C7  3  85 rr        	sta varopt		; store the option.
0019C9  3  4C A4 1A     	jmp redraw		; redraw the screen.
0019CC  3               
0019CC  3               ;------------------------------------------------------
0019CC  3               ; Option not available.  Skip this line.
0019CC  3               ;------------------------------------------------------
0019CC  3               
0019CC  3               dbox13:
0019CC  3  A0 00        	ldy #0
0019CE  3  B1 rr        	lda (z80_hl),y		; get character.
0019D0  3  E6 rr        	inc z80_l		; next one.
0019D2  3  D0 02        	bne :+
0019D4  3  E6 rr        	inc z80_h
0019D6  3               :
0019D6  3  C9 2C        	cmp #','		; another line?
0019D8  3  D0 03        	bne :+
0019DA  3  4C F6 18     	jmp dbox2		; yes, do next line.
0019DD  3               :
0019DD  3  C9 0D        	cmp #ASCII_NEWLINE			; another line?
0019DF  3  D0 03        	bne :+
0019E1  3  4C F6 18     	jmp dbox2		; yes, do next line.
0019E4  3               :
0019E4  3               
0019E4  3  10 03        	bpl :+			; end of message?
0019E6  3  4C 7C 19     	jmp dbox11		; yes, finish message.
0019E9  3               :
0019E9  3  4C CC 19     	jmp dbox13
0019EC  3               dbox15:
0019EC  3  A5 rr        	lda TmpAddr		; pop message pointer from the stack.
0019EE  3  85 rr        	sta z80_h
0019F0  3  A5 rr        	lda TmpAddr+1
0019F2  3  85 rr        	sta z80_l
0019F4  3  60           	rts
0019F5  3               
0019F5  3               ;------------------------------------------------------
0019F5  3               ; Invert bar
0019F5  3               ;------------------------------------------------------
0019F5  3               
0019F5  3               dbar:
0019F5  3  A5 rr        	lda blft		; box left.
0019F7  3  85 rr        	sta dispx		; set display coordinate.
0019F9  3  20 0E 13     	jsr gprad		; get printing address.
0019FC  3               
0019FC  3  A5 rr        	lda bwid		; box width.
0019FE  3  85 rr        	sta z80_c		; loop counter in c.
001A00  3  A5 rr        	lda z80_h
001A02  3  85 rr        	sta z80_d		; store screen address high byte.
001A04  3               dbar1:
001A04  3  A0 07        	ldy #7			; pixel height in b.
001A06  3               dbar0:
001A06  3  B1 rr        	lda (scraddr),y		; get screen byte.
001A08  3  49 FF        	eor #255		; reverse all bits.
001A0A  3  91 rr        	sta (scraddr),y		; write back to screen.
001A0C  3  88           	dey			; next line down.
001A0D  3  10 F7        	bpl dbar0		; draw rest of character.
001A0F  3               
001A0F  3  18           	clc
001A10  3  A5 rr        	lda scraddr		; one char right.
001A12  3  69 08        	adc #8
001A14  3  85 rr        	sta scraddr
001A16  3  90 02        	bcc :+
001A18  3  E6 rr        	inc scraddr+1
001A1A  3               :
001A1A  3               
001A1A  3  C6 rr        	dec z80_c		; decrement character counter.
001A1C  3  F0 03        	beq :+
001A1E  3  4C 04 1A     	jmp dbar1		; repeat for whole line.
001A21  3               :
001A21  3  60           	rts
001A22  3               
001A22  3               ;------------------------------------------------------
001A22  3               ; Point to object
001A22  3               ;
001A22  3               ; Input:
001A22  3               ;  -
001A22  3               ;
001A22  3               ; Output:
001A22  3               ;  A = object number, A=255 if already in possession
001A22  3               ;------------------------------------------------------
001A22  3               
001A22  3               invdis:
001A22  3  A5 rr        	lda z80_l		; store message text pointer.
001A24  3  48           	pha
001A25  3  A5 rr        	lda z80_h
001A27  3  48           	pha
001A28  3  A5 rr        	lda combyt		; object number.
001A2A  3  E6 rr        	inc combyt		; ready for next one.
001A2C  3  20 95 1D     	jsr gotob		; check if we have object.
001A2F  3  A8           	tay
001A30  3  68           	pla
001A31  3  85 rr        	sta z80_h
001A33  3  68           	pla
001A34  3  85 rr        	sta z80_l
001A36  3  98           	tya
001A37  3  60           	rts
001A38  3               
001A38  3               ;------------------------------------------------------
001A38  3               ; Find option selected.
001A38  3               ;
001A38  3               ; Input:
001A38  3               ;  -
001A38  3               ;
001A38  3               ; Output:
001A38  3               ;  OPT = selected object
001A38  3               ;------------------------------------------------------
001A38  3               
001A38  3               fopt:
001A38  3  A5 rr        	lda dispy
001A3A  3  38           	sec
001A3B  3  E5 rr        	sbc btop		; find selected option.
001A3D  3  85 rr        	sta tmp+2		; option selected in b register.
001A3F  3  E6 rr        	inc tmp+2
001A41  3               
001A41  3  A9 00        	lda #0			; set to first item.
001A43  3  85 rr        	sta combyt		; object number.
001A45  3               fopt0:
001A45  3  20 55 1A     	jsr fobj		; find next object in inventory.
001A48  3  C6 rr        	dec tmp+2
001A4A  3  D0 F9        	bne fopt0		; repeat for relevant steps down the list.
001A4C  3               
001A4C  3  A5 rr        	lda combyt		; get option.
001A4E  3  85 rr        	sta varopt		; store the option.
001A50  3  C6 rr        	dec varopt		; one less, due to where we increment combyt.
001A52  3  4C A4 1A     	jmp redraw		; redraw the screen.
001A55  3               fobj:
001A55  3  A4 rr        	ldy combyt		; object number.
001A57  3  E6 rr        	inc combyt		; ready for next item.
001A59  3  98           	tya
001A5A  3  20 95 1D     	jsr gotob		; do we have this item?
001A5D  3  C9 FF        	cmp #255
001A5F  3  D0 01        	bne :+
001A61  3  60           	rts
001A62  3               :
001A62  3  4C 55 1A     	jmp fobj		; yes, it's on the list.
001A65  3               .endif
001A65  3               
001A65  3               ;----------------------------------------------------
001A65  3               ; Clear sprite table.
001A65  3               ;
001A65  3               ; sprtab[0] - sprtab[SPRBUF-1] = 255
001A65  3               ;----------------------------------------------------
001A65  3               
001A65  3               xspr:
001A65  3  A9 FF        	lda #255		; clear byte.
001A67  3  A2 00        	ldx #0			; length of table.
001A69  3               xspr0:
001A69  3  9D 00 0B     	sta sprtab,x		; sprite table.
001A6C  3  E8           	inx			; move to next byte.
001A6D  3  E0 CC        	cpx #SPRBUF
001A6F  3  D0 F8        	bne xspr0		; repeat for rest of table.
001A71  3  60           	rts
001A72  3               
001A72  3               ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
001A72  3               ; Sound, NOT IMPLEMENTED!!!
001A72  3               ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
001A72  3               ;
001A72  3               ;silenc:
001A72  3               ;	jsr silen1 		; silence channel 1.
001A72  3               ;	jsr silen2 		; silence channel 2.
001A72  3               ;	jsr silen3 		; silence channel 3.
001A72  3               ;	jmp plsnd 		; play all channels to switch them off.
001A72  3               ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
001A72  3               
001A72  3               ;-------------------------------------------------------------
001A72  3               ; Initialise all objects.
001A72  3               ;
001A72  3               ; Reset current room,y,x to start room,y,x for all objects
001A72  3               ;-------------------------------------------------------------
001A72  3               
001A72  3               iniob:
001A72  3  A9 D6        	lda #<(objdta + data_address - data_start) 		; objects table.
001A74  3  85 rr        	sta z80_x
001A76  3  A9 B2        	lda #>(objdta + data_address - data_start)
001A78  3  85 rr        	sta z80_i
001A7A  3               
001A7A  3  AE 10 18     	ldx numob 		; number of objects in the game.
001A7D  3               iniob0:
001A7D  3  A0 23        	ldy #35
001A7F  3  B1 rr        	lda (z80_ix),y 		; start screen.
001A81  3  A0 20        	ldy #32
001A83  3  91 rr        	sta (z80_ix),y 		; set start screen.
001A85  3               
001A85  3  A0 24        	ldy #36
001A87  3  B1 rr        	lda (z80_ix),y 		; find start y.
001A89  3  A0 21        	ldy #33
001A8B  3  91 rr        	sta (z80_ix),y 		; set start y.
001A8D  3               
001A8D  3  A0 25        	ldy #37
001A8F  3  B1 rr        	lda (z80_ix),y 		; get initial x.
001A91  3  A0 22        	ldy #34
001A93  3  91 rr        	sta (z80_ix),y 		; set x coord.
001A95  3               
001A95  3  18           	clc 			; point to next object.
001A96  3  A5 rr        	lda z80_x
001A98  3  69 26        	adc #38			; distance between objects.
001A9A  3  85 rr        	sta z80_x
001A9C  3  90 02        	bcc :+
001A9E  3  E6 rr        	inc z80_i
001AA0  3               :
001AA0  3  CA           	dex 			; repeat.
001AA1  3  D0 DA        	bne iniob0
001AA3  3               
001AA3  3  60           	rts
001AA4  3               
001AA4  3               ;-----------------------------------------------
001AA4  3               ; Redraw the screen.
001AA4  3               ;
001AA4  3               ; Remove old copy of all sprites for redraw.
001AA4  3               ;-----------------------------------------------
001AA4  3               
001AA4  3               redraw:
001AA4  3  A5 rr        	lda z80_i 		; place sprite pointer on stack.
001AA6  3  48           	pha
001AA7  3  A5 rr        	lda z80_x
001AA9  3  48           	pha
001AAA  3               
001AAA  3  20 7F 20     	jsr droom		; show screen layout.
001AAD  3  20 19 1D     	jsr shwob		; draw objects.
001AB0  3               numsp0:
001AB0  3  A9 0C        	lda #NUMSPR		; sprites to draw.
001AB2  3  85 rr        	sta tmp
001AB4  3               
001AB4  3  A9 00        	lda #<sprtab		; sprite table.
001AB6  3  85 rr        	sta z80_x
001AB8  3  A9 0B        	lda #>sprtab
001ABA  3  85 rr        	sta z80_i
001ABC  3               redrw0:
001ABC  3  A0 00        	ldy #0
001ABE  3  B1 rr        	lda (z80_ix),y		; old sprite type.
001AC0  3  C9 FF        	cmp #255		; is it enabled?
001AC2  3  F0 0B        	beq redrw1 		; no, find next one.
001AC4  3               
001AC4  3  A0 03        	ldy #var_Y
001AC6  3  B1 rr        	lda (z80_ix),y 		; sprite y.
001AC8  3  C9 B1        	cmp #177		; beyond maximum?
001ACA  3  B0 03        	bcs redrw1		; yes, nothing to draw.
001ACC  3               
001ACC  3  20 37 10     	jsr sspria		; show single sprite.
001ACF  3               
001ACF  3               redrw1:
001ACF  3  18           	clc			; next sprite.
001AD0  3  A5 rr        	lda z80_x
001AD2  3  69 11        	adc #TABSIZ		; distance to next odd/even entry.
001AD4  3  85 rr        	sta z80_x
001AD6  3  90 02        	bcc :+
001AD8  3  E6 rr        	inc z80_i
001ADA  3               :
001ADA  3  C6 rr        	dec tmp			; repeat for remaining sprites.
001ADC  3  D0 DE        	bne redrw0
001ADE  3               
001ADE  3               rpblc1:
001ADE  3               ;	jsr dshrp		; redraw shrapnel.
001ADE  3               
001ADE  3  68           	pla			; retrieve sprite pointer.
001ADF  3  85 rr        	sta z80_x
001AE1  3  68           	pla
001AE2  3  85 rr        	sta z80_i
001AE4  3               
001AE4  3  60           	rts
001AE5  3               
001AE5  3               ;----------------------------------------------------------------------
001AE5  3               ; Clear screen routine.
001AE5  3               ;
001AE5  3               ; Fill screenmem $8000-$97ff with ScrFillByte
001AE5  3               ;----------------------------------------------------------------------
001AE5  3               
001AE5  3               cls:
001AE5  3  A9 50        	lda #>ScreenAddr		; screen address.
001AE7  3  8D F0 1A     	sta clsloop+2
001AEA  3  A9 00        	lda #ScrFillByte
001AEC  3  A0 00        	ldy #0
001AEE  3               clsloop:
001AEE  3  99 00 50     	sta ScreenAddr,y
001AF1  3  C8           	iny
001AF2  3  D0 FA        	bne clsloop
001AF4  3  EE F0 1A     	inc clsloop+2
001AF7  3  AE F0 1A     	ldx clsloop+2
001AFA  3  E0 80        	cpx #>(ScreenAddr+ScreenSize)		; _BEEB
001AFC  3  D0 F0        	bne clsloop
001AFE  3  60           	rts
001AFF  3               
001AFF  3               ;----------------------------------------------------------------------
001AFF  3               ; FODDER check
001AFF  3               ;----------------------------------------------------------------------
001AFF  3               
001AFF  3               fdchk:
001AFF  3  C9 04        	cmp #FODDER 		; is it fodder?
001B01  3  F0 01        	beq :+
001B03  3  60           	rts 			; no.
001B04  3               :
001B04  3  A9 00        	lda #0			; wipe fodder in MAP
001B06  3  A0 00        	ldy #0
001B08  3  91 rr        	sta (bufaddr),y 	; rewrite block type.
001B0A  3               
001B0A  3  A5 rr        	lda dispx		; x=x/8
001B0C  3  48           	pha
001B0D  3  4A           	lsr a
001B0E  3  4A           	lsr a
001B0F  3  4A           	lsr a
001B10  3  85 rr        	sta dispx
001B12  3               
001B12  3  A5 rr        	lda dispy		; y=y/8
001B14  3  48           	pha
001B15  3  4A           	lsr a
001B16  3  4A           	lsr a
001B17  3  4A           	lsr a
001B18  3  85 rr        	sta dispy
001B1A  3               
001B1A  3  A9 00        	lda #0 			; block to write.
001B1C  3  20 6C 13     	jsr pattr 		; write block.
001B1F  3               
001B1F  3  68           	pla
001B20  3  85 rr        	sta dispy
001B22  3  68           	pla
001B23  3  85 rr        	sta dispx
001B25  3  60           	rts
001B26  3               
001B26  3               ;----------------------------------------------------
001B26  3               ; Scrolly text and puzzle variables.
001B26  3               ;----------------------------------------------------
001B26  3               
001B26  3               .if sflag
001B26  3               txtbit:	.byte 128		; bit to write.
001B26  3               txtwid:	.byte 16		; width of ticker message.
001B26  3               txtpos:	.word (msgdat + data_address - data_start)
001B26  3               txtini:	.word (msgdat + data_address - data_start)
001B26  3               txtscr:	.word ScreenAddr
001B26  3               .endif
001B26  3               
001B26  3               ;----------------------------------------------------
001B26  3               ; Specialist routines.
001B26  3               ; Process shrapnel.
001B26  3               ;----------------------------------------------------
001B26  3               proshr:
001B26  3               .if pflag
001B26  3               	lda #<SHRAPN		; table.
001B26  3               	sta z80_x
001B26  3               	lda #>SHRAPN
001B26  3               	sta z80_i
001B26  3               
001B26  3               	lda #NUMSHR		; shrapnel pieces to process.
001B26  3               	sta shrctr
001B26  3               prosh0:
001B26  3               	ldy #0
001B26  3               	lda (z80_ix),y		; on/off marker.
001B26  3               	asl a
001B26  3               proshx:
001B26  3               	bcs :+
001B26  3               	jsr prosh1 		; on, so process it.
001B26  3               :
001B26  3               	clc
001B26  3               	lda z80_x
001B26  3               	adc #SHRSIZ
001B26  3               	sta z80_x
001B26  3               	bcc :+
001B26  3               	inc z80_i
001B26  3               :
001B26  3               	dec shrctr		; round again.
001B26  3               	bne prosh0
001B26  3               .endif
001B26  3               .if sflag
001B26  3               	jsr scrly
001B26  3               .endif
001B26  3  60           	rts
001B27  3               
001B27  3               .if pflag
001B27  3               ;----------------------------------------------------
001B27  3               ; Proces shrapnel piece
001B27  3               ;----------------------------------------------------
001B27  3               
001B27  3               prosh1:
001B27  3               	jsr plot 		; delete the pixel.
001B27  3               
001B27  3               	lda #<shrptr		; shrapnel routine pointers.
001B27  3               	sta z80_l
001B27  3               	lda #>shrptr
001B27  3               	sta z80_h
001B27  3               
001B27  3               	ldy #0
001B27  3               	lda (z80_ix),y		; restore shrapnel type.
001B27  3               	jsr prosh2 		; run the routine.
001B27  3               	jsr chkxy		; check x and y are good before we redisplay.
001B27  3               
001B27  3               	lda #<SHRSIZ 		; distance to next.
001B27  3               	sta z80_e
001B27  3               	lda #>SHRSIZ
001B27  3               	sta z80_d
001B27  3               	rts
001B27  3               
001B27  3               ;----------------------------------------------------
001B27  3               ; Run the routine
001B27  3               ;----------------------------------------------------
001B27  3               
001B27  3               prosh2:
001B27  3               	asl a 			; 2 bytes per address.
001B27  3               	tay
001B27  3               	lda shrptr,y
001B27  3               	sta z80_l
001B27  3               	lda shrptr+1,y 		; fetch high byte from table.
001B27  3               	sta z80_h
001B27  3               	jmp (z80_hl) 		; jump to routine.
001B27  3               
001B27  3               ;----------------------------------------------------
001B27  3               ; Paricle routine table
001B27  3               ;----------------------------------------------------
001B27  3               
001B27  3               shrptr:	.word laser		; laser.
001B27  3               	.word trail		; vapour trail.
001B27  3               	.word shrap		; shrapnel from explosion.
001B27  3               	.word dotl		; horizontal starfield left.
001B27  3               	.word dotr		; horizontal starfield right.
001B27  3               	.word dotu		; vertical starfield up.
001B27  3               	.word dotd		; vertical starfield down.
001B27  3               	.word ptcusr		; user particle.
001B27  3               
001B27  3               ;----------------------------------------------------
001B27  3               ; Explosion shrapnel.
001B27  3               ;----------------------------------------------------
001B27  3               
001B27  3               shrap:
001B27  3               	ldy #1
001B27  3               	lda (z80_ix),y 		; get the angle.
001B27  3               	clc
001B27  3               	adc #<shrsin		; shrapnel sine table.
001B27  3               	sta z80_l
001B27  3               	lda #>shrsin
001B27  3               	adc #0
001B27  3               	sta z80_h
001B27  3               
001B27  3               	ldy #0
001B27  3               	lda (z80_hl),y 		; fetch value from table.
001B27  3               	sta z80_e
001B27  3               	inc z80_l 		; next byte of table.
001B27  3               	bne :+
001B27  3               	inc z80_h
001B27  3               :
001B27  3               	ldy #0
001B27  3               	lda (z80_hl),y		; fetch value from table.
001B27  3               	sta z80_d
001B27  3               	inc z80_l		; next byte of table.
001B27  3               	bne :+
001B27  3               	inc z80_h
001B27  3               :
001B27  3               	ldy #0
001B27  3               	lda (z80_hl),y 		; fetch value from table.
001B27  3               	sta z80_c
001B27  3               	inc z80_l 		; next byte of table.
001B27  3               	bne :+
001B27  3               	inc z80_h
001B27  3               :
001B27  3               	ldy #0
001B27  3               	lda (z80_hl),y 		; fetch value from table.
001B27  3               	sta z80_b
001B27  3               
001B27  3               	ldy #2
001B27  3               	lda (z80_ix),y 		; x coordinate in hl.
001B27  3               	clc
001B27  3               	adc z80_e		; add sine lb
001B27  3               	sta (z80_ix),y		; store new coordinate lb.
001B27  3               	ldy #3
001B27  3               	lda (z80_ix),y
001B27  3               	adc z80_d		; add sine hb
001B27  3               	sta (z80_ix),y		; store new coordinate hb.
001B27  3               
001B27  3               	ldy #4
001B27  3               	lda (z80_ix),y	 	; y coordinate in hl.
001B27  3               	clc
001B27  3               	adc z80_c		; add cosine lb
001B27  3               	sta (z80_ix),y		; store new coordinate lb.
001B27  3               	ldy #5
001B27  3               	lda (z80_ix),y
001B27  3               	adc z80_b		; add cosine lb
001B27  3               	sta (z80_ix),y		; store new coordinate hb.
001B27  3               
001B27  3               	rts
001B27  3               
001B27  3               ;----------------------------------------------------
001B27  3               ; Move dots
001B27  3               ;----------------------------------------------------
001B27  3               
001B27  3               dotl:
001B27  3               	ldy #5
001B27  3               	lda (z80_ix),y
001B27  3               	sec
001B27  3               	sbc #1		 	; move left.
001B27  3               	sta (z80_ix),y
001B27  3               	rts
001B27  3               dotr:
001B27  3               	ldy #5
001B27  3               	lda (z80_ix),y
001B27  3               	clc
001B27  3               	adc #1		 	; move left.
001B27  3               	sta (z80_ix),y
001B27  3               	rts
001B27  3               dotu:
001B27  3               	ldy #3
001B27  3               	lda (z80_ix),y
001B27  3               	sec
001B27  3               	sbc #1		 	; move up.
001B27  3               	sta (z80_ix),y
001B27  3               	rts
001B27  3               dotd:
001B27  3               	ldy #3
001B27  3               	lda (z80_ix),y
001B27  3               	clc
001B27  3               	adc #1			; move down.
001B27  3               	sta (z80_ix),y
001B27  3               	rts
001B27  3               
001B27  3               ;----------------------------------------------------
001B27  3               ; Check if coordinates are ok before redrawing at new position.
001B27  3               ;
001B27  3               ; left:   X>L		X=L	Ok
001B27  3               ; right:  R+15>X	X=R	Ok
001B27  3               ; top:    Y>T		Y=T	Ok
001B27  3               ; bottom: B+15>Y	Y=B	Ok
001B27  3               ;----------------------------------------------------
001B27  3               
001B27  3               chkxy:
001B27  3               
001B27  3               ; top:    Y>T		Y=T	Ok
001B27  3               
001B27  3               	ldy #3
001B27  3               	lda (z80_ix),y	 	; fetch shrapnel coordinate.
001B27  3               	cmp wntopx		; window top.
001B27  3               	bcs :+			; compare with top window limit.
001B27  3               	jmp kilshr		; out of window, kill shrapnel.
001B27  3               :
001B27  3               ; left:   X>L		X=L	Ok
001B27  3               
001B27  3               	ldy #5
001B27  3               	lda (z80_ix),y	 	; fetch shrapnel coordinate.
001B27  3               	cmp wnlftx		; left edge.
001B27  3               	bcs :+			; compare with left window limit.
001B27  3               	jmp kilshr		; out of window, kill shrapnel.
001B27  3               :
001B27  3               ; bottom: B+15>Y	Y=B	Ok
001B27  3               
001B27  3               	lda wnbotx		; point to bottom.
001B27  3               	clc
001B27  3               	adc #15
001B27  3               	ldy #3
001B27  3               	cmp (z80_ix),y	 	; fetch shrapnel coordinate.
001B27  3               	bcs :+			; compare with shrapnel x coordinate.
001B27  3               	jmp kilshr		; off screen, kill shrapnel..
001B27  3               :
001B27  3               ; right:  R+15>X	X=R	Ok
001B27  3               
001B27  3               	lda wnrgtx		; point to right edge.
001B27  3               	clc
001B27  3               	adc #15
001B27  3               	ldy #5
001B27  3               	cmp (z80_ix),y	 	; fetch shrapnel coordinate.
001B27  3               	bcs :+			; compare with window limit.
001B27  3               	jmp kilshr		; off screen, kill shrapnel.
001B27  3               :
001B27  3               
001B27  3               ;----------------------------------------------------
001B27  3               ; Drop through.
001B27  3               ; Display shrapnel.
001B27  3               ;----------------------------------------------------
001B27  3               
001B27  3               plot:
001B27  3               	ldy #3
001B27  3               	lda (z80_ix),y		; y integer.
001B27  3               	sta dispy	 	; workspace coordinates.
001B27  3               	ldy #5
001B27  3               	lda (z80_ix),y	 	; x integer.
001B27  3               	sta dispx 		; workspace coordinates.
001B27  3               
001B27  3               	ldy #0
001B27  3               	lda (z80_ix),y 		; type.
001B27  3               	bne :+			; is it a laser?
001B27  3               	jmp plot1 		; yes, draw laser instead.
001B27  3               :
001B27  3               plot0:
001B27  3               	lda dispx		; which pixel within byte do we
001B27  3               	and #7			; want to set first?
001B27  3               	tay
001B27  3               	lda dots,y 		; table of small pixel positions.
001B27  3               	sta z80_e 		; get value.
001B27  3               
001B27  3               	jsr scadd 		; screen address.
001B27  3               	ldy #0
001B27  3               	lda (scraddr),y		; see what's already there.
001B27  3               	eor z80_e
001B27  3               	sta (scraddr),y 	; put back on screen.
001B27  3               	rts
001B27  3               
001B27  3               plot1:
001B27  3               	jsr scadd 		; screen address.
001B27  3               	ldy #0
001B27  3               	lda (scraddr),y 	; fetch byte there.
001B27  3               	eor #255 		; toggle all bits.
001B27  3               	sta (scraddr),y 	; new byte.
001B27  3               	rts
001B27  3               
001B27  3               ;----------------------------------------------------
001B27  3               ; Switch off shrapnel
001B27  3               ;----------------------------------------------------
001B27  3               
001B27  3               kilshr:
001B27  3               	lda #128
001B27  3               	ldy #0
001B27  3               	sta (z80_ix),y	; switch off shrapnel.
001B27  3               	rts
001B27  3               
001B27  3               ;----------------------------------------------------
001B27  3               ; Sine/cosine table
001B27  3               ;----------------------------------------------------
001B27  3               
001B27  3               shrsin:	.word 0,1024,391,946,724,724,946,391
001B27  3               	.word 1024,0,946,65144,724,64811,391,64589
001B27  3               	.word 0,64512,65144,64589,64811,64811,64589,65144
001B27  3               	.word 64512,0,64589,391,64811,724,65144,946
001B27  3               
001B27  3               ;----------------------------------------------------
001B27  3               ; Create trail
001B27  3               ;----------------------------------------------------
001B27  3               
001B27  3               trail:
001B27  3               	ldy #1
001B27  3               	lda (z80_ix),y 	; time remaining.
001B27  3               	sec
001B27  3               	sbc #1
001B27  3               	sta (z80_ix),y
001B27  3               	bne :+
001B27  3               	jmp trailk		; time to switch it off.
001B27  3               :
001B27  3               	jsr qrand		; get a random number.
001B27  3               	lsr a 			; x or y axis?
001B27  3               	bcc :+
001B27  3               	jmp trailv		; use y.
001B27  3               :
001B27  3               ; Trail horizontal
001B27  3               
001B27  3               	lsr a 			; which direction?
001B27  3               	bcc :+
001B27  3               	jmp traill		; go left.
001B27  3               :
001B27  3               ; Trail right
001B27  3               
001B27  3               	ldy #5
001B27  3               	lda (z80_ix),y
001B27  3               	clc
001B27  3               	adc #1	 		; go right.
001B27  3               	sta (z80_ix),y
001B27  3               	rts
001B27  3               
001B27  3               ; Trail left
001B27  3               
001B27  3               traill:
001B27  3               	ldy #5
001B27  3               	lda (z80_ix),y
001B27  3               	sec
001B27  3               	sbc #1 			; go left.
001B27  3               	sta (z80_ix),y
001B27  3               	rts
001B27  3               
001B27  3               ; Trail vertical
001B27  3               
001B27  3               trailv:
001B27  3               	lsr a		 	; which direction?
001B27  3               	bcc :+
001B27  3               	jmp trailu		; go up.
001B27  3               :
001B27  3               ; Trail down
001B27  3               
001B27  3               	ldy #3
001B27  3               	lda (z80_ix),y
001B27  3               	clc
001B27  3               	adc #1 			; go down.
001B27  3               	sta (z80_ix),y
001B27  3               	rts
001B27  3               
001B27  3               ; Trail up
001B27  3               
001B27  3               trailu:
001B27  3               	ldy #3
001B27  3               	lda (z80_ix),y
001B27  3               	sec
001B27  3               	sbc #1 			; go up.
001B27  3               	sta (z80_ix),y
001B27  3               	rts
001B27  3               
001B27  3               ; Kill trail
001B27  3               
001B27  3               trailk:
001B27  3               	lda #200		; set off-screen to kill vapour trail.
001B27  3               	ldy #3
001B27  3               	sta (z80_ix),y
001B27  3               	rts
001B27  3               
001B27  3               ;----------------------------------------------------
001B27  3               ; Create laser beam
001B27  3               ;----------------------------------------------------
001B27  3               
001B27  3               laser:
001B27  3               	ldy #1
001B27  3               	lda (z80_ix),y 		; direction.
001B27  3               	ror a 			; left or right?
001B27  3               	bcs :+
001B27  3               	jmp laserl		; move left.
001B27  3               :
001B27  3               ; Laser right
001B27  3               
001B27  3               	lda #8			; distance to travel.
001B27  3               	sta z80_b
001B27  3               	jmp laserm		; move laser.
001B27  3               
001B27  3               ; Laser left
001B27  3               
001B27  3               laserl:
001B27  3               	lda #248		; distance to travel.
001B27  3               	sta z80_b
001B27  3               laserm:
001B27  3               	ldy #5
001B27  3               	lda (z80_ix),y		; x position.
001B27  3               	clc
001B27  3               	adc z80_b		; add distance.
001B27  3               	sta (z80_ix),y		; set new x coordinate.
001B27  3               
001B27  3               ; Test new block.
001B27  3               
001B27  3               	sta dispx 		; set x for block collision detection purposes.
001B27  3               	ldy #3
001B27  3               	lda (z80_ix),y 		; get y.
001B27  3               	sta dispy		; set coordinate for collision test.
001B27  3               	jsr tstbl 		; get block type there.
001B27  3               	cmp #WALL		; is it solid?
001B27  3               	bne :+
001B27  3               	jmp trailk		; yes, it cannot pass.
001B27  3               :
001B27  3                       cmp #FODDER             ; is it fodder?
001B27  3                       bne :+
001B27  3                       jsr fdchk               ; remove fodder block.
001B27  3                       jmp trailk              ; destroy laser.
001B27  3               :
001B27  3                       rts                     ; no, ignore it.
001B27  3               
001B27  3               ;----------------------------------------------------
001B27  3               ; Dots mask
001B27  3               ;----------------------------------------------------
001B27  3               
001B27  3               dots:	.byte 128,64,32,16,8,4,2,1
001B27  3               
001B27  3               
001B27  3               ;----------------------------------------------------
001B27  3               ; Plot, preserving de.
001B27  3               ;----------------------------------------------------
001B27  3               
001B27  3               plotde:
001B27  3               	lda z80_d 		; put de on stack.
001B27  3               	pha
001B27  3               	lda z80_e
001B27  3               	pha
001B27  3               
001B27  3               	jsr plot 		; plot pixel.
001B27  3               
001B27  3               	pla			; restore de from stack.
001B27  3               	sta z80_e
001B27  3               	pla
001B27  3               	sta z80_d
001B27  3               
001B27  3               	rts
001B27  3               
001B27  3               ;----------------------------------------------------
001B27  3               ; Shoot a laser.
001B27  3               ;----------------------------------------------------
001B27  3               
001B27  3               shoot:
001B27  3               	sta z80_c		; store direction in c register.
001B27  3               	ldy #8
001B27  3               	lda (z80_ix),y 		; y coordinate.
001B27  3               shoot1:
001B27  3               	clc
001B27  3               	adc #7 			; down 7 pixels.
001B27  3               	sta z80_l 		; puty y coordinate in l.
001B27  3               
001B27  3               	ldy #9
001B27  3               	lda (z80_ix),y 		; x coordinate in h.
001B27  3               	sta z80_h
001B27  3               
001B27  3               	lda z80_i		; store pointer to sprite.
001B27  3               	pha
001B27  3               	lda z80_x
001B27  3               	pha
001B27  3               
001B27  3               	jsr fpslot 		; find particle slot.
001B27  3               	bcs :+
001B27  3               	jmp vapou2		; failed, restore ix.
001B27  3               :
001B27  3               	lda #0
001B27  3               	ldy #0
001B27  3               	sta (z80_ix),y 		; set up a laser.
001B27  3               
001B27  3               	lda z80_c
001B27  3               	ldy #1
001B27  3               	sta (z80_ix),y 		; set the direction.
001B27  3               
001B27  3               	lda z80_l
001B27  3               	ldy #3
001B27  3               	sta (z80_ix),y		; set y coordinate.
001B27  3               
001B27  3               	ror z80_c		; check direction we want.
001B27  3               	bcc :+
001B27  3               	jmp shootr		; shoot right.
001B27  3               :
001B27  3               	lda z80_h		; X position.
001B27  3               shoot0:
001B27  3               	and #248		; align on character boundary.
001B27  3               	ldy #5
001B27  3               	sta (z80_ix),y		; set x coordinate.
001B27  3               	jmp vapou0 		; draw first image.
001B27  3               shootr:
001B27  3               	lda z80_h		; x position.
001B27  3               	clc
001B27  3               	adc #15			; look right.
001B27  3               	jmp shoot0		; align and continue.
001B27  3               
001B27  3               ;----------------------------------------------------
001B27  3               ; Create a bit of vapour trail.
001B27  3               ;----------------------------------------------------
001B27  3               
001B27  3               vapour:
001B27  3               	lda z80_i		; store pointer to sprite.
001B27  3               	pha
001B27  3               	lda z80_x
001B27  3               	pha
001B27  3               
001B27  3               	ldy #8
001B27  3               	lda (z80_ix),y 		; y coordinate.
001B27  3               	clc
001B27  3               	adc #7			; mid-point of sprite.
001B27  3               	sta z80_l
001B27  3               
001B27  3               	ldy #9
001B27  3               	lda (z80_ix),y 		; x coordinate.
001B27  3               	adc #7
001B27  3               	sta z80_h
001B27  3               
001B27  3               	jsr fpslot 		; find particle slot.
001B27  3               	bcc :+
001B27  3               	jmp vapou1		; no, we can use it.
001B27  3               :
001B27  3               vapou2:
001B27  3               	pla
001B27  3               	sta z80_x
001B27  3               	pla
001B27  3               	sta z80_i
001B27  3               	rts
001B27  3               vapou1:
001B27  3               	lda z80_l
001B27  3               	ldy #3
001B27  3               	sta (z80_ix),y		; set up y.
001B27  3               
001B27  3               	lda z80_h
001B27  3               	ldy #5
001B27  3               	sta (z80_ix),y 		; set up x coordinate.
001B27  3               
001B27  3               	jsr qrand		; get quick random number.
001B27  3               	and #15			; random time.
001B27  3               	clc
001B27  3               	adc #15			; minimum time on screen.
001B27  3               	ldy #1
001B27  3               	sta (z80_ix),y		; set time on screen.
001B27  3               
001B27  3               	lda #1
001B27  3               	ldy #0
001B27  3               	sta (z80_ix),y		; define particle as vapour trail.
001B27  3               vapou0:
001B27  3               	jsr chkxy		; plot first position.
001B27  3               	jmp vapou2
001B27  3               
001B27  3               ;----------------------------------------------------
001B27  3               ; Create a user particle.
001B27  3               ;----------------------------------------------------
001B27  3               
001B27  3               ptusr:
001B27  3               	sta z80_f		; store timer.
001B27  3               
001B27  3               	ldy #8
001B27  3               	lda (z80_ix),y 		; y coordinate.
001B27  3               	clc
001B27  3               	adc #7			; mid-point of sprite.
001B27  3               	sta z80_l
001B27  3               
001B27  3               	ldy #9
001B27  3               	lda (z80_ix),y 		; x coordinate.
001B27  3               	clc
001B27  3               	adc #7			; mid-point of sprite.
001B27  3               	sta z80_h
001B27  3               
001B27  3               	jsr fpslot 		; find particle slot.
001B27  3               	bcs ptusr1
001B27  3               	rts 			; out of slots, can't generate anything.
001B27  3               ptusr1:
001B27  3               	lda z80_l
001B27  3               	ldy #3
001B27  3               	sta (z80_ix),y 		; set up y.
001B27  3               
001B27  3               	lda z80_h
001B27  3               	ldy #5
001B27  3               	sta (z80_ix),y		; set up x coordinate.
001B27  3               
001B27  3               	lda z80_f 		; restore timer.
001B27  3               	ldy #1
001B27  3               	sta (z80_ix),y		; set time on screen.
001B27  3               
001B27  3               	lda #7
001B27  3               	ldy #0
001B27  3               	sta (z80_ix),y		; define particle as user particle.
001B27  3               
001B27  3               	jmp chkxy		; plot first position.
001B27  3               
001B27  3               ;----------------------------------------------------
001B27  3               ; Create a vertical or horizontal star.
001B27  3               ;----------------------------------------------------
001B27  3               
001B27  3               star:
001B27  3               	lda z80_i		; store pointer to sprite.
001B27  3               	pha
001B27  3               	lda z80_x
001B27  3               	pha
001B27  3               
001B27  3               	jsr fpslot 		; find particle slot.
001B27  3               	bcs star7		; found one we can use.
001B27  3               star0:
001B27  3               	pla 			; restore sprite pointer.
001B27  3               	sta z80_x
001B27  3               	pla
001B27  3               	sta z80_i
001B27  3               	rts 			; out of slots, can't generate anything.
001B27  3               star7:
001B27  3               	lda z80_c		; direction.
001B27  3               	and #3 			; is it left?
001B27  3               	bne :+
001B27  3               	jmp star1 		; yes, it's left.
001B27  3               :
001B27  3               	cmp #1 			; is it right?
001B27  3               	bne :+
001B27  3               	jmp star2 		; yes, it's right.
001B27  3               :
001B27  3               	cmp #2 			; is it up?
001B27  3               	bne :+
001B27  3               	jmp star3 		; yes, it's up.
001B27  3               :
001B27  3               	ldy wntopx 		; get edge of screen.
001B27  3               	iny			; down one pixel.
001B27  3               	tya
001B27  3               star8:
001B27  3               	ldy #3
001B27  3               	sta (z80_ix),y 		; set y coord.
001B27  3               	jsr qrand 		; get quick random number.
001B27  3               star9:
001B27  3               	ldy #5
001B27  3               	sta (z80_ix),y		; set x position.
001B27  3               
001B27  3               	lda z80_c		; direction.
001B27  3               	and #3			; zero to three.
001B27  3               	clc
001B27  3               	adc #3			; 3 to 6 for starfield.
001B27  3               	ldy #0
001B27  3               	sta (z80_ix),y		; define particle as star.
001B27  3               	jsr chkxy		; plot first position.
001B27  3               	jmp star0
001B27  3               star1:
001B27  3               	jsr qrand		; get quick random number.
001B27  3               	ldy #3
001B27  3               	sta (z80_ix),y 		; set y coord.
001B27  3               
001B27  3               	lda wnrgtx 		; get edge of screen.
001B27  3               	clc
001B27  3               	adc #15			; add width of sprite minus 1.
001B27  3               	jmp star9
001B27  3               star2:
001B27  3               	jsr qrand 		; get quick random number.
001B27  3               	ldy #3
001B27  3               	sta (z80_ix),y		; set y coord.
001B27  3               
001B27  3               	lda wnlftx		; get edge of screen.
001B27  3               	jmp star9
001B27  3               star3:
001B27  3               	lda wnbotx 		; get edge of screen.
001B27  3               	clc
001B27  3               	adc #15 		; height of sprite minus one pixel.
001B27  3               	jmp star8
001B27  3               
001B27  3               ;----------------------------------------------------
001B27  3               ; Find particle slot for lasers or vapour trail.
001B27  3               ; can't use alternate accumulator.
001B27  3               ;----------------------------------------------------
001B27  3               
001B27  3               fpslot:
001B27  3               	lda #<SHRAPN 		; shrapnel table.
001B27  3               	sta z80_x
001B27  3               	lda #>SHRAPN
001B27  3               	sta z80_i
001B27  3               
001B27  3               	lda #NUMSHR		; number of pieces in table.
001B27  3               	sta z80_b
001B27  3               fpslt0:
001B27  3               	ldy #0
001B27  3               	lda (z80_ix),y		; get type.
001B27  3               	asl a  			; is this slot in use?
001B27  3               	bcc :+
001B27  3               	rts			; no, we can use it.
001B27  3               :
001B27  3               	clc			; point to more shrapnel.
001B27  3               	lda z80_x
001B27  3               	adc #SHRSIZ
001B27  3               	sta z80_x
001B27  3               	bcc :+
001B27  3               	inc z80_i
001B27  3               :
001B27  3               	dec z80_b		; repeat for all shrapnel.
001B27  3               	bne fpslt0
001B27  3               
001B27  3               	clc
001B27  3               	rts 			; out of slots, can't generate anything.
001B27  3               
001B27  3               ;----------------------------------------------------
001B27  3               ; Create an explosion at sprite position.
001B27  3               ;----------------------------------------------------
001B27  3               
001B27  3               explod:
001B27  3               	sta z80_c 		; particles to create.
001B27  3               
001B27  3               	lda z80_i 		; store pointer to sprite.
001B27  3               	pha
001B27  3               	lda z80_x
001B27  3               	pha
001B27  3               
001B27  3               	ldy #8
001B27  3               	lda (z80_ix),y 		; y coordinate.
001B27  3               	sta z80_l
001B27  3               	ldy #9
001B27  3               	lda (z80_ix),y		; x coordinate.
001B27  3               	sta z80_h
001B27  3               
001B27  3               	lda #<SHRAPN		; shrapnel table.
001B27  3               	sta z80_x
001B27  3               	lda #>SHRAPN
001B27  3               	sta z80_i
001B27  3               
001B27  3               	lda #NUMSHR		; number of pieces in table.
001B27  3               	sta explcnt
001B27  3               expld0:
001B27  3               	ldy #0
001B27  3               	lda (z80_ix),y		; get type.
001B27  3               	asl a 			; is this slot in use?
001B27  3               	bcs expld1		; no, we can use it.
001B27  3               expld2:
001B27  3               	clc
001B27  3               	lda z80_x
001B27  3               	adc #SHRSIZ
001B27  3               	sta z80_x
001B27  3               	bcc :+
001B27  3               	inc z80_i
001B27  3               :
001B27  3               	dec explcnt		; repeat for all shrapnel.
001B27  3               	bne expld0
001B27  3               expld3:
001B27  3               	pla			; restore sprite pointer.
001B27  3               	sta z80_x
001B27  3               	pla
001B27  3               	sta z80_i
001B27  3               	rts 			; out of slots, can't generate any more.
001B27  3               
001B27  3               expld1:
001B27  3               	lda z80_c		; shrapnel counter.
001B27  3               	and #15			; 0 to 15.
001B27  3               	clc			; add to x.
001B27  3               	adc z80_l
001B27  3               	ldy #3
001B27  3               	sta (z80_ix),y		; y coord.
001B27  3               
001B27  3               	lda seed3 		; crap random number.
001B27  3               	and #15			; 0 to 15.
001B27  3               	clc 			; add to y.
001B27  3               	adc z80_h
001B27  3               	ldy #5
001B27  3               	sta (z80_ix),y		; x coord.
001B27  3               
001B27  3               	lda #2
001B27  3               	ldy #0
001B27  3               	sta (z80_ix),y		; switch it on.
001B27  3               
001B27  3               	jsr chkxy		; plot first position.
001B27  3               	jsr qrand		; quick random angle.
001B27  3               	and #60 		; keep within range.
001B27  3               	ldy #1
001B27  3               	sta (z80_ix),y		; angle.
001B27  3               
001B27  3               	dec z80_c		; one less piece of shrapnel to generate.
001B27  3               	bne expld2 		; back to main explosion loop.
001B27  3               	jmp expld3 		; restore sprite pointer and exit.
001B27  3               
001B27  3               ;----------------------------------------------------
001B27  3               ; Quick random
001B27  3               ;----------------------------------------------------
001B27  3               
001B27  3               qrand:
001B27  3               	jsr random		; r register.
001B27  3               	eor seed3		; combine with seed.
001B27  3               	sta seed3 		; new seed.
001B27  3               	rts
001B27  3               
001B27  3               ;----------------------------------------------------
001B27  3               ; Display all shrapnel.
001B27  3               ;----------------------------------------------------
001B27  3               
001B27  3               dshrp:
001B27  3               	lda #<plotde		; display routine.
001B27  3               	sta proshx+1
001B27  3               	lda #>plotde
001B27  3               	sta proshx+2
001B27  3               	jsr proshr		; process shrapnel.
001B27  3               
001B27  3               	lda #<prosh1		; processing routine.
001B27  3               	sta proshx+1
001B27  3               	lda #>prosh1
001B27  3               	sta proshx+2
001B27  3               	rts
001B27  3               
001B27  3               ;------------------------------------------------------
001B27  3               ; Particle engine.
001B27  3               ;
001B27  3               ; Init particle data for 55 particles in SHRAPN table.
001B27  3               ; Every particle has 6 bytes.
001B27  3               ;
001B27  3               ; global:	-
001B27  3               ; local:	x,y,hl
001B27  3               ; calls:	-
001B27  3               ;------------------------------------------------------
001B27  3               
001B27  3               inishr:
001B27  3               	lda #<SHRAPN 		; table.
001B27  3               	sta z80_l
001B27  3               	lda #>SHRAPN
001B27  3               	sta z80_h
001B27  3               
001B27  3               	ldy #0
001B27  3               	ldx #NUMSHR		; shrapnel pieces to process.
001B27  3               inish0:
001B27  3               	lda #255 		; kill the shrapnel.
001B27  3               	sta (z80_hl),y
001B27  3               
001B27  3               	clc 			; point there.
001B27  3               	lda z80_l
001B27  3               	adc #SHRSIZ		; distance to next.
001B27  3               	sta z80_l
001B27  3               	bcc :+
001B27  3               	inc z80_h
001B27  3               :
001B27  3               	dex
001B27  3               	bne inish0 		; round again.
001B27  3               	rts
001B27  3               
001B27  3               ;------------------------------------------------------
001B27  3               ; Check for collision between laser and sprite.
001B27  3               ;------------------------------------------------------
001B27  3               
001B27  3               lcol:
001B27  3               	lda #<SHRAPN		; shrapnel table.
001B27  3               	sta z80_l
001B27  3               	lda #>SHRAPN
001B27  3               	sta z80_h
001B27  3               
001B27  3               	lda #NUMSHR		; number of pieces in table.
001B27  3               	sta z80_b
001B27  3               lcol0:
001B27  3               	ldy #0
001B27  3               	lda (z80_hl),y 		; get type.
001B27  3               	beq lcol1		; yes, check collision.
001B27  3               lcol3:
001B27  3               	clc			; point to more shrapnel.
001B27  3               	lda z80_l
001B27  3               	adc #SHRSIZ
001B27  3               	sta z80_l
001B27  3               	bcc :+
001B27  3               	inc z80_h
001B27  3               :
001B27  3               	dec z80_b		; repeat for all shrapnel.
001B27  3               	bne lcol0
001B27  3               	rts 			; no collision, carry not set.
001B27  3               lcol1:
001B27  3               	ldy #3
001B27  3               	lda (z80_hl),y		; get y.
001B27  3               	sec
001B27  3               	ldy #8
001B27  3               	sbc (z80_ix),y		; subtract sprite y.
001B27  3               lcolh:
001B27  3               	cmp #16 		; within range?
001B27  3               	bcc :+
001B27  3               	jmp lcol2		; no, missed.
001B27  3               :
001B27  3               	ldy #5
001B27  3               	lda (z80_hl),y 		; get x.
001B27  3               	sec
001B27  3               	ldy #9
001B27  3               	sbc (z80_ix),y 		; subtract sprite y.
001B27  3               	cmp #16			; within range?
001B27  3               	bcs :+
001B27  3               	jmp lcol4 		; yes, collision occurred.
001B27  3               :
001B27  3               lcol2:
001B27  3               	jmp lcol3
001B27  3               lcol4:
001B27  3               	sec
001B27  3               	rts 			; return with carry set for collision.
001B27  3               .endif
001B27  3               
001B27  3               ;------------------------------------------------------
001B27  3               ; Main game engine code starts here.
001B27  3               ; After initialisation, mloop is the main loop
001B27  3               ;------------------------------------------------------
001B27  3               
001B27  3               game:
001B27  3               
001B27  3               ; Set up screen address table.
001B27  3               
001B27  3               setsat:
001B27  3  A9 00        	lda #<ScreenAddr		; start of screen.
001B29  3  85 rr        	sta scraddr
001B2B  3  A9 50        	lda #>ScreenAddr
001B2D  3  85 rr        	sta scraddr+1
001B2F  3               
001B2F  3  A0 00        	ldy #0			; vertical lines on screen.
001B31  3               setsa0:
001B31  3  A5 rr        	lda scraddr
001B33  3  99 00 06     	sta SCADTB_lb,y		; write low byte.
001B36  3  A5 rr        	lda scraddr+1
001B38  3  99 00 07     	sta SCADTB_hb,y		; write high byte.
001B3B  3  20 5F 11     	jsr nline		; next line down.
001B3E  3  C8           	iny			; next position in table.
001B3F  3  D0 F0        	bne setsa0
001B41  3               
001B41  3               ; Init graphics mode
001B41  3               
001B41  3  20 33 0F     	jsr screeninit
001B44  3               
001B44  3               ; Init AtoMMC joystick
001B44  3  20 FE 0E     	jsr joyinit		; AtoMMC joystick on PORT B
001B47  3               
001B47  3               rpblc2:
001B47  3               .if pflag
001B47  3               	jsr inishr 		; initialise particle engine.
001B47  3               .endif
001B47  3               evintr:
001B47  3  20 76 39     	jsr evnt12 		; call intro/menu event.
001B4A  3               
001B4A  3  A9 02        	lda #WALL 		; write default property.
001B4C  3  A2 00        	ldx #0
001B4E  3               clrmap:
001B4E  3  9D 00 03     	sta MAP,x 		; block properties.
001B51  3  9D 00 04     	sta MAP+256,x
001B54  3  9D 00 05     	sta MAP+512,x
001B57  3  E8           	inx			; next byte.
001B58  3  D0 F4        	bne clrmap
001B5A  3               
001B5A  3  20 72 1A     	jsr iniob 		; initialise objects.
001B5D  3               
001B5D  3  A9 00        	lda #0			; put zero in accumulator.
001B5F  3  85 rr        	sta gamwon		; reset game won flag.
001B61  3               
001B61  3  20 C9 1C     	jsr inisc 		; init the score.
001B64  3               mapst:
001B64  3  AD E6 2B     	lda stmap 		; start position on map.
001B67  3  8D 9E 2B     	sta roomtb		; set up position in table, if there is one.
001B6A  3               
001B6A  3               inipbl:
001B6A  3               ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
001B6A  3               .if aflag
001B6A  3               	lda #<eop		; reset blockpointer
001B6A  3               	sta pbptr
001B6A  3               	lda #>eop
001B6A  3               	sta pbptr+1
001B6A  3               .endif
001B6A  3               ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
001B6A  3  20 55 28     	jsr initsc 		; set up first screen.
001B6D  3               
001B6D  3  A9 8D        	lda #<ssprit 		; default to spare sprite in table.
001B6F  3  85 rr        	sta z80_x
001B71  3  A9 2B        	lda #>ssprit
001B73  3  85 rr        	sta z80_i
001B75  3               evini:
001B75  3  20 69 3A     	jsr evnt13 		; initialisation.
001B78  3               
001B78  3               ; Two restarts.
001B78  3               ; First restart - clear all sprites and initialise everything.
001B78  3               
001B78  3               rstrt:
001B78  3  20 69 1C     	jsr rsevt 		; restart events.
001B7B  3  20 65 1A     	jsr xspr 		; clear sprite table.
001B7E  3  20 C1 29     	jsr sprlst 		; fetch pointer to screen sprites.
001B81  3  20 4A 2A     	jsr ispr 		; initialise sprite table.
001B84  3               
001B84  3  4C 93 1B     	jmp rstrt0
001B87  3               
001B87  3               ; Second restart - clear all but player, and don't initialise him.
001B87  3               
001B87  3               rstrtn:
001B87  3  20 69 1C     	jsr rsevt		; restart events.
001B8A  3  20 EE 29     	jsr nspr 		; clear all non-player sprites.
001B8D  3  20 C1 29     	jsr sprlst 		; fetch pointer to screen sprites.
001B90  3  20 87 2A     	jsr kspr 		; initialise sprite table, no more players.
001B93  3               
001B93  3               ; Set up the player and/or enemy sprites.
001B93  3               
001B93  3               rstrt0:
001B93  3  A9 00        	lda #0 			; zero in accumulator.
001B95  3  85 rr        	sta nexlev 		; reset next level flag.
001B97  3  85 rr        	sta restfl 		; reset restart flag.
001B99  3  85 rr        	sta deadf 		; reset dead flag.
001B9B  3  20 7F 20     	jsr droom 		; show screen layout.
001B9E  3               rpblc0:
001B9E  3               .if pflag
001B9E  3               	jsr inishr 		; initialise particle engine.
001B9E  3               .endif
001B9E  3               ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
001B9E  3               .if aflag
001B9E  3               	jsr rbloc		; draw blocks for this screen
001B9E  3               .endif
001B9E  3               ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
001B9E  3  20 19 1D     	jsr shwob		; draw objects.
001BA1  3               
001BA1  3  A9 00        	lda #<sprtab 		; address of sprite table, even sprites.
001BA3  3  85 rr        	sta z80_x
001BA5  3  A9 0B        	lda #>sprtab
001BA7  3  85 rr        	sta z80_i
001BA9  3               
001BA9  3  20 1F 26     	jsr dspr 		; display sprites.
001BAC  3               
001BAC  3  A9 11        	lda #<(sprtab+TABSIZ) 	; address of first odd sprite.
001BAE  3  85 rr        	sta z80_x
001BB0  3  A9 0B        	lda #>(sprtab+TABSIZ)
001BB2  3  85 rr        	sta z80_i
001BB4  3  20 1F 26     	jsr dspr 		; display sprites.
001BB7  3               
001BB7  3               mloop:
001BB7  3  20 C9 0E     	jsr bbcsync
001BBA  3               
001BBA  3  20 16 0F     	jsr vsync 		; synchronise with display.
001BBD  3               
001BBD  3  A9 00        	lda #<sprtab 		; address of sprite table, even sprites.
001BBF  3  85 rr        	sta z80_x
001BC1  3  A9 0B        	lda #>sprtab
001BC3  3  85 rr        	sta z80_i
001BC5  3               
001BC5  3               DEBUG_PAL PAL_red
001BC5  3  20 1F 26     	jsr dspr 		; display even sprites.
001BC8  3               DEBUG_PAL PAL_black
001BC8  3               
001BC8  3  20 18 1D     	jsr plsnd 		; play sounds.
001BCB  3  20 16 0F     	jsr vsync 		; synchronise with display.
001BCE  3               
001BCE  3  A9 11        	lda #<(sprtab+TABSIZ) 	; address of first odd sprite.
001BD0  3  85 rr        	sta z80_x
001BD2  3  A9 0B        	lda #>(sprtab+TABSIZ)
001BD4  3  85 rr        	sta z80_i
001BD6  3               
001BD6  3               DEBUG_PAL PAL_red
001BD6  3  20 1F 26     	jsr dspr 		; display odd sprites.
001BD9  3               DEBUG_PAL PAL_black
001BD9  3               
001BD9  3  A9 8D        	lda #<(ssprit) 		; point to spare sprite for spawning purposes.
001BDB  3  85 rr        	sta z80_x
001BDD  3  A9 2B        	lda #>(ssprit)
001BDF  3  85 rr        	sta z80_i
001BE1  3               evlp1:
001BE1  3               DEBUG_PAL PAL_green
001BE1  3  20 76 38     	jsr evnt10 		; called once per main loop.
001BE4  3  20 9D 25     	jsr pspr 		; process sprites.
001BE7  3               DEBUG_PAL PAL_black
001BE7  3               
001BE7  3               ; Main loop events.
001BE7  3               
001BE7  3  A9 8D        	lda #<ssprit 		; point to spare sprite for spawning purposes.
001BE9  3  85 rr        	sta z80_x
001BEB  3  A9 2B        	lda #>ssprit
001BED  3  85 rr        	sta z80_i
001BEF  3               DEBUG_PAL PAL_green
001BEF  3               evlp2:
001BEF  3  20 75 39     	jsr evnt11 		; called once per main loop.
001BF2  3               bsortx:
001BF2  3  20 13 25     	jsr bsort 		; sort sprites.
001BF5  3               DEBUG_PAL PAL_black
001BF5  3               
001BF5  3  A5 rr        	lda nexlev		; finished level flag.
001BF7  3  D0 1F        	bne newlev		; is set, go to next level.
001BF9  3  A5 rr        	lda gamwon		; finished game flag.
001BFB  3  D0 2A        	bne evwon		; is set, finish the game.
001BFD  3  A5 rr        	lda restfl 		; finished level flag.
001BFF  3  C9 01        	cmp #1			; has it been set?
001C01  3  D0 03        	bne :+
001C03  3  4C 78 1B     	jmp rstrt		; yes, go to next level.
001C06  3               :
001C06  3  C9 02        	cmp #2			; has it been set?
001C08  3  D0 03        	bne :+
001C0A  3  4C 87 1B     	jmp rstrtn		; yes, go to next level.
001C0D  3               :
001C0D  3  A5 rr        	lda deadf 		; dead flag.
001C0F  3  D0 1C        	bne pdead		; yes, player dead.
001C11  3               
001C11  3               ; back to start of main loop.
001C11  3               
001C11  3  E6 rr        	inc frmno
001C13  3  E6 rr        	inc clock
001C15  3  4C B7 1B     	jmp mloop		; switched to a jmp mloop during test mode.
001C18  3               
001C18  3               ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
001C18  3               
001C18  3               ;----------------------------------------------------------
001C18  3               ; Read blocks from list and update screen accordingly.
001C18  3               ;----------------------------------------------------------
001C18  3               
001C18  3               .if aflag
001C18  3               rbloc:
001C18  3               	lda #<eop		; reset temp blockpointer
001C18  3               	sta tmp
001C18  3               	lda #>eop
001C18  3               	sta tmp+1
001C18  3               
001C18  3               rbloc2:
001C18  3               	lda tmp			; check for last block
001C18  3               	cmp pbptr
001C18  3               	bne rbloc1
001C18  3               	lda tmp+1
001C18  3               	cmp pbptr+1
001C18  3               	bne rbloc1
001C18  3               	rts
001C18  3               rbloc1:
001C18  3               	ldy #0
001C18  3               	lda (tmp),y		; check if block for this scno
001C18  3               	cmp scno
001C18  3               	bne rbloc0		; if not, skip
001C18  3               	iny
001C18  3               	lda (tmp),y		; get y
001C18  3               	sta dispy
001C18  3               	iny
001C18  3               	lda (tmp),y		; get x
001C18  3               	sta dispx
001C18  3               	iny
001C18  3               	lda (tmp),y		; get blocknr
001C18  3               	jsr pattr2		; draw block
001C18  3               rbloc0:
001C18  3               	clc			; point to next block
001C18  3               	lda tmp
001C18  3               	adc #4
001C18  3               	sta tmp
001C18  3               	bcc rbloc2
001C18  3               	inc tmp+1
001C18  3               	jmp rbloc2
001C18  3               .endif
001C18  3               ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
001C18  3               
001C18  3               ;----------------------------------------------------------
001C18  3               ; New level
001C18  3               ;----------------------------------------------------------
001C18  3               
001C18  3               newlev:
001C18  3  A5 rr        	lda scno 			; current screen.
001C1A  3  18           	clc
001C1B  3  69 01        	adc #1				; next screen.
001C1D  3  CD F9 B0     	cmp numsc + data_address - data_start			; total number of screens.
001C20  3  B0 05        	bcs evwon			; yes, game finished.
001C22  3  85 rr        	sta scno			; set new level number.
001C24  3  4C 78 1B     	jmp rstrt			; restart, clearing all aliens.
001C27  3               
001C27  3               evwon:
001C27  3  20 B2 3B     	jsr evnt18		 	; game completed.
001C2A  3  4C 3E 1C     	jmp tidyup			; tidy up and return to BASIC/calling routine.
001C2D  3               
001C2D  3               ;----------------------------------------------------------
001C2D  3               ; Player dead.
001C2D  3               ;----------------------------------------------------------
001C2D  3               
001C2D  3               pdead:
001C2D  3  A9 00        	lda #0				; zeroise accumulator.
001C2F  3  85 rr        	sta deadf			; reset dead flag.
001C31  3               evdie:
001C31  3  20 42 3B     	jsr evnt16 			; death subroutine.
001C34  3  A5 rr        	lda numlif			; number of lives.
001C36  3  F0 03        	beq :+
001C38  3  4C 78 1B     	jmp rstrt 			; restart game.
001C3B  3               :
001C3B  3               evfail:
001C3B  3  20 74 3B     	jsr evnt17 			; failure event.
001C3E  3               
001C3E  3               ;----------------------------------------------------------
001C3E  3               ; Tidy things up
001C3E  3               ;----------------------------------------------------------
001C3E  3               
001C3E  3               tidyup:
001C3E  3  A0 00        	ldy #0				; digits to check.
001C40  3               tidyu2:
001C40  3  B9 E3 1E     	lda score,y 			; get score digit.
001C43  3  CD E9 1E     	cmp hiscor 			; are we larger than high score digit?
001C46  3  90 07        	bcc tidyu0			; high score is bigger.
001C48  3  D0 0E        	bne tidyu1			; score is greater, record new high score.
001C4A  3  C8           	iny				; next digit of high score.
001C4B  3  C0 06        	cpy #6
001C4D  3  D0 F1        	bne tidyu2			; repeat for all digits
001C4F  3               tidyu0:
001C4F  3  A9 E3        	lda #<score			; return pointing to score.
001C51  3  85 rr        	sta z80_c
001C53  3  A9 1E        	lda #>score
001C55  3  85 rr        	sta z80_b
001C57  3  60           	rts
001C58  3               tidyu1:
001C58  3  A0 05        	ldy #5
001C5A  3               tidyu3:
001C5A  3  B9 E3 1E     	lda score,y			; score.
001C5D  3  99 E9 1E     	sta hiscor,y			; high score.
001C60  3  88           	dey
001C61  3  10 F7        	bpl tidyu3 			; copy score to high score.
001C63  3               evnewh:
001C63  3  20 D8 3B     	jsr evnt19			; new high score event.
001C66  3  4C 4F 1C     	jmp tidyu0			; tidy up.
001C69  3               
001C69  3               ;--------------------------------------------------
001C69  3               ; Restart event.
001C69  3               ;--------------------------------------------------
001C69  3               
001C69  3               rsevt:
001C69  3  A9 8D        	lda #<ssprit 			; default to spare element in table.
001C6B  3  85 rr        	sta z80_x
001C6D  3  A9 2B        	lda #>ssprit
001C6F  3  85 rr        	sta z80_i
001C71  3               evrs:
001C71  3  4C 40 3B     	jmp evnt14	 		; call restart event.
001C74  3               
001C74  3               ;------------------------------------------------------------------
001C74  3               ; Copy number passed in a to string position bc, right-justified.
001C74  3               ;
001C74  3               ; Input:
001C74  3               ;  A  = number
001C74  3               ;  BC = string address
001C74  3               ;
001C74  3               ; Output:
001C74  3               ;  BC = string with number
001C74  3               ;-----------------------------------------------------------------
001C74  3               
001C74  3               num2ch:
001C74  3  85 rr        	sta z80_d		; Save number
001C76  3               
001C76  3  A9 00        	lda #0
001C78  3  85 rr        	sta flag
001C7A  3               numdg3:
001C7A  3  A2 64        	ldx #100		; hundreds column.
001C7C  3  86 rr        	stx z80_e
001C7E  3  20 8E 1C     	jsr numdg		; show digit.
001C81  3               numdg2:
001C81  3  A2 0A        	ldx #10			; tens column.
001C83  3  86 rr        	stx z80_e
001C85  3  20 8E 1C     	jsr numdg		; show digit.
001C88  3               
001C88  3  E6 rr        	inc flag
001C8A  3  A2 01        	ldx #1			; units column.
001C8C  3  86 rr        	stx z80_e
001C8E  3               numdg:
001C8E  3  A9 30        	lda #48			; clear digit.
001C90  3  85 rr        	sta z80_a
001C92  3               numdg1:
001C92  3  A5 rr        	lda z80_d
001C94  3  C5 rr        	cmp z80_e
001C96  3  90 0E        	bcc numdg0		; nothing to show.
001C98  3  38           	sec
001C99  3  A5 rr        	lda z80_d
001C9B  3  E5 rr        	sbc z80_e		; subtract from column.
001C9D  3  85 rr        	sta z80_d
001C9F  3  E6 rr        	inc z80_a		; increment digit.
001CA1  3  E6 rr        	inc flag
001CA3  3  4C 92 1C     	jmp numdg1		; repeat until column is zero.
001CA6  3               numdg0:
001CA6  3  A0 00        	ldy #0
001CA8  3  A5 rr        	lda z80_a
001CAA  3  91 rr        	sta (z80_bc),y		; write digit to buffer.
001CAC  3  A5 rr        	lda flag
001CAE  3  F0 06        	beq :+
001CB0  3  E6 rr        	inc z80_c		; next buffer position.
001CB2  3  D0 02        	bne :+
001CB4  3  E6 rr        	inc z80_b
001CB6  3               :
001CB6  3  60           	rts
001CB7  3               num2dd:
001CB7  3  85 rr        	sta z80_d		; Save number
001CB9  3               
001CB9  3  A9 01        	lda #1
001CBB  3  85 rr        	sta flag
001CBD  3               
001CBD  3  4C 81 1C     	jmp numdg2
001CC0  3               num2td:
001CC0  3  85 rr        	sta z80_d		; Save number
001CC2  3               
001CC2  3  A9 01        	lda #1
001CC4  3  85 rr        	sta flag
001CC6  3  4C 7A 1C     	jmp numdg3
001CC9  3               
001CC9  3               ;---------------------------------------------------------
001CC9  3               ; Reset score to "000000"
001CC9  3               ;---------------------------------------------------------
001CC9  3               
001CC9  3               inisc:
001CC9  3  A9 30        	lda #'0'
001CCB  3  A2 05        	ldx #5			; digits to initialise.
001CCD  3               inisc0:
001CCD  3  9D E3 1E     	sta score,x 		; write zero digit.
001CD0  3  CA           	dex			; next column.
001CD1  3  10 FA        	bpl inisc0		; repeat for all digits.
001CD3  3               
001CD3  3  60           	rts
001CD4  3               
001CD4  3               ;-----------------------------------------------------
001CD4  3               ; Multiply h by d and return in hl.
001CD4  3               ;
001CD4  3               ; Input:
001CD4  3               ;  H = first number
001CD4  3               ;  D = second number
001CD4  3               ;
001CD4  3               ; Output:
001CD4  3               ;  HL = result H x D
001CD4  3               ;-----------------------------------------------------
001CD4  3               
001CD4  3               imul:
001CD4  3  A5 rr        	lda z80_d		; HL = H * D
001CD6  3  85 rr        	sta z80_e
001CD8  3  A5 rr        	lda z80_h
001CDA  3  85 rr        	sta z80_c		; make c first multiplier.
001CDC  3               imul0:
001CDC  3  A9 00        	lda #0			; zeroise total.
001CDE  3  85 rr        	sta z80_l
001CE0  3  85 rr        	sta z80_h
001CE2  3               
001CE2  3  A5 rr        	lda z80_h
001CE4  3  85 rr        	sta z80_d		; zeroise high byte.
001CE6  3               
001CE6  3  A9 08        	lda #8			; repeat 8 times.
001CE8  3  85 rr        	sta z80_b
001CEA  3               imul1:
001CEA  3  46 rr        	lsr z80_c		; rotate rightmost bit into carry.
001CEC  3  90 0E        	bcc imul2		; wasn't set.
001CEE  3  18           	clc			; bit was set, so add de.
001CEF  3  A5 rr        	lda z80_l
001CF1  3  65 rr        	adc z80_e
001CF3  3  85 rr        	sta z80_l
001CF5  3  A5 rr        	lda z80_h
001CF7  3  65 rr        	adc z80_d
001CF9  3  85 rr        	sta z80_h
001CFB  3  18           	clc 			; reset carry.
001CFC  3               imul2:
001CFC  3  06 rr        	asl z80_e 		; shift de 1 bit left.
001CFE  3  26 rr        	rol z80_d
001D00  3  C6 rr        	dec z80_b
001D02  3  D0 E6        	bne imul1		; repeat 8 times.
001D04  3               
001D04  3  60           	rts
001D05  3               
001D05  3               ;-----------------------------------------------
001D05  3               ; Divide d by e and return in d, remainder in a.
001D05  3               ;
001D05  3               ; Input:
001D05  3               ;  D = first number
001D05  3               ;  E = second number
001D05  3               ;
001D05  3               ; Output:
001D05  3               ;  D = result D/E
001D05  3               ;  A = remainder
001D05  3               ;-----------------------------------------------
001D05  3               
001D05  3               idiv:
001D05  3  A9 00        	lda #0
001D07  3  A0 08        	ldy #8		 	; bits to shift.
001D09  3  06 rr        	asl z80_d
001D0B  3               idiv0:
001D0B  3  2A           	rol a 			; multiply d by 2.
001D0C  3  C5 rr        	cmp z80_e 		; test if e is smaller.
001D0E  3  90 02        	bcc idiv1		; e is greater, no division this time.
001D10  3  E5 rr        	sbc z80_e		; subtract it.
001D12  3               idiv1:
001D12  3  26 rr        	rol z80_d		; rotate into d.
001D14  3  88           	dey
001D15  3  D0 F4        	bne idiv0		; repeat
001D17  3  60           	rts
001D18  3               
001D18  3               ;---------------------------------------------------
001D18  3               ; Play AY sound effect
001D18  3               ;---------------------------------------------------
001D18  3               
001D18  3               plsnd:
001D18  3  60           	rts
001D19  3               
001D19  3               ;---------------------------------------------------
001D19  3               ; Objects handling.
001D19  3               ; 32 bytes for image
001D19  3               ; 3 for room, y and x
001D19  3               ; 3 for starting room, y and x.
001D19  3               ; 254 = disabled.
001D19  3               ; 255 = object in player"s pockets.
001D19  3               ;---------------------------------------------------
001D19  3               
001D19  3               ;---------------------------------------------------
001D19  3               ; Show items present.
001D19  3               ;---------------------------------------------------
001D19  3               
001D19  3               shwob:
001D19  3  A9 D6        	lda #<(objdta + data_address - data_start) 			; objects table.
001D1B  3  85 rr        	sta z80_l
001D1D  3  A9 B2        	lda #>(objdta + data_address - data_start)
001D1F  3  85 rr        	sta z80_h
001D21  3               
001D21  3  AD 10 18     	lda numob 			; number of objects in the game.
001D24  3  85 rr        	sta sprcnt
001D26  3               shwob0:
001D26  3  A0 20        	ldy #32 			; distance to room number.
001D28  3  B1 rr        	lda (z80_hl),y 			; same as an item?
001D2A  3  C5 rr        	cmp scno 			; current location.
001D2C  3  D0 03        	bne :+
001D2E  3  20 43 1D     	jsr dobj 			; yes, display object.
001D31  3               :
001D31  3  18           	clc
001D32  3  A5 rr        	lda z80_l
001D34  3  69 26        	adc #38 			; distance to next item.
001D36  3  85 rr        	sta z80_l
001D38  3  A5 rr        	lda z80_h
001D3A  3  69 00        	adc #0
001D3C  3  85 rr        	sta z80_h	 		; point to it.
001D3E  3  C6 rr        	dec sprcnt
001D40  3  D0 E4        	bne shwob0 			; repeat for others.
001D42  3  60           	rts
001D43  3               
001D43  3               ;---------------------------------------------------
001D43  3               ; Display object.
001D43  3               ; hl must point to object's start address.
001D43  3               ;
001D43  3               ; Input:
001D43  3               ;  HL = object address
001D43  3               ;---------------------------------------------------
001D43  3               
001D43  3               dobj:
001D43  3  A0 21        	ldy #33
001D45  3  B1 rr        	lda (z80_hl),y 			; point to y.
001D47  3  85 rr        	sta dispy
001D49  3  C8           	iny
001D4A  3  B1 rr        	lda (z80_hl),y 			; point to x.
001D4C  3  85 rr        	sta dispx
001D4E  3               dobj1:
001D4E  3  4C 73 0F     	jmp sprite 			; draw this sprite.
001D51  3               
001D51  3               ;--------------------------------------
001D51  3               ; Remove an object.
001D51  3               ;
001D51  3               ; Input:
001D51  3               ;  A = object number
001D51  3               ;--------------------------------------
001D51  3               
001D51  3               remob:
001D51  3  CD 10 18     	cmp numob			; number of objects in game.
001D54  3  90 01        	bcc :+				; are we checking past the end?
001D56  3  60           	rts				; yes, can't get non-existent item.
001D57  3               :
001D57  3  48           	pha				; remember object.
001D58  3  20 66 1D     	jsr getob			; pick it up if we haven't already got it.
001D5B  3  68           	pla				; retrieve object number.
001D5C  3  20 95 1D     	jsr gotob			; get its address.
001D5F  3  A9 FE        	lda #254
001D61  3  A0 20        	ldy #32
001D63  3  91 rr        	sta (z80_hl),y			; remove it.
001D65  3  60           	rts
001D66  3               
001D66  3               ;---------------------------------------------------
001D66  3               ; Pick up object number held in the accumulator.
001D66  3               ;
001D66  3               ; Input:
001D66  3               ;  A = object number
001D66  3               ;---------------------------------------------------
001D66  3               
001D66  3               getob:
001D66  3  CD 10 18     	cmp numob 		; number of objects in game.
001D69  3  90 01        	bcc :+			; are we checking past the end?
001D6B  3  60           	rts			; yes, can't get non-existent item.
001D6C  3               :
001D6C  3  20 95 1D     	jsr gotob 		; check if we already have it.
001D6F  3  C9 FF        	cmp #255
001D71  3  D0 01        	bne :+
001D73  3  60           	rts			; we already do.
001D74  3               :
001D74  3  A0 20        	ldy #32
001D76  3  B1 rr        	lda (z80_hl),y		; is it on this screen?
001D78  3  C5 rr        	cmp scno 		; current screen.
001D7A  3  D0 14        	bne getob0		; not on screen, so nothing to delete.
001D7C  3               
001D7C  3  A9 FF        	lda #255
001D7E  3  91 rr        	sta (z80_hl),y		; pick it up.
001D80  3  C8           	iny 			; point to y coord.
001D81  3               getob1:
001D81  3  A0 21        	ldy #33
001D83  3  B1 rr        	lda (z80_hl),y		; y coord.
001D85  3  85 rr        	sta dispy
001D87  3  A0 22        	ldy #34
001D89  3  B1 rr        	lda (z80_hl),y 		; x coord.
001D8B  3  85 rr        	sta dispx
001D8D  3  4C 4E 1D     	jmp dobj1 		; delete object sprite.
001D90  3               getob0:
001D90  3  A9 FF        	lda #255
001D92  3  91 rr        	sta (z80_hl),y 		; pick it up.
001D94  3  60           	rts
001D95  3               
001D95  3               ;-----------------------------------------------------------------
001D95  3               ; Got object check.
001D95  3               ; Call with object in accumulator, returns zero set if in pockets.
001D95  3               ;
001D95  3               ; Input:
001D95  3               ;  A = object number
001D95  3               ;-----------------------------------------------------------------
001D95  3               
001D95  3               gotob:
001D95  3  CD 10 18     	cmp numob 		; number of objects in game.
001D98  3  90 03        	bcc :+ 			; are we checking past the end?
001D9A  3  4C A1 1D     	jmp gotob0 		; yes, we can't have a non-existent object.
001D9D  3               :
001D9D  3  20 A6 1D     	jsr findob		; find the object.
001DA0  3               gotob1:
001DA0  3  60           	rts
001DA1  3               
001DA1  3               gotob0:
001DA1  3  A9 FE        	lda #254 		; missing.
001DA3  3  4C A0 1D     	jmp gotob1
001DA6  3               
001DA6  3               findob:
001DA6  3  48           	pha			; save object number
001DA7  3  A9 D6        	lda #<(objdta + data_address - data_start) 		; objects.
001DA9  3  85 rr        	sta z80_l
001DAB  3  A9 B2        	lda #>(objdta + data_address - data_start)
001DAD  3  85 rr        	sta z80_h
001DAF  3  68           	pla			; retreive object number
001DB0  3  F0 0F        	beq fndob1 		; is it zero? yes, skip loop.
001DB2  3  AA           	tax 			; loop counter
001DB3  3               fndob2:
001DB3  3  18           	clc
001DB4  3  A5 rr        	lda z80_l
001DB6  3  69 26        	adc #38 		; size of each object.
001DB8  3  85 rr        	sta z80_l
001DBA  3  90 02        	bcc :+
001DBC  3  E6 rr        	inc z80_h
001DBE  3               :
001DBE  3  CA           	dex 			; repeat until we find address.
001DBF  3  D0 F2        	bne fndob2
001DC1  3               fndob1:
001DC1  3  A0 20        	ldy #32			; distance to room it's in.
001DC3  3  B1 rr        	lda (z80_hl),y		; fetch status.
001DC5  3  60           	rts
001DC6  3               
001DC6  3               ;---------------------------------------------
001DC6  3               ; Drop object number at (dispx, dispy).
001DC6  3               ;
001DC6  3               ; Input:
001DC6  3               ;  A = object number
001DC6  3               ;---------------------------------------------
001DC6  3               
001DC6  3               drpob:
001DC6  3  CD 10 18     	cmp numob 		; are we checking past the end?
001DC9  3  90 01        	bcc :+
001DCB  3  60           	rts			; yes, can't drop non-existent item.
001DCC  3               :
001DCC  3  20 95 1D     	jsr gotob		; make sure object is in inventory.
001DCF  3  C5 rr        	cmp scno		; already on this screen?
001DD1  3  D0 01        	bne :+
001DD3  3  60           	rts			; yes, nothing to do.
001DD4  3               :
001DD4  3  A0 20        	ldy #32
001DD6  3  A5 rr        	lda scno
001DD8  3  91 rr        	sta (z80_hl),y		; bring onto screen.
001DDA  3  A5 rr        	lda dispy		; sprite y coordinate.
001DDC  3  C8           	iny
001DDD  3  91 rr        	sta (z80_hl),y		; point to object y.
001DDF  3  A5 rr        	lda dispx 		; sprite x coordinate.
001DE1  3  C8           	iny
001DE2  3  91 rr        	sta (z80_hl),y 		; point to object x
001DE4  3  4C 43 1D     	jmp dobj		; draw the object sprite.
001DE7  3               
001DE7  3               ;-----------------------------------------------
001DE7  3               ; Seek objects at sprite position.
001DE7  3               ;
001DE7  3               ; Output:
001DE7  3               ;  A = object number, if not found A=255
001DE7  3               ;-----------------------------------------------
001DE7  3               
001DE7  3               skobj:
001DE7  3  A9 D6        	lda #<(objdta + data_address - data_start) 		; pointer to objects.
001DE9  3  85 rr        	sta z80_l
001DEB  3  A9 B2        	lda #>(objdta + data_address - data_start)
001DED  3  85 rr        	sta z80_h
001DEF  3               
001DEF  3  AD 10 18     	lda numob 		; number of objects in game.
001DF2  3  85 rr        	sta z80_b 		; set up the loop counter.
001DF4  3               skobj0:
001DF4  3  A5 rr        	lda scno		; current room number.
001DF6  3  A0 20        	ldy #32
001DF8  3  D1 rr        	cmp (z80_hl),y		; is object in here?
001DFA  3  D0 03        	bne :+
001DFC  3  20 11 1E     	jsr skobj1		; yes, check coordinates.
001DFF  3               :
001DFF  3  18           	clc			; point to next object in table.
001E00  3  A5 rr        	lda z80_l
001E02  3  69 26        	adc #38			; size of each object.
001E04  3  85 rr        	sta z80_l
001E06  3  90 02        	bcc :+
001E08  3  E6 rr        	inc z80_h
001E0A  3               :
001E0A  3  C6 rr        	dec z80_b
001E0C  3  D0 E6        	bne skobj0		; repeat for all objects.
001E0E  3               
001E0E  3  A9 FF        	lda #255		; end of list and nothing found, return 255.
001E10  3  60           	rts
001E11  3               
001E11  3               skobj1:
001E11  3  A0 21        	ldy #33			; point to y coordinate.
001E13  3  B1 rr        	lda (z80_hl),y		; point to y coordinate.
001E15  3  38           	sec
001E16  3  A0 08        	ldy #var_newY
001E18  3  F1 rr        	sbc (z80_ix),y 		; subtract sprite y.
001E1A  3  18           	clc
001E1B  3  69 0F        	adc #15			; add sprite height minus one.
001E1D  3  C9 1F        	cmp #31			; within range?
001E1F  3  90 03        	bcc :+
001E21  3  4C 3F 1E     	jmp skobj2		; no, ignore object.
001E24  3               :
001E24  3  A0 22        	ldy #34			; point to x coordinate now.
001E26  3  B1 rr        	lda (z80_hl),y 		; get coordinate.
001E28  3  38           	sec
001E29  3  A0 09        	ldy #var_newX
001E2B  3  F1 rr        	sbc (z80_ix),y 		; subtract the sprite x.
001E2D  3  18           	clc			; add sprite width minus one.
001E2E  3  69 0F        	adc #15
001E30  3  C9 1F        	cmp #31			; within range?
001E32  3  90 03        	bcc :+
001E34  3  4C 3F 1E     	jmp skobj2		; no, ignore object.
001E37  3               :
001E37  3  68           	pla			; remove return address from stack.
001E38  3  68           	pla
001E39  3               
001E39  3  AD 10 18     	lda numob 		; objects in game.
001E3C  3  38           	sec
001E3D  3  E5 rr        	sbc z80_b		; subtract loop counter.
001E3F  3               skobj2:
001E3F  3  60           	rts			; accumulator now points to object.
001E40  3               
001E40  3               
001E40  3               ;---------------------------------------------------------------------
001E40  3               ; Spawn a new sprite.
001E40  3               ;---------------------------------------------------------------------
001E40  3               
001E40  3               spawn:
001E40  3  A9 00        	lda #<sprtab		; sprite table.
001E42  3  85 rr        	sta z80_l
001E44  3  A9 0B        	lda #>sprtab
001E46  3  85 rr        	sta z80_h
001E48  3               numsp1:
001E48  3  A9 0C        	lda #NUMSPR		; number of sprites.
001E4A  3  85 rr        	sta spcnt
001E4C  3               spaw0:
001E4C  3  A0 00        	ldy #var_Type
001E4E  3  B1 rr        	lda (z80_hl),y		; get sprite type.
001E50  3  C9 FF        	cmp #255		; is it an unused slot?
001E52  3  F0 0F        	beq spaw1 		; yes, we can use this one.
001E54  3               
001E54  3  18           	clc 			; point to next sprite in table.
001E55  3  A5 rr        	lda z80_l
001E57  3  69 11        	adc #TABSIZ		; size of each entry.
001E59  3  85 rr        	sta z80_l
001E5B  3  90 02        	bcc :+
001E5D  3  E6 rr        	inc z80_h
001E5F  3               :
001E5F  3  C6 rr        	dec spcnt		; one less iteration.
001E61  3  D0 E9        	bne spaw0		; keep going until we find a slot.
001E63  3               
001E63  3               ; Didn't find one but drop through and set up a dummy sprite instead.
001E63  3               
001E63  3               spaw1:
001E63  3  A5 rr        	lda z80_i		; address of original sprite.
001E65  3  48           	pha
001E66  3  A5 rr        	lda z80_x
001E68  3  48           	pha
001E69  3               
001E69  3  A5 rr        	lda z80_l		; store spawned sprite address.
001E6B  3  85 rr        	sta spptr
001E6D  3  A5 rr        	lda z80_h
001E6F  3  85 rr        	sta spptr+1
001E71  3               
001E71  3  A5 rr        	lda z80_c
001E73  3  A0 00        	ldy #var_Type
001E75  3  91 rr        	sta (z80_hl),y 		; set the type.
001E77  3  A0 05        	ldy #var_newType
001E79  3  91 rr        	sta (z80_hl),y		; copy
001E7B  3               
001E7B  3  A5 rr        	lda z80_b
001E7D  3  A0 01        	ldy #var_Image
001E7F  3  91 rr        	sta (z80_hl),y		; set the image.
001E81  3  A0 06        	ldy #var_newImage
001E83  3  91 rr        	sta (z80_hl),y		; copy
001E85  3               
001E85  3  A9 00        	lda #0 				; frame zero.
001E87  3  A0 02        	ldy #var_Frame
001E89  3  91 rr        	sta (z80_hl),y		; set frame.
001E8B  3  A0 07        	ldy #var_newFrame
001E8D  3  91 rr        	sta (z80_hl),y		; copy
001E8F  3               
001E8F  3  A0 09        	ldy #9
001E91  3  B1 rr        	lda (z80_ix),y 		; x coordinate.
001E93  3  A0 04        	ldy #var_X
001E95  3  91 rr        	sta (z80_hl),y		; set sprite coordinate.
001E97  3  A0 09        	ldy #var_newX
001E99  3  91 rr        	sta (z80_hl),y		; copy
001E9B  3               
001E9B  3  A0 08        	ldy #8
001E9D  3  B1 rr        	lda (z80_ix),y 		; y coordinate.
001E9F  3  A0 03        	ldy #var_Y
001EA1  3  91 rr        	sta (z80_hl),y		; set sprite coordinate.
001EA3  3  A0 08        	ldy #var_newY
001EA5  3  91 rr        	sta (z80_hl),y		; copy
001EA7  3               
001EA7  3  A0 0A        	ldy #10				; direction of original.
001EA9  3  B1 rr        	lda (z80_ix),y
001EAB  3  A0 0A        	ldy #var_Direction
001EAD  3  91 rr        	sta (z80_hl),y		; direction
001EAF  3               
001EAF  3  A9 00        	lda #0
001EB1  3  A0 0D        	ldy #var_jumpLo
001EB3  3  91 rr        	sta (z80_hl),y		; reset parameter.
001EB5  3  C8           	iny
001EB6  3  91 rr        	sta (z80_hl),y		; reset parameter.
001EB8  3  C8           	iny
001EB9  3  91 rr        	sta (z80_hl),y		; reset parameter.
001EBB  3  C8           	iny
001EBC  3  91 rr        	sta (z80_hl),y		; reset parameter.
001EBE  3               rtssp:
001EBE  3  A5 rr        	lda spptr			; address of new sprite.
001EC0  3  85 rr        	sta z80_x
001EC2  3  A5 rr        	lda spptr+1
001EC4  3  85 rr        	sta z80_i
001EC6  3               evis1:
001EC6  3  20 42 38     	jsr evnt09 			; call sprite initialisation event.
001EC9  3               
001EC9  3  A5 rr        	lda spptr 			; address of new sprite.
001ECB  3  85 rr        	sta z80_x
001ECD  3  A5 rr        	lda spptr+1
001ECF  3  85 rr        	sta z80_i
001ED1  3               
001ED1  3               	; _BEEB clipping code copied from CPC Engine - MISSING?!
001ED1  3  A0 03        	ldy #var_Y
001ED3  3  B1 rr        	lda (z80_hl), y		; old x coord
001ED5  3  C9 B1        	cmp #SpriteMaxY     ; beyond maximum?
001ED7  3  B0 03        	bcs :+				; yes, don't draw it.
001ED9  3               
001ED9  3  20 37 10     	jsr sspria 			; display the new sprite.
001EDC  3               :
001EDC  3  68           	pla					; address of original sprite.
001EDD  3  85 rr        	sta z80_x
001EDF  3  68           	pla
001EE0  3  85 rr        	sta z80_i
001EE2  3               
001EE2  3  60           	rts
001EE3  3               
001EE3  3  30 30 30 30  score:	.byte "000000"		; player"s score.
001EE7  3  30 30        
001EE9  3  30 30 30 30  hiscor:	.byte "000000"		; high score.
001EED  3  30 30        
001EEF  3  30 30 30 30  bonus:	.byte "000000"		; bonus.
001EF3  3  30 30        
001EF5  3  00 50        grbase:	.word ScreenAddr	; graphics base address.
001EF7  3               
001EF7  3               ;----------------------------------------------------
001EF7  3               ; Check y-pos
001EF7  3               ;----------------------------------------------------
001EF7  3               
001EF7  3               checkx:
001EF7  3  A5 rr        	lda dispy		; y position.
001EF9  3  C9 18        	cmp #24			; off screen?
001EFB  3  B0 01        	bcs :+
001EFD  3  60           	rts			; no, it's okay.
001EFE  3               :
001EFE  3  68           	pla			; remove return address from stack.
001EFF  3  85 rr        	sta z80_l
001F01  3  68           	pla
001F02  3  85 rr        	sta z80_h
001F04  3  60           	rts
001F05  3               
001F05  3               ;-----------------------------------------------
001F05  3               ; Displays the current high score.
001F05  3               ;-----------------------------------------------
001F05  3               
001F05  3               dhisc:
001F05  3  A9 E9        	lda #<hiscor 		; high score text.
001F07  3  85 rr        	sta z80_l
001F09  3  A9 1E        	lda #>hiscor
001F0B  3  85 rr        	sta z80_h
001F0D  3  4C 18 1F     	jmp dscor1		; check in printable range then show 6 digits.
001F10  3               
001F10  3               ;------------------------------------------------------
001F10  3               ; Displays the current score.
001F10  3               ;------------------------------------------------------
001F10  3               
001F10  3               dscor:
001F10  3  A9 E3        	lda #<score		; score text.
001F12  3  85 rr        	sta z80_l
001F14  3  A9 1E        	lda #>score
001F16  3  85 rr        	sta z80_h
001F18  3               dscor1:
001F18  3  20 E7 24     	jsr preprt		; set up font and print position.
001F1B  3  20 F7 1E     	jsr checkx		; make sure we're in a printable range.
001F1E  3               
001F1E  3  A9 06        	lda #6			; digits to display.
001F20  3  85 rr        	sta z80_b
001F22  3  A5 rr        	lda prtmod		; get print mode.
001F24  3  F0 03        	beq :+			; standard size text?
001F26  3  4C 45 1F     	jmp bscor0		; no, show double-height.
001F29  3               :
001F29  3               dscor0:
001F29  3  A0 00        	ldy #0
001F2B  3  B1 rr        	lda (z80_hl),y 		; fetch character.
001F2D  3  20 C0 12     	jsr pchar 		; display character.
001F30  3  E6 rr        	inc dispx		; move along x coordinate
001F32  3               
001F32  3  E6 rr        	inc z80_l		; next score column.
001F34  3  D0 02        	bne :+
001F36  3  E6 rr        	inc z80_h
001F38  3               :
001F38  3  C6 rr        	dec z80_b
001F3A  3  D0 ED        	bne dscor0 		; repeat for all digits.
001F3C  3               dscor2:
001F3C  3  A5 rr        	lda dispx 		; set up display coordinates.
001F3E  3  85 rr        	sta charx
001F40  3  A5 rr        	lda dispy
001F42  3  85 rr        	sta chary
001F44  3  60           	rts
001F45  3               
001F45  3               ;------------------------------------------------------
001F45  3               ; Displays the current score in double-height characters.
001F45  3               ;
001F45  3               ; Input:
001F45  3               ;  B  = digit number
001F45  3               ;  HL = score string
001F45  3               ;------------------------------------------------------
001F45  3               
001F45  3               bscor0:
001F45  3  A0 00        	ldy #0
001F47  3               
001F47  3  B1 rr        	lda (z80_hl),y 		; fetch character.
001F49  3  20 6A 24     	jsr bchar 		; display big char.
001F4C  3               
001F4C  3  E6 rr        	inc z80_l 		; next score column.
001F4E  3  D0 02        	bne :+
001F50  3  E6 rr        	inc z80_h
001F52  3               :
001F52  3  C6 rr        	dec z80_b
001F54  3  F0 03        	beq :+
001F56  3  4C 45 1F     	jmp bscor0 		; repeat for all digits.
001F59  3               :
001F59  3  4C 3C 1F     	jmp dscor2 		; tidy up line and column variables.
001F5C  3               
001F5C  3               ;-----------------------------------------------------
001F5C  3               ; Adds number in the hl pair to the score.
001F5C  3               ;-----------------------------------------------------
001F5C  3               
001F5C  3               addsc:
001F5C  3  A9 E4        	lda #<(score+1) 	; ten thousands column.
001F5E  3  85 rr        	sta z80_e
001F60  3  A9 1E        	lda #>(score+1)
001F62  3  85 rr        	sta z80_d
001F64  3  A9 10        	lda #<10000		; amount to add each time.
001F66  3  85 rr        	sta z80_c
001F68  3  A9 27        	lda #>10000
001F6A  3  85 rr        	sta z80_b
001F6C  3  20 B0 1F     	jsr incsc		; add to score.
001F6F  3               
001F6F  3  E6 rr        	inc z80_e		; thousands column.
001F71  3  D0 02        	bne :+
001F73  3  E6 rr        	inc z80_d
001F75  3               :
001F75  3  A9 E8        	lda #<1000		; amount to add each time.
001F77  3  85 rr        	sta z80_c
001F79  3  A9 03        	lda #>1000
001F7B  3  85 rr        	sta z80_b
001F7D  3  20 B0 1F     	jsr incsc 		; add to score.
001F80  3               
001F80  3  E6 rr        	inc z80_e		; hundreds column.
001F82  3  D0 02        	bne :+
001F84  3  E6 rr        	inc z80_d
001F86  3               :
001F86  3  A9 64        	lda #<100		; amount to add each time.
001F88  3  85 rr        	sta z80_c
001F8A  3  A9 00        	lda #>100
001F8C  3  85 rr        	sta z80_b
001F8E  3  20 B0 1F     	jsr incsc		; add to score.
001F91  3               
001F91  3  E6 rr        	inc z80_e 		; tens column.
001F93  3  D0 02        	bne :+
001F95  3  E6 rr        	inc z80_d
001F97  3               :
001F97  3  A9 0A        	lda #<10		; amount to add each time.
001F99  3  85 rr        	sta z80_c
001F9B  3  A9 00        	lda #>10
001F9D  3  85 rr        	sta z80_b
001F9F  3  20 B0 1F     	jsr incsc 		; add to score.
001FA2  3               
001FA2  3  E6 rr        	inc z80_e		; units column.
001FA4  3  D0 02        	bne :+
001FA6  3  E6 rr        	inc z80_d
001FA8  3               :
001FA8  3  A9 01        	lda #<1			; units.
001FAA  3  85 rr        	sta z80_c
001FAC  3  A9 00        	lda #>1
001FAE  3  85 rr        	sta z80_b
001FB0  3               incsc:
001FB0  3  A5 rr        	lda z80_h		; store amount to add.
001FB2  3  48           	pha
001FB3  3  A5 rr        	lda z80_l
001FB5  3  48           	pha
001FB6  3               
001FB6  3  38           	sec			; subtract from amount to add.
001FB7  3  A5 rr        	lda z80_l
001FB9  3  E5 rr        	sbc z80_c
001FBB  3  85 rr        	sta z80_l
001FBD  3  A5 rr        	lda z80_h
001FBF  3  E5 rr        	sbc z80_b
001FC1  3  85 rr        	sta z80_h
001FC3  3  90 14        	bcc incsc0		; too much, restore value.
001FC5  3               
001FC5  3  68           	pla			; delete the previous amount from the stack.
001FC6  3  68           	pla
001FC7  3               
001FC7  3  A5 rr        	lda z80_d 		; store column position.
001FC9  3  48           	pha
001FCA  3  A5 rr        	lda z80_e
001FCC  3  48           	pha
001FCD  3  20 E0 1F     	jsr incsc2		; do the increment.
001FD0  3               
001FD0  3  68           	pla			; restore column.
001FD1  3  85 rr        	sta z80_e
001FD3  3  68           	pla
001FD4  3  85 rr        	sta z80_d
001FD6  3  4C B0 1F     	jmp incsc		; repeat until all added.
001FD9  3               
001FD9  3               incsc0:
001FD9  3  68           	pla			; restore previous value.
001FDA  3  85 rr        	sta z80_l
001FDC  3  68           	pla
001FDD  3  85 rr        	sta z80_h
001FDF  3  60           	rts
001FE0  3               incsc2:
001FE0  3  A0 00        	ldy #0
001FE2  3  B1 rr        	lda (z80_de),y 		; get amount.
001FE4  3  18           	clc
001FE5  3  69 01        	adc #1			; add one to column.
001FE7  3  91 rr        	sta (z80_de),y		; write new column total.
001FE9  3  C9 3A        	cmp #'9'+1		; gone beyond range of digits?
001FEB  3  B0 01        	bcs :+
001FED  3  60           	rts			; no, carry on.
001FEE  3               :
001FEE  3  A9 30        	lda #'0'		; make it zero.
001FF0  3  91 rr        	sta (z80_de),y		; write new column total.
001FF2  3  C6 rr        	dec z80_e		; back one column.
001FF4  3  D0 02        	bne :+
001FF6  3  C6 rr        	dec z80_d
001FF8  3               :
001FF8  3  4C E0 1F     	jmp incsc2
001FFB  3               
001FFB  3               ;------------------------------------
001FFB  3               ; Add bonus to score and reset bonus
001FFB  3               ;------------------------------------
001FFB  3               
001FFB  3               addbo:
001FFB  3  A2 05        	ldx #5			; last digit.
001FFD  3  18           	clc			; clear carry.
001FFE  3               addbo0:
001FFE  3  BD E3 1E     	lda score,x		; get score.
002001  3  7D EF 1E     	adc bonus,x		; add bonus.
002004  3  38           	sec			; 0 to 18.
002005  3  E9 30        	sbc #48
002007  3  48           	pha
002008  3  A9 30        	lda #'0'
00200A  3  9D EF 1E     	sta bonus,x		; zeroise bonus.
00200D  3  68           	pla
00200E  3  C9 3A        	cmp #58			; carried?
002010  3  B0 07        	bcs addbo2		; no, do next one.
002012  3  38           	sec
002013  3  E9 0A        	sbc #10			; subtract 10.
002015  3  38           	sec
002016  3  4C 1A 20     	jmp addbo1
002019  3               addbo2:
002019  3  18           	clc
00201A  3               addbo1:
00201A  3  9D E3 1E     	sta score,x		; write new score.
00201D  3  CA           	dex			; next digit.
00201E  3  10 DE        	bpl addbo0		; repeat for all 6 digits.
002020  3  60           	rts
002021  3               
002021  3               ;------------------------------------
002021  3               ; Swap score and bonus.
002021  3               ;------------------------------------
002021  3               
002021  3               swpsb:
002021  3  A2 05        	ldx #5			; digits to add.
002023  3               swpsb0:
002023  3  BD E3 1E     	lda score,x 		; get score digits.
002026  3  48           	pha			; save digit
002027  3  BD EF 1E     	lda bonus,x 		; get bonus digits.
00202A  3  9D E3 1E     	sta score,x		; switch score-bonus
00202D  3  68           	pla
00202E  3  9D EF 1E     	sta bonus,x
002031  3  CA           	dex 			; repeat for all 6 digits.
002032  3  10 EF        	bpl swpsb0
002034  3  60           	rts
002035  3               
002035  3               ;----------------------------------------------
002035  3               ; Write block
002035  3               ;----------------------------------------------
002035  3               
002035  3               ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
002035  3               .if aflag
002035  3               wbloc:
002035  3               	ldy #3
002035  3               	sta (pbptr),y		; store block number
002035  3               	dey
002035  3               	lda dispx
002035  3               	sta (pbptr),y		; write x position of block.
002035  3               	dey
002035  3               	lda dispy
002035  3               	sta (pbptr),y		; write y position of block.
002035  3               	dey
002035  3               	lda scno
002035  3               	sta (pbptr),y		; write screen.
002035  3               	clc			; point to next free location
002035  3               	lda pbptr
002035  3               	adc #4
002035  3               	sta pbptr
002035  3               	bcc :+
002035  3               	inc pbptr+1
002035  3               :
002035  3               	rts
002035  3               .endif
002035  3               ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
002035  3               
002035  3               ;----------------------------------------------
002035  3               ; Print character pixels, no more.
002035  3               ;
002035  3               ; Input:
002035  3               ;  A	= character to print
002035  3               ;----------------------------------------------
002035  3               
002035  3               pchr:
002035  3  20 C0 12     	jsr pchar 		; show character in accumulator.
002038  3  E6 rr        	inc dispx		; move along one.
00203A  3  60           	rts
00203B  3               
00203B  3               ;----------------------------------------------------
00203B  3               ; Shifter sprite routine for objects.
00203B  3               ;----------------------------------------------------
00203B  3               
00203B  3               sprit7:
00203B  3  A5 rr        	lda z80_b
00203D  3  F0 0A        	beq sprit0
00203F  3  A8           	tay
002040  3               sprit3:
002040  3  46 rr        	lsr spr			; shift into position.
002042  3  66 rr        	ror spr+1
002044  3  66 rr        	ror spr+2
002046  3  88           	dey				; one less iteration.
002047  3  D0 F7        	bne sprit3
002049  3               sprit0:
002049  3  60           	rts 			; now apply to screen.
00204A  3               
00204A  3               ;-----------------------------------------------------------
00204A  3               ; Get room address.
00204A  3               ;-----------------------------------------------------------
00204A  3               
00204A  3               groom:
00204A  3  A6 rr        	ldx scno 		; screen number.
00204C  3  A0 00        	ldy #0
00204E  3               groomx:
00204E  3  A9 65        	lda #<(scdat + data_address - data_start) 		; pointer to screens.
002050  3  85 rr        	sta z80_l
002052  3  A9 8E        	lda #>(scdat + data_address - data_start)
002054  3  85 rr        	sta z80_h
002056  3               groom1:
002056  3  E0 00        	cpx #0			; is it the first one?
002058  3  F0 15        	beq groom0 		; no more screens to skip.
00205A  3               
00205A  3  18           	clc
00205B  3  A5 rr        	lda z80_l
00205D  3  79 65 8E     	adc scdat + data_address - data_start,y 		; low byte of screen size.
002060  3  85 rr        	sta z80_l
002062  3  C8           	iny			; point to high byte.
002063  3  A5 rr        	lda z80_h
002065  3  79 65 8E     	adc scdat + data_address - data_start,y 		; high byte of screen size.
002068  3  85 rr        	sta z80_h
00206A  3  C8           	iny			; next address.
00206B  3               
00206B  3  CA           	dex 			; one less iteration.
00206C  3  4C 56 20     	jmp groom1 		; loop until we reach the end.
00206F  3               groom0:
00206F  3  AD F9 B0     	lda numsc + data_address - data_start 		; add displacement.
002072  3  0A           	asl a
002073  3  18           	clc			; add double displacement to address.
002074  3  65 rr        	adc z80_l
002076  3  85 rr        	sta z80_l
002078  3  A5 rr        	lda z80_h
00207A  3  69 00        	adc #0
00207C  3  85 rr        	sta z80_h
00207E  3  60           	rts
00207F  3               
00207F  3               ;-----------------------------------------------------------
00207F  3               ; Draw present room.
00207F  3               ;-----------------------------------------------------------
00207F  3               
00207F  3               droom:
00207F  3  AD 0C 18     	lda wintop 		; window top.
002082  3  85 rr        	sta dispy		; set cursor y position.
002084  3               droom2:
002084  3  20 4A 20     	jsr groom 		; get address of current room.
002087  3  A9 00        	lda #0	 		; zero in accumulator.
002089  3  85 rr        	sta comcnt 		; reset compression counter.
00208B  3  AD 0E 18     	lda winhgt 		; height of window.
00208E  3  85 rr        	sta rrow		; set row counter
002090  3               droom0:
002090  3  AD 0D 18     	lda winlft 		; window left edge.
002093  3  85 rr        	sta dispx 		; set cursor x position.
002095  3  AD 0F 18     	lda winwid 		; width of window.
002098  3  85 rr        	sta rcol		; set column counter
00209A  3               droom1:
00209A  3  20 AB 20     	jsr flbyt 		; decompress next byte on the fly.
00209D  3  20 6C 13     	jsr pattr2 		; show attributes and block.
0020A0  3  C6 rr        	dec rcol		; one less column.
0020A2  3  D0 F6        	bne droom1 		; repeat for entire line.
0020A4  3  E6 rr        	inc dispy		; move down one line.
0020A6  3  C6 rr        	dec rrow 		; one less row.
0020A8  3  D0 E6        	bne droom0 		; repeat for all rows.
0020AA  3  60           	rts
0020AB  3               
0020AB  3               ;----------------------------------------------
0020AB  3               ; Decompress bytes on-the-fly.
0020AB  3               ;----------------------------------------------
0020AB  3               
0020AB  3               flbyt:
0020AB  3  A5 rr        	lda comcnt 		; compression counter.
0020AD  3  D0 21        	bne flbyt1		; any more to decompress?  yes.
0020AF  3               
0020AF  3  A0 00        	ldy #0
0020B1  3  B1 rr        	lda (z80_hl),y 		; fetch next byte.
0020B3  3  E6 rr        	inc z80_l 		; point to next cell.
0020B5  3  D0 02        	bne :+
0020B7  3  E6 rr        	inc z80_h
0020B9  3               :
0020B9  3  C9 FF        	cmp #255 		; is this byte a control code?
0020BB  3  F0 01        	beq :+
0020BD  3  60           	rts 			; no, this byte is uncompressed.
0020BE  3               :
0020BE  3  B1 rr        	lda (z80_hl),y 		; fetch byte type.
0020C0  3  85 rr        	sta combyt 		; set up the type.
0020C2  3  E6 rr        	inc z80_l 		; point to quantity.
0020C4  3  D0 02        	bne :+
0020C6  3  E6 rr        	inc z80_h
0020C8  3               :
0020C8  3  B1 rr        	lda (z80_hl),y 		; get quantity.
0020CA  3  E6 rr        	inc z80_l 		; point to next byte.
0020CC  3  D0 02        	bne :+
0020CE  3  E6 rr        	inc z80_h
0020D0  3               :
0020D0  3               flbyt1:
0020D0  3  85 rr        	sta comcnt 		; store new quantity.
0020D2  3  C6 rr        	dec comcnt		; one less.
0020D4  3  A5 rr        	lda combyt 		; byte to expand.
0020D6  3  60           	rts
0020D7  3               
0020D7  3               ;------------------------------------------
0020D7  3               ; Ladder down check.
0020D7  3               ;
0020D7  3               ; Input:
0020D7  3               ;  IX = sprite pointer
0020D7  3               ;------------------------------------------
0020D7  3               
0020D7  3               laddd:
0020D7  3  A0 09        	ldy #var_newX
0020D9  3  B1 rr        	lda (z80_ix),y		; x coordinate.
0020DB  3  85 rr        	sta dispx
0020DD  3               
0020DD  3  A0 08        	ldy #var_newY
0020DF  3  B1 rr        	lda (z80_ix),y		; y coordinate.
0020E1  3  29 FE        	and #254		; make it even.
0020E3  3  91 rr        	sta (z80_ix),y 		; reset it.
0020E5  3               numsp5:
0020E5  3  18           	clc 			; look down 16 pixels.
0020E6  3  69 10        	adc #16
0020E8  3  85 rr        	sta dispy		; coords in dispx,dispy.
0020EA  3  4C 00 21     	jmp laddv
0020ED  3               
0020ED  3               ;------------------------------------------
0020ED  3               ; Ladder up check.
0020ED  3               ;
0020ED  3               ; Input:
0020ED  3               ;  IX = sprite pointer
0020ED  3               ;
0020ED  3               ; Output:
0020ED  3               ;  A  = 0 is ok, A <>0 is not ok
0020ED  3               ;------------------------------------------
0020ED  3               
0020ED  3               laddu:
0020ED  3  A0 09        	ldy #var_newX
0020EF  3  B1 rr        	lda (z80_ix),y		; x coordinate.
0020F1  3  85 rr        	sta dispx
0020F3  3               
0020F3  3  A0 08        	ldy #var_newY
0020F5  3  B1 rr        	lda (z80_ix),y		; y coordinate.
0020F7  3  29 FE        	and #254 		; make it even.
0020F9  3  91 rr        	sta (z80_ix),y		; reset it.
0020FB  3               numsp6:
0020FB  3  18           	clc 			; look 2 pixels above feet.
0020FC  3  69 0E        	adc #14
0020FE  3  85 rr        	sta dispy		; coords in dispx,dispy.
002100  3               laddv:
002100  3  20 42 23     	jsr tstbl 		; get map address.
002103  3  20 0D 22     	jsr ldchk 		; standard ladder check.
002106  3  F0 01        	beq :+
002108  3  60           	rts 			; no way through.
002109  3               :
002109  3  E6 rr        	inc bufaddr 		; look right one cell.
00210B  3  D0 02        	bne :+
00210D  3  E6 rr        	inc bufaddr+1
00210F  3               :
00210F  3  20 0D 22     	jsr ldchk 		; do the check.
002112  3  F0 01        	beq :+
002114  3  60           	rts 			; impassable.
002115  3               :
002115  3  A5 rr        	lda dispx 		; y coordinate.
002117  3  29 07        	and #7 			; position straddling block cells.
002119  3  D0 01        	bne :+
00211B  3  60           	rts 			; no more checks needed.
00211C  3               :
00211C  3  E6 rr        	inc bufaddr 		; look to third cell.
00211E  3  D0 02        	bne :+
002120  3  E6 rr        	inc bufaddr+1
002122  3               :
002122  3  20 0D 22     	jsr ldchk 		; do the check.
002125  3  60           	rts  			; return with zero flag set accordingly.
002126  3               
002126  3               ;---------------------------------------------------------
002126  3               ; Can go up check.
002126  3               ;
002126  3               ; Input:
002126  3               ;  IX = sprite pointer
002126  3               ;
002126  3               ; Output:
002126  3               ;  A  = 0 is ok, A <>0 is not ok
002126  3               ;---------------------------------------------------------
002126  3               
002126  3               cangu:
002126  3  A0 09        	ldy #var_newX
002128  3  B1 rr        	lda (z80_ix),y		; x coordinate.
00212A  3  85 rr        	sta dispx
00212C  3  A0 08        	ldy #var_newY
00212E  3  B1 rr        	lda (z80_ix),y 		; y coordinate.
002130  3  38           	sec
002131  3  E9 02        	sbc #2
002133  3  85 rr        	sta dispy		; coords in dispx,dispy.
002135  3  20 42 23     	jsr tstbl 		; get map address.
002138  3  20 D8 21     	jsr lrchk 		; standard left/right check.
00213B  3  F0 01        	beq :+
00213D  3  60           	rts			; no way through.
00213E  3               :
00213E  3  E6 rr        	inc bufaddr		; look right one cell.
002140  3  D0 02        	bne :+
002142  3  E6 rr        	inc bufaddr+1
002144  3               :
002144  3  20 D8 21     	jsr lrchk 		; do the check.
002147  3  F0 01        	beq :+
002149  3  60           	rts			; impassable.
00214A  3               :
00214A  3  A5 rr        	lda dispx		; x coordinate.
00214C  3  29 07        	and #7			; position straddling block cells.
00214E  3  D0 01        	bne :+
002150  3  60           	rts			; no more checks needed.
002151  3               :
002151  3  E6 rr        	inc bufaddr		; look to third cell.
002153  3  D0 02        	bne :+
002155  3  E6 rr        	inc bufaddr+1
002157  3               :
002157  3  20 D8 21     	jsr lrchk		; do the check.
00215A  3  60           	rts 			; return with zero flag set accordingly.
00215B  3               
00215B  3               ;---------------------------------------------------------
00215B  3               ; Can go down check.
00215B  3               ;
00215B  3               ; Input:
00215B  3               ;  IX = sprite pointer
00215B  3               ;
00215B  3               ; Output:
00215B  3               ;  A  = 0 is ok, A <>0 is not ok
00215B  3               ;---------------------------------------------------------
00215B  3               
00215B  3               cangd:
00215B  3  A0 09        	ldy #var_newX
00215D  3  B1 rr        	lda (z80_ix),y 		; x coordinate.
00215F  3  85 rr        	sta dispx
002161  3  A0 08        	ldy #var_newY
002163  3  B1 rr        	lda (z80_ix),y		; y coordinate.
002165  3               numsp3:
002165  3  18           	clc
002166  3  69 10        	adc #16 		; look down 16 pixels.
002168  3  85 rr        	sta dispy		; coords in dispx,dispy.
00216A  3  20 42 23     	jsr tstbl 		; get map address.
00216D  3  20 ED 21     	jsr plchk 		; block, platform check.
002170  3  F0 01        	beq :+
002172  3  60           	rts			; no way through.
002173  3               :
002173  3  E6 rr        	inc bufaddr		; look right one cell.
002175  3  D0 02        	bne :+
002177  3  E6 rr        	inc bufaddr+1
002179  3               :
002179  3  20 ED 21     	jsr plchk		; block, platform check.
00217C  3  F0 01        	beq :+
00217E  3  60           	rts			; impassable.
00217F  3               :
00217F  3  A5 rr        	lda dispx		; x coordinate.
002181  3  29 07        	and #7			; position straddling block cells.
002183  3  D0 01        	bne :+
002185  3  60           	rts			; no more checks needed.
002186  3               :
002186  3  E6 rr        	inc bufaddr		; look to third cell.
002188  3  D0 02        	bne :+
00218A  3  E6 rr        	inc bufaddr+1
00218C  3               :
00218C  3  20 ED 21     	jsr plchk		; block, platform check.
00218F  3  60           	rts			; return with zero flag set accordingly.
002190  3               
002190  3               ;---------------------------------------------------------
002190  3               ; Can go left check.
002190  3               ;
002190  3               ; Input:
002190  3               ;  IX = sprite pointer
002190  3               ;
002190  3               ; Output:
002190  3               ;  A  = 0 is ok, A <>0 is not ok
002190  3               ;---------------------------------------------------------
002190  3               
002190  3               cangl:
002190  3  A0 08        	ldy #var_newY
002192  3  B1 rr        	lda (z80_ix),y 		; y coordinate.
002194  3  85 rr        	sta dispy
002196  3  A0 09        	ldy #var_newX
002198  3  B1 rr        	lda (z80_ix),y 		; x coordinate.
00219A  3  38           	sec
00219B  3  E9 02        	sbc #2			; look left 2 pixels.
00219D  3  85 rr        	sta dispx		; coords in dispx,dispy.
00219F  3  4C B1 21     	jmp cangh		; test if we can go there.
0021A2  3               
0021A2  3               ;---------------------------------------------------------
0021A2  3               ; Can go right check.
0021A2  3               ;
0021A2  3               ; Input:
0021A2  3               ;  IX = sprite pointer
0021A2  3               ;
0021A2  3               ; Output:
0021A2  3               ;  A  = 0 is ok, A <>0 is not ok
0021A2  3               ;---------------------------------------------------------
0021A2  3               
0021A2  3               cangr:
0021A2  3  A0 08        	ldy #var_newY
0021A4  3  B1 rr        	lda (z80_ix),y		; y coordinate.
0021A6  3  85 rr        	sta dispy
0021A8  3  A0 09        	ldy #var_newX
0021AA  3  B1 rr        	lda (z80_ix),y		; x coordinate.
0021AC  3  18           	clc
0021AD  3  69 10        	adc #16			; look right 16 pixels.
0021AF  3  85 rr        	sta dispx		; coords in dispx,dispy.
0021B1  3               cangh:
0021B1  3               cangh2:
0021B1  3  A9 03        	lda #3			; default rows to write.
0021B3  3  85 rr        	sta z80_b
0021B5  3  A5 rr        	lda dispy		; y position.
0021B7  3  29 07        	and #7			; does x straddle cells?
0021B9  3  D0 02        	bne cangh0		; yes, loop counter is good.
0021BB  3  C6 rr        	dec z80_b		; one less row to write.
0021BD  3               cangh0:
0021BD  3  20 42 23     	jsr tstbl		; get map address.
0021C0  3               cangh1:
0021C0  3  20 D8 21     	jsr lrchk		; standard left/right check.
0021C3  3  F0 01        	beq :+
0021C5  3  60           	rts			; no way through.
0021C6  3               :
0021C6  3  48           	pha
0021C7  3  18           	clc
0021C8  3  A5 rr        	lda bufaddr
0021CA  3  69 20        	adc #32			; look down.
0021CC  3  85 rr        	sta bufaddr
0021CE  3  90 02        	bcc :+
0021D0  3  E6 rr        	inc bufaddr+1
0021D2  3               :
0021D2  3  68           	pla
0021D3  3               
0021D3  3  C6 rr        	dec z80_b
0021D5  3  D0 E9        	bne cangh1
0021D7  3  60           	rts
0021D8  3               
0021D8  3               ;-------------------------------------
0021D8  3               ; Check left/right movement is okay.
0021D8  3               ;
0021D8  3               ; Input:
0021D8  3               ;  bufaddr = MAP + x/8 + y/8*32
0021D8  3               ;
0021D8  3               ; Output:
0021D8  3               ;  A  = 0 is ok, A <>0 is not ok
0021D8  3               ;-------------------------------------
0021D8  3               
0021D8  3               lrchk:
0021D8  3  A0 00        	ldy #0
0021DA  3  B1 rr        	lda (bufaddr),y		; fetch map cell.
0021DC  3  C9 02        	cmp #WALL 		; is it passable?
0021DE  3  F0 0A        	beq lrchkx		; no.
0021E0  3               
0021E0  3  C9 04        	cmp #FODDER		; fodder has to be dug.
0021E2  3  F0 06        	beq lrchkx		; not passable.
0021E4  3  A9 00        	lda #0
0021E6  3  60           	rts
0021E7  3               
0021E7  3               ;--------------------------------------------------------------
0021E7  3               ; Called by mmenu
0021E7  3               ;--------------------------------------------------------------
0021E7  3               
0021E7  3               always:
0021E7  3  A9 FF        	lda #255		; report it as okay.
0021E9  3  60           	rts
0021EA  3               
0021EA  3               lrchkx:
0021EA  3  A9 01        	lda #1 			; reset all bits.
0021EC  3  60           	rts
0021ED  3               
0021ED  3               
0021ED  3               ;--------------------------------------------------------------
0021ED  3               ; Check platform or solid item is not in way.
0021ED  3               ;
0021ED  3               ; Input:
0021ED  3               ;  bufaddr = MAP + x/8 + y/8*32
0021ED  3               ;
0021ED  3               ; Output:
0021ED  3               ;  A  = 0 is ok, A <>0 is not ok
0021ED  3               ;--------------------------------------------------------------
0021ED  3               
0021ED  3               plchk:
0021ED  3  A0 00        	ldy #0
0021EF  3  B1 rr        	lda (bufaddr),y 	; fetch map cell.
0021F1  3  C9 02        	cmp #WALL 		; is it passable?
0021F3  3  F0 F5        	beq lrchkx		; no.
0021F5  3               
0021F5  3  C9 04        	cmp #FODDER		; fodder has to be dug.
0021F7  3  F0 F1        	beq lrchkx		; not passable.
0021F9  3               
0021F9  3  C9 01        	cmp #PLATFM		; platform is solid.
0021FB  3  F0 07        	beq plchkx		; not passable.
0021FD  3               
0021FD  3  C9 03        	cmp #LADDER		; is it a ladder?
0021FF  3  F0 E9        	beq lrchkx		; on ladder, deny movement.
002201  3               plchk0:
002201  3  A9 00        	lda #0			; report as ok
002203  3  60           	rts
002204  3               plchkx:
002204  3  A5 rr        	lda dispy		; x coordinate.
002206  3  29 07        	and #7			; position straddling blocks.
002208  3  F0 E0        	beq lrchkx		; on platform, deny movement.
00220A  3  4C 01 22     	jmp plchk0
00220D  3               
00220D  3               ;--------------------------------------------------------------
00220D  3               ; Check ladder is available.
00220D  3               ;
00220D  3               ; Input:
00220D  3               ;  bufaddr = MAP + x/8 + y/8*32
00220D  3               ;
00220D  3               ; Output:
00220D  3               ;  A  = 0 is ok, A <>0 is not ok
00220D  3               ;--------------------------------------------------------------
00220D  3               
00220D  3               ldchk:
00220D  3  A0 00        	ldy #0
00220F  3  B1 rr        	lda (bufaddr),y 	; fetch cell.
002211  3  C9 03        	cmp #LADDER 		; is it a ladder?
002213  3  F0 03        	beq :+
002215  3  A9 01        	lda #1
002217  3  60           	rts  			; return with zero flag set accordingly.
002218  3               :
002218  3  A9 00        	lda #0
00221A  3  60           	rts
00221B  3               
00221B  3               ;--------------------------------------------------------------
00221B  3               ; Get collectables.
00221B  3               ;--------------------------------------------------------------
00221B  3               
00221B  3               getcol:
00221B  3  A9 08            lda #COLECT             ; collectable blocks.
00221D  3  85 rr            sta z80_b
00221F  3  20 87 22         jsr tded                ; test for collectable blocks.
002222  3  C5 rr            cmp z80_b               ; did we find one?
002224  3  F0 01            beq :+
002226  3  60               rts                     ; none were found, job done.
002227  3               :
002227  3  20 30 22         jsr gtblk               ; get block.
00222A  3               
00222A  3  20 D9 3B         jsr evnt20              ; collected block event.
00222D  3  4C 1B 22         jmp getcol              ; repeat until none left.
002230  3               
002230  3               ; Get collectable block.
002230  3               
002230  3               gtblk:
002230  3  A0 00        	ldy #0
002232  3  B1 rr        	lda (bufaddr),y
002234  3  85 rr        	sta z80_a
002236  3  A9 00                lda #0
002238  3  91 rr                sta (bufaddr),y		; make it empty now.
00223A  3               
00223A  3  A5 rr        	lda bufaddr		; set dispx
00223C  3  29 1F        	and #31
00223E  3  85 rr        	sta dispx
002240  3               
002240  3  A5 rr        	lda bufaddr+1		; Set dispy
002242  3  38           	sec
002243  3  E9 03        	sbc #>MAP
002245  3  85 rr        	sta bufaddr+1
002247  3  06 rr        	asl bufaddr
002249  3  26 rr        	rol bufaddr+1
00224B  3  06 rr        	asl bufaddr
00224D  3  26 rr        	rol bufaddr+1
00224F  3  06 rr        	asl bufaddr
002251  3  26 rr        	rol bufaddr+1
002253  3  A5 rr        	lda bufaddr+1
002255  3  85 rr        	sta dispy
002257  3               
002257  3  A5 rr        	lda colpatt		; get blocknr
002259  3  85 rr        	sta z80_e		; displacement in e.
00225B  3  A9 00        	lda #0
00225D  3  85 rr        	sta z80_d		; no high byte.
00225F  3  06 rr        	asl z80_e  		; multiply char by 8.
002261  3  26 rr        	rol z80_d
002263  3  06 rr        	asl z80_e
002265  3  26 rr        	rol z80_d
002267  3  06 rr        	asl z80_e
002269  3  26 rr        	rol z80_d
00226B  3  18           	clc
00226C  3  A5 rr        	lda z80_e
00226E  3  69 2E        	adc #<(chgfx + data_address - data_start) 		; address of graphics.
002270  3  85 rr        	sta tileaddr
002272  3  A5 rr        	lda z80_d
002274  3  69 84        	adc #>(chgfx + data_address - data_start)
002276  3  85 rr        	sta tileaddr+1
002278  3  20 0E 13     	jsr gprad 		; get screen address.
00227B  3  A0 07        	ldy #7			; number of pixel rows to write.
00227D  3               gtblk0:
00227D  3  B1 rr        	lda (tileaddr),y 	; get image byte.
00227F  3  51 rr        	eor (scraddr),y 	; XOR tile on screen
002281  3  91 rr        	sta (scraddr),y 	; copy to screen.
002283  3  88           	dey	 		; repeat for 8 pixel rows.
002284  3  10 F7        	bpl gtblk0
002286  3  60           	rts
002287  3               
002287  3               ;--------------------------------------------------------------
002287  3               ; Touched deadly block check.
002287  3               ; returns with DEADLY (must be non-zero) in accumulator if true.
002287  3               ;
002287  3               ; Input:
002287  3               ;  IX = sprite address
002287  3               ;
002287  3               ; Output:
002287  3               ;  A  = 0 is ok, A=5 is not ok
002287  3               ;--------------------------------------------------------------
002287  3               
002287  3               tded:
002287  3  A0 08        	ldy #var_newY
002289  3  B1 rr        	lda (z80_ix),y 		; y coordinate.
00228B  3  85 rr        	sta dispy
00228D  3  C8           	iny
00228E  3  B1 rr        	lda (z80_ix),y 		; x coordinate.
002290  3  85 rr        	sta dispx		; coords in dispx,dispy.
002292  3  20 42 23     	jsr tstbl		; get map address.
002295  3  48           	pha
002296  3  A9 1F        	lda #31			; default distance to next line down.
002298  3  85 rr        	sta z80_e
00229A  3  68           	pla
00229B  3  C5 rr        	cmp z80_b		; is this the required block?
00229D  3  D0 01        	bne :+
00229F  3  60           	rts			; yes.
0022A0  3               :
0022A0  3  E6 rr        	inc bufaddr 		; next cell.
0022A2  3  D0 02        	bne :+
0022A4  3  E6 rr        	inc bufaddr+1
0022A6  3               :
0022A6  3  A0 00        	ldy #0
0022A8  3  B1 rr        	lda (bufaddr),y		; fetch type.
0022AA  3  C5 rr        	cmp z80_b 		; is this deadly/custom?
0022AC  3  D0 01        	bne :+
0022AE  3  60           	rts			; yes.
0022AF  3               :
0022AF  3  A5 rr        	lda dispx		; horizontal position.
0022B1  3  85 rr        	sta z80_c 		; store column in c register.
0022B3  3  29 07        	and #7			; is it straddling cells?
0022B5  3  D0 03        	bne :+
0022B7  3  4C CB 22     	jmp tded0		; no.
0022BA  3               :
0022BA  3  E6 rr        	inc bufaddr 		; last cell.
0022BC  3  D0 02        	bne :+
0022BE  3  E6 rr        	inc bufaddr+1
0022C0  3               :
0022C0  3  A0 00        	ldy #0
0022C2  3  B1 rr        	lda (bufaddr),y 	; fetch type.
0022C4  3  C5 rr        	cmp z80_b		; is this the block?
0022C6  3  D0 01        	bne :+
0022C8  3  60           	rts			; yes.
0022C9  3               :
0022C9  3  C6 rr        	dec z80_e		; one less cell to next row down.
0022CB  3               tded0:
0022CB  3  18           	clc 			; point to next row.
0022CC  3  A5 rr        	lda bufaddr
0022CE  3  65 rr        	adc z80_e
0022D0  3  85 rr        	sta bufaddr
0022D2  3  90 02        	bcc :+
0022D4  3  E6 rr        	inc bufaddr+1
0022D6  3               :
0022D6  3  A0 00        	ldy #0
0022D8  3  B1 rr        	lda (bufaddr),y		; fetch left cell block.
0022DA  3  C5 rr        	cmp z80_b		; is this fatal?
0022DC  3  D0 01        	bne :+
0022DE  3  60           	rts			; yes.
0022DF  3               :
0022DF  3  E6 rr        	inc bufaddr 		; next cell.
0022E1  3  D0 02        	bne :+
0022E3  3  E6 rr        	inc bufaddr+1
0022E5  3               :
0022E5  3  A0 00        	ldy #0
0022E7  3  B1 rr        	lda (bufaddr),y 	; fetch type.
0022E9  3  C5 rr        	cmp z80_b		; is this fatal?
0022EB  3  D0 01        	bne :+
0022ED  3  60           	rts			; yes.
0022EE  3               :
0022EE  3  A5 rr        	lda z80_c		; horizontal position.
0022F0  3  29 07        	and #7			; is it straddling cells?
0022F2  3  D0 03        	bne :+
0022F4  3  4C 06 23     	jmp tded1 		; no.
0022F7  3               :
0022F7  3  E6 rr        	inc bufaddr		; last cell.
0022F9  3  D0 02        	bne :+
0022FB  3  E6 rr        	inc bufaddr+1
0022FD  3               :
0022FD  3  A0 00        	ldy #0
0022FF  3  B1 rr        	lda (bufaddr),y		; fetch type.
002301  3  C5 rr        	cmp z80_b		; is this fatal?
002303  3  D0 01        	bne :+
002305  3  60           	rts			; yes.
002306  3               :
002306  3               tded1:
002306  3  A5 rr        	lda dispy		; vertical position.
002308  3  29 07        	and #7 			; is it straddling cells?
00230A  3  D0 01        	bne :+
00230C  3  60           	rts			; no, job done.
00230D  3               :
00230D  3  18           	clc			; point to next row.
00230E  3  A5 rr        	lda bufaddr
002310  3  65 rr        	adc z80_e
002312  3  85 rr        	sta bufaddr
002314  3  90 02        	bcc :+
002316  3  E6 rr        	inc bufaddr+1
002318  3               :
002318  3  A0 00        	ldy #0
00231A  3  B1 rr        	lda (bufaddr),y 	; fetch left cell block.
00231C  3  C5 rr        	cmp z80_b		; is this fatal?
00231E  3  D0 01        	bne :+
002320  3  60           	rts			; yes.
002321  3               :
002321  3  E6 rr        	inc bufaddr		; next cell.
002323  3  D0 02        	bne :+
002325  3  E6 rr        	inc bufaddr+1
002327  3               :
002327  3  A0 00        	ldy #0
002329  3  B1 rr        	lda (bufaddr),y 	; fetch type.
00232B  3  C5 rr        	cmp z80_b		; is this fatal?
00232D  3  D0 01        	bne :+
00232F  3  60           	rts			; yes.
002330  3               :
002330  3  A5 rr        	lda z80_c		; horizontal position.
002332  3  29 07        	and #7			; is it straddling cells?
002334  3  D0 01        	bne :+
002336  3  60           	rts			; no.
002337  3               :
002337  3  E6 rr        	inc bufaddr		; last cell.
002339  3  D0 02        	bne :+
00233B  3  E6 rr        	inc bufaddr+1
00233D  3               :
00233D  3  A0 00        	ldy #0
00233F  3  B1 rr        	lda (bufaddr),y		; fetch final type.
002341  3  60           	rts 			; return with final type in accumulator.
002342  3               
002342  3               ;---------------------------------------------------
002342  3               ; Fetch block type at (dispx, dispy).
002342  3               ;
002342  3               ; Output:
002342  3               ;  A = block type
002342  3               ;---------------------------------------------------
002342  3               
002342  3               tstbl:
002342  3  A5 rr        	lda dispy 			; fetch y coord.
002344  3  4A           	lsr a				; bufaddr = y/8
002345  3  4A           	lsr a
002346  3  4A           	lsr a
002347  3  85 rr        	sta chary
002349  3               
002349  3  85 rr        	sta bufaddr
00234B  3  A9 00        	lda #0
00234D  3  85 rr        	sta bufaddr+1
00234F  3               
00234F  3  06 rr        	asl bufaddr  		; bufaddr = y/8 * 32
002351  3  26 rr        	rol bufaddr+1
002353  3  06 rr        	asl bufaddr
002355  3  26 rr        	rol bufaddr+1
002357  3  06 rr        	asl bufaddr
002359  3  26 rr        	rol bufaddr+1
00235B  3  06 rr        	asl bufaddr
00235D  3  26 rr        	rol bufaddr+1
00235F  3  06 rr        	asl bufaddr
002361  3  26 rr        	rol bufaddr+1
002363  3               
002363  3  A5 rr        	lda dispx			; x/8
002365  3  4A           	lsr a
002366  3  4A           	lsr a
002367  3  4A           	lsr a
002368  3  85 rr        	sta charx
00236A  3               
00236A  3  18           	clc					; bufaddr = MAP + x/8 + y/8*32
00236B  3  65 rr        	adc bufaddr
00236D  3               ;	adc #<MAP			; only works because <MAP == $0
00236D  3  85 rr        	sta bufaddr
00236F  3  A5 rr        	lda bufaddr+1
002371  3  69 03        	adc #>MAP
002373  3  85 rr        	sta bufaddr+1
002375  3               
002375  3  A0 00        	ldy #0
002377  3  B1 rr        	lda (bufaddr),y 	; fetch byte there.
002379  3  60           	rts
00237A  3               
00237A  3               ;-------------------------------------------------------------------
00237A  3               ; Jump - if we can.
00237A  3               ; Requires initial speed to be set up in accumulator prior to call.
00237A  3               ;
00237A  3               ; Input:
00237A  3               ;  IX = sprite address
00237A  3               ;-------------------------------------------------------------------
00237A  3               
00237A  3               jump:
00237A  3  A0 0D        	ldy #var_jumpLo
00237C  3  B1 rr        	lda (z80_ix),y		; jump table low.
00237E  3  A0 0E        	ldy #var_jumpHi
002380  3  11 rr        	ora (z80_ix),y		; jump table high.
002382  3  F0 01        	beq :+
002384  3  60           	rts			; already in the air.
002385  3               :
002385  3  A9 B8        	lda #>(jtab + data_address - data_start)
002387  3  A0 0E        	ldy #var_jumpHi
002389  3  91 rr        	sta (z80_ix),y		; set jump high.
00238B  3  A9 CE        	lda #<(jtab + data_address - data_start)		; jump table start.
00238D  3  A0 0D        	ldy #var_jumpLo
00238F  3  91 rr        	sta (z80_ix),y		; set jump low.
002391  3  60           	rts
002392  3               
002392  3               ; Jump table.
002392  3               
002392  3               ;jtab:
002392  3               ;	.byte 248,250,252
002392  3               ;	.byte 254,254,255
002392  3               ;	.byte 255,255,0,0
002392  3               ;	.byte 0,1,1,1,2,2
002392  3               ;	.byte 4,6,8,8,8,99
002392  3               
002392  3               ;------------------------------------------------
002392  3               ; Random numbers code.
002392  3               ; Pseudo-random number generator, 8-bit.
002392  3               ;
002392  3               ; Output:
002392  3               ;  RND = random number
002392  3               ;------------------------------------------------
002392  3               
002392  3               random:
002392  3  A5 rr        	lda seed		; get last random number.
002394  3  0A           	asl a
002395  3  0A           	asl a
002396  3  18           	clc
002397  3  65 rr        	adc seed
002399  3  18           	clc
00239A  3  69 45        	adc #$45
00239C  3  85 rr        	sta seed		; store new seed.
00239E  3  85 rr        	sta varrnd		; return number in variable.
0023A0  3  60           	rts
0023A1  3               
0023A1  3               ;-------------------------------------------------------
0023A1  3               ; Joystick and keyboard reading routines.
0023A1  3               ;
0023A1  3               ; contrl = 0, Keyboard
0023A1  3               ;          1, JoyKeyb
0023A1  3               ;          2, JoyMMC
0023A1  3               ;-------------------------------------------------------
0023A1  3               
0023A1  3               joykey:
0023A1  3  A5 rr        	lda contrl 		; control flag.
0023A3  3  C9 01        	cmp #1
0023A5  3  D0 03        	bne :+
0023A7  3  4C C5 23     	jmp joyjoy 		; read keyboard joystick
0023AA  3               :
0023AA  3  C9 02        	cmp #2
0023AC  3  D0 03        	bne :+
0023AE  3  4C FE 0E     	jmp joysin 		; read MMC joystick.
0023B1  3               :
0023B1  3               ; Keyboard controls.
0023B1  3               
0023B1  3  A9 00        	lda #0		 	; zero reading.
0023B3  3  85 rr        	sta z80_e
0023B5  3               
0023B5  3  A0 06        	ldy #6	 		; address of last key.
0023B7  3               joyke0:
0023B7  3  B9 E4 B8     	lda keys + data_address - data_start,y 		; get key from table.
0023BA  3  20 D4 0E     	jsr ktest		; being pressed?
0023BD  3  26 rr        	rol z80_e 		; rotate into reading.
0023BF  3               
0023BF  3  88           	dey		 	; next key.
0023C0  3  10 F5        	bpl joyke0 		; repeat for all keys.
0023C2  3  4C D6 23     	jmp joyjo1 		; store the value.
0023C5  3               
0023C5  3               ; Keyboard joystick controls.
0023C5  3               
0023C5  3               joyjoy:
0023C5  3  A9 00        	lda #0		 	; zero reading.
0023C7  3  85 rr        	sta z80_e
0023C9  3               
0023C9  3  A0 06        	ldy #6	 		; address of last key.
0023CB  3               joyjo3:
0023CB  3  B9 6A 0E     	lda jkeys,y 		; get key from table.
0023CE  3  20 D4 0E     	jsr ktest		; being pressed?
0023D1  3  26 rr        	rol z80_e 		; rotate into reading.
0023D3  3               
0023D3  3  88           	dey		 	; next key.
0023D4  3  10 F5        	bpl joyjo3 		; repeat for all keys.
0023D6  3               joyjo1:
0023D6  3  A5 rr        	lda z80_e 		; copy e register to accumulator.
0023D8  3               joyjo2:
0023D8  3  85 rr        	sta joyval		; remember value.
0023DA  3  60           	rts
0023DB  3               
0023DB  3               ;---------------------------------------------------------------
0023DB  3               ; Display message.
0023DB  3               ;
0023DB  3               ; Input:
0023DB  3               ;  A = message number
0023DB  3               ;---------------------------------------------------------------
0023DB  3               
0023DB  3               dmsg:
0023DB  3  AA           	tax
0023DC  3  A9 00        	lda #<(msgdat + data_address - data_start)		; pointer to messages.
0023DE  3  85 rr        	sta z80_l
0023E0  3  A9 80        	lda #>(msgdat + data_address - data_start)
0023E2  3  85 rr        	sta z80_h
0023E4  3  20 FA 24     	jsr getwrd		; get message number.
0023E7  3               dmsg3:
0023E7  3  20 E7 24     	jsr preprt		; pre-printing stuff.
0023EA  3  20 F7 1E     	jsr checkx		; make sure we"re in a printable range.
0023ED  3  A5 rr        	lda prtmod		; print mode.
0023EF  3  D0 47        	bne bmsg1		; no, double-height text.
0023F1  3               dmsg0:
0023F1  3  A5 rr        	lda z80_h		; store string pointer.
0023F3  3  48           	pha
0023F4  3  A5 rr        	lda z80_l
0023F6  3  48           	pha
0023F7  3               
0023F7  3  A0 00        	ldy #0
0023F9  3  B1 rr        	lda (z80_hl),y		; fetch byte to display.
0023FB  3  29 7F        	and #127		; remove any end marker.
0023FD  3  C9 0D        	cmp #ASCII_NEWLINE
0023FF  3  F0 24        	beq dmsg1
002401  3  20 C0 12     	jsr pchar		; display character.
002404  3  20 D2 24     	jsr nexpos 		; display position.
002407  3  D0 03        	bne dmsg2		; not on a new line.
002409  3  20 D9 24     	jsr nexlin		; next line down.
00240C  3               dmsg2:
00240C  3  68           	pla			; retrieve string pointer
00240D  3  85 rr        	sta z80_l
00240F  3  68           	pla
002410  3  85 rr        	sta z80_h
002412  3               
002412  3  A0 00        	ldy #0
002414  3  B1 rr        	lda (z80_hl),y		; fetch last character.
002416  3  0A           	asl a  			; was it the end?
002417  3  90 03        	bcc :+
002419  3  4C 3C 1F     	jmp dscor2		; yes, job done.
00241C  3               :
00241C  3  E6 rr        	inc z80_l		; next character to display.
00241E  3  D0 02        	bne :+
002420  3  E6 rr        	inc z80_h
002422  3               :
002422  3  4C F1 23     	jmp dmsg0
002425  3               dmsg1:
002425  3  E6 rr        	inc dispy
002427  3  A5 rr        	lda dispy
002429  3  C9 18        	cmp #24
00242B  3  90 04        	bcc dmsg4
00242D  3  A9 00        	lda #0
00242F  3  85 rr        	sta dispy
002431  3               dmsg4:
002431  3  A9 00        	lda #0
002433  3  85 rr        	sta dispx
002435  3  4C 0C 24     	jmp dmsg2
002438  3               
002438  3               ;----------------------------------------------------------
002438  3               ; Display message in big text.
002438  3               ;
002438  3               ; Input:
002438  3               ;  HL = string pointer
002438  3               ;----------------------------------------------------------
002438  3               
002438  3               bmsg1:
002438  3  A0 00        	ldy #0
00243A  3  B1 rr        	lda (z80_hl),y 		; get character to display.
00243C  3  29 7F        	and #127		; only want 7 bits.
00243E  3  C9 0D        	cmp #ASCII_NEWLINE
002440  3  F0 13        	beq bmsg2
002442  3  20 6A 24     	jsr bchar 		; display big char.
002445  3               bmsg3:
002445  3  A0 00        	ldy #0
002447  3  B1 rr        	lda (z80_hl),y 		; look at last character.
002449  3  48           	pha
00244A  3  E6 rr        	inc z80_l 		; next character in list.
00244C  3  D0 02        	bne :+
00244E  3  E6 rr        	inc z80_h
002450  3               :
002450  3  68           	pla
002451  3  0A           	asl a  			; was terminator flag set?
002452  3  90 E4        	bcc bmsg1		; no, keep going.
002454  3               :
002454  3  60           	rts
002455  3               bmsg2:
002455  3  A9 00        	lda #0
002457  3  85 rr        	sta dispx
002459  3  E6 rr        	inc dispy
00245B  3  E6 rr        	inc dispy
00245D  3  A5 rr        	lda dispy
00245F  3  C9 17        	cmp #23
002461  3  90 E2        	bcc bmsg3
002463  3  A9 00        	lda #0
002465  3  85 rr        	sta dispy
002467  3  4C 45 24     	jmp bmsg3
00246A  3               
00246A  3               ;----------------------------------------------------------
00246A  3               ; Big character display.
00246A  3               ;
00246A  3               ; Input:
00246A  3               ;  A = character
00246A  3               ;----------------------------------------------------------
00246A  3               
00246A  3               bchar:
00246A  3  85 rr        	sta z80_e		; save char in lb
00246C  3  A9 00        	lda #0
00246E  3  85 rr        	sta z80_d		; reset hb
002470  3               
002470  3  06 rr        	asl z80_e 		; multiply char by 8.
002472  3  26 rr        	rol z80_d
002474  3  06 rr        	asl z80_e
002476  3  26 rr        	rol z80_d
002478  3  06 rr        	asl z80_e
00247A  3  26 rr        	rol z80_d		; de = a*8
00247C  3               
00247C  3  18           	clc			; de = FontPtr + a*8
00247D  3  A5 rr        	lda z80_e
00247F  3  65 rr        	adc FontPtr 		; address of font.
002481  3  85 rr        	sta z80_e
002483  3  A5 rr        	lda z80_d
002485  3  65 rr        	adc FontPtr+1
002487  3  85 rr        	sta z80_d
002489  3               
002489  3  20 0E 13     	jsr gprad 		; get screen address.
00248C  3               
00248C  3  A2 00        	ldx #0			; height of character in font.
00248E  3               bchar0:
00248E  3  A0 00        	ldy #0
002490  3  B1 rr        	lda (z80_de),y 		; get a bit of the font.
002492  3               
002492  3  49 00        	eor #TxtInvert		; Invert
002494  3               
002494  3  91 rr        	sta (scraddr),y
002496  3  48           	pha
002497  3  20 5F 11     	jsr nline 		; next line down.
00249A  3  68           	pla
00249B  3  91 rr        	sta (scraddr),y
00249D  3  20 5F 11     	jsr nline 		; next line down.
0024A0  3               
0024A0  3  18           	clc
0024A1  3  E6 rr        	inc z80_e 		; next line of font.
0024A3  3  D0 02        	bne :+
0024A5  3  E6 rr        	inc z80_d
0024A7  3               :
0024A7  3  E8           	inx
0024A8  3  E0 08        	cpx #8
0024AA  3  D0 E2        	bne bchar0
0024AC  3               
0024AC  3  20 D2 24     	jsr nexpos		; display position.
0024AF  3  D0 05        	bne bchar2 		; not on a new line.
0024B1  3               bchar3:
0024B1  3  E6 rr        	inc dispy
0024B3  3  20 D9 24     	jsr nexlin 		; next line check.
0024B6  3               bchar2:
0024B6  3  4C 3C 1F     	jmp dscor2		; tidy up line and column variables.
0024B9  3               
0024B9  3               
0024B9  3               ;-------------------------------------------------
0024B9  3               ; Display a character.
0024B9  3               ;
0024B9  3               ; Input:
0024B9  3               ;  A = character
0024B9  3               ;-------------------------------------------------
0024B9  3               
0024B9  3               achar:
0024B9  3  85 rr        	sta z80_b 		; copy to b.
0024BB  3  20 E7 24     	jsr preprt 		; get ready to print.
0024BE  3  A5 rr        	lda z80_b		; character in accumulator.
0024C0  3  A6 rr        	ldx prtmod 		; print mode.
0024C2  3  F0 03        	beq :+
0024C4  3  4C 6A 24     	jmp bchar 		; no, double-height text.
0024C7  3               :
0024C7  3  20 C0 12     	jsr pchar 		; display character.
0024CA  3  20 D2 24     	jsr nexpos 		; display position.
0024CD  3  F0 E2        	beq bchar3		; next line down.
0024CF  3  4C B6 24     	jmp bchar2 		; tidy up.
0024D2  3               
0024D2  3               
0024D2  3               ;-------------------------------------------------
0024D2  3               ; Get next print column position.
0024D2  3               ;-------------------------------------------------
0024D2  3               
0024D2  3               nexpos:
0024D2  3  E6 rr        	inc dispx		; move along one position.
0024D4  3  A5 rr        	lda dispx 		; get coordinate.
0024D6  3  29 1F        	and #31
0024D8  3  60           	rts 			; return with status in zero flag.
0024D9  3               
0024D9  3               ;-------------------------------------------------
0024D9  3               ; Get next print line position.
0024D9  3               ;-------------------------------------------------
0024D9  3               
0024D9  3               nexlin:
0024D9  3  E6 rr        	inc dispy 		; newline.
0024DB  3  A5 rr        	lda dispy		; vertical position.
0024DD  3  C9 18        	cmp #24			; past screen edge?
0024DF  3  B0 01        	bcs :+
0024E1  3  60           	rts			; no, still okay.
0024E2  3               :
0024E2  3  A9 00        	lda #0			; restart at top.
0024E4  3  85 rr        	sta dispy
0024E6  3  60           	rts
0024E7  3               
0024E7  3               ;--------------------------------------------------------
0024E7  3               ; Pre-print preliminaries.
0024E7  3               ;--------------------------------------------------------
0024E7  3               
0024E7  3               preprt:
0024E7  3  A5 rr        	lda FontPtr		; font pointer.
0024E9  3  8D F5 1E     	sta grbase		; set up graphics base.
0024EC  3  A5 rr        	lda FontPtr+1
0024EE  3  8D F6 1E     	sta grbase+1
0024F1  3               prescr:
0024F1  3  A5 rr        	lda charx 		; display coordinates.
0024F3  3  85 rr        	sta dispx		; set up general coordinates.
0024F5  3  A5 rr        	lda chary
0024F7  3  85 rr        	sta dispy
0024F9  3  60           	rts
0024FA  3               
0024FA  3               ;--------------------------------------------------------------
0024FA  3               ; Get messagenr x in hl
0024FA  3               ;
0024FA  3               ; Input:
0024FA  3               ;  HL = pointer to message list
0024FA  3               ;  X  = message number.
0024FA  3               ;--------------------------------------------------------------
0024FA  3               
0024FA  3               getwrd:
0024FA  3  E0 00        	cpx #0
0024FC  3  D0 01        	bne:+ 			; first word in list?
0024FE  3  60           	rts 			; yep, don't search.
0024FF  3               :
0024FF  3  A0 00        	ldy #0
002501  3               getwd0:
002501  3  B1 rr        	lda (z80_hl),y
002503  3  48           	pha
002504  3  E6 rr        	inc z80_l
002506  3  D0 02        	bne :+
002508  3  E6 rr        	inc z80_h
00250A  3               :
00250A  3  68           	pla
00250B  3  C9 80        	cmp #128		; found end?
00250D  3  30 F2        	bmi getwd0		; no, carry on.
00250F  3  CA           	dex			; until we have right number.
002510  3  D0 EF        	bne getwd0
002512  3  60           	rts
002513  3               
002513  3               ;-----------------------------------------------------------
002513  3               ; Bubble sort.
002513  3               ;-----------------------------------------------------------
002513  3               
002513  3               bsort:
002513  3  A9 0B        	lda #NUMSPR - 1		; sprites to swap.
002515  3  85 rr        	sta qscnt
002517  3               
002517  3  A9 00        	lda #<sprtab 		; sprite table.
002519  3  85 rr        	sta z80_x
00251B  3  A9 0B        	lda #>sprtab
00251D  3  85 rr        	sta z80_i
00251F  3               bsort0:
00251F  3  A0 00        	ldy #0
002521  3  B1 rr        	lda (z80_ix),y 		; first sprite type.
002523  3  C9 FF        	cmp #255 		; is it switched off?
002525  3  F0 30        	beq swemp		; yes, may need to switch another in here.
002527  3               
002527  3  A0 11        	ldy #TABSIZ
002529  3  B1 rr        	lda (z80_ix),y 		; check next slot exists.
00252B  3  C9 FF        	cmp #255 		; is it enabled?
00252D  3  F0 0A        	beq bsort2 		; no, nothing to swap.
00252F  3               
00252F  3  A0 14        	ldy #TABSIZ+3
002531  3  B1 rr        	lda (z80_ix),y 		; fetch next sprite's coordinate.
002533  3  A0 03        	ldy #3
002535  3  D1 rr        	cmp (z80_ix),y 		; compare with this x coordinate.
002537  3  90 10        	bcc bsort1		; next sprite is higher - may need to switch.
002539  3               bsort2:
002539  3  18           	clc
00253A  3  A5 rr        	lda z80_x
00253C  3  69 11        	adc #TABSIZ 		; distance to next odd/even entry.
00253E  3  85 rr        	sta z80_x
002540  3  90 02        	bcc :+
002542  3  E6 rr        	inc z80_i
002544  3               :
002544  3  C6 rr        	dec qscnt
002546  3  D0 D7        	bne bsort0		; repeat for remaining sprites.
002548  3  60           	rts
002549  3               
002549  3               bsort1:
002549  3  A0 11        	ldy #TABSIZ
00254B  3  B1 rr        	lda (z80_ix),y		; sprite on/off flag.
00254D  3  C9 FF        	cmp #255		; is it enabled?
00254F  3  F0 E8        	beq bsort2		; no, nothing to swap.
002551  3  20 65 25     	jsr swspr		; swap positions.
002554  3  4C 39 25     	jmp bsort2
002557  3               swemp:
002557  3  A0 11        	ldy #TABSIZ
002559  3  B1 rr        	lda (z80_ix),y		; next table entry.
00255B  3  C9 FF        	cmp #255		; is that one on?
00255D  3  F0 DA        	beq bsort2		; no, nothing to swap.
00255F  3  20 65 25     	jsr swspr		; swap positions.
002562  3  4C 39 25     	jmp bsort2
002565  3               
002565  3               ; Swap sprites.
002565  3               
002565  3               swspr:
002565  3  A5 rr        	lda z80_x		; table address
002567  3  85 rr        	sta z80_e		; copy to de pair.
002569  3  85 rr        	sta z80_l		; copy to hl pair.
00256B  3  A5 rr        	lda z80_i
00256D  3  85 rr        	sta z80_h
00256F  3  85 rr        	sta z80_d
002571  3               
002571  3  18           	clc
002572  3  A5 rr        	lda z80_l
002574  3  69 11        	adc #TABSIZ		; distance to second entry.
002576  3  85 rr        	sta z80_l
002578  3  90 02        	bcc :+
00257A  3  E6 rr        	inc z80_h
00257C  3               :
00257C  3  A9 11        	lda #TABSIZ		; bytes to swap.
00257E  3  85 rr        	sta z80_b
002580  3  A0 00        	ldy #0
002582  3               swspr0:
002582  3  B1 rr        	lda (z80_hl),y		; fetch second byte.
002584  3  48           	pha
002585  3  B1 rr        	lda (z80_de),y 		; fetch first byte.
002587  3  91 rr        	sta (z80_hl),y 		; copy to second.
002589  3  68           	pla
00258A  3  91 rr        	sta (z80_de),y 		; copy to first sprite entry.
00258C  3               
00258C  3  E6 rr        	inc z80_e 		; next byte.
00258E  3  D0 02        	bne :+
002590  3  E6 rr        	inc z80_d
002592  3               :
002592  3  E6 rr        	inc z80_l 		; next byte.
002594  3  D0 02        	bne :+
002596  3  E6 rr        	inc z80_h
002598  3               :
002598  3  C6 rr        	dec z80_b
00259A  3  D0 E6        	bne swspr0 		; swap all bytes in table entry.
00259C  3  60           	rts
00259D  3               
00259D  3               ;----------------------------------------------------
00259D  3               ; Process sprites.
00259D  3               ;----------------------------------------------------
00259D  3               
00259D  3               pspr:
00259D  3  A9 0C        	lda #NUMSPR		; sprites to process.
00259F  3  85 rr        	sta sprptr
0025A1  3               
0025A1  3  A9 00        	lda #<sprtab 		; sprite table.
0025A3  3  85 rr        	sta z80_x
0025A5  3  A9 0B        	lda #>sprtab
0025A7  3  85 rr        	sta z80_i
0025A9  3               pspr1:
0025A9  3  A0 00        	ldy #0
0025AB  3  B1 rr        	lda (z80_ix),y		; fetch sprite type.
0025AD  3  C9 09        	cmp #9 			; within range of sprite types?
0025AF  3  B0 03        	bcs :+
0025B1  3  20 C4 25     	jsr pspr2 		; yes, process this one.
0025B4  3               :
0025B4  3  18           	clc
0025B5  3  A5 rr        	lda z80_x
0025B7  3  69 11        	adc #TABSIZ 		; distance to next odd/even entry.
0025B9  3  85 rr        	sta z80_x
0025BB  3  90 02        	bcc :+
0025BD  3  E6 rr        	inc z80_i		; next sprite.
0025BF  3               :
0025BF  3  C6 rr        	dec sprptr 		; repeat for remaining sprites.
0025C1  3  D0 E6        	bne pspr1
0025C3  3  60           	rts
0025C4  3               
0025C4  3               pspr2:
0025C4  3  A5 rr        	lda z80_x 		; store original sprite pointer.
0025C6  3  85 rr        	sta ogptr
0025C8  3  A5 rr        	lda z80_i
0025CA  3  85 rr        	sta ogptr+1
0025CC  3  20 D8 25     	jsr pspr3		; do the routine.
0025CF  3               rtorg:
0025CF  3  A5 rr        	lda ogptr 		; restore original pointer to sprite.
0025D1  3  85 rr        	sta z80_x
0025D3  3  A5 rr        	lda ogptr+1
0025D5  3  85 rr        	sta z80_i
0025D7  3               rtorg0:
0025D7  3  60           	rts
0025D8  3               
0025D8  3               pspr3:
0025D8  3  A9 0D        	lda #<evtyp0		; sprite type events list.
0025DA  3  85 rr        	sta z80_l
0025DC  3  A9 26        	lda #>evtyp0
0025DE  3  85 rr        	sta z80_h
0025E0  3               pspr4:
0025E0  3  B1 rr        	lda (z80_ix),y
0025E2  3  0A           	asl a			; double accumulator.
0025E3  3  18           	clc
0025E4  3  65 rr        	adc z80_l
0025E6  3  85 rr        	sta z80_l
0025E8  3  90 02        	bcc :+
0025EA  3  E6 rr        	inc z80_h
0025EC  3               :
0025EC  3  B1 rr        	lda (z80_hl),y
0025EE  3  85 rr        	sta z80_e 		; copy to de.
0025F0  3  48           	pha
0025F1  3               
0025F1  3  E6 rr        	inc z80_l 		; next byte of address.
0025F3  3  D0 02        	bne :+
0025F5  3  E6 rr        	inc z80_h
0025F7  3               :
0025F7  3  B1 rr        	lda (z80_hl),y 		; address high.
0025F9  3  85 rr        	sta z80_d
0025FB  3               
0025FB  3  48           	pha	 		; swap address into hl.
0025FC  3  A5 rr        	lda z80_h
0025FE  3  85 rr        	sta z80_d
002600  3  68           	pla
002601  3  85 rr        	sta z80_h
002603  3  68           	pla
002604  3  85 rr        	sta z80_l
002606  3  A5 rr        	lda z80_l
002608  3  85 rr        	sta z80_e
00260A  3               
00260A  3  6C rr rr     	jmp (z80_hl) 		; go there.
00260D  3               
00260D  3               ; Address of each sprite type's routine.
00260D  3               
00260D  3  E7 2B        evtyp0:	.word evnt00
00260F  3  6F 2F        evtyp1:	.word evnt01
002611  3  7E 2F        evtyp2:	.word evnt02
002613  3  C8 34        evtyp3:	.word evnt03
002615  3  81 35        evtyp4:	.word evnt04
002617  3  24 36        evtyp5:	.word evnt05
002619  3  4C 37        evtyp6:	.word evnt06
00261B  3  40 38        evtyp7:	.word evnt07
00261D  3  41 38        evtyp8:	.word evnt08
00261F  3               
00261F  3               ;--------------------------------------------------------------
00261F  3               ; Display sprites.
00261F  3               ;
00261F  3               ; Input:
00261F  3               ;  IX = sprite table
00261F  3               ;--------------------------------------------------------------
00261F  3               
00261F  3               dspr:
00261F  3  A9 06        	lda #(NUMSPR/2)		; number of sprites to display.
002621  3  85 rr        	sta sprcnt
002623  3               
002623  3               dspr0:
002623  3  A0 00        	ldy #var_Type
002625  3  B1 rr        	lda (z80_ix),y 		; get sprite type.
002627  3  C9 FF        	cmp #255 			; is it enabled?
002629  3  D0 45        	bne dspr1 			; yes, it needs deleting.
00262B  3               
00262B  3               dspr5:
00262B  3  A0 05        	ldy #var_newType
00262D  3  B1 rr        	lda (z80_ix),y 		; new type.
00262F  3  C9 FF        	cmp #255			; is it enabled?
002631  3  F0 03        	beq dspr2			; no, skip
002633  3  4C BF 26     	jmp dspr3 			; yes, it needs drawing.
002636  3               
002636  3               dspr2:
002636  3  A0 05        	ldy #var_newType
002638  3  B1 rr        	lda (z80_ix),y 		; copy new type.
00263A  3  A0 00        	ldy #var_Type
00263C  3  91 rr        	sta (z80_ix),y
00263E  3  A0 06        	ldy #var_newImage
002640  3  B1 rr        	lda (z80_ix),y 		; copy new image number.
002642  3  A0 01        	ldy #var_Image
002644  3  91 rr        	sta (z80_ix),y
002646  3  A0 07        	ldy #var_newFrame
002648  3  B1 rr        	lda (z80_ix),y 		; copy new frame.
00264A  3  A0 02        	ldy #var_Frame
00264C  3  91 rr        	sta (z80_ix),y
00264E  3  A0 08        	ldy #var_newY
002650  3  B1 rr        	lda (z80_ix),y 		; copy new y.
002652  3  A0 03        	ldy #var_Y
002654  3  91 rr        	sta (z80_ix),y
002656  3  A0 09        	ldy #var_newX
002658  3  B1 rr        	lda (z80_ix),y 		; copy new x.
00265A  3  A0 04        	ldy #var_X
00265C  3  91 rr        	sta (z80_ix),y
00265E  3               
00265E  3  18           	clc
00265F  3  A5 rr        	lda z80_x
002661  3  69 22        	adc #(TABSIZ*2)		; distance to next odd/even entry.
002663  3  85 rr        	sta z80_x
002665  3  A5 rr        	lda z80_i
002667  3  69 00        	adc #0
002669  3  85 rr        	sta z80_i 			; next sprite.
00266B  3  C6 rr        	dec sprcnt
00266D  3  D0 B4        	bne dspr0			; repeat for remaining sprites.
00266F  3  60           	rts
002670  3               
002670  3               dspr1:
002670  3               	; _BEEB clipping code copied from CPC Engine
002670  3  A0 03        	ldy #var_Y
002672  3  B1 rr        	lda (z80_ix), y		; old x coord
002674  3  C9 B1        	cmp #SpriteMaxY     ; beyond maximum?
002676  3  B0 B3        	bcs dspr5			; yes, don't delete it.
002678  3               
002678  3  A0 05        	ldy #var_newType
00267A  3  B1 rr        	lda (z80_ix),y 		; type of new sprite.
00267C  3  C9 FF        	cmp #255			; is this enabled?
00267E  3  D0 06        	bne dspr4 			; yes, display both.
002680  3               
002680  3               dspr6:
002680  3  20 37 10     	jsr sspria 			; show single sprite.
002683  3  4C 36 26     	jmp dspr2
002686  3               
002686  3               ; Displaying two sprites.  Don't bother redrawing if nothing has changed.
002686  3               
002686  3               dspr4:
002686  3               	; _BEEB clipping code copied from CPC Engine
002686  3  A0 08        	ldy #var_newY
002688  3  B1 rr        	lda (z80_ix), y		; old x coord
00268A  3  C9 B1        	cmp #SpriteMaxY     ; beyond maximum?
00268C  3  B0 F2        	bcs dspr6			; yes, don't display it.
00268E  3               
00268E  3  A0 04        	ldy #var_X
002690  3  B1 rr        	lda (z80_ix),y		; old x.
002692  3  A0 09        	ldy #var_newX
002694  3  D1 rr        	cmp (z80_ix),y 		; compare with new value.
002696  3  D0 21        	bne dspr7 			; they differ, need to redraw.
002698  3               
002698  3  A0 03        	ldy #var_Y
00269A  3  B1 rr        	lda (z80_ix),y		; old y.
00269C  3  A0 08        	ldy #var_newY
00269E  3  D1 rr        	cmp (z80_ix),y 		; compare against new value.
0026A0  3  D0 17        	bne dspr7			; they differ, need to redraw.
0026A2  3               
0026A2  3  A0 02        	ldy #var_Frame
0026A4  3  B1 rr        	lda (z80_ix),y 		; old frame.
0026A6  3  A0 07        	ldy #var_newFrame
0026A8  3  D1 rr        	cmp (z80_ix),y 		; compare against new value.
0026AA  3  D0 0D        	bne dspr7 			; they differ, need to redraw.
0026AC  3               
0026AC  3  A0 01        	ldy #var_Image
0026AE  3  B1 rr        	lda (z80_ix),y 		; old image.
0026B0  3  A0 06        	ldy #var_newImage
0026B2  3  D1 rr        	cmp (z80_ix),y 		; compare against new value.
0026B4  3  D0 03        	bne dspr7 			; they differ, need to redraw.
0026B6  3  4C 36 26     	jmp dspr2			; everything is the same, don't redraw.
0026B9  3               
0026B9  3               dspr7:
0026B9  3  20 6E 10     	jsr sspric 			; delete old sprite, draw new one simultaneously.
0026BC  3  4C 36 26     	jmp dspr2
0026BF  3               
0026BF  3               dspr3:
0026BF  3               	; _BEEB clipping code copied from CPC Engine
0026BF  3  A0 08        	ldy #var_newY
0026C1  3  B1 rr        	lda (z80_ix), y		; old x coord
0026C3  3  C9 B1        	cmp #SpriteMaxY     ; beyond maximum?
0026C5  3  90 03        	bcc :+				; no, continue
0026C7  3  4C 36 26     	jmp dspr2			; yes, don't display it.
0026CA  3               :
0026CA  3  20 68 10     	jsr ssprib 			; show single sprite.
0026CD  3  4C 36 26     	jmp dspr2
0026D0  3               
0026D0  3               ;-----------------------------------------
0026D0  3               ; Get sprite address calculations.
0026D0  3               ; gspran = new sprite, gsprad = old sprite.
0026D0  3               ;
0026D0  3               ; Input:
0026D0  3               ;  IX = sprite address
0026D0  3               ;-----------------------------------------
0026D0  3               
0026D0  3               gspran:
0026D0  3  A0 08        	ldy #var_newY
0026D2  3  B1 rr        	lda (z80_ix),y 		; new y coordinate.
0026D4  3  85 rr        	sta dispy
0026D6  3  A0 09        	ldy #var_newX
0026D8  3  B1 rr        	lda (z80_ix),y 		; new x coordinate.
0026DA  3  85 rr        	sta dispx
0026DC  3  A0 06        	ldy #var_newImage
0026DE  3  B1 rr        	lda (z80_ix),y 		; new sprite image.
0026E0  3  20 B2 29     	jsr gfrm		; fetch start frame for this sprite.
0026E3  3               
0026E3  3  A0 00        	ldy #0
0026E5  3  B1 rr        	lda (z80_hl),y 		; frame in accumulator.
0026E7  3  A0 07        	ldy #var_newFrame
0026E9  3  18           	clc
0026EA  3  71 rr        	adc (z80_ix),y 		; new add frame number.
0026EC  3  4C 0B 27     	jmp gspra0
0026EF  3               
0026EF  3               ;-----------------------------------------
0026EF  3               ; Calculate old sprite address
0026EF  3               ;
0026EF  3               ; Input:
0026EF  3               ;  IX = sprite address
0026EF  3               ;
0026EF  3               ; Output:
0026EF  3               ;  B  = right byte mask
0026EF  3               ;  C  = left byte mask
0026EF  3               ;  DE = spriteframe address
0026EF  3               ;  scraddr = screenaddress(dispx,dispy)
0026EF  3               ;-----------------------------------------
0026EF  3               
0026EF  3               gsprad:
0026EF  3  A0 03        	ldy #var_Y
0026F1  3  B1 rr        	lda (z80_ix),y		; y coordinate.
0026F3  3  85 rr        	sta dispy
0026F5  3  A0 04        	ldy #var_X
0026F7  3  B1 rr        	lda (z80_ix),y		; x coordinate.
0026F9  3  85 rr        	sta dispx
0026FB  3  A0 01        	ldy #var_Image
0026FD  3  B1 rr        	lda (z80_ix),y 		; sprite image.
0026FF  3  20 B2 29     	jsr gfrm 		; fetch start frame for this sprite.
002702  3               
002702  3  A0 00        	ldy #0
002704  3  B1 rr        	lda (z80_hl),y 		; frame in accumulator.
002706  3  A0 02        	ldy #var_Frame
002708  3  18           	clc
002709  3  71 rr        	adc (z80_ix),y 		; add frame number.
00270B  3               
00270B  3               gspra0:
00270B  3               .if 0
00270B  3               	lsr a	  		; multiply by 128.
00270B  3               	sta z80_d 		; store in d.
00270B  3               	lda #0
00270B  3               	ror a
00270B  3               	sta z80_e 		; got low byte.
00270B  3               .else
00270B  3  85 rr        	sta z80_e
00270D  3  A9 00        	lda #0
00270F  3  85 rr        	sta z80_d
002711  3               
002711  3  06 rr        	asl z80_e
002713  3  26 rr        	rol z80_d
002715  3  06 rr        	asl z80_e
002717  3  26 rr        	rol z80_d
002719  3  06 rr        	asl z80_e
00271B  3  26 rr        	rol z80_d
00271D  3  06 rr        	asl z80_e
00271F  3  26 rr        	rol z80_d
002721  3  06 rr        	asl z80_e
002723  3  26 rr        	rol z80_d
002725  3               
002725  3               .endif
002725  3               
002725  3  18           	clc 			; address of play sprites.
002726  3  A5 rr        	lda z80_e
002728  3  69 6D        	adc #<(sprgfx + data_address - data_start)
00272A  3  85 rr        	sta z80_e
00272C  3  A5 rr        	lda z80_d
00272E  3  69 89        	adc #>(sprgfx + data_address - data_start)
002730  3  85 rr        	sta z80_d
002732  3               
002732  3  A5 rr        	lda dispx 		; y coordinate.
002734  3  29 06        	and #6 			; position within byte boundary.
002736  3  AA           	tax	 		; low byte of table displacement.
002737  3  86 rr        	stx sprshft
002739  3               
002739  3               .if 0
002739  3               	asl a	  		; multiply by 32.
002739  3               	asl a  			; already a multiple
002739  3               	asl a  			; of 2, so just 4
002739  3               	asl a  			; shifts needed.
002739  3               
002739  3               	clc 			; add to sprite address.
002739  3               	adc z80_e
002739  3               	sta z80_e
002739  3               	bcc :+
002739  3               	inc z80_d
002739  3               :
002739  3               .endif
002739  3               
002739  3  BD 46 27     	lda spmask,x		 ; pointer to mask table.
00273C  3  85 rr        	sta z80_c 		; left mask.
00273E  3  BD 47 27     	lda spmask+1,x
002741  3  85 rr        	sta z80_b 		; right mask.
002743  3               ; Drop into screen address routine.
002743  3  4C 1C 10     	jmp scadd
002746  3               
002746  3  FF 00 3F C0  spmask:	.byte 255,0,63,192,15,240,3,252
00274A  3  0F F0 03 FC  
00274E  3               
00274E  3               
00274E  3               ;-----------------------------------------------------------
00274E  3               ; Animates a sprite.
00274E  3               ;
00274E  3               ; Input:
00274E  3               ;  IX = sprite address
00274E  3               ;  HL = last sprite address
00274E  3               ;-----------------------------------------------------------
00274E  3               
00274E  3               animsp:
00274E  3  25 rr        	and frmno
002750  3  F0 01        	beq :+
002752  3  60           	rts
002753  3               :
002753  3  A0 06        	ldy #var_newImage
002755  3  B1 rr        	lda (z80_ix),y		; sprite image
002757  3  20 B2 29     	jsr gfrm		; get frame data.
00275A  3               
00275A  3  E6 rr        	inc z80_l		; point to frames.
00275C  3  D0 02        	bne :+
00275E  3  E6 rr        	inc z80_h
002760  3               :
002760  3  A0 07        	ldy #var_newFrame
002762  3  B1 rr        	lda (z80_ix),y		; sprite frame.
002764  3  18           	clc
002765  3  69 01        	adc #1			; next one along.
002767  3  A0 00        	ldy #0
002769  3  D1 rr        	cmp (z80_hl),y		; reached the last frame?
00276B  3  90 02        	bcc anims0		; no, not yet.
00276D  3  A9 00        	lda #0			; start at first frame.
00276F  3               anims0:
00276F  3  A0 07        	ldy #var_newFrame
002771  3  91 rr        	sta (z80_ix),y		; new frame.
002773  3  60           	rts
002774  3               
002774  3               ;--------------------------------------------------------------
002774  3               ; Animate back
002774  3               ;
002774  3               ; Input:
002774  3               ;  IX = sprite address
002774  3               ;  HL = last sprite address
002774  3               ;--------------------------------------------------------------
002774  3               
002774  3               animbk:
002774  3  25 rr        	and frmno
002776  3  F0 01        	beq :+
002778  3  60           	rts
002779  3               :
002779  3  A0 06        	ldy #var_newImage
00277B  3  B1 rr        	lda (z80_ix),y		; sprite image.
00277D  3  20 B2 29     	jsr gfrm		; get frame data.
002780  3               
002780  3  E6 rr        	inc z80_l 		; point to frames.
002782  3  D0 02        	bne :+
002784  3  E6 rr        	inc z80_h
002786  3               :
002786  3  A0 07        	ldy #var_newFrame
002788  3  B1 rr        	lda (z80_ix),y 		; sprite frame.
00278A  3  F0 03        	beq :+
00278C  3  4C 93 27     	jmp rtanb0 		; yes, start at end.
00278F  3               :
00278F  3  A0 00        	ldy #0
002791  3  B1 rr        	lda (z80_hl),y 		; last sprite.
002793  3               rtanb0:
002793  3  38           	sec
002794  3  E9 01        	sbc #1			; next one along.
002796  3  4C 6F 27     	jmp anims0		; set new frame.
002799  3               
002799  3               ;--------------------------------------------------------------
002799  3               ; Check for collision with other sprite, strict enforcement.
002799  3               ;
002799  3               ; Input:
002799  3               ;  b		= sprite to test for
002799  3               ;  ix		= current sprite pointer
002799  3               ;
002799  3               ; global:	b
002799  3               ; local:	x,y,hl,de,skptr
002799  3               ; calls:	-
002799  3               ;--------------------------------------------------------------
002799  3               
002799  3               sktyp:
002799  3  A9 00        	lda #<sprtab				; sprite table.
00279B  3  85 rr        	sta z80_l
00279D  3  A9 0B        	lda #>sprtab
00279F  3  85 rr        	sta z80_h
0027A1  3               numsp2:
0027A1  3  A9 0C        	lda #NUMSPR				; number of sprites.
0027A3  3  85 rr        	sta sktptr
0027A5  3               sktyp0:
0027A5  3  A5 rr        	lda z80_l 				; store pointer to sprite.
0027A7  3  85 rr        	sta skptr
0027A9  3  A5 rr        	lda z80_h
0027AB  3  85 rr        	sta skptr+1
0027AD  3               
0027AD  3  A0 00        	ldy #0
0027AF  3  B1 rr        	lda (z80_hl),y 				; get sprite type.
0027B1  3  C5 rr        	cmp z80_b				; is it the type we seek?
0027B3  3  F0 1D        	beq coltyp				; yes, we can use this one.
0027B5  3               :
0027B5  3               sktyp1:
0027B5  3  18           	clc
0027B6  3  A5 rr        	lda skptr				; retrieve sprite pointer.
0027B8  3  69 11        	adc #TABSIZ				; size of each entry.
0027BA  3  85 rr        	sta z80_l
0027BC  3  A5 rr        	lda skptr+1
0027BE  3  69 00        	adc #0
0027C0  3  85 rr        	sta z80_h
0027C2  3  C6 rr        	dec sktptr					; one less iteration.
0027C4  3  D0 DF        	bne sktyp0				; keep going until we find a slot.
0027C6  3               :
0027C6  3  A9 00        	lda #0					; default to ROM address - no sprite.
0027C8  3  85 rr        	sta z80_l
0027CA  3  85 rr        	sta z80_h
0027CC  3  85 rr        	sta skptr				; store pointer to sprite.
0027CE  3  85 rr        	sta skptr+1
0027D0  3               
0027D0  3  18           	clc					; don't return with zero flag set.
0027D1  3  60           	rts 					; didn't find one.
0027D2  3               
0027D2  3               coltyp:
0027D2  3  A0 00        	ldy #0
0027D4  3  B1 rr        	lda (z80_ix),y				; current sprite type.
0027D6  3  C5 rr        	cmp z80_b				; seeking sprite of same type?
0027D8  3  F0 3D        	beq colty1				; yes, need to check we're not detecting ourselves.
0027DA  3               colty0:
0027DA  3  A0 09        	ldy #9					; distance to x position in table.
0027DC  3  B1 rr        	lda (z80_hl),y				; fetch x coordinate.
0027DE  3  85 rr        	sta z80_e
0027E0  3  88           	dey
0027E1  3  B1 rr        	lda (z80_hl),y				; fetch y coordinate.
0027E3  3  85 rr        	sta z80_d
0027E5  3               
0027E5  3               ; Drop into collision detection.
0027E5  3               
0027E5  3               colc16:
0027E5  3  A0 09        	ldy #9
0027E7  3  B1 rr        	lda (z80_ix),y			 	; x coord.
0027E9  3  38           	sec					; subtract x.
0027EA  3  E5 rr        	sbc z80_e
0027EC  3  B0 05        	bcs  colc1a 				; result is positive.
0027EE  3  49 FF        	eor #$ff				; make negative positive.
0027F0  3  18           	clc
0027F1  3  69 01        	adc #1
0027F3  3               colc1a:
0027F3  3  C9 10        	cmp #16 				; within x range?
0027F5  3  B0 BE        	bcs sktyp1				; no - they"ve missed.
0027F7  3  85 rr        	sta z80_c				; store difference.
0027F9  3               
0027F9  3  A0 08        	ldy #8
0027FB  3  B1 rr        	lda (z80_ix),y				; y coord.
0027FD  3  38           	sec
0027FE  3  E5 rr        	sbc z80_d				; subtract y.
002800  3  B0 05        	bcs colc1b				; result is positive.
002802  3  49 FF        	eor #$ff				; make negative positive.
002804  3  18           	clc
002805  3  69 01        	adc #1
002807  3               colc1b:
002807  3  C9 10        	cmp #16					; within y range?
002809  3  B0 AA        	bcs sktyp1 				; no - they've missed.
00280B  3  18           	clc					; add x difference.
00280C  3  65 rr        	adc z80_c
00280E  3  C9 1A        	cmp #26					; only 5 corner pixels touching?
002810  3  B0 02        	bcs :+
002812  3  38           	sec
002813  3  60           	rts 					; carry set if there's a collision.
002814  3               :
002814  3  4C B5 27     	jmp sktyp1				; try next sprite in table.
002817  3               colty1:
002817  3  A5 rr        	lda z80_x  				; compare the two.
002819  3  C5 rr        	cmp z80_l
00281B  3  D0 09        	bne end_col
00281D  3  A5 rr        	lda z80_i
00281F  3  C5 rr        	cmp z80_h
002821  3  D0 03        	bne end_col
002823  3  4C B5 27     	jmp sktyp1 				; addresses are identical.
002826  3               end_col:
002826  3  4C DA 27     	jmp colty0
002829  3               
002829  3               ;-----------------------------------------------------------
002829  3               ; Display number, left aligned
002829  3               ;
002829  3               ; Input:
002829  3               ;  a		= number
002829  3               ;
002829  3               ; global:	-
002829  3               ; local:	a,y,bc,hl,displ0
002829  3               ; calls:	num2ch,dmsg3
002829  3               ;-----------------------------------------------------------
002829  3               
002829  3               disply:
002829  3  85 rr        	sta z80_a
00282B  3  A9 51        	lda #<displ0				; display workspace.
00282D  3  85 rr        	sta z80_c
00282F  3  A9 28        	lda #>displ0
002831  3  85 rr        	sta z80_b
002833  3  A5 rr        	lda z80_a
002835  3  20 74 1C     	jsr num2ch				; convert accumulator to string.
002838  3               displ1:
002838  3  C6 rr        	dec z80_c				; back one character.
00283A  3  D0 02        	bne :+
00283C  3  C6 rr        	dec z80_b
00283E  3               :
00283E  3  A0 00        	ldy #0
002840  3  B1 rr        	lda (z80_bc),y				; fetch digit.
002842  3  09 80        	ora #128				; insert end marker.
002844  3  91 rr        	sta (z80_bc),y				; new value.
002846  3               
002846  3  A9 51        	lda #<displ0				; display space.
002848  3  85 rr        	sta z80_l
00284A  3  A9 28        	lda #>displ0
00284C  3  85 rr        	sta z80_h
00284E  3  4C E7 23     	jmp dmsg3				; display the string.
002851  3               
002851  3  00 00 00 8D  displ0:	.byte 0,0,0,13+128
002855  3               
002855  3               ;----------------------------------------------------------------
002855  3               ; Initialise screen.
002855  3               ;
002855  3               ; global:	roomtb,scno
002855  3               ; local:	-
002855  3               ; calls:	tstcs
002855  3               ;----------------------------------------------------------------
002855  3               
002855  3               initsc:
002855  3  AD 9E 2B     	lda roomtb 			; whereabouts in the map are we?
002858  3  20 62 28     	jsr tstsc 			; find displacement.
00285B  3  C9 FF        	cmp #255 			; is it valid?
00285D  3  F0 02        	beq init_end 			; no, it's rubbish.
00285F  3  85 rr        	sta scno			; store new room number.
002861  3               init_end:
002861  3  60           	rts
002862  3               
002862  3               ;----------------------------------------------------------------
002862  3               ; Test screen.
002862  3               ;
002862  3               ; global:	-
002862  3               ; local:	x
002862  3               ; calls:	-
002862  3               ;----------------------------------------------------------------
002862  3               
002862  3               tstsc:
002862  3  85 rr        	sta tmproom
002864  3  18           	clc
002865  3  69 0A        	adc #MAPWID 			; add width in case we"re negative.
002867  3  AA           	tax 				; add displacement to map data.
002868  3  BD A0 2B     	lda mapdat-MAPWID,x 		; find room number there.
00286B  3  60           	rts
00286C  3               
00286C  3               ;--------------------------
00286C  3               ; Screen left.
00286C  3               ;--------------------------
00286C  3               
00286C  3               scrl:
00286C  3  AD 9E 2B     	lda roomtb 			; present room table pointer.
00286F  3  38           	sec
002870  3  E9 01        	sbc #1				; room left.
002872  3               scrl0:
002872  3  20 62 28     	jsr tstsc			; test screen.
002875  3  C9 FF        	cmp #255			; is there a screen this way?
002877  3  D0 01        	bne :+
002879  3  60           	rts				; no, return to loop.
00287A  3               :
00287A  3  A5 rr        	lda tmproom			; restore room displacement.
00287C  3  8D 9E 2B     	sta roomtb			; new room table position.
00287F  3               scrl1:
00287F  3  20 55 28     	jsr initsc 			; set new screen.
002882  3  A9 02        	lda #2
002884  3  85 rr        	sta restfl 			; set it.
002886  3  60           	rts
002887  3               scrr:
002887  3  AD 9E 2B     	lda roomtb 			; room table pointer.
00288A  3  18           	clc
00288B  3  69 01        	adc #1				; room right.
00288D  3  4C 72 28     	jmp scrl0
002890  3               scru:
002890  3  AD 9E 2B     	lda roomtb 			; room table pointer.
002893  3  38           	sec
002894  3  E9 0A        	sbc #MAPWID 			; room up.
002896  3  4C 72 28     	jmp scrl0
002899  3               scrd:
002899  3  AD 9E 2B     	lda roomtb 			; room table pointer.
00289C  3  18           	clc
00289D  3  69 0A        	adc #MAPWID 			; room down.
00289F  3  4C 72 28     	jmp scrl0
0028A2  3               
0028A2  3               ;-----------------------------------------
0028A2  3               ; Jump to new screen.
0028A2  3               ;-----------------------------------------
0028A2  3               
0028A2  3               nwscr:
0028A2  3  A2 00        	ldx #0				; start of map data.
0028A4  3               nwscr0:
0028A4  3  DD AA 2B     	cmp mapdat,x
0028A7  3  F0 06        	beq nwscr1			; have we found a match for screen?
0028A9  3  E8           	inx 				; next room.
0028AA  3  E0 50        	cpx #80				; zero room count, 80 to search.
0028AC  3  D0 F6        	bne nwscr0			; keep looking.
0028AE  3  60           	rts
0028AF  3               nwscr1:
0028AF  3  8E 9E 2B     	stx roomtb			; set the map position.
0028B2  3  4C 7F 28     	jmp scrl1			; draw new room.
0028B5  3               
0028B5  3               
0028B5  3               ;----------------------------------------------------------
0028B5  3               ; Gravity processing.
0028B5  3               ;----------------------------------------------------------
0028B5  3               
0028B5  3               grav:
0028B5  3  A0 0D        	ldy #var_jumpLo
0028B7  3  B1 rr        	lda (z80_ix),y			; jump pointer low.
0028B9  3  85 rr        	sta z80_l
0028BB  3  A0 0E        	ldy #var_jumpHi
0028BD  3  B1 rr        	lda (z80_ix),y			; jump pointer high.
0028BF  3  85 rr        	sta z80_h
0028C1  3  05 rr        	ora z80_l			; merge in low byte.
0028C3  3  D0 01        	bne :+
0028C5  3  60           	rts				; if neither is set, we're not in the air.
0028C6  3               :
0028C6  3  A0 00        	ldy #0
0028C8  3  B1 rr        	lda (z80_hl),y			; pixels to move.
0028CA  3  85 rr        	sta z80_a
0028CC  3  C9 63        	cmp #99				; reached the end?
0028CE  3  D0 0C        	bne grav0			; no, continue.
0028D0  3               grav2:
0028D0  3  C6 rr        	dec z80_l			; go back to previous value.
0028D2  3  C9 FF        	cmp #$ff
0028D4  3  D0 02        	bne :+
0028D6  3  C6 rr        	dec z80_h
0028D8  3               :
0028D8  3  B1 rr        	lda (z80_hl),y			; fetch that from table.
0028DA  3  85 rr        	sta z80_a
0028DC  3               grav0:
0028DC  3  E6 rr        	inc z80_l			; point to next table entry.
0028DE  3  D0 02        	bne :+
0028E0  3  E6 rr        	inc z80_h
0028E2  3               :
0028E2  3  A5 rr        	lda z80_l
0028E4  3  A0 0D        	ldy #var_jumpLo
0028E6  3  91 rr        	sta (z80_ix),y			; store new pointer low.
0028E8  3  A5 rr        	lda z80_h
0028EA  3  A0 0E        	ldy #var_jumpHi
0028EC  3  91 rr        	sta (z80_ix),y			; store new pointer high.
0028EE  3               grav1:
0028EE  3  A5 rr        	lda z80_a
0028F0  3  D0 01        	bne :+				; any movement required?
0028F2  3  60           	rts				; no, not this time.
0028F3  3               :
0028F3  3  A5 rr        	lda z80_a
0028F5  3  C9 80        	cmp #128			; is it up or down?
0028F7  3  B0 15        	bcs gravu			; it's up.
0028F9  3               gravd:
0028F9  3  85 rr        	sta z80_b			; set pixels to move.
0028FB  3               gravd0:
0028FB  3  20 5B 21     	jsr cangd			; can we go down?
0028FE  3  D0 28        	bne gravst			; can't move down, so stop.
002900  3  A0 08        	ldy #var_newY
002902  3  B1 rr        	lda (z80_ix),y			; adjust new x coord.
002904  3  18           	clc
002905  3  69 01        	adc #1
002907  3  91 rr        	sta (z80_ix),y
002909  3  C6 rr        	dec z80_b
00290B  3  D0 EE        	bne gravd0
00290D  3  60           	rts
00290E  3               gravu:
00290E  3  49 FF        	eor #$ff			; flip the sign so it's positive.
002910  3  18           	clc
002911  3  69 01        	adc #1
002913  3  85 rr        	sta z80_b			; set pixels to move.
002915  3               gravu0:
002915  3  20 26 21     	jsr cangu			; can we go up?
002918  3  D0 6E        	bne ifalls			; can't move up, go down next.
00291A  3  A0 08        	ldy #var_newY
00291C  3  B1 rr        	lda (z80_ix),y
00291E  3  38           	sec
00291F  3  E9 01        	sbc #1
002921  3  91 rr        	sta (z80_ix),y			; adjust new x coord.
002923  3  C6 rr        	dec z80_b
002925  3  D0 EE        	bne gravu0
002927  3  60           	rts
002928  3               gravst:
002928  3  A0 0D        	ldy #var_jumpLo
00292A  3  B1 rr        	lda (z80_ix),y			; jump pointer low.
00292C  3  85 rr        	sta z80_l
00292E  3  A0 0E        	ldy #var_jumpHi
002930  3  B1 rr        	lda (z80_ix),y			; jump pointer high.
002932  3  85 rr        	sta z80_h
002934  3               
002934  3  A9 00        	lda #0				; null value in pointer.
002936  3  A0 0D        	ldy #var_jumpLo
002938  3  91 rr        	sta (z80_ix),y			; store new pointer low.
00293A  3  C8           	iny
00293B  3  91 rr        	sta (z80_ix),y			; store new pointer high.
00293D  3               
00293D  3  A0 00        	ldy #0
00293F  3  B1 rr        	lda (z80_hl),y			; fetch byte from table.
002941  3  C9 63        	cmp #99				; is it the end marker?
002943  3               evftf:
002943  3  F0 01        	beq :+				; yes, fallen too far.
002945  3  60           	rts
002946  3               :
002946  3  4C 41 3B     	jmp evnt15			; EVENT FELLTOOFAR
002949  3               
002949  3               ;------------------------------------------------
002949  3               ; Initiate fall check.
002949  3               ;------------------------------------------------
002949  3               
002949  3               ifall:
002949  3  A0 0D        	ldy #var_jumpLo
00294B  3  B1 rr        	lda (z80_ix),y 			; jump pointer low.
00294D  3  85 rr        	sta z80_l
00294F  3  A0 0E        	ldy #var_jumpHi
002951  3  B1 rr        	lda (z80_ix),y 			; jump pointer high.
002953  3  85 rr        	sta z80_h			; high byte in accumulator.
002955  3  05 rr        	ora z80_l			; merge in low byte.
002957  3  F0 01        	beq :+
002959  3  60           	rts				; if either is set, we're already in the air.
00295A  3               :
00295A  3  A0 09        	ldy #var_newX
00295C  3  B1 rr        	lda (z80_ix),y			; y coordinate.
00295E  3  85 rr        	sta dispx
002960  3               numsp7:
002960  3  A0 08        	ldy #var_newY
002962  3  B1 rr        	lda (z80_ix),y			; look x coordinate.
002964  3  18           	clc
002965  3  69 10        	adc #16				; add 16 pixels.
002967  3  85 rr        	sta dispy			; set up test coordinates.
002969  3  20 42 23     	jsr tstbl			; get map address.
00296C  3  20 ED 21     	jsr plchk			; block, platform check.
00296F  3  F0 01        	beq :+
002971  3  60           	rts				; it's solid, don't fall.
002972  3               :
002972  3  E6 rr        	inc bufaddr			; look right one cell.
002974  3  20 ED 21     	jsr plchk			; block, platform check.
002977  3  F0 01        	beq :+
002979  3  60           	rts				; it's solid, don't fall.
00297A  3               :
00297A  3  A5 rr        	lda dispx			; y coordinate.
00297C  3  29 07        	and #7				; position straddling block cells.
00297E  3  F0 08        	beq ifalls			; no more checks needed.
002980  3  E6 rr        	inc bufaddr			; look to third cell.
002982  3  20 ED 21     	jsr plchk			; block, platform check.
002985  3  F0 01        	beq :+
002987  3  60           	rts				; it's solid, don't fall.
002988  3               :
002988  3               ifalls:
002988  3  A9 CE        	lda #<(jtab + data_address - data_start)			; jump table start.
00298A  3  85 rr        	sta z80_l
00298C  3  A9 B8        	lda #>(jtab + data_address - data_start)
00298E  3  85 rr        	sta z80_h
002990  3               ifal0:
002990  3  E6 rr        	inc z80_l			; point to next value.
002992  3  D0 02        	bne :+
002994  3  E6 rr        	inc z80_h
002996  3               :
002996  3  A0 00        	ldy #0
002998  3  B1 rr        	lda (z80_hl),y			; fetch value.
00299A  3  F0 F4        	beq ifal0			; no, get next value.
00299C  3  C9 63        	cmp #99				; reached end of table?
00299E  3  D0 01        	bne :+
0029A0  3  60           	rts				; yes, don't fall.
0029A1  3               :
0029A1  3  C9 80        	cmp #128			; is it going up?
0029A3  3  B0 EB        	bcs ifal0			; yes, looking for first movement down.
0029A5  3               
0029A5  3  A0 0D        	ldy #var_jumpLo
0029A7  3  A5 rr        	lda z80_l
0029A9  3  91 rr        	sta (z80_ix),y 			; set jump low.
0029AB  3  A0 0E        	ldy #var_jumpHi
0029AD  3  A5 rr        	lda z80_h
0029AF  3  91 rr        	sta (z80_ix),y 			; set jump high.
0029B1  3  60           	rts
0029B2  3               
0029B2  3               
0029B2  3               ;----------------------------------------------------
0029B2  3               ; Get frame data for a particular sprite.
0029B2  3               ; Input:
0029B2  3               ;  a		= framenumer
0029B2  3               ; Output:
0029B2  3               ;  hl		= frame address
0029B2  3               ;
0029B2  3               ; global:	hl,frmptr
0029B2  3               ; local:	-
0029B2  3               ; calls:	-
0029B2  3               ;----------------------------------------------------
0029B2  3               
0029B2  3               gfrm:
0029B2  3  0A           	asl a	 		 	; multiple of 2.
0029B3  3  18           	clc
0029B4  3  6D 15 18     	adc frmptr 			; frames used by game.
0029B7  3  85 rr        	sta z80_l
0029B9  3  AD 16 18     	lda frmptr+1
0029BC  3  69 00        	adc #0
0029BE  3  85 rr        	sta z80_h 			; point to frame start.
0029C0  3  60           	rts
0029C1  3               
0029C1  3               ;----------------------------------------------------
0029C1  3               ; Find sprite list for current room.
0029C1  3               ;
0029C1  3               ; global:	hl
0029C1  3               ; local:	x,y
0029C1  3               ; calls:	-
0029C1  3               ;----------------------------------------------------
0029C1  3               
0029C1  3               sprlst:
0029C1  3  A9 FA        	lda #<(nmedat + data_address - data_start) 			; list of enemy sprites.
0029C3  3  85 rr        	sta z80_l
0029C5  3  A9 B0        	lda #>(nmedat + data_address - data_start)
0029C7  3  85 rr        	sta z80_h
0029C9  3  A6 rr        	ldx scno 			; screen number.
0029CB  3  D0 01        	bne sprls2 			; is it the first screen?
0029CD  3  60           	rts 				; yes, don't need to search data.
0029CE  3               sprls2:
0029CE  3  A0 00        	ldy #0
0029D0  3               sprls1:
0029D0  3  B1 rr        	lda (z80_hl),y 			; fetch type of sprite.
0029D2  3  C9 FF        	cmp #255			; is it an end marker?
0029D4  3  F0 0E        	beq sprls0 			; yes, end of this room.
0029D6  3               
0029D6  3  18           	clc 				; point to next sprite in list.
0029D7  3  A5 rr        	lda z80_l
0029D9  3  69 04        	adc #NMESIZ
0029DB  3  85 rr        	sta z80_l
0029DD  3  90 02        	bcc :+
0029DF  3  E6 rr        	inc z80_h
0029E1  3               :
0029E1  3  4C D0 29     	jmp sprls1 			; continue until end of room.
0029E4  3               sprls0:
0029E4  3  E6 rr        	inc z80_l 			; point to start of next screen.s
0029E6  3  D0 02        	bne :+
0029E8  3  E6 rr        	inc z80_h
0029EA  3               :
0029EA  3  CA           	dex
0029EB  3  D0 E3        	bne sprls1 			; continue until room found.
0029ED  3  60           	rts
0029EE  3               
0029EE  3               
0029EE  3               ;----------------------------------------------------
0029EE  3               ; Clear all but a single player sprite.
0029EE  3               ;
0029EE  3               ; global:	-
0029EE  3               ; local:	x,y,ix
0029EE  3               ; calls:	-
0029EE  3               ;----------------------------------------------------
0029EE  3               
0029EE  3               nspr:
0029EE  3  A9 0C        	lda #NUMSPR			; sprite slots in table.
0029F0  3  85 rr        	sta sprcnt
0029F2  3  A9 00        	lda #<sprtab 			; sprite table.
0029F4  3  85 rr        	sta z80_x
0029F6  3  A9 0B        	lda #>sprtab
0029F8  3  85 rr        	sta z80_i
0029FA  3               nspr0:
0029FA  3  A0 00        	ldy #0 				; fetch sprite type.
0029FC  3  B1 rr        	lda (z80_ix),y 			; is it a player?
0029FE  3  F0 1A        	beq nspr1 			; yes, keep this one.
002A00  3               
002A00  3  A9 FF        	lda #255
002A02  3  A0 00        	ldy #0 				; fetch sprite type.
002A04  3  91 rr        	sta (z80_ix),y 			; delete sprite.
002A06  3  A0 05        	ldy #5
002A08  3  91 rr        	sta (z80_ix),y 			; remove next type.
002A0A  3               
002A0A  3  18           	clc	 			; next sprite.
002A0B  3  A5 rr        	lda z80_x
002A0D  3  69 11        	adc #TABSIZ 			; distance to next odd/even entry.
002A0F  3  85 rr        	sta z80_x
002A11  3  90 02        	bcc :+
002A13  3  E6 rr        	inc z80_i
002A15  3               :
002A15  3  C6 rr        	dec sprcnt	 			; one less space in the table.
002A17  3  D0 E1        	bne nspr0
002A19  3  60           	rts
002A1A  3               nspr1:
002A1A  3  A9 FF        	lda #255
002A1C  3  A0 00        	ldy #0
002A1E  3  91 rr        	sta (z80_ix),y 			; delete sprite.
002A20  3               
002A20  3  18           	clc	 			; point to next sprite.
002A21  3  A5 rr        	lda z80_x
002A23  3  69 11        	adc #TABSIZ 			; distance to next odd/even entry.
002A25  3  85 rr        	sta z80_x
002A27  3  90 02        	bcc :+
002A29  3  E6 rr        	inc z80_i
002A2B  3               :
002A2B  3  C6 rr        	dec sprcnt	 			; one less to do.
002A2D  3  D0 01        	bne nspr2
002A2F  3  60           	rts
002A30  3               nspr2:
002A30  3  A9 FF        	lda #255
002A32  3  A0 00        	ldy #0
002A34  3  91 rr        	sta (z80_ix),y 			; delete sprite.
002A36  3  A0 05        	ldy #5
002A38  3  91 rr        	sta (z80_ix),y 			; remove next type.
002A3A  3               
002A3A  3  18           	clc	 			; next sprite.
002A3B  3  A5 rr        	lda z80_x
002A3D  3  69 11        	adc #TABSIZ 			; distance to next odd/even entry.
002A3F  3  85 rr        	sta z80_x
002A41  3  90 02        	bcc :+
002A43  3  E6 rr        	inc z80_i
002A45  3               :
002A45  3  C6 rr        	dec sprcnt	 			; one less space in table.
002A47  3  D0 E7        	bne nspr2
002A49  3  60           	rts
002A4A  3               
002A4A  3               ;----------------------------------------------------------
002A4A  3               ; Two initialisation routines.
002A4A  3               ; Initialise sprites - copy everything from list to table.
002A4A  3               ;
002A4A  3               ; global:	-
002A4A  3               ; local:	x,y,ix
002A4A  3               ; calls:	cpsp
002A4A  3               ;----------------------------------------------------------
002A4A  3               
002A4A  3               ispr:
002A4A  3  A9 0C        	lda #NUMSPR			; sprite slots in table.
002A4C  3  85 rr        	sta sprcnt
002A4E  3  A9 00        	lda #<sprtab			; sprite table.
002A50  3  85 rr        	sta z80_x
002A52  3  A9 0B        	lda #>sprtab
002A54  3  85 rr        	sta z80_i
002A56  3               ispr2:
002A56  3  A0 00        	ldy #0
002A58  3  B1 rr        	lda (z80_hl),y 			; fetch byte.
002A5A  3  C9 FF        	cmp #255 			; is it an end marker?
002A5C  3  D0 01        	bne :+
002A5E  3  60           	rts 				; yes, no more to do.
002A5F  3               :
002A5F  3               ispr1:
002A5F  3  A0 00        	ldy #0
002A61  3  B1 rr        	lda (z80_ix),y 			; fetch sprite type.
002A63  3  C9 FF        	cmp #255 			; is it enabled yet?
002A65  3  D0 08        	bne ispr4			; yes, try another slot.
002A67  3               
002A67  3  A0 05        	ldy #5
002A69  3  B1 rr        	lda (z80_ix),y		 	; next type.
002A6B  3  C9 FF        	cmp #255 			; is it enabled yet?
002A6D  3  F0 10        	beq ispr3 			; no, process this one.
002A6F  3               ispr4:
002A6F  3  18           	clc 				; next sprite.
002A70  3  A5 rr        	lda z80_x
002A72  3  69 11        	adc #TABSIZ		 	; distance to next odd/even entry.
002A74  3  85 rr        	sta z80_x
002A76  3  90 02        	bcc :+
002A78  3  E6 rr        	inc z80_i
002A7A  3               :
002A7A  3  C6 rr        	dec sprcnt
002A7C  3  D0 E1        	bne ispr1 			; repeat for remaining sprites.
002A7E  3  60           	rts  				; no more room in table.
002A7F  3               ispr3:
002A7F  3  20 D2 2A     	jsr cpsp			; initialise a sprite.
002A82  3  C6 rr        	dec sprcnt			; one less space in the table.
002A84  3  D0 D0        	bne ispr2
002A86  3  60           	rts
002A87  3               
002A87  3               
002A87  3               ;-----------------------------------------------------------------------
002A87  3               ; Initialise sprites - but not player, we're keeping the old one.
002A87  3               ;
002A87  3               ; global:	-
002A87  3               ; local:	x,y,ix
002A87  3               ; calls:	cpsp
002A87  3               ;-----------------------------------------------------------------------
002A87  3               
002A87  3               kspr:
002A87  3  A2 0C        	ldx #NUMSPR			; sprite slots in table.
002A89  3  A9 00        	lda #<sprtab 			; sprite table.
002A8B  3  85 rr        	sta z80_x
002A8D  3  A9 0B        	lda #>sprtab
002A8F  3  85 rr        	sta z80_i
002A91  3               kspr2:
002A91  3  A0 00        	ldy #0
002A93  3  B1 rr        	lda (z80_hl),y 			; fetch byte.
002A95  3  C9 FF        	cmp #255 			; is it an end marker?
002A97  3  D0 01        	bne :+
002A99  3  60           	rts 				; yes, no more to do.
002A9A  3               :
002A9A  3  C9 00        	cmp #0
002A9C  3  D0 0E        	bne kspr1 			; no, add to table as normal.
002A9E  3               
002A9E  3  18           	clc 				; next sprite.
002A9F  3  A5 rr        	lda z80_l
002AA1  3  69 04        	adc #NMESIZ		 	; distance to next odd/even entry.
002AA3  3  85 rr        	sta z80_l
002AA5  3  90 02        	bcc :+
002AA7  3  E6 rr        	inc z80_h
002AA9  3               :
002AA9  3  4C 91 2A     	jmp kspr2
002AAC  3               kspr1:
002AAC  3  A0 00        	ldy #0 				; fetch sprite type.
002AAE  3  B1 rr        	lda (z80_ix),y
002AB0  3  C9 FF        	cmp #255 			; is it enabled yet?
002AB2  3  D0 08        	bne kspr4 			; yes, try another slot.
002AB4  3               
002AB4  3  A0 05        	ldy #5 				; next type.
002AB6  3  B1 rr        	lda (z80_ix),y
002AB8  3  C9 FF        	cmp #255 			; is it enabled yet?
002ABA  3  F0 0F        	beq kspr3 			; no, process this one.
002ABC  3               kspr4:
002ABC  3  18           	clc 				; next sprite.
002ABD  3  A5 rr        	lda z80_x
002ABF  3  69 11        	adc #TABSIZ		 	; distance to next odd/even entry.
002AC1  3  85 rr        	sta z80_x
002AC3  3  90 02        	bcc :+
002AC5  3  E6 rr        	inc z80_i
002AC7  3               :
002AC7  3  CA           	dex	 			; repeat for remaining sprites.
002AC8  3  D0 E2        	bne kspr1
002ACA  3  60           	rts  				; no more room in table.
002ACB  3               kspr3:
002ACB  3  20 D2 2A     	jsr cpsp 			; copy sprite to table.
002ACE  3  CA           	dex	 			; one less space in the table.
002ACF  3  D0 C0        	bne kspr2
002AD1  3  60           	rts
002AD2  3               
002AD2  3               ;----------------------------------------------
002AD2  3               ; Copy sprite from list to table.
002AD2  3               ;
002AD2  3               ; global:	hl,ix
002AD2  3               ; local:	y
002AD2  3               ; calls:	evnt09
002AD2  3               ;----------------------------------------------
002AD2  3               
002AD2  3               cpsp:
002AD2  3  A0 00        	ldy #0					; fetch byte from table.
002AD4  3  B1 rr        	lda (z80_hl),y
002AD6  3               	; y=var_Type
002AD6  3  91 rr        	sta (z80_ix),y			; set up type.
002AD8  3  A0 05        	ldy #var_newType
002ADA  3  91 rr        	sta (z80_ix),y 			; set up type.
002ADC  3               
002ADC  3  E6 rr        	inc z80_l 				; move to next byte.
002ADE  3  D0 02        	bne :+
002AE0  3  E6 rr        	inc z80_h
002AE2  3               :
002AE2  3  A0 00        	ldy #0 					; fetch byte from table.
002AE4  3  B1 rr        	lda (z80_hl),y
002AE6  3  A0 06        	ldy #var_newImage
002AE8  3  91 rr        	sta (z80_ix),y			; set up image.
002AEA  3               
002AEA  3  E6 rr        	inc z80_l 				; move to next byte.
002AEC  3  D0 02        	bne :+
002AEE  3  E6 rr        	inc z80_h
002AF0  3               :
002AF0  3  A0 00        	ldy #0
002AF2  3  B1 rr        	lda (z80_hl),y 			; fetch byte from table.
002AF4  3  A0 08        	ldy #var_newY
002AF6  3  91 rr        	sta (z80_ix),y 			; set up coordinate.
002AF8  3               
002AF8  3  A9 C8        	lda #200 				; set initial coordinate off screen.
002AFA  3  A0 03        	ldy #var_Y
002AFC  3  91 rr        	sta (z80_ix),y
002AFE  3               
002AFE  3  E6 rr        	inc z80_l 				; move to next byte.
002B00  3  D0 02        	bne :+
002B02  3  E6 rr        	inc z80_h
002B04  3               :
002B04  3  A0 00        	ldy #0 					; fetch byte from table.
002B06  3  B1 rr        	lda (z80_hl),y
002B08  3  A0 09        	ldy #var_newX
002B0A  3  91 rr        	sta (z80_ix),y 			; set up coordinate.
002B0C  3               
002B0C  3  E6 rr        	inc z80_l 				; move to next byte.
002B0E  3  D0 02        	bne :+
002B10  3  E6 rr        	inc z80_h
002B12  3               :
002B12  3  A9 00        	lda #0					; zeroes in accumulator.
002B14  3  A0 07        	ldy #var_newFrame 		; reset frame number.
002B16  3  91 rr        	sta (z80_ix),y
002B18  3  A0 0A        	ldy #var_Direction 		; reset direction.
002B1A  3  91 rr        	sta (z80_ix),y
002B1C  3  A0 0D        	ldy #var_jumpLo			; reset jump pointer low.
002B1E  3  91 rr        	sta (z80_ix),y
002B20  3  A0 0E        	ldy #var_jumpHi	 		; reset jump pointer high.
002B22  3  91 rr        	sta (z80_ix),y
002B24  3               
002B24  3  A9 FF        	lda #255 				; reset data pointer to auto-restore.
002B26  3  A0 10        	ldy #var_dataHi
002B28  3  91 rr        	sta (z80_ix),y
002B2A  3               evis0:
002B2A  3  A5 rr        	lda z80_i
002B2C  3  48           	pha
002B2D  3  A5 rr        	lda z80_x
002B2F  3  48           	pha
002B30  3  A5 rr        	lda z80_h
002B32  3  48           	pha
002B33  3  A5 rr        	lda z80_l
002B35  3  48           	pha
002B36  3               
002B36  3  20 42 38     	jsr evnt09 				; perform event.
002B39  3               
002B39  3  68           	pla
002B3A  3  85 rr        	sta z80_l
002B3C  3  68           	pla
002B3D  3  85 rr        	sta z80_h
002B3F  3  68           	pla
002B40  3  85 rr        	sta z80_x
002B42  3  68           	pla
002B43  3  85 rr        	sta z80_i
002B45  3               
002B45  3  18           	clc
002B46  3  A5 rr        	lda z80_x 			; distance to next odd/even entry.
002B48  3  69 11        	adc #TABSIZ		 	; next sprite.
002B4A  3  85 rr        	sta z80_x
002B4C  3  90 02        	bcc :+
002B4E  3  E6 rr        	inc z80_i
002B50  3               :
002B50  3  60           	rts
002B51  3               
002B51  3               
002B51  3               ;-------------------------------------
002B51  3               ; Clear the play area window.
002B51  3               ;-------------------------------------
002B51  3               
002B51  3               clw:
002B51  3  AD 0C 18     	lda wintop			; get coordinates of window.
002B54  3  85 rr        	sta dispy			; put into dispx for calculation.
002B56  3  AD 0D 18     	lda winlft
002B59  3  85 rr        	sta dispx
002B5B  3               
002B5B  3  AD 0E 18     	lda winhgt			; height of window.
002B5E  3  85 rr        	sta rrow			; copy to b register.
002B60  3               clw3:
002B60  3  AD 0F 18     	lda winwid 			; width of window.
002B63  3  85 rr        	sta rcol
002B65  3               clw2:
002B65  3  20 0E 13     	jsr gprad 			; get print address.
002B68  3  A9 00        	lda #0				; zero byte to write.
002B6A  3  A0 07        	ldy #7				; pixel height of each cell.
002B6C  3               clw1:
002B6C  3  91 rr        	sta (scraddr),y 	; copy to screen.
002B6E  3  88           	dey					; next screen row down.
002B6F  3  10 FB        	bpl clw1
002B71  3               
002B71  3  E6 rr        	inc dispx			; next column.
002B73  3  C6 rr        	dec rcol			; one less to do.
002B75  3  D0 EE        	bne clw2			; repeat for remaining columns.
002B77  3               
002B77  3  AD 0D 18     	lda winlft			; get left edge.
002B7A  3  85 rr        	sta dispx 			; reset x.
002B7C  3  E6 rr        	inc dispy 			; next line down.
002B7E  3               
002B7E  3  C6 rr        	dec rrow
002B80  3  D0 DE        	bne clw3			; repeat down the screen.
002B82  3               
002B82  3  AD 0C 18     	lda wintop			; get coordinates of window.
002B85  3  85 rr        	sta chary			; put into display position.
002B87  3  AD 0D 18     	lda winlft
002B8A  3  85 rr        	sta charx
002B8C  3  60           	rts
002B8D  3               
002B8D  3               
002B8D  3               ;----------------------------------------------------------
002B8D  3               ; Effects code.
002B8D  3               ; Ticker routine is called 25 times per second.
002B8D  3               ;
002B8D  3               ; HL = txtscr = left text screen address
002B8D  3               ; DE = txtscr+txtwid-1 = right text screen address
002B8D  3               ; BC = txtpos = text scroller position
002B8D  3               ;
002B8D  3               ;----------------------------------------------------------
002B8D  3               
002B8D  3               .if sflag
002B8D  3               scrly:
002B8D  3               	rts
002B8D  3               	.word txtscr         	; get left screen address.
002B8D  3               	sta scr_l
002B8D  3               	lda txtscr+1
002B8D  3               	sta scr_l+1
002B8D  3               	sta scr_r+1
002B8D  3               
002B8D  3               	stx xtmp
002B8D  3               
002B8D  3               	clc         		; get right screen address.
002B8D  3               	lda scr_l
002B8D  3               	adc txtwid
002B8D  3               	sta scr_r
002B8D  3               	dec scr_r
002B8D  3               scrly1:
002B8D  3               	ldy txtwid		; set txtwide
002B8D  3               	dey
002B8D  3               	clc
002B8D  3               scrly0:
002B8D  3               	lda (scr_l),y		; scroll 1 line
002B8D  3               	rol a
002B8D  3               	sta (scr_l),y
002B8D  3               	dey
002B8D  3               	bpl scrly0
002B8D  3               
002B8D  3               	clc			; point to next line
002B8D  3               	lda scr_l
002B8D  3               	adc #32
002B8D  3               	sta scr_l
002B8D  3               	bcc scrly1		; repeat 8 times
002B8D  3               
002B8D  3               	lda txtpos 		; get text pointer.
002B8D  3               	sta scr_txt
002B8D  3               	lda txtpos+1
002B8D  3               	sta scr_txt+1
002B8D  3               
002B8D  3               	ldy #0
002B8D  3               	lda (scr_txt),y 		; find character we're displaying.
002B8D  3               	and #127 		; remove end marker bit if applicable.
002B8D  3               	cmp #ASCII_NEWLINE			; is it newline?
002B8D  3               	bne scrly5 		; no, it's okay.
002B8D  3               	lda #32			; convert to a space instead.
002B8D  3               scrly5:
002B8D  3               	sta fntaddr		; calculate char address
002B8D  3               	lda #0
002B8D  3               	sta fntaddr+1
002B8D  3               	asl fntaddr  		; multiply char by 8.
002B8D  3               	rol fntaddr+1
002B8D  3               	asl fntaddr
002B8D  3               	rol fntaddr+1
002B8D  3               	asl fntaddr
002B8D  3               	rol fntaddr+1
002B8D  3               	lda fntaddr
002B8D  3               	clc
002B8D  3               	adc FontPtr
002B8D  3               	sta scrly3+1		; that's the low byte.
002B8D  3               	lda fntaddr+1
002B8D  3               	adc FontPtr+1
002B8D  3               	sta scrly3+2		; add displacement.
002B8D  3               
002B8D  3               	ldx #0
002B8D  3               scrly3:
002B8D  3               	lda $3333,x		; get image of char line.
002B8D  3               	and txtbit
002B8D  3               	beq scrly2		; don't plot pixel
002B8D  3               	ldy scrline,x
002B8D  3               	lda (scr_r),y
002B8D  3               	clc
002B8D  3               	ora #1
002B8D  3               	sta (scr_r),y		; plot pixel
002B8D  3               scrly2:
002B8D  3               	inx			; next line of char.
002B8D  3               	cpx #8
002B8D  3               	bne scrly3
002B8D  3               
002B8D  3               	lsr txtbit		; bit of text to display.
002B8D  3               	bcs :+
002B8D  3               	rts
002B8D  3               :
002B8D  3               	ldy #0
002B8D  3               	lda (scr_txt),y 	; what was the character?
002B8D  3               	asl a	  		; end of message?
002B8D  3               	bcs scrly4
002B8D  3               	inc txtpos
002B8D  3               	bne :+
002B8D  3               	inc txtpos+1
002B8D  3               :
002B8D  3               	jmp scrly6 		; not yet - continue.
002B8D  3               scrly4:
002B8D  3               	lda txtini 		; start of scrolling message.
002B8D  3               	sta txtpos
002B8D  3               	lda txtini+1
002B8D  3               	sta txtpos+1
002B8D  3               scrly6:
002B8D  3               	lda #128
002B8D  3               	sta txtbit
002B8D  3               	ldx xtmp
002B8D  3               	rts
002B8D  3               
002B8D  3               scrline:	.byte $00,$20,$40,$60,$80,$a0,$c0,$e0
002B8D  3               
002B8D  3               ;-------------------------------------------------------
002B8D  3               ; Entry TICKER command
002B8D  3               ;
002B8D  3               ; Entry:
002B8D  3               ;  z80_b = message nr
002B8D  3               ;  z80_c = width
002B8D  3               ;-------------------------------------------------------
002B8D  3               
002B8D  3               iscrly:
002B8D  3               	jsr prescr 		; set up display position.
002B8D  3               
002B8D  3               	lda #<(msgdat + data_address - data_start) 		; text messages.
002B8D  3               	sta z80_l
002B8D  3               	lda #>(msgdat + data_address - data_start)
002B8D  3               	sta z80_h
002B8D  3               
002B8D  3               	lda z80_c 		; width.
002B8D  3               	sec
002B8D  3               	sbc #1			; subtract one.
002B8D  3               	cmp #32 		; is it between 1 and 32?
002B8D  3               	bcc :+
002B8D  3               	lda #$60
002B8D  3               	jmp iscrl0		; no, disable messages.
002B8D  3               :
002B8D  3               	ldx z80_b		; message number.
002B8D  3               	jsr getwrd 		; find message start.
002B8D  3               
002B8D  3               	lda z80_l		; set initial text position.
002B8D  3               	sta txtini
002B8D  3               	lda z80_h
002B8D  3               	sta txtini+1
002B8D  3               
002B8D  3               	lda #$ad		; code for lda adrr
002B8D  3               iscrl0:
002B8D  3               	sta scrly		; enable/disable scrolling routine.
002B8D  3               
002B8D  3               	jsr prescr 		; set up display position.
002B8D  3               	jsr gprad 		; get print address.
002B8D  3               
002B8D  3               	lda scraddr 		; set text screen address.
002B8D  3               	sta txtscr
002B8D  3               	lda scraddr+1
002B8D  3               	sta txtscr+1
002B8D  3               
002B8D  3               	lda z80_c		; width.
002B8D  3               	sta txtwid		; set width in working storage.
002B8D  3               
002B8D  3               	lda #128 		; start with leftmost bit.
002B8D  3               	sta txtbit
002B8D  3               
002B8D  3               	jmp scrly4
002B8D  3               .endif
002B8D  3               
002B8D  3               ;------------------------------------------------------------------
002B8D  3               ; Dig routine, conditional assembly depending on dflag
002B8D  3               ;------------------------------------------------------------------
002B8D  3               .if dflag
002B8D  3               dig:
002B8D  3               	and #3
002B8D  3               	beq digr		; dig right
002B8D  3               	cmp #1
002B8D  3               	beq digl		; dig left
002B8D  3               	cmp #2
002B8D  3               	beq digd		; dig down
002B8D  3               
002B8D  3               ; Dig up.
002B8D  3               
002B8D  3               digu:				; dig up
002B8D  3               	ldy #var_newY
002B8D  3               	lda (z80_ix),y
002B8D  3               	sec
002B8D  3               	sbc #2
002B8D  3               	sta dispy		; set y
002B8D  3               
002B8D  3               	iny
002B8D  3               	lda (z80_ix),y
002B8D  3               	sta dispx		; set x
002B8D  3               	jmp digv
002B8D  3               
002B8D  3               ; Dig down.
002B8D  3               
002B8D  3               digd:
002B8D  3               	ldy #var_newX
002B8D  3               	lda (z80_ix),y
002B8D  3               	sta dispx		; set x
002B8D  3               
002B8D  3               	dey
002B8D  3               	clc
002B8D  3               	lda (z80_ix),y
002B8D  3               	adc #16
002B8D  3               	sta dispy		; set y
002B8D  3               	jmp digv
002B8D  3               
002B8D  3               ; Dig left.
002B8D  3               
002B8D  3               digl:
002B8D  3               	ldy #var_newY
002B8D  3               	lda (z80_ix),y
002B8D  3               	sta dispy		; set y
002B8D  3               
002B8D  3               	iny
002B8D  3               	lda (z80_ix),y
002B8D  3               	sec
002B8D  3               	sbc #2			; x=x-2
002B8D  3               	sta dispx		; set x
002B8D  3               	jmp digh
002B8D  3               
002B8D  3               ; Dig right.
002B8D  3               
002B8D  3               digr:
002B8D  3               	ldy #var_newY
002B8D  3               	lda (z80_ix),y
002B8D  3               	sta dispy		; set y
002B8D  3               
002B8D  3               	iny
002B8D  3               	lda (z80_ix),y
002B8D  3               	clc
002B8D  3               	adc #16
002B8D  3               	sta dispx		; set x+16
002B8D  3               	jmp digh
002B8D  3               
002B8D  3               ; Vertical digging
002B8D  3               
002B8D  3               digv:
002B8D  3               	jsr tstbl		; check blocktype in MAP
002B8D  3               	jsr fdchk		; test if FODDER
002B8D  3               
002B8D  3               	clc
002B8D  3               	lda dispx		; look 1 cell down
002B8D  3               	adc #8
002B8D  3               	sta dispx
002B8D  3               	jsr tstbl		; check blocktype in MAP
002B8D  3               	jsr fdchk
002B8D  3               	lda dispx
002B8D  3               	and #7
002B8D  3               	bne :+
002B8D  3               	rts
002B8D  3               :
002B8D  3               	clc
002B8D  3               	lda dispx		; look 1 cell down
002B8D  3               	adc #8
002B8D  3               	sta dispx
002B8D  3               	jsr tstbl		; check blocktype in MAP
002B8D  3               	jmp fdchk
002B8D  3               
002B8D  3               ; Horizontal digging
002B8D  3               
002B8D  3               digh:
002B8D  3               	jsr tstbl		; check blocktype in MAP
002B8D  3               	jsr fdchk		; test if FODDER
002B8D  3               
002B8D  3               	clc
002B8D  3               	lda dispy		; look 1 cell down
002B8D  3               	adc #8
002B8D  3               	sta dispy
002B8D  3               	jsr tstbl		; check blocktype in MAP
002B8D  3               	jsr fdchk
002B8D  3               	lda dispy
002B8D  3               	and #7
002B8D  3               	bne :+
002B8D  3               	rts
002B8D  3               :
002B8D  3               	clc
002B8D  3               	lda dispy		; look 1 cell down
002B8D  3               	adc #8
002B8D  3               	sta dispy
002B8D  3               	jsr tstbl		; check blocktype in MAP
002B8D  3               	jmp fdchk
002B8D  3               
002B8D  3               digcnt:	.byte 0
002B8D  3               
002B8D  3               .endif
002B8D  3               
002B8D  3               ;------------------------------------------------------------------
002B8D  3               ; Sprite table
002B8D  3               ;------------------------------------------------------------------
002B8D  3               
002B8D  3               
002B8D  3               ; ix+0  = type.
002B8D  3               ; ix+1  = sprite image number.
002B8D  3               ; ix+2  = frame.
002B8D  3               ; ix+3  = y coord.
002B8D  3               ; ix+4  = x coord.
002B8D  3               
002B8D  3               ; ix+5  = new type.
002B8D  3               ; ix+6  = new image number.
002B8D  3               ; ix+7  = new frame.
002B8D  3               ; ix+8  = new y coord.
002B8D  3               ; ix+9  = new x coord.
002B8D  3               
002B8D  3               ; ix+10 = direction.
002B8D  3               ; ix+11 = parameter 1.
002B8D  3               ; ix+12 = parameter 2.
002B8D  3               ; ix+13 = jump pointer low.
002B8D  3               ; ix+14 = jump pointer high.
002B8D  3               ; ix+15 = data pointer low.
002B8D  3               ; ix+16 = data pointer high.
002B8D  3               
002B8D  3               ; block NUMSPR * TABSIZ,255
002B8D  3               ; sprtab NUMSPR*TABSIZ,255
002B8D  3               
002B8D  3  FF FF FF FF  ssprit:	.byte 255,255,255,255,255,255,255,0,192,120,0,0,0,255,255,255,255
002B91  3  FF FF FF 00  
002B95  3  C0 78 00 00  
002B9E  3  07           roomtb:	.byte 7                      ; start room map offset.
002B9F  3               
002B9F  3               ; User routine.  Put your own code in here to be called with USER instruction.
002B9F  3               ; if USER has an argument it will be passed in the accumulator.
002B9F  3               
002B9F  3               user:
002B9F  3  60           	rts
002BA0  3               
002BA0  3               ; Everything below here will be generated by the editors.
002BA0  3               
002BA0  3               script_start:
002BA0  3               
002BA0  3               WINDOWTOP = 0
002BA0  3               WINDOWLFT = 2
002BA0  3               WINDOWHGT = 20
002BA0  3               WINDOWWID = 28 ;
002BA0  3               MAPWID = 10
002BA0  3  FF FF FF FF          .byte 255,255,255,255,255,255,255,255,255,255
002BA4  3  FF FF FF FF  
002BA8  3  FF FF        
002BAA  3               mapdat:
002BAA  3  FF 1B FF 14          .byte 255,27,255,20,255,23,255,255,255,255,255,255,255,19,21,22,24,25,26,255,255,255,14,13,12,11,10,18,17,255,255,255,255,15,3,0,4,6,8,255,255,255,255,16,2,1,5,7,9,255
002BAE  3  FF 17 FF FF  
002BB2  3  FF FF FF FF  
002BDC  3  FF FF FF FF          .byte 255,255,255,255,255,255,255,255,255,255
002BE0  3  FF FF FF FF  
002BE4  3  FF FF        
002BE6  3  23           stmap:  .byte 35
002BE7  3               
002BE7  3               evnt00:
002BE7  3  20 5B 21             jsr cangd
002BEA  3  F0 03                beq :+
002BEC  3  4C F2 2B             jmp a00020
002BEF  3               :
002BEF  3  20 49 29             jsr ifall
002BF2  3  20 E7 1D     a00020: jsr skobj
002BF5  3  85 rr                sta varobj
002BF7  3  A9 FF                lda #255
002BF9  3  C5 rr                cmp varobj
002BFB  3  D0 03                bne *+5
002BFD  3  4C CC 2C             jmp a00484
002C00  3  A5 rr                lda varobj
002C02  3  20 66 1D             jsr getob
002C05  3  A9 32                lda #50
002C07  3  0A                   asl a
002C08  3  8D 32 0F             sta sndtyp
002C0B  3  A9 01                lda #1
002C0D  3  C5 rr                cmp scno
002C0F  3  F0 03                beq *+5
002C11  3  4C 28 2C             jmp a00132
002C14  3  A5 rr                lda vark
002C16  3  18                   clc
002C17  3  69 01                adc #1
002C19  3  85 rr                sta vark
002C1B  3                       ; COLOUR command
002C1B  3  A9 14                lda #20
002C1D  3  85 rr                sta chary
002C1F  3  A9 1D                lda #29
002C21  3  85 rr                sta charx
002C23  3  A5 rr                lda vark
002C25  3  20 29 28             jsr disply
002C28  3  A9 10        a00132: lda #16
002C2A  3  C5 rr                cmp scno
002C2C  3  F0 03                beq *+5
002C2E  3  4C 45 2C             jmp a00197
002C31  3  A5 rr                lda vark
002C33  3  18                   clc
002C34  3  69 01                adc #1
002C36  3  85 rr                sta vark
002C38  3                       ; COLOUR command
002C38  3  A9 14                lda #20
002C3A  3  85 rr                sta chary
002C3C  3  A9 1D                lda #29
002C3E  3  85 rr                sta charx
002C40  3  A5 rr                lda vark
002C42  3  20 29 28             jsr disply
002C45  3  A9 07        a00197: lda #7
002C47  3  C5 rr                cmp scno
002C49  3  F0 03                beq *+5
002C4B  3  4C 6E 2C             jmp a00283
002C4E  3  A9 03                lda #3
002C50  3  20 95 1D             jsr gotob
002C53  3  C9 FF                cmp #255
002C55  3  F0 03                beq :+
002C57  3  4C 6E 2C             jmp a00283
002C5A  3               :
002C5A  3  A5 rr                lda vark
002C5C  3  18                   clc
002C5D  3  69 01                adc #1
002C5F  3  85 rr                sta vark
002C61  3                       ; COLOUR command
002C61  3  A9 14                lda #20
002C63  3  85 rr                sta chary
002C65  3  A9 1D                lda #29
002C67  3  85 rr                sta charx
002C69  3  A5 rr                lda vark
002C6B  3  20 29 28             jsr disply
002C6E  3  A9 0D        a00283: lda #13
002C70  3  C5 rr                cmp scno
002C72  3  F0 03                beq *+5
002C74  3  4C 8A 2C             jmp a00336
002C77  3  A9 09                lda #9
002C79  3  20 95 1D             jsr gotob
002C7C  3  C9 FF                cmp #255
002C7E  3  F0 03                beq :+
002C80  3  4C 8A 2C             jmp a00336
002C83  3               :
002C83  3  A5 rr                lda varc
002C85  3  18                   clc
002C86  3  69 01                adc #1
002C88  3  85 rr                sta varc
002C8A  3  A9 11        a00336: lda #17
002C8C  3  C5 rr                cmp scno
002C8E  3  F0 03                beq *+5
002C90  3  4C AB 2C             jmp a00410
002C93  3  A5 rr                lda numlif
002C95  3  18                   clc
002C96  3  69 01                adc #1
002C98  3  85 rr                sta numlif
002C9A  3                       ; COLOUR command
002C9A  3  A9 15                lda #21
002C9C  3  85 rr                sta chary
002C9E  3  A9 1D                lda #29
002CA0  3  85 rr                sta charx
002CA2  3  A5 rr                lda numlif
002CA4  3  20 29 28             jsr disply
002CA7  3  A9 01                lda #1
002CA9  3  85 rr                sta varh
002CAB  3  A9 13        a00410: lda #19
002CAD  3  C5 rr                cmp scno
002CAF  3  F0 03                beq *+5
002CB1  3  4C CC 2C             jmp a00484
002CB4  3  A5 rr                lda numlif
002CB6  3  18                   clc
002CB7  3  69 01                adc #1
002CB9  3  85 rr                sta numlif
002CBB  3                       ; COLOUR command
002CBB  3  A9 15                lda #21
002CBD  3  85 rr                sta chary
002CBF  3  A9 1D                lda #29
002CC1  3  85 rr                sta charx
002CC3  3  A5 rr                lda numlif
002CC5  3  20 29 28             jsr disply
002CC8  3  A9 01                lda #1
002CCA  3  85 rr                sta vari
002CCC  3  A9 DF        a00484: lda #223
002CCE  3  A0 09                ldy #9
002CD0  3  D1 rr                cmp (z80_ix),y
002CD2  3  90 03                bcc *+5
002CD4  3  4C EC 2C             jmp a00552
002CD7  3  20 87 28             jsr scrr
002CDA  3  A9 20                lda #32
002CDC  3  A0 09                ldy #9
002CDE  3  91 rr                sta (z80_ix),y
002CE0  3  A0 08                ldy #8
002CE2  3  B1 rr                lda (z80_ix),y
002CE4  3  85 rr                sta varo
002CE6  3  A0 09                ldy #9
002CE8  3  B1 rr                lda (z80_ix),y
002CEA  3  85 rr                sta varp
002CEC  3  A9 10        a00552: lda #16
002CEE  3  A0 09                ldy #9
002CF0  3  D1 rr                cmp (z80_ix),y
002CF2  3  B0 03                bcs *+5
002CF4  3  4C 0C 2D             jmp a00620
002CF7  3  20 6C 28             jsr scrl
002CFA  3  A9 D0                lda #208
002CFC  3  A0 09                ldy #9
002CFE  3  91 rr                sta (z80_ix),y
002D00  3  A0 08                ldy #8
002D02  3  B1 rr                lda (z80_ix),y
002D04  3  85 rr                sta varo
002D06  3  A0 09                ldy #9
002D08  3  B1 rr                lda (z80_ix),y
002D0A  3  85 rr                sta varp
002D0C  3  A9 02        a00620: lda #2
002D0E  3  A0 08                ldy #8
002D10  3  D1 rr                cmp (z80_ix),y
002D12  3  B0 03                bcs *+5
002D14  3  4C 2C 2D             jmp a00687
002D17  3  20 90 28             jsr scru
002D1A  3  A9 8C                lda #140
002D1C  3  A0 08                ldy #8
002D1E  3  91 rr                sta (z80_ix),y
002D20  3  A0 08                ldy #8
002D22  3  B1 rr                lda (z80_ix),y
002D24  3  85 rr                sta varo
002D26  3  A0 09                ldy #9
002D28  3  B1 rr                lda (z80_ix),y
002D2A  3  85 rr                sta varp
002D2C  3  A9 8C        a00687: lda #140
002D2E  3  A0 08                ldy #8
002D30  3  D1 rr                cmp (z80_ix),y
002D32  3  90 03                bcc *+5
002D34  3  4C 4C 2D             jmp a00755
002D37  3  20 99 28             jsr scrd
002D3A  3  A9 08                lda #8
002D3C  3  A0 08                ldy #8
002D3E  3  91 rr                sta (z80_ix),y
002D40  3  A0 08                ldy #8
002D42  3  B1 rr                lda (z80_ix),y
002D44  3  85 rr                sta varo
002D46  3  A0 09                ldy #9
002D48  3  B1 rr                lda (z80_ix),y
002D4A  3  85 rr                sta varp
002D4C  3  20 D7 20     a00755: jsr laddd
002D4F  3  F0 03                beq :+
002D51  3  4C 67 2D             jmp a00803
002D54  3               :
002D54  3  A9 02                lda #2
002D56  3  85 rr                sta varl
002D58  3  20 ED 20             jsr laddu
002D5B  3  F0 03                beq :+
002D5D  3  4C 64 2D             jmp a00798
002D60  3               :
002D60  3  A9 01                lda #1
002D62  3  85 rr                sta varl
002D64  3  4C 6B 2D     a00798: jmp a00811
002D67  3  A9 00        a00803: lda #0
002D69  3  85 rr                sta varl
002D6B  3  A5 rr        a00811: lda joyval
002D6D  3  29 01                and #1
002D6F  3  F0 03                beq :+
002D71  3  4C 16 2E             jmp a01146
002D74  3               :
002D74  3  20 A2 21             jsr cangr
002D77  3  F0 03                beq :+
002D79  3  4C 16 2E             jmp a01146
002D7C  3               :
002D7C  3  A5 rr                lda joyval
002D7E  3  29 04                and #4
002D80  3  F0 03                beq :+
002D82  3  4C B0 2D             jmp a00943
002D85  3               :
002D85  3  20 D7 20             jsr laddd
002D88  3  F0 03                beq :+
002D8A  3  4C 90 2D             jmp a00877
002D8D  3               :
002D8D  3  4C AD 2D             jmp a00938
002D90  3  A9 00        a00877: lda #0
002D92  3  C5 rr                cmp vara
002D94  3  F0 03                beq *+5
002D96  3  4C 9E 2D             jmp a00903
002D99  3  A9 00                lda #0
002D9B  3  20 4E 27             jsr animsp
002D9E  3  A9 00        a00903: lda #0
002DA0  3  A0 06                ldy #6
002DA2  3  91 rr                sta (z80_ix),y
002DA4  3  A0 09                ldy #9
002DA6  3  B1 rr                lda (z80_ix),y
002DA8  3  18                   clc
002DA9  3  69 02                adc #2
002DAB  3  91 rr                sta (z80_ix),y
002DAD  3  4C 16 2E     a00938: jmp a01146
002DB0  3  A5 rr        a00943: lda joyval
002DB2  3  29 08                and #8
002DB4  3  F0 03                beq :+
002DB6  3  4C E4 2D             jmp a01044
002DB9  3               :
002DB9  3  20 ED 20             jsr laddu
002DBC  3  F0 03                beq :+
002DBE  3  4C C4 2D             jmp a00978
002DC1  3               :
002DC1  3  4C E1 2D             jmp a01039
002DC4  3  A9 00        a00978: lda #0
002DC6  3  A0 06                ldy #6
002DC8  3  91 rr                sta (z80_ix),y
002DCA  3  A9 00                lda #0
002DCC  3  C5 rr                cmp vara
002DCE  3  F0 03                beq *+5
002DD0  3  4C D8 2D             jmp a01017
002DD3  3  A9 00                lda #0
002DD5  3  20 4E 27             jsr animsp
002DD8  3  A0 09        a01017: ldy #9
002DDA  3  B1 rr                lda (z80_ix),y
002DDC  3  18                   clc
002DDD  3  69 02                adc #2
002DDF  3  91 rr                sta (z80_ix),y
002DE1  3  4C 16 2E     a01039: jmp a01146
002DE4  3  A9 01        a01044: lda #1
002DE6  3  85 rr                sta vard
002DE8  3  A9 00                lda #0
002DEA  3  A0 06                ldy #6
002DEC  3  91 rr                sta (z80_ix),y
002DEE  3  A9 00                lda #0
002DF0  3  C5 rr                cmp vara
002DF2  3  F0 03                beq *+5
002DF4  3  4C 0D 2E             jmp a01124
002DF7  3  A9 00                lda #0
002DF9  3  20 4E 27             jsr animsp
002DFC  3  A9 00                lda #0
002DFE  3  A0 07                ldy #7
002E00  3  D1 rr                cmp (z80_ix),y
002E02  3  F0 03                beq *+5
002E04  3  4C 0D 2E             jmp a01124
002E07  3  A9 14                lda #20
002E09  3  0A                   asl a
002E0A  3  8D 32 0F             sta sndtyp
002E0D  3  A0 09        a01124: ldy #9
002E0F  3  B1 rr                lda (z80_ix),y
002E11  3  18                   clc
002E12  3  69 02                adc #2
002E14  3  91 rr                sta (z80_ix),y
002E16  3  A5 rr        a01146: lda joyval
002E18  3  29 02                and #2
002E1A  3  F0 03                beq :+
002E1C  3  4C C1 2E             jmp a01482
002E1F  3               :
002E1F  3  20 90 21             jsr cangl
002E22  3  F0 03                beq :+
002E24  3  4C C1 2E             jmp a01482
002E27  3               :
002E27  3  A5 rr                lda joyval
002E29  3  29 04                and #4
002E2B  3  F0 03                beq :+
002E2D  3  4C 5B 2E             jmp a01278
002E30  3               :
002E30  3  20 D7 20             jsr laddd
002E33  3  F0 03                beq :+
002E35  3  4C 3B 2E             jmp a01213
002E38  3               :
002E38  3  4C 58 2E             jmp a01274
002E3B  3  A9 00        a01213: lda #0
002E3D  3  C5 rr                cmp vara
002E3F  3  F0 03                beq *+5
002E41  3  4C 49 2E             jmp a01238
002E44  3  A9 00                lda #0
002E46  3  20 4E 27             jsr animsp
002E49  3  A9 01        a01238: lda #1
002E4B  3  A0 06                ldy #6
002E4D  3  91 rr                sta (z80_ix),y
002E4F  3  A0 09                ldy #9
002E51  3  B1 rr                lda (z80_ix),y
002E53  3  38                   sec
002E54  3  E9 02                sbc #2
002E56  3  91 rr                sta (z80_ix),y
002E58  3  4C C1 2E     a01274: jmp a01482
002E5B  3  A5 rr        a01278: lda joyval
002E5D  3  29 08                and #8
002E5F  3  F0 03                beq :+
002E61  3  4C 8F 2E             jmp a01379
002E64  3               :
002E64  3  20 ED 20             jsr laddu
002E67  3  F0 03                beq :+
002E69  3  4C 6F 2E             jmp a01314
002E6C  3               :
002E6C  3  4C 8C 2E             jmp a01375
002E6F  3  A9 01        a01314: lda #1
002E71  3  A0 06                ldy #6
002E73  3  91 rr                sta (z80_ix),y
002E75  3  A9 00                lda #0
002E77  3  C5 rr                cmp vara
002E79  3  F0 03                beq *+5
002E7B  3  4C 83 2E             jmp a01353
002E7E  3  A9 00                lda #0
002E80  3  20 4E 27             jsr animsp
002E83  3  A0 09        a01353: ldy #9
002E85  3  B1 rr                lda (z80_ix),y
002E87  3  38                   sec
002E88  3  E9 02                sbc #2
002E8A  3  91 rr                sta (z80_ix),y
002E8C  3  4C C1 2E     a01375: jmp a01482
002E8F  3  A9 02        a01379: lda #2
002E91  3  85 rr                sta vard
002E93  3  A9 01                lda #1
002E95  3  A0 06                ldy #6
002E97  3  91 rr                sta (z80_ix),y
002E99  3  A9 00                lda #0
002E9B  3  C5 rr                cmp vara
002E9D  3  F0 03                beq *+5
002E9F  3  4C B8 2E             jmp a01460
002EA2  3  A9 00                lda #0
002EA4  3  20 4E 27             jsr animsp
002EA7  3  A9 00                lda #0
002EA9  3  A0 07                ldy #7
002EAB  3  D1 rr                cmp (z80_ix),y
002EAD  3  F0 03                beq *+5
002EAF  3  4C B8 2E             jmp a01460
002EB2  3  A9 14                lda #20
002EB4  3  0A                   asl a
002EB5  3  8D 32 0F             sta sndtyp
002EB8  3  A0 09        a01460: ldy #9
002EBA  3  B1 rr                lda (z80_ix),y
002EBC  3  38                   sec
002EBD  3  E9 02                sbc #2
002EBF  3  91 rr                sta (z80_ix),y
002EC1  3  A5 rr        a01482: lda joyval
002EC3  3  29 08                and #8
002EC5  3  F0 03                beq :+
002EC7  3  4C F3 2E             jmp a01582
002ECA  3               :
002ECA  3  A9 03                lda #3
002ECC  3  85 rr                sta vard
002ECE  3  20 ED 20             jsr laddu
002ED1  3  F0 03                beq :+
002ED3  3  4C F3 2E             jmp a01582
002ED6  3               :
002ED6  3  A9 02                lda #2
002ED8  3  A0 06                ldy #6
002EDA  3  91 rr                sta (z80_ix),y
002EDC  3  A9 00                lda #0
002EDE  3  C5 rr                cmp vara
002EE0  3  F0 03                beq *+5
002EE2  3  4C EA 2E             jmp a01560
002EE5  3  A9 00                lda #0
002EE7  3  20 4E 27             jsr animsp
002EEA  3  A0 08        a01560: ldy #8
002EEC  3  B1 rr                lda (z80_ix),y
002EEE  3  38                   sec
002EEF  3  E9 02                sbc #2
002EF1  3  91 rr                sta (z80_ix),y
002EF3  3  A5 rr        a01582: lda joyval
002EF5  3  29 04                and #4
002EF7  3  F0 03                beq :+
002EF9  3  4C 25 2F             jmp a01681
002EFC  3               :
002EFC  3  A9 03                lda #3
002EFE  3  85 rr                sta vard
002F00  3  20 D7 20             jsr laddd
002F03  3  F0 03                beq :+
002F05  3  4C 25 2F             jmp a01681
002F08  3               :
002F08  3  A9 02                lda #2
002F0A  3  A0 06                ldy #6
002F0C  3  91 rr                sta (z80_ix),y
002F0E  3  A9 00                lda #0
002F10  3  C5 rr                cmp vara
002F12  3  F0 03                beq *+5
002F14  3  4C 1C 2F             jmp a01659
002F17  3  A9 00                lda #0
002F19  3  20 4E 27             jsr animsp
002F1C  3  A0 08        a01659: ldy #8
002F1E  3  B1 rr                lda (z80_ix),y
002F20  3  18                   clc
002F21  3  69 02                adc #2
002F23  3  91 rr                sta (z80_ix),y
002F25  3  A5 rr        a01681: lda joyval
002F27  3  29 10                and #16
002F29  3  F0 03                beq :+
002F2B  3  4C 4E 2F             jmp a01755
002F2E  3               :
002F2E  3  A9 01                lda #1
002F30  3  C5 rr                cmp varl
002F32  3  F0 03                beq *+5
002F34  3  4C 3A 2F             jmp a01720
002F37  3  4C 4E 2F             jmp a01755
002F3A  3  20 5B 21     a01720: jsr cangd
002F3D  3  F0 03                beq :+
002F3F  3  4C 45 2F             jmp a01739
002F42  3               :
002F42  3  4C 4E 2F             jmp a01755
002F45  3  A9 28        a01739: lda #40
002F47  3  0A                   asl a
002F48  3  8D 32 0F             sta sndtyp
002F4B  3  20 7A 23             jsr jump
002F4E  3  A9 05        a01755: lda #DEADLY
002F50  3  85 rr                sta z80_b
002F52  3  20 87 22             jsr tded
002F55  3  C5 rr                cmp z80_b
002F57  3  F0 03                beq :+
002F59  3  4C 6C 2F             jmp a01818
002F5C  3               :
002F5C  3  A5 rr                lda varo
002F5E  3  A0 08                ldy #8
002F60  3  91 rr                sta (z80_ix),y
002F62  3  A5 rr                lda varp
002F64  3  A0 09                ldy #9
002F66  3  91 rr                sta (z80_ix),y
002F68  3  A9 01                lda #1
002F6A  3  85 rr                sta deadf
002F6C  3  4C B5 28     a01818: jmp grav
002F6F  3               .out .sprintf("EVENT 0 SIZE = %d", (* - evnt00))
002F6F  3               
002F6F  3               evnt01:
002F6F  3  A9 00                lda #0
002F71  3  C5 rr                cmp vara
002F73  3  F0 03                beq *+5
002F75  3  4C 7D 2F             jmp b00027
002F78  3  A9 00                lda #0
002F7A  3  20 4E 27             jsr animsp
002F7D  3  60           b00027: rts
002F7E  3               .out .sprintf("EVENT 1 SIZE = %d", (* - evnt01))
002F7E  3               
002F7E  3               evnt02:
002F7E  3  A9 00                lda #0
002F80  3  C5 rr                cmp vara
002F82  3  F0 03                beq *+5
002F84  3  4C 8C 2F             jmp c00027
002F87  3  A9 00                lda #0
002F89  3  20 4E 27             jsr animsp
002F8C  3  A9 00        c00027: lda #0
002F8E  3  85 rr                sta z80_b
002F90  3  20 99 27             jsr sktyp
002F93  3  B0 03                bcs :+
002F95  3  4C C7 34             jmp c02817
002F98  3               :
002F98  3  A5 rr                lda joyval
002F9A  3  29 40                and #64
002F9C  3  F0 03                beq :+
002F9E  3  4C C7 34             jmp c02817
002FA1  3               :
002FA1  3  A9 09                lda #9
002FA3  3  AA                   tax
002FA4  3  20 17 18             jsr minve
002FA7  3                       ; SILENCE command
002FA7  3  A0 08                ldy #8
002FA9  3  B1 rr                lda (z80_ix),y
002FAB  3  85 rr                sta vare
002FAD  3  A0 09                ldy #9
002FAF  3  B1 rr                lda (z80_ix),y
002FB1  3  85 rr                sta varf
002FB3  3  A9 00                lda #0
002FB5  3  C5 rr                cmp scno
002FB7  3  F0 03                beq *+5
002FB9  3  4C 15 30             jmp c00310
002FBC  3  A9 00                lda #0
002FBE  3  C5 rr                cmp varopt
002FC0  3  F0 03                beq *+5
002FC2  3  4C 15 30             jmp c00310
002FC5  3  A9 08                lda #8
002FC7  3  85 rr                sta chary
002FC9  3  A9 1C                lda #28
002FCB  3  85 rr                sta charx
002FCD  3  A5 rr                lda charx
002FCF  3  85 rr                sta dispx
002FD1  3  A5 rr                lda chary
002FD3  3  85 rr                sta dispy
002FD5  3  A9 00                lda #0
002FD7  3  20 6C 13             jsr pattr
002FDA  3  A5 rr                lda charx
002FDC  3  85 rr                sta dispx
002FDE  3  A5 rr                lda chary
002FE0  3  85 rr                sta dispy
002FE2  3  A9 00                lda #0
002FE4  3  20 6C 13             jsr pattr
002FE7  3  A9 09                lda #9
002FE9  3  85 rr                sta chary
002FEB  3  A9 1C                lda #28
002FED  3  85 rr                sta charx
002FEF  3  A5 rr                lda charx
002FF1  3  85 rr                sta dispx
002FF3  3  A5 rr                lda chary
002FF5  3  85 rr                sta dispy
002FF7  3  A9 00                lda #0
002FF9  3  20 6C 13             jsr pattr
002FFC  3  A5 rr                lda charx
002FFE  3  85 rr                sta dispx
003000  3  A5 rr                lda chary
003002  3  85 rr                sta dispy
003004  3  A9 00                lda #0
003006  3  20 6C 13             jsr pattr
003009  3  A9 50                lda #80
00300B  3  0A                   asl a
00300C  3  8D 32 0F             sta sndtyp
00300F  3  A9 FF                lda #255
003011  3  A0 05                ldy #5
003013  3  91 rr                sta (z80_ix),y
003015  3  A9 0B        c00310: lda #11
003017  3  C5 rr                cmp scno
003019  3  F0 03                beq *+5
00301B  3  4C 77 30             jmp c00509
00301E  3  A9 05                lda #5
003020  3  C5 rr                cmp varopt
003022  3  F0 03                beq *+5
003024  3  4C 77 30             jmp c00509
003027  3  A9 02                lda #2
003029  3  85 rr                sta chary
00302B  3  A9 14                lda #20
00302D  3  85 rr                sta charx
00302F  3  A5 rr                lda charx
003031  3  85 rr                sta dispx
003033  3  A5 rr                lda chary
003035  3  85 rr                sta dispy
003037  3  A9 00                lda #0
003039  3  20 6C 13             jsr pattr
00303C  3  A5 rr                lda charx
00303E  3  85 rr                sta dispx
003040  3  A5 rr                lda chary
003042  3  85 rr                sta dispy
003044  3  A9 00                lda #0
003046  3  20 6C 13             jsr pattr
003049  3  A9 03                lda #3
00304B  3  85 rr                sta chary
00304D  3  A9 14                lda #20
00304F  3  85 rr                sta charx
003051  3  A5 rr                lda charx
003053  3  85 rr                sta dispx
003055  3  A5 rr                lda chary
003057  3  85 rr                sta dispy
003059  3  A9 00                lda #0
00305B  3  20 6C 13             jsr pattr
00305E  3  A5 rr                lda charx
003060  3  85 rr                sta dispx
003062  3  A5 rr                lda chary
003064  3  85 rr                sta dispy
003066  3  A9 00                lda #0
003068  3  20 6C 13             jsr pattr
00306B  3  A9 3C                lda #60
00306D  3  0A                   asl a
00306E  3  8D 32 0F             sta sndtyp
003071  3  A9 FF                lda #255
003073  3  A0 05                ldy #5
003075  3  91 rr                sta (z80_ix),y
003077  3  A9 04        c00509: lda #4
003079  3  C5 rr                cmp scno
00307B  3  F0 03                beq *+5
00307D  3  4C F6 30             jmp c00778
003080  3  A9 06                lda #6
003082  3  C5 rr                cmp varopt
003084  3  F0 03                beq *+5
003086  3  4C F6 30             jmp c00778
003089  3                       ; COLOUR command
003089  3  A9 02                lda #2
00308B  3  85 rr                sta chary
00308D  3  A9 0B                lda #11
00308F  3  85 rr                sta charx
003091  3  A5 rr                lda charx
003093  3  85 rr                sta dispx
003095  3  A5 rr                lda chary
003097  3  85 rr                sta dispy
003099  3  A9 15                lda #21
00309B  3  20 6C 13             jsr pattr
00309E  3  A5 rr                lda charx
0030A0  3  85 rr                sta dispx
0030A2  3  A5 rr                lda chary
0030A4  3  85 rr                sta dispy
0030A6  3  A9 16                lda #22
0030A8  3  20 6C 13             jsr pattr
0030AB  3  A9 03                lda #3
0030AD  3  85 rr                sta chary
0030AF  3  A9 0B                lda #11
0030B1  3  85 rr                sta charx
0030B3  3  A5 rr                lda charx
0030B5  3  85 rr                sta dispx
0030B7  3  A5 rr                lda chary
0030B9  3  85 rr                sta dispy
0030BB  3  A9 15                lda #21
0030BD  3  20 6C 13             jsr pattr
0030C0  3  A5 rr                lda charx
0030C2  3  85 rr                sta dispx
0030C4  3  A5 rr                lda chary
0030C6  3  85 rr                sta dispy
0030C8  3  A9 16                lda #22
0030CA  3  20 6C 13             jsr pattr
0030CD  3  A9 3C                lda #60
0030CF  3  0A                   asl a
0030D0  3  8D 32 0F             sta sndtyp
0030D3  3  A9 FF                lda #255
0030D5  3  A0 05                ldy #5
0030D7  3  91 rr                sta (z80_ix),y
0030D9  3  A9 88                lda #136
0030DB  3  A0 08                ldy #8
0030DD  3  91 rr                sta (z80_ix),y
0030DF  3  A9 18                lda #24
0030E1  3  A0 09                ldy #9
0030E3  3  91 rr                sta (z80_ix),y
0030E5  3  A0 09                ldy #9
0030E7  3  B1 rr                lda (z80_ix),y
0030E9  3  85 rr                sta dispx
0030EB  3  A0 08                ldy #8
0030ED  3  B1 rr                lda (z80_ix),y
0030EF  3  85 rr                sta dispy
0030F1  3  A9 06                lda #6
0030F3  3  20 C6 1D             jsr drpob
0030F6  3  A9 09        c00778: lda #9
0030F8  3  C5 rr                cmp scno
0030FA  3  F0 03                beq *+5
0030FC  3  4C 75 31             jmp c01040
0030FF  3  A9 08                lda #8
003101  3  C5 rr                cmp varopt
003103  3  F0 03                beq *+5
003105  3  4C 75 31             jmp c01040
003108  3  A9 04                lda #4
00310A  3  85 rr                sta chary
00310C  3  A9 02                lda #2
00310E  3  85 rr                sta charx
003110  3  A5 rr                lda charx
003112  3  85 rr                sta dispx
003114  3  A5 rr                lda chary
003116  3  85 rr                sta dispy
003118  3  A9 00                lda #0
00311A  3  20 6C 13             jsr pattr
00311D  3  A5 rr                lda charx
00311F  3  85 rr                sta dispx
003121  3  A5 rr                lda chary
003123  3  85 rr                sta dispy
003125  3  A9 00                lda #0
003127  3  20 6C 13             jsr pattr
00312A  3  A9 05                lda #5
00312C  3  85 rr                sta chary
00312E  3  A9 02                lda #2
003130  3  85 rr                sta charx
003132  3  A5 rr                lda charx
003134  3  85 rr                sta dispx
003136  3  A5 rr                lda chary
003138  3  85 rr                sta dispy
00313A  3  A9 00                lda #0
00313C  3  20 6C 13             jsr pattr
00313F  3  A5 rr                lda charx
003141  3  85 rr                sta dispx
003143  3  A5 rr                lda chary
003145  3  85 rr                sta dispy
003147  3  A9 00                lda #0
003149  3  20 6C 13             jsr pattr
00314C  3  A9 2D                lda #45
00314E  3  0A                   asl a
00314F  3  8D 32 0F             sta sndtyp
003152  3  A9 FF                lda #255
003154  3  A0 05                ldy #5
003156  3  91 rr                sta (z80_ix),y
003158  3  A9 88                lda #136
00315A  3  A0 08                ldy #8
00315C  3  91 rr                sta (z80_ix),y
00315E  3  A9 18                lda #24
003160  3  A0 09                ldy #9
003162  3  91 rr                sta (z80_ix),y
003164  3  A0 09                ldy #9
003166  3  B1 rr                lda (z80_ix),y
003168  3  85 rr                sta dispx
00316A  3  A0 08                ldy #8
00316C  3  B1 rr                lda (z80_ix),y
00316E  3  85 rr                sta dispy
003170  3  A9 08                lda #8
003172  3  20 C6 1D             jsr drpob
003175  3  A9 14        c01040: lda #20
003177  3  C5 rr                cmp scno
003179  3  F0 03                beq *+5
00317B  3  4C DA 31             jmp c01250
00317E  3  A9 0F                lda #15
003180  3  C5 rr                cmp varopt
003182  3  F0 03                beq *+5
003184  3  4C DA 31             jmp c01250
003187  3  A9 04                lda #4
003189  3  85 rr                sta chary
00318B  3  A9 08                lda #8
00318D  3  85 rr                sta charx
00318F  3  A5 rr                lda charx
003191  3  85 rr                sta dispx
003193  3  A5 rr                lda chary
003195  3  85 rr                sta dispy
003197  3  A9 3C                lda #60
003199  3  20 6C 13             jsr pattr
00319C  3  A9 05                lda #5
00319E  3  85 rr                sta chary
0031A0  3  A9 08                lda #8
0031A2  3  85 rr                sta charx
0031A4  3  A5 rr                lda charx
0031A6  3  85 rr                sta dispx
0031A8  3  A5 rr                lda chary
0031AA  3  85 rr                sta dispy
0031AC  3  A9 3D                lda #61
0031AE  3  20 6C 13             jsr pattr
0031B1  3  A9 50                lda #80
0031B3  3  0A                   asl a
0031B4  3  8D 32 0F             sta sndtyp
0031B7  3  A9 FF                lda #255
0031B9  3  A0 05                ldy #5
0031BB  3  91 rr                sta (z80_ix),y
0031BD  3  A9 08                lda #8
0031BF  3  A0 08                ldy #8
0031C1  3  91 rr                sta (z80_ix),y
0031C3  3  A9 D8                lda #216
0031C5  3  A0 09                ldy #9
0031C7  3  91 rr                sta (z80_ix),y
0031C9  3  A0 09                ldy #9
0031CB  3  B1 rr                lda (z80_ix),y
0031CD  3  85 rr                sta dispx
0031CF  3  A0 08                ldy #8
0031D1  3  B1 rr                lda (z80_ix),y
0031D3  3  85 rr                sta dispy
0031D5  3  A9 0F                lda #15
0031D7  3  20 C6 1D             jsr drpob
0031DA  3  A9 0D        c01250: lda #13
0031DC  3  C5 rr                cmp scno
0031DE  3  F0 03                beq *+5
0031E0  3  4C 37 32             jmp c01443
0031E3  3  A9 07                lda #7
0031E5  3  C5 rr                cmp varopt
0031E7  3  F0 03                beq *+5
0031E9  3  4C 37 32             jmp c01443
0031EC  3  A9 11                lda #17
0031EE  3  85 rr                sta chary
0031F0  3  A9 0E                lda #14
0031F2  3  85 rr                sta charx
0031F4  3  A5 rr                lda charx
0031F6  3  85 rr                sta dispx
0031F8  3  A5 rr                lda chary
0031FA  3  85 rr                sta dispy
0031FC  3  A9 00                lda #0
0031FE  3  20 6C 13             jsr pattr
003201  3  A5 rr                lda charx
003203  3  85 rr                sta dispx
003205  3  A5 rr                lda chary
003207  3  85 rr                sta dispy
003209  3  A9 00                lda #0
00320B  3  20 6C 13             jsr pattr
00320E  3  A9 2D                lda #45
003210  3  0A                   asl a
003211  3  8D 32 0F             sta sndtyp
003214  3  A9 FF                lda #255
003216  3  A0 05                ldy #5
003218  3  91 rr                sta (z80_ix),y
00321A  3  A9 30                lda #48
00321C  3  A0 08                ldy #8
00321E  3  91 rr                sta (z80_ix),y
003220  3  A9 D8                lda #216
003222  3  A0 09                ldy #9
003224  3  91 rr                sta (z80_ix),y
003226  3  A0 09                ldy #9
003228  3  B1 rr                lda (z80_ix),y
00322A  3  85 rr                sta dispx
00322C  3  A0 08                ldy #8
00322E  3  B1 rr                lda (z80_ix),y
003230  3  85 rr                sta dispy
003232  3  A9 07                lda #7
003234  3  20 C6 1D             jsr drpob
003237  3  A9 0E        c01443: lda #14
003239  3  C5 rr                cmp scno
00323B  3  F0 03                beq *+5
00323D  3  4C 87 32             jmp c01610
003240  3  A9 0B                lda #11
003242  3  C5 rr                cmp varopt
003244  3  F0 03                beq *+5
003246  3  4C 87 32             jmp c01610
003249  3  A9 0F                lda #15
00324B  3  85 rr                sta chary
00324D  3  A9 07                lda #7
00324F  3  85 rr                sta charx
003251  3  A5 rr                lda charx
003253  3  85 rr                sta dispx
003255  3  A5 rr                lda chary
003257  3  85 rr                sta dispy
003259  3  A9 38                lda #56
00325B  3  20 6C 13             jsr pattr
00325E  3  A9 50                lda #80
003260  3  0A                   asl a
003261  3  8D 32 0F             sta sndtyp
003264  3  A9 FF                lda #255
003266  3  A0 05                ldy #5
003268  3  91 rr                sta (z80_ix),y
00326A  3  A9 88                lda #136
00326C  3  A0 08                ldy #8
00326E  3  91 rr                sta (z80_ix),y
003270  3  A9 18                lda #24
003272  3  A0 09                ldy #9
003274  3  91 rr                sta (z80_ix),y
003276  3  A0 09                ldy #9
003278  3  B1 rr                lda (z80_ix),y
00327A  3  85 rr                sta dispx
00327C  3  A0 08                ldy #8
00327E  3  B1 rr                lda (z80_ix),y
003280  3  85 rr                sta dispy
003282  3  A9 0B                lda #11
003284  3  20 C6 1D             jsr drpob
003287  3  A9 05        c01610: lda #5
003289  3  C5 rr                cmp scno
00328B  3  F0 03                beq *+5
00328D  3  4C 0B 33             jmp c01895
003290  3  A9 0A                lda #10
003292  3  C5 rr                cmp varopt
003294  3  F0 03                beq *+5
003296  3  4C 0B 33             jmp c01895
003299  3  A0 08                ldy #8
00329B  3  B1 rr                lda (z80_ix),y
00329D  3  85 rr                sta vare
00329F  3  A0 09                ldy #9
0032A1  3  B1 rr                lda (z80_ix),y
0032A3  3  85 rr                sta varf
0032A5  3  A9 48                lda #72
0032A7  3  A0 08                ldy #8
0032A9  3  91 rr                sta (z80_ix),y
0032AB  3  A9 B0                lda #176
0032AD  3  A0 09                ldy #9
0032AF  3  91 rr                sta (z80_ix),y
0032B1  3  A0 09                ldy #9
0032B3  3  B1 rr                lda (z80_ix),y
0032B5  3  85 rr                sta dispx
0032B7  3  A0 08                ldy #8
0032B9  3  B1 rr                lda (z80_ix),y
0032BB  3  85 rr                sta dispy
0032BD  3  A9 0A                lda #10
0032BF  3  20 C6 1D             jsr drpob
0032C2  3  A9 3C                lda #60
0032C4  3  0A                   asl a
0032C5  3  8D 32 0F             sta sndtyp
0032C8  3  A9 FF                lda #255
0032CA  3  A0 05                ldy #5
0032CC  3  91 rr                sta (z80_ix),y
0032CE  3  A5 rr                lda varf
0032D0  3  A0 09                ldy #9
0032D2  3  91 rr                sta (z80_ix),y
0032D4  3  A5 rr                lda vare
0032D6  3  A0 08                ldy #8
0032D8  3  91 rr                sta (z80_ix),y
0032DA  3  A9 4B                lda #75
0032DC  3  20 FF 0E             jsr delay
0032DF  3  A9 18                lda #24
0032E1  3  85 rr                sta z80_c
0032E3  3  A0 09                ldy #9
0032E5  3  B1 rr                lda (z80_ix),y
0032E7  3  18                   clc
0032E8  3  65 rr                adc z80_c
0032EA  3  A0 09                ldy #9
0032EC  3  91 rr                sta (z80_ix),y
0032EE  3  A0 09                ldy #9
0032F0  3  B1 rr                lda (z80_ix),y
0032F2  3  85 rr                sta dispx
0032F4  3  A0 08                ldy #8
0032F6  3  B1 rr                lda (z80_ix),y
0032F8  3  85 rr                sta dispy
0032FA  3  A9 0E                lda #14
0032FC  3  20 C6 1D             jsr drpob
0032FF  3  A5 rr                lda varf
003301  3  A0 09                ldy #9
003303  3  91 rr                sta (z80_ix),y
003305  3  A9 46                lda #70
003307  3  0A                   asl a
003308  3  8D 32 0F             sta sndtyp
00330B  3  A9 0E        c01895: lda #14
00330D  3  C5 rr                cmp scno
00330F  3  F0 03                beq *+5
003311  3  4C 75 33             jmp c02116
003314  3  A9 0E                lda #14
003316  3  C5 rr                cmp varopt
003318  3  F0 03                beq *+5
00331A  3  4C 75 33             jmp c02116
00331D  3  A9 09                lda #9
00331F  3  85 rr                sta chary
003321  3  A9 0B                lda #11
003323  3  85 rr                sta charx
003325  3  A5 rr                lda charx
003327  3  85 rr                sta dispx
003329  3  A5 rr                lda chary
00332B  3  85 rr                sta dispy
00332D  3  A9 37                lda #55
00332F  3  20 6C 13             jsr pattr
003332  3  A5 rr                lda charx
003334  3  85 rr                sta dispx
003336  3  A5 rr                lda chary
003338  3  85 rr                sta dispy
00333A  3  A9 48                lda #72
00333C  3  20 6C 13             jsr pattr
00333F  3  A5 rr                lda charx
003341  3  85 rr                sta dispx
003343  3  A5 rr                lda chary
003345  3  85 rr                sta dispy
003347  3  A9 49                lda #73
003349  3  20 6C 13             jsr pattr
00334C  3  A9 3C                lda #60
00334E  3  0A                   asl a
00334F  3  8D 32 0F             sta sndtyp
003352  3  A9 FF                lda #255
003354  3  A0 05                ldy #5
003356  3  91 rr                sta (z80_ix),y
003358  3  A9 88                lda #136
00335A  3  A0 08                ldy #8
00335C  3  91 rr                sta (z80_ix),y
00335E  3  A9 18                lda #24
003360  3  A0 09                ldy #9
003362  3  91 rr                sta (z80_ix),y
003364  3  A0 09                ldy #9
003366  3  B1 rr                lda (z80_ix),y
003368  3  85 rr                sta dispx
00336A  3  A0 08                ldy #8
00336C  3  B1 rr                lda (z80_ix),y
00336E  3  85 rr                sta dispy
003370  3  A9 0E                lda #14
003372  3  20 C6 1D             jsr drpob
003375  3  A9 10        c02116: lda #16
003377  3  C5 rr                cmp scno
003379  3  F0 03                beq *+5
00337B  3  4C D8 33             jmp c02324
00337E  3  A9 09                lda #9
003380  3  C5 rr                cmp varopt
003382  3  F0 03                beq *+5
003384  3  4C D8 33             jmp c02324
003387  3  A9 48                lda #72
003389  3  A0 08                ldy #8
00338B  3  91 rr                sta (z80_ix),y
00338D  3  A9 78                lda #120
00338F  3  A0 09                ldy #9
003391  3  91 rr                sta (z80_ix),y
003393  3  A0 09                ldy #9
003395  3  B1 rr                lda (z80_ix),y
003397  3  85 rr                sta dispx
003399  3  A0 08                ldy #8
00339B  3  B1 rr                lda (z80_ix),y
00339D  3  85 rr                sta dispy
00339F  3  A9 09                lda #9
0033A1  3  20 C6 1D             jsr drpob
0033A4  3  A9 3C                lda #60
0033A6  3  0A                   asl a
0033A7  3  8D 32 0F             sta sndtyp
0033AA  3  A9 FF                lda #255
0033AC  3  A0 05                ldy #5
0033AE  3  91 rr                sta (z80_ix),y
0033B0  3  A9 32                lda #50
0033B2  3  20 FF 0E             jsr delay
0033B5  3  A9 50                lda #80
0033B7  3  0A                   asl a
0033B8  3  8D 32 0F             sta sndtyp
0033BB  3  A9 80                lda #128
0033BD  3  A0 08                ldy #8
0033BF  3  91 rr                sta (z80_ix),y
0033C1  3  A9 A8                lda #168
0033C3  3  A0 09                ldy #9
0033C5  3  91 rr                sta (z80_ix),y
0033C7  3  A0 09                ldy #9
0033C9  3  B1 rr                lda (z80_ix),y
0033CB  3  85 rr                sta dispx
0033CD  3  A0 08                ldy #8
0033CF  3  B1 rr                lda (z80_ix),y
0033D1  3  85 rr                sta dispy
0033D3  3  A9 02                lda #2
0033D5  3  20 C6 1D             jsr drpob
0033D8  3  A9 0F        c02324: lda #15
0033DA  3  C5 rr                cmp scno
0033DC  3  F0 03                beq *+5
0033DE  3  4C 35 34             jmp c02518
0033E1  3  A9 11                lda #17
0033E3  3  C5 rr                cmp varopt
0033E5  3  F0 03                beq *+5
0033E7  3  4C 35 34             jmp c02518
0033EA  3  A9 0F                lda #15
0033EC  3  85 rr                sta chary
0033EE  3  A9 14                lda #20
0033F0  3  85 rr                sta charx
0033F2  3  A5 rr                lda charx
0033F4  3  85 rr                sta dispx
0033F6  3  A5 rr                lda chary
0033F8  3  85 rr                sta dispy
0033FA  3  A9 34                lda #52
0033FC  3  20 6C 13             jsr pattr
0033FF  3  A5 rr                lda charx
003401  3  85 rr                sta dispx
003403  3  A5 rr                lda chary
003405  3  85 rr                sta dispy
003407  3  A9 34                lda #52
003409  3  20 6C 13             jsr pattr
00340C  3  A9 3C                lda #60
00340E  3  0A                   asl a
00340F  3  8D 32 0F             sta sndtyp
003412  3  A9 FF                lda #255
003414  3  A0 05                ldy #5
003416  3  91 rr                sta (z80_ix),y
003418  3  A9 88                lda #136
00341A  3  A0 08                ldy #8
00341C  3  91 rr                sta (z80_ix),y
00341E  3  A9 18                lda #24
003420  3  A0 09                ldy #9
003422  3  91 rr                sta (z80_ix),y
003424  3  A0 09                ldy #9
003426  3  B1 rr                lda (z80_ix),y
003428  3  85 rr                sta dispx
00342A  3  A0 08                ldy #8
00342C  3  B1 rr                lda (z80_ix),y
00342E  3  85 rr                sta dispy
003430  3  A9 11                lda #17
003432  3  20 C6 1D             jsr drpob
003435  3  A9 17        c02518: lda #23
003437  3  C5 rr                cmp scno
003439  3  F0 03                beq *+5
00343B  3  4C 88 34             jmp c02686
00343E  3  A9 12                lda #18
003440  3  C5 rr                cmp varopt
003442  3  F0 03                beq *+5
003444  3  4C 88 34             jmp c02686
003447  3  A9 05                lda #5
003449  3  85 rr                sta chary
00344B  3  A9 18                lda #24
00344D  3  85 rr                sta charx
00344F  3  A5 rr                lda charx
003451  3  85 rr                sta dispx
003453  3  A5 rr                lda chary
003455  3  85 rr                sta dispy
003457  3  A9 00                lda #0
003459  3  20 6C 13             jsr pattr
00345C  3  A9 2D                lda #45
00345E  3  0A                   asl a
00345F  3  8D 32 0F             sta sndtyp
003462  3  A9 32                lda #50
003464  3  20 FF 0E             jsr delay
003467  3  A9 06                lda #6
003469  3  85 rr                sta chary
00346B  3  A9 18                lda #24
00346D  3  85 rr                sta charx
00346F  3  A5 rr                lda charx
003471  3  85 rr                sta dispx
003473  3  A5 rr                lda chary
003475  3  85 rr                sta dispy
003477  3  A9 00                lda #0
003479  3  20 6C 13             jsr pattr
00347C  3  A9 2D                lda #45
00347E  3  0A                   asl a
00347F  3  8D 32 0F             sta sndtyp
003482  3  A9 FF                lda #255
003484  3  A0 05                ldy #5
003486  3  91 rr                sta (z80_ix),y
003488  3  A9 0A        c02686: lda #10
00348A  3  C5 rr                cmp scno
00348C  3  F0 03                beq *+5
00348E  3  4C BB 34             jmp c02789
003491  3  A9 10                lda #16
003493  3  C5 rr                cmp varopt
003495  3  F0 03                beq *+5
003497  3  4C BB 34             jmp c02789
00349A  3  A9 04                lda #4
00349C  3  85 rr                sta chary
00349E  3  A9 11                lda #17
0034A0  3  85 rr                sta charx
0034A2  3  A5 rr                lda charx
0034A4  3  85 rr                sta dispx
0034A6  3  A5 rr                lda chary
0034A8  3  85 rr                sta dispy
0034AA  3  A9 00                lda #0
0034AC  3  20 6C 13             jsr pattr
0034AF  3  A9 2D                lda #45
0034B1  3  0A                   asl a
0034B2  3  8D 32 0F             sta sndtyp
0034B5  3  A9 FF                lda #255
0034B7  3  A0 05                ldy #5
0034B9  3  91 rr                sta (z80_ix),y
0034BB  3  A5 rr        c02789: lda vare
0034BD  3  A0 08                ldy #8
0034BF  3  91 rr                sta (z80_ix),y
0034C1  3  A5 rr                lda varf
0034C3  3  A0 09                ldy #9
0034C5  3  91 rr                sta (z80_ix),y
0034C7  3  60           c02817: rts
0034C8  3               .out .sprintf("EVENT 2 SIZE = %d", (* - evnt02))
0034C8  3               
0034C8  3               evnt03:
0034C8  3  A9 00                lda #0
0034CA  3  C5 rr                cmp varc
0034CC  3  F0 03                beq *+5
0034CE  3  4C 6B 35             jmp d00347
0034D1  3  A9 00                lda #0
0034D3  3  A0 0B                ldy #11
0034D5  3  D1 rr                cmp (z80_ix),y
0034D7  3  F0 03                beq *+5
0034D9  3  4C 25 35             jmp d00196
0034DC  3  20 90 21             jsr cangl
0034DF  3  F0 03                beq :+
0034E1  3  4C 1C 35             jmp d00178
0034E4  3               :
0034E4  3  A0 09                ldy #9
0034E6  3  B1 rr                lda (z80_ix),y
0034E8  3  38                   sec
0034E9  3  E9 02                sbc #2
0034EB  3  91 rr                sta (z80_ix),y
0034ED  3  A9 10                lda #16
0034EF  3  85 rr                sta z80_c
0034F1  3  A0 09                ldy #9
0034F3  3  B1 rr                lda (z80_ix),y
0034F5  3  38                   sec
0034F6  3  E5 rr                sbc z80_c
0034F8  3  A0 09                ldy #9
0034FA  3  91 rr                sta (z80_ix),y
0034FC  3  20 5B 21             jsr cangd
0034FF  3  F0 03                beq :+
003501  3  4C 0A 35             jmp d00138
003504  3               :
003504  3  A9 01                lda #1
003506  3  A0 0B                ldy #11
003508  3  91 rr                sta (z80_ix),y
00350A  3  A9 10        d00138: lda #16
00350C  3  85 rr                sta z80_c
00350E  3  A0 09                ldy #9
003510  3  B1 rr                lda (z80_ix),y
003512  3  18                   clc
003513  3  65 rr                adc z80_c
003515  3  A0 09                ldy #9
003517  3  91 rr                sta (z80_ix),y
003519  3  4C 22 35             jmp d00191
00351C  3  A9 01        d00178: lda #1
00351E  3  A0 0B                ldy #11
003520  3  91 rr                sta (z80_ix),y
003522  3  4C 6B 35     d00191: jmp d00347
003525  3  20 A2 21     d00196: jsr cangr
003528  3  F0 03                beq :+
00352A  3  4C 65 35             jmp d00333
00352D  3               :
00352D  3  A0 09                ldy #9
00352F  3  B1 rr                lda (z80_ix),y
003531  3  18                   clc
003532  3  69 02                adc #2
003534  3  91 rr                sta (z80_ix),y
003536  3  A9 10                lda #16
003538  3  85 rr                sta z80_c
00353A  3  A0 09                ldy #9
00353C  3  B1 rr                lda (z80_ix),y
00353E  3  18                   clc
00353F  3  65 rr                adc z80_c
003541  3  A0 09                ldy #9
003543  3  91 rr                sta (z80_ix),y
003545  3  20 5B 21             jsr cangd
003548  3  F0 03                beq :+
00354A  3  4C 53 35             jmp d00294
00354D  3               :
00354D  3  A9 00                lda #0
00354F  3  A0 0B                ldy #11
003551  3  91 rr                sta (z80_ix),y
003553  3  A9 10        d00294: lda #16
003555  3  85 rr                sta z80_c
003557  3  A0 09                ldy #9
003559  3  B1 rr                lda (z80_ix),y
00355B  3  38                   sec
00355C  3  E5 rr                sbc z80_c
00355E  3  A0 09                ldy #9
003560  3  91 rr                sta (z80_ix),y
003562  3  4C 6B 35             jmp d00347
003565  3  A9 00        d00333: lda #0
003567  3  A0 0B                ldy #11
003569  3  91 rr                sta (z80_ix),y
00356B  3  A9 00        d00347: lda #0
00356D  3  20 4E 27             jsr animsp
003570  3  A9 00                lda #0
003572  3  85 rr                sta z80_b
003574  3  20 99 27             jsr sktyp
003577  3  B0 03                bcs :+
003579  3  4C 80 35             jmp d00385
00357C  3               :
00357C  3  A9 01                lda #1
00357E  3  85 rr                sta deadf
003580  3  60           d00385: rts
003581  3               .out .sprintf("EVENT 3 SIZE = %d", (* - evnt03))
003581  3               
003581  3               evnt04:
003581  3  A9 47                lda #71
003583  3  29 07                and #7
003585  3  85 rr                sta spriteink
003587  3  A9 00                lda #0
003589  3  A0 0B                ldy #11
00358B  3  D1 rr                cmp (z80_ix),y
00358D  3  F0 03                beq *+5
00358F  3  4C C3 35             jmp e00133
003592  3  20 5B 21             jsr cangd
003595  3  F0 03                beq :+
003597  3  4C B4 35             jmp e00103
00359A  3               :
00359A  3  A0 08                ldy #8
00359C  3  B1 rr                lda (z80_ix),y
00359E  3  18                   clc
00359F  3  69 02                adc #2
0035A1  3  91 rr                sta (z80_ix),y
0035A3  3  A9 00                lda #0
0035A5  3  C5 rr                cmp vara
0035A7  3  F0 03                beq *+5
0035A9  3  4C B1 35             jmp e00098
0035AC  3  A9 00                lda #0
0035AE  3  20 4E 27             jsr animsp
0035B1  3  4C C0 35     e00098: jmp e00128
0035B4  3  A9 01        e00103: lda #1
0035B6  3  A0 0B                ldy #11
0035B8  3  91 rr                sta (z80_ix),y
0035BA  3  A9 23                lda #35
0035BC  3  0A                   asl a
0035BD  3  8D 32 0F             sta sndtyp
0035C0  3  4C F1 35     e00128: jmp e00224
0035C3  3  20 26 21     e00133: jsr cangu
0035C6  3  F0 03                beq :+
0035C8  3  4C E5 35             jmp e00199
0035CB  3               :
0035CB  3  A0 08                ldy #8
0035CD  3  B1 rr                lda (z80_ix),y
0035CF  3  38                   sec
0035D0  3  E9 02                sbc #2
0035D2  3  91 rr                sta (z80_ix),y
0035D4  3  A9 00                lda #0
0035D6  3  C5 rr                cmp vara
0035D8  3  F0 03                beq *+5
0035DA  3  4C E2 35             jmp e00194
0035DD  3  A9 00                lda #0
0035DF  3  20 4E 27             jsr animsp
0035E2  3  4C F1 35     e00194: jmp e00224
0035E5  3  A9 00        e00199: lda #0
0035E7  3  A0 0B                ldy #11
0035E9  3  91 rr                sta (z80_ix),y
0035EB  3  A9 23                lda #35
0035ED  3  0A                   asl a
0035EE  3  8D 32 0F             sta sndtyp
0035F1  3  A9 00        e00224: lda #0
0035F3  3  85 rr                sta z80_b
0035F5  3  20 99 27             jsr sktyp
0035F8  3  B0 03                bcs :+
0035FA  3  4C 01 36             jmp e00254
0035FD  3               :
0035FD  3  A9 01                lda #1
0035FF  3  85 rr                sta deadf
003601  3  A9 03        e00254: lda #3
003603  3  A0 06                ldy #6
003605  3  D1 rr                cmp (z80_ix),y
003607  3  F0 03                beq *+5
003609  3  4C 12 36             jmp e00290
00360C  3  A9 46                lda #70
00360E  3  29 07                and #7
003610  3  85 rr                sta spriteink
003612  3  A9 06        e00290: lda #6
003614  3  A0 06                ldy #6
003616  3  D1 rr                cmp (z80_ix),y
003618  3  F0 03                beq *+5
00361A  3  4C 23 36             jmp e00325
00361D  3  A9 4D                lda #77
00361F  3  29 07                and #7
003621  3  85 rr                sta spriteink
003623  3  60           e00325: rts
003624  3               .out .sprintf("EVENT 4 SIZE = %d", (* - evnt04))
003624  3               
003624  3               evnt05:
003624  3  A9 00                lda #0
003626  3  C5 rr                cmp vara
003628  3  F0 03                beq *+5
00362A  3  4C 32 36             jmp f00027
00362D  3  A9 00                lda #0
00362F  3  20 4E 27             jsr animsp
003632  3  A9 00        f00027: lda #0
003634  3  85 rr                sta z80_b
003636  3  20 99 27             jsr sktyp
003639  3  B0 03                bcs :+
00363B  3  4C 4B 37             jmp f00601
00363E  3               :
00363E  3  A5 rr                lda joyval
003640  3  29 40                and #64
003642  3  F0 03                beq :+
003644  3  4C 4B 37             jmp f00601
003647  3               :
003647  3  A9 09                lda #9
003649  3  AA                   tax
00364A  3  20 17 18             jsr minve
00364D  3                       ; SILENCE command
00364D  3  A0 08                ldy #8
00364F  3  B1 rr                lda (z80_ix),y
003651  3  85 rr                sta vare
003653  3  A0 09                ldy #9
003655  3  B1 rr                lda (z80_ix),y
003657  3  85 rr                sta varf
003659  3  A9 19                lda #25
00365B  3  C5 rr                cmp scno
00365D  3  F0 03                beq *+5
00365F  3  4C BB 36             jmp f00311
003662  3  A9 04                lda #4
003664  3  C5 rr                cmp varopt
003666  3  F0 03                beq *+5
003668  3  4C BB 36             jmp f00311
00366B  3  A9 09                lda #9
00366D  3  85 rr                sta chary
00366F  3  A9 0E                lda #14
003671  3  85 rr                sta charx
003673  3  A5 rr                lda charx
003675  3  85 rr                sta dispx
003677  3  A5 rr                lda chary
003679  3  85 rr                sta dispy
00367B  3  A9 00                lda #0
00367D  3  20 6C 13             jsr pattr
003680  3  A5 rr                lda charx
003682  3  85 rr                sta dispx
003684  3  A5 rr                lda chary
003686  3  85 rr                sta dispy
003688  3  A9 00                lda #0
00368A  3  20 6C 13             jsr pattr
00368D  3  A9 0A                lda #10
00368F  3  85 rr                sta chary
003691  3  A9 0E                lda #14
003693  3  85 rr                sta charx
003695  3  A5 rr                lda charx
003697  3  85 rr                sta dispx
003699  3  A5 rr                lda chary
00369B  3  85 rr                sta dispy
00369D  3  A9 00                lda #0
00369F  3  20 6C 13             jsr pattr
0036A2  3  A5 rr                lda charx
0036A4  3  85 rr                sta dispx
0036A6  3  A5 rr                lda chary
0036A8  3  85 rr                sta dispy
0036AA  3  A9 00                lda #0
0036AC  3  20 6C 13             jsr pattr
0036AF  3  A9 32                lda #50
0036B1  3  0A                   asl a
0036B2  3  8D 32 0F             sta sndtyp
0036B5  3  A9 FF                lda #255
0036B7  3  A0 05                ldy #5
0036B9  3  91 rr                sta (z80_ix),y
0036BB  3  A9 01        f00311: lda #1
0036BD  3  C5 rr                cmp scno
0036BF  3  F0 03                beq *+5
0036C1  3  4C 1D 37             jmp f00510
0036C4  3  A9 04                lda #4
0036C6  3  C5 rr                cmp varopt
0036C8  3  F0 03                beq *+5
0036CA  3  4C 1D 37             jmp f00510
0036CD  3  A9 0F                lda #15
0036CF  3  85 rr                sta chary
0036D1  3  A9 16                lda #22
0036D3  3  85 rr                sta charx
0036D5  3  A5 rr                lda charx
0036D7  3  85 rr                sta dispx
0036D9  3  A5 rr                lda chary
0036DB  3  85 rr                sta dispy
0036DD  3  A9 00                lda #0
0036DF  3  20 6C 13             jsr pattr
0036E2  3  A5 rr                lda charx
0036E4  3  85 rr                sta dispx
0036E6  3  A5 rr                lda chary
0036E8  3  85 rr                sta dispy
0036EA  3  A9 00                lda #0
0036EC  3  20 6C 13             jsr pattr
0036EF  3  A9 10                lda #16
0036F1  3  85 rr                sta chary
0036F3  3  A9 16                lda #22
0036F5  3  85 rr                sta charx
0036F7  3  A5 rr                lda charx
0036F9  3  85 rr                sta dispx
0036FB  3  A5 rr                lda chary
0036FD  3  85 rr                sta dispy
0036FF  3  A9 00                lda #0
003701  3  20 6C 13             jsr pattr
003704  3  A5 rr                lda charx
003706  3  85 rr                sta dispx
003708  3  A5 rr                lda chary
00370A  3  85 rr                sta dispy
00370C  3  A9 00                lda #0
00370E  3  20 6C 13             jsr pattr
003711  3  A9 32                lda #50
003713  3  0A                   asl a
003714  3  8D 32 0F             sta sndtyp
003717  3  A9 FF                lda #255
003719  3  A0 05                ldy #5
00371B  3  91 rr                sta (z80_ix),y
00371D  3  A9 05        f00510: lda #5
00371F  3  C5 rr                cmp scno
003721  3  F0 03                beq *+5
003723  3  4C 4B 37             jmp f00601
003726  3  A9 03                lda #3
003728  3  C5 rr                cmp vark
00372A  3  F0 03                beq *+5
00372C  3  4C 3F 37             jmp f00573
00372F  3  A9 13                lda #19
003731  3  C5 rr                cmp varopt
003733  3  F0 03                beq *+5
003735  3  4C 3F 37             jmp f00573
003738  3  A9 1B                lda #27
00373A  3  85 rr                sta scno
00373C  3  20 A2 28             jsr nwscr
00373F  3  A5 rr        f00573: lda vare
003741  3  A0 08                ldy #8
003743  3  91 rr                sta (z80_ix),y
003745  3  A5 rr                lda varf
003747  3  A0 09                ldy #9
003749  3  91 rr                sta (z80_ix),y
00374B  3  60           f00601: rts
00374C  3               .out .sprintf("EVENT 5 SIZE = %d", (* - evnt05))
00374C  3               
00374C  3               evnt06:
00374C  3  A9 00                lda #0
00374E  3  A0 0B                ldy #11
003750  3  D1 rr                cmp (z80_ix),y
003752  3  F0 03                beq *+5
003754  3  4C 92 37             jmp g00152
003757  3  20 90 21             jsr cangl
00375A  3  F0 03                beq :+
00375C  3  4C 89 37             jmp g00134
00375F  3               :
00375F  3  A0 09                ldy #9
003761  3  B1 rr                lda (z80_ix),y
003763  3  38                   sec
003764  3  E9 02                sbc #2
003766  3  91 rr                sta (z80_ix),y
003768  3  A9 10                lda #16
00376A  3  85 rr                sta z80_c
00376C  3  A0 09                ldy #9
00376E  3  B1 rr                lda (z80_ix),y
003770  3  38                   sec
003771  3  E5 rr                sbc z80_c
003773  3  A0 09                ldy #9
003775  3  91 rr                sta (z80_ix),y
003777  3  A9 10                lda #16
003779  3  85 rr                sta z80_c
00377B  3  A0 09                ldy #9
00377D  3  B1 rr                lda (z80_ix),y
00377F  3  18                   clc
003780  3  65 rr                adc z80_c
003782  3  A0 09                ldy #9
003784  3  91 rr                sta (z80_ix),y
003786  3  4C 8F 37             jmp g00148
003789  3  A9 01        g00134: lda #1
00378B  3  A0 0B                ldy #11
00378D  3  91 rr                sta (z80_ix),y
00378F  3  4C CA 37     g00148: jmp g00276
003792  3  20 A2 21     g00152: jsr cangr
003795  3  F0 03                beq :+
003797  3  4C C4 37             jmp g00263
00379A  3               :
00379A  3  A0 09                ldy #9
00379C  3  B1 rr                lda (z80_ix),y
00379E  3  18                   clc
00379F  3  69 02                adc #2
0037A1  3  91 rr                sta (z80_ix),y
0037A3  3  A9 10                lda #16
0037A5  3  85 rr                sta z80_c
0037A7  3  A0 09                ldy #9
0037A9  3  B1 rr                lda (z80_ix),y
0037AB  3  18                   clc
0037AC  3  65 rr                adc z80_c
0037AE  3  A0 09                ldy #9
0037B0  3  91 rr                sta (z80_ix),y
0037B2  3  A9 10                lda #16
0037B4  3  85 rr                sta z80_c
0037B6  3  A0 09                ldy #9
0037B8  3  B1 rr                lda (z80_ix),y
0037BA  3  38                   sec
0037BB  3  E5 rr                sbc z80_c
0037BD  3  A0 09                ldy #9
0037BF  3  91 rr                sta (z80_ix),y
0037C1  3  4C CA 37             jmp g00276
0037C4  3  A9 00        g00263: lda #0
0037C6  3  A0 0B                ldy #11
0037C8  3  91 rr                sta (z80_ix),y
0037CA  3  A9 01        g00276: lda #1
0037CC  3  A0 0B                ldy #11
0037CE  3  D1 rr                cmp (z80_ix),y
0037D0  3  F0 03                beq *+5
0037D2  3  4C F4 37             jmp g00358
0037D5  3  A9 00                lda #0
0037D7  3  C5 rr                cmp vara
0037D9  3  F0 03                beq *+5
0037DB  3  4C F4 37             jmp g00358
0037DE  3  A9 00                lda #0
0037E0  3  20 4E 27             jsr animsp
0037E3  3  A9 03                lda #3
0037E5  3  A0 07                ldy #7
0037E7  3  D1 rr                cmp (z80_ix),y
0037E9  3  F0 03                beq *+5
0037EB  3  4C F4 37             jmp g00358
0037EE  3  A9 23                lda #35
0037F0  3  0A                   asl a
0037F1  3  8D 32 0F             sta sndtyp
0037F4  3  A9 00        g00358: lda #0
0037F6  3  A0 0B                ldy #11
0037F8  3  D1 rr                cmp (z80_ix),y
0037FA  3  F0 03                beq *+5
0037FC  3  4C 1E 38             jmp g00440
0037FF  3  A9 00                lda #0
003801  3  C5 rr                cmp vara
003803  3  F0 03                beq *+5
003805  3  4C 1E 38             jmp g00440
003808  3  A9 00                lda #0
00380A  3  20 74 27             jsr animbk
00380D  3  A9 03                lda #3
00380F  3  A0 07                ldy #7
003811  3  D1 rr                cmp (z80_ix),y
003813  3  F0 03                beq *+5
003815  3  4C 1E 38             jmp g00440
003818  3  A9 23                lda #35
00381A  3  0A                   asl a
00381B  3  8D 32 0F             sta sndtyp
00381E  3  A9 00        g00440: lda #0
003820  3  85 rr                sta z80_b
003822  3  20 99 27             jsr sktyp
003825  3  B0 03                bcs :+
003827  3  4C 2E 38             jmp g00470
00382A  3               :
00382A  3  A9 01                lda #1
00382C  3  85 rr                sta deadf
00382E  3  A9 08        g00470: lda #8
003830  3  A0 06                ldy #6
003832  3  D1 rr                cmp (z80_ix),y
003834  3  F0 03                beq *+5
003836  3  4C 3F 38             jmp g00505
003839  3  A9 06                lda #6
00383B  3  29 07                and #7
00383D  3  85 rr                sta spriteink
00383F  3  60           g00505: rts
003840  3               .out .sprintf("EVENT 6 SIZE = %d", (* - evnt06))
003840  3               
003840  3               evnt07:
003840  3  60                   rts
003841  3               .out .sprintf("EVENT 7 SIZE = %d", (* - evnt07))
003841  3               
003841  3               evnt08:
003841  3  60                   rts
003842  3               .out .sprintf("EVENT 8 SIZE = %d", (* - evnt08))
003842  3               
003842  3               evnt09:
003842  3  A9 04                lda #4
003844  3  A0 05                ldy #5
003846  3  D1 rr                cmp (z80_ix),y
003848  3  F0 03                beq *+5
00384A  3  4C 53 38             jmp j00037
00384D  3  A9 01                lda #1
00384F  3  A0 0B                ldy #11
003851  3  91 rr                sta (z80_ix),y
003853  3  A9 00        j00037: lda #0
003855  3  A0 05                ldy #5
003857  3  D1 rr                cmp (z80_ix),y
003859  3  F0 03                beq *+5
00385B  3  4C 75 38             jmp j00112
00385E  3  A5 rr                lda varo
003860  3  A0 08                ldy #8
003862  3  91 rr                sta (z80_ix),y
003864  3  A5 rr                lda varp
003866  3  A0 09                ldy #9
003868  3  91 rr                sta (z80_ix),y
00386A  3  A0 08                ldy #8
00386C  3  B1 rr                lda (z80_ix),y
00386E  3  18                   clc
00386F  3  69 01                adc #1
003871  3  A0 08                ldy #8
003873  3  91 rr                sta (z80_ix),y
003875  3  60           j00112: rts
003876  3               .out .sprintf("EVENT 9 SIZE = %d", (* - evnt09))
003876  3               
003876  3               evnt10:
003876  3  A5 rr                lda vara
003878  3  18                   clc
003879  3  69 01                adc #1
00387B  3  85 rr                sta vara
00387D  3  A9 02                lda #2
00387F  3  C5 rr                cmp vara
003881  3  90 03                bcc *+5
003883  3  4C 8A 38             jmp k00042
003886  3  A9 00                lda #0
003888  3  85 rr                sta vara
00388A  3  A9 01        k00042: lda #1
00388C  3  C5 rr                cmp varh
00388E  3  F0 03                beq *+5
003890  3  4C DB 38             jmp k00214
003893  3  A9 0C                lda #12
003895  3  20 95 1D             jsr gotob
003898  3  C9 FF                cmp #255
00389A  3  F0 03                beq :+
00389C  3  4C DB 38             jmp k00214
00389F  3               :
00389F  3  A0 08                ldy #8
0038A1  3  B1 rr                lda (z80_ix),y
0038A3  3  85 rr                sta vare
0038A5  3  A0 09                ldy #9
0038A7  3  B1 rr                lda (z80_ix),y
0038A9  3  85 rr                sta varf
0038AB  3  A9 28                lda #40
0038AD  3  A0 08                ldy #8
0038AF  3  91 rr                sta (z80_ix),y
0038B1  3  A9 58                lda #88
0038B3  3  A0 09                ldy #9
0038B5  3  91 rr                sta (z80_ix),y
0038B7  3  A0 09                ldy #9
0038B9  3  B1 rr                lda (z80_ix),y
0038BB  3  85 rr                sta dispx
0038BD  3  A0 08                ldy #8
0038BF  3  B1 rr                lda (z80_ix),y
0038C1  3  85 rr                sta dispy
0038C3  3  A9 0C                lda #12
0038C5  3  20 C6 1D             jsr drpob
0038C8  3  A5 rr                lda vare
0038CA  3  A0 08                ldy #8
0038CC  3  91 rr                sta (z80_ix),y
0038CE  3  A5 rr                lda varf
0038D0  3  A0 09                ldy #9
0038D2  3  91 rr                sta (z80_ix),y
0038D4  3  A5 rr                lda varh
0038D6  3  18                   clc
0038D7  3  69 01                adc #1
0038D9  3  85 rr                sta varh
0038DB  3  A9 01        k00214: lda #1
0038DD  3  C5 rr                cmp vari
0038DF  3  F0 03                beq *+5
0038E1  3  4C 2C 39             jmp k00386
0038E4  3  A9 0D                lda #13
0038E6  3  20 95 1D             jsr gotob
0038E9  3  C9 FF                cmp #255
0038EB  3  F0 03                beq :+
0038ED  3  4C 2C 39             jmp k00386
0038F0  3               :
0038F0  3  A0 08                ldy #8
0038F2  3  B1 rr                lda (z80_ix),y
0038F4  3  85 rr                sta vare
0038F6  3  A0 09                ldy #9
0038F8  3  B1 rr                lda (z80_ix),y
0038FA  3  85 rr                sta varf
0038FC  3  A9 08                lda #8
0038FE  3  A0 08                ldy #8
003900  3  91 rr                sta (z80_ix),y
003902  3  A9 18                lda #24
003904  3  A0 09                ldy #9
003906  3  91 rr                sta (z80_ix),y
003908  3  A0 09                ldy #9
00390A  3  B1 rr                lda (z80_ix),y
00390C  3  85 rr                sta dispx
00390E  3  A0 08                ldy #8
003910  3  B1 rr                lda (z80_ix),y
003912  3  85 rr                sta dispy
003914  3  A9 0D                lda #13
003916  3  20 C6 1D             jsr drpob
003919  3  A5 rr                lda vare
00391B  3  A0 08                ldy #8
00391D  3  91 rr                sta (z80_ix),y
00391F  3  A5 rr                lda varf
003921  3  A0 09                ldy #9
003923  3  91 rr                sta (z80_ix),y
003925  3  A5 rr                lda vari
003927  3  18                   clc
003928  3  69 01                adc #1
00392A  3  85 rr                sta vari
00392C  3  A9 1B        k00386: lda #27
00392E  3  C5 rr                cmp scno
003930  3  F0 03                beq *+5
003932  3  4C 64 39             jmp k00506
003935  3  A9 00                lda #0
003937  3  C5 rr                cmp varg
003939  3  F0 03                beq *+5
00393B  3  4C 64 39             jmp k00506
00393E  3                       ; COLOUR command
00393E  3  A9 02                lda #2
003940  3  85 rr                sta chary
003942  3  A9 03                lda #3
003944  3  85 rr                sta charx
003946  3  A9 0B                lda #11
003948  3  20 DB 23             jsr dmsg
00394B  3                       ; COLOUR command
00394B  3  A9 12                lda #18
00394D  3  85 rr                sta chary
00394F  3  A9 0C                lda #12
003951  3  85 rr                sta charx
003953  3  A9 14                lda #20
003955  3  20 DB 23             jsr dmsg
003958  3  A5 rr                lda varg
00395A  3  18                   clc
00395B  3  69 01                adc #1
00395D  3  85 rr                sta varg
00395F  3  A9 19                lda #25
003961  3  20 FF 0E             jsr delay
003964  3  A9 1B        k00506: lda #27
003966  3  C5 rr                cmp scno
003968  3  F0 03                beq *+5
00396A  3  4C 74 39             jmp k00536
00396D  3  20 75 0E             jsr prskey
003970  3  A9 01                lda #1
003972  3  85 rr                sta gamwon
003974  3  60           k00536: rts
003975  3               .out .sprintf("EVENT 10 SIZE = %d", (* - evnt10))
003975  3               
003975  3               evnt11:
003975  3  60                   rts
003976  3               .out .sprintf("EVENT 11 SIZE = %d", (* - evnt11))
003976  3               
003976  3               evnt12:
003976  3                       ; COLOUR command
003976  3  20 E5 1A             jsr cls
003979  3  A9 02                lda #2
00397B  3  85 rr                sta chary
00397D  3  A9 0A                lda #10
00397F  3  85 rr                sta charx
003981  3  A9 00                lda #0
003983  3  20 DB 23             jsr dmsg
003986  3  A9 01                lda #1
003988  3  85 rr                sta chary
00398A  3  A9 12                lda #18
00398C  3  20 DB 23             jsr dmsg
00398F  3                       ; COLOUR command
00398F  3  A9 04                lda #4
003991  3  85 rr                sta chary
003993  3  A9 00                lda #0
003995  3  85 rr                sta charx
003997  3  A9 0C                lda #12
003999  3  20 DB 23             jsr dmsg
00399C  3                       ; COLOUR command
00399C  3  A9 12                lda #18
00399E  3  85 rr                sta chary
0039A0  3  A9 00                lda #0
0039A2  3  85 rr                sta charx
0039A4  3  A9 0D                lda #13
0039A6  3  20 DB 23             jsr dmsg
0039A9  3                       ; COLOUR command
0039A9  3  A9 01                lda #1
0039AB  3  85 rr                sta chary
0039AD  3  A9 0F                lda #15
0039AF  3  85 rr                sta charx
0039B1  3  A9 0E                lda #14
0039B3  3  20 DB 23             jsr dmsg
0039B6  3  A9 08                lda #8
0039B8  3  85 rr                sta chary
0039BA  3  A9 02                lda #2
0039BC  3  85 rr                sta charx
0039BE  3  A9 0F                lda #15
0039C0  3  20 DB 23             jsr dmsg
0039C3  3                       ; COLOUR command
0039C3  3  A9 04                lda #4
0039C5  3  85 rr                sta chary
0039C7  3  A9 1D                lda #29
0039C9  3  85 rr                sta charx
0039CB  3  A9 10                lda #16
0039CD  3  20 DB 23             jsr dmsg
0039D0  3                       ; COLOUR command
0039D0  3  A9 06                lda #6
0039D2  3  85 rr                sta chary
0039D4  3  A9 08                lda #8
0039D6  3  85 rr                sta charx
0039D8  3  A9 0A                lda #10
0039DA  3  20 DB 23             jsr dmsg
0039DD  3  A9 0A                lda #10
0039DF  3  85 rr                sta chary
0039E1  3  A9 08                lda #8
0039E3  3  85 rr                sta charx
0039E5  3  A9 0A                lda #10
0039E7  3  20 DB 23             jsr dmsg
0039EA  3  A9 08                lda #8
0039EC  3  85 rr                sta chary
0039EE  3  A9 17                lda #23
0039F0  3  85 rr                sta charx
0039F2  3  A9 0A                lda #10
0039F4  3  20 DB 23             jsr dmsg
0039F7  3                       ; COLOUR command
0039F7  3  A9 09                lda #9
0039F9  3  85 rr                sta chary
0039FB  3  A9 17                lda #23
0039FD  3  85 rr                sta charx
0039FF  3  A9 0A                lda #10
003A01  3  20 DB 23             jsr dmsg
003A04  3                       ; COLOUR command
003A04  3  A9 04                lda #4
003A06  3  85 rr                sta chary
003A08  3  A9 14                lda #20
003A0A  3  85 rr                sta charx
003A0C  3  A9 08                lda #8
003A0E  3  20 DB 23             jsr dmsg
003A11  3                       ; COLOUR command
003A11  3  A9 0C                lda #12
003A13  3  85 rr                sta chary
003A15  3  A9 0A                lda #10
003A17  3  85 rr                sta charx
003A19  3  A9 08                lda #8
003A1B  3  20 DB 23             jsr dmsg
003A1E  3                       ; COLOUR command
003A1E  3  A9 0C                lda #12
003A20  3  85 rr                sta chary
003A22  3  A9 0C                lda #12
003A24  3  85 rr                sta charx
003A26  3  A9 08                lda #8
003A28  3  20 DB 23             jsr dmsg
003A2B  3                       ; COLOUR command
003A2B  3  A9 0C                lda #12
003A2D  3  85 rr                sta chary
003A2F  3  A9 0B                lda #11
003A31  3  85 rr                sta charx
003A33  3  A9 08                lda #8
003A35  3  20 DB 23             jsr dmsg
003A38  3                       ; COLOUR command
003A38  3  A9 15                lda #21
003A3A  3  85 rr                sta chary
003A3C  3  A9 11                lda #17
003A3E  3  20 DB 23             jsr dmsg
003A41  3               
003A41  3               rtcon:
003A41  3  20 16 0F             jsr vsync
003A44  3  A9 00                lda #0
003A46  3  85 rr                sta contrl
003A48  3  AD EB B8             lda keys + data_address - data_start+7
003A4B  3  20 D4 0E             jsr ktest
003A4E  3  90 18                bcc rtcon1
003A50  3  A9 01                lda #1
003A52  3  85 rr                sta contrl
003A54  3  AD EC B8             lda keys + data_address - data_start+8
003A57  3  20 D4 0E             jsr ktest
003A5A  3  90 0C                bcc rtcon1
003A5C  3  A9 02                lda #2
003A5E  3  85 rr                sta contrl
003A60  3  AD ED B8             lda keys + data_address - data_start+9
003A63  3  20 D4 0E             jsr ktest
003A66  3  B0 D9                bcs rtcon
003A68  3                       rtcon1:
003A68  3  60                   rts
003A69  3               .out .sprintf("EVENT 12 SIZE = %d", (* - evnt12))
003A69  3               
003A69  3               evnt13:
003A69  3                       ; BORDER command
003A69  3                       ; COLOUR command
003A69  3  20 E5 1A             jsr cls
003A6C  3                       ; SILENCE command
003A6C  3                       ; COLOUR command
003A6C  3  A9 14                lda #20
003A6E  3  85 rr                sta chary
003A70  3  A9 02                lda #2
003A72  3  85 rr                sta charx
003A74  3  A9 00                lda #0
003A76  3  20 DB 23             jsr dmsg
003A79  3                       ; COLOUR command
003A79  3  A9 00                lda #0
003A7B  3  85 rr                sta varc
003A7D  3  A9 00                lda #0
003A7F  3  85 rr                sta varg
003A81  3  A9 80                lda #128
003A83  3  85 rr                sta varo
003A85  3  A9 20                lda #32
003A87  3  85 rr                sta varp
003A89  3  A9 03                lda #3
003A8B  3  85 rr                sta numlif
003A8D  3  A9 00                lda #0
003A8F  3  85 rr                sta vark
003A91  3  A9 00                lda #0
003A93  3  85 rr                sta vare
003A95  3  A9 00                lda #0
003A97  3  85 rr                sta varf
003A99  3  A9 00                lda #0
003A9B  3  85 rr                sta chary
003A9D  3  A9 01                lda #1
003A9F  3  85 rr                sta charx
003AA1  3  A9 03                lda #3
003AA3  3  20 DB 23             jsr dmsg
003AA6  3  A9 15                lda #21
003AA8  3  85 rr                sta loopa
003AAA  3  A9 01        n00160: lda #1
003AAC  3  85 rr                sta charx
003AAE  3  A9 03                lda #3
003AB0  3  20 DB 23             jsr dmsg
003AB3  3  C6 rr                dec loopa
003AB5  3  F0 03                beq :+
003AB7  3  4C AA 3A             jmp n00160
003ABA  3               :
003ABA  3  A9 01                lda #1
003ABC  3  85 rr                sta charx
003ABE  3  A9 04                lda #4
003AC0  3  20 DB 23             jsr dmsg
003AC3  3  A9 00                lda #0
003AC5  3  85 rr                sta chary
003AC7  3  A9 1E                lda #30
003AC9  3  85 rr                sta charx
003ACB  3  A9 03                lda #3
003ACD  3  20 DB 23             jsr dmsg
003AD0  3  A9 15                lda #21
003AD2  3  85 rr                sta loopa
003AD4  3  A9 1E        n00239: lda #30
003AD6  3  85 rr                sta charx
003AD8  3  A9 03                lda #3
003ADA  3  20 DB 23             jsr dmsg
003ADD  3  C6 rr                dec loopa
003ADF  3  F0 03                beq :+
003AE1  3  4C D4 3A             jmp n00239
003AE4  3               :
003AE4  3  A9 16                lda #22
003AE6  3  85 rr                sta chary
003AE8  3  A9 02                lda #2
003AEA  3  85 rr                sta charx
003AEC  3  A9 05                lda #5
003AEE  3  20 DB 23             jsr dmsg
003AF1  3  A9 16                lda #22
003AF3  3  85 rr                sta chary
003AF5  3  A9 1E                lda #30
003AF7  3  85 rr                sta charx
003AF9  3  A9 06                lda #6
003AFB  3  20 DB 23             jsr dmsg
003AFE  3                       ; COLOUR command
003AFE  3  A9 15                lda #21
003B00  3  85 rr                sta chary
003B02  3  A9 16                lda #22
003B04  3  85 rr                sta charx
003B06  3  A9 01                lda #1
003B08  3  20 DB 23             jsr dmsg
003B0B  3  A9 15                lda #21
003B0D  3  85 rr                sta chary
003B0F  3  A9 1D                lda #29
003B11  3  85 rr                sta charx
003B13  3  A5 rr                lda numlif
003B15  3  20 29 28             jsr disply
003B18  3  A9 15                lda #21
003B1A  3  85 rr                sta chary
003B1C  3  A9 02                lda #2
003B1E  3  85 rr                sta charx
003B20  3  A9 07                lda #7
003B22  3  20 DB 23             jsr dmsg
003B25  3                       ; COLOUR command
003B25  3  A9 14                lda #20
003B27  3  85 rr                sta chary
003B29  3  A9 13                lda #19
003B2B  3  85 rr                sta charx
003B2D  3  A9 02                lda #2
003B2F  3  20 DB 23             jsr dmsg
003B32  3  A9 14                lda #20
003B34  3  85 rr                sta chary
003B36  3  A9 1D                lda #29
003B38  3  85 rr                sta charx
003B3A  3  A5 rr                lda vark
003B3C  3  20 29 28             jsr disply
003B3F  3  60                   rts
003B40  3               .out .sprintf("EVENT 13 SIZE = %d", (* - evnt13))
003B40  3               
003B40  3               evnt14:
003B40  3  60                   rts
003B41  3               .out .sprintf("EVENT 14 SIZE = %d", (* - evnt14))
003B41  3               
003B41  3               evnt15:
003B41  3  60                   rts
003B42  3               .out .sprintf("EVENT 15 SIZE = %d", (* - evnt15))
003B42  3               
003B42  3               evnt16:
003B42  3  A9 3C                lda #60
003B44  3  0A                   asl a
003B45  3  8D 32 0F             sta sndtyp
003B48  3  85 rr                sta z80_b
003B4A  3  20 FF 0E             jsr delay
003B4D  3  A5 rr                lda numlif
003B4F  3  38                   sec
003B50  3  E9 01                sbc #1
003B52  3  85 rr                sta numlif
003B54  3  A5 rr                lda varo
003B56  3  A0 08                ldy #8
003B58  3  91 rr                sta (z80_ix),y
003B5A  3  A5 rr                lda varp
003B5C  3  A0 09                ldy #9
003B5E  3  91 rr                sta (z80_ix),y
003B60  3                       ; COLOUR command
003B60  3  A9 4E                lda #78
003B62  3  A0 09                ldy #9
003B64  3  91 rr                sta (z80_ix),y
003B66  3  A9 15                lda #21
003B68  3  85 rr                sta chary
003B6A  3  A9 1D                lda #29
003B6C  3  85 rr                sta charx
003B6E  3  A5 rr                lda numlif
003B70  3  20 29 28             jsr disply
003B73  3  60                   rts
003B74  3               .out .sprintf("EVENT 16 SIZE = %d", (* - evnt16))
003B74  3               
003B74  3               evnt17:
003B74  3  A9 32                lda #50
003B76  3  20 FF 0E             jsr delay
003B79  3  20 E5 1A             jsr cls
003B7C  3                       ; COLOUR command
003B7C  3  A9 0A                lda #10
003B7E  3  85 rr                sta chary
003B80  3  A9 0A                lda #10
003B82  3  85 rr                sta charx
003B84  3  A9 00                lda #0
003B86  3  20 DB 23             jsr dmsg
003B89  3  A9 09                lda #9
003B8B  3  85 rr                sta chary
003B8D  3  A9 12                lda #18
003B8F  3  20 DB 23             jsr dmsg
003B92  3                       ; COLOUR command
003B92  3  A9 0C                lda #12
003B94  3  85 rr                sta chary
003B96  3  A9 0C                lda #12
003B98  3  85 rr                sta charx
003B9A  3  A9 15                lda #21
003B9C  3  20 DB 23             jsr dmsg
003B9F  3                       ; COLOUR command
003B9F  3  A9 0E                lda #14
003BA1  3  85 rr                sta chary
003BA3  3  A9 0F                lda #15
003BA5  3  85 rr                sta charx
003BA7  3  A9 0E                lda #14
003BA9  3  20 DB 23             jsr dmsg
003BAC  3  A9 C8                lda #200
003BAE  3  20 FF 0E             jsr delay
003BB1  3  60                   rts
003BB2  3               .out .sprintf("EVENT 17 SIZE = %d", (* - evnt17))
003BB2  3               
003BB2  3               evnt18:
003BB2  3                       ; COLOUR command
003BB2  3  20 E5 1A             jsr cls
003BB5  3  A9 32                lda #50
003BB7  3  20 FF 0E             jsr delay
003BBA  3  A9 01                lda #1
003BBC  3  85 rr                sta chary
003BBE  3  A9 00                lda #0
003BC0  3  85 rr                sta charx
003BC2  3  A9 13                lda #19
003BC4  3  20 DB 23             jsr dmsg
003BC7  3                       ; COLOUR command
003BC7  3  A9 15                lda #21
003BC9  3  85 rr                sta chary
003BCB  3  A9 0B                lda #11
003BCD  3  85 rr                sta charx
003BCF  3  A9 14                lda #20
003BD1  3  20 DB 23             jsr dmsg
003BD4  3  20 75 0E             jsr prskey
003BD7  3  60                   rts
003BD8  3               .out .sprintf("EVENT 18 SIZE = %d", (* - evnt18))
003BD8  3               
003BD8  3               evnt19:
003BD8  3  60                   rts
003BD9  3               .out .sprintf("EVENT 19 SIZE = %d", (* - evnt19))
003BD9  3               
003BD9  3               evnt20:
003BD9  3  60                   rts
003BDA  3               .out .sprintf("EVENT 20 SIZE = %d", (* - evnt20))
003BDA  3               
003BDA  3  60           ptcusr: rts
003BDB  3               script_end:
003BDB  3               
003BDB  3               .out .sprintf("TOTAL SCRIPT SIZE = %d", (* - script_start))
003BDB  3               
003BDB  3               data_start:
003BDB  3               msgdat:
003BDB  3  46 4F 47 47          .byte "FOGGYS;QUEST",138
003BDF  3  59 53 3B 51  
003BE3  3  55 45 53 54  
003BE8  3  4C 49 56 45          .byte "LIVES:",138
003BEC  3  53 3A 8A     
003BEF  3  43 52 59 53          .byte "CRYSTALS:",138
003BF3  3  54 41 4C 53  
003BF7  3  3A 8A        
003BF9  3  40 8A                .byte "@",138
003BFB  3  60 8A                .byte "`",138
003BFD  3  5F 5F 5F 5F          .byte "____________________________",138
003C01  3  5F 5F 5F 5F  
003C05  3  5F 5F 5F 5F  
003C1A  3  24 8A                .byte "$",138
003C1C  3  42 59 3A 3B          .byte "BY:;J.BLYTHE",138
003C20  3  4A 2E 42 4C  
003C24  3  59 54 48 45  
003C29  3  78 8A                .byte "x",138
003C2B  3  3B 4B 45 59          .byte ";KEY;BLUE;;",13
003C2F  3  3B 42 4C 55  
003C33  3  45 3B 3B 0D  
003C37  3  43 52 59 53          .byte "CRYSTAL;BLU",13
003C3B  3  54 41 4C 3B  
003C3F  3  42 4C 55 0D  
003C43  3  43 52 59 53          .byte "CRYSTAL;RED",13
003C47  3  54 41 4C 3B  
003C4B  3  52 45 44 0D  
003C4F  3  43 52 59 53          .byte "CRYSTAL;GRN",13
003C53  3  54 41 4C 3B  
003C57  3  47 52 4E 0D  
003C5B  3  3B 3B 4B 45          .byte ";;KEY;RED;;",13
003C5F  3  59 3B 52 45  
003C63  3  44 3B 3B 0D  
003C67  3  3B 4B 45 59          .byte ";KEY;PINK;;",13
003C6B  3  3B 50 49 4E  
003C6F  3  4B 3B 3B 0D  
003C73  3  3B 3B 4C 41          .byte ";;LADDER;;;",13
003C77  3  44 44 45 52  
003C7B  3  3B 3B 3B 0D  
003C7F  3  3B 3B 3B 42          .byte ";;;BOMB;;;;",13
003C83  3  4F 4D 42 3B  
003C87  3  3B 3B 3B 0D  
003C8B  3  3B 54 48 45          .byte ";THE;CUBE;;",13
003C8F  3  3B 43 55 42  
003C93  3  45 3B 3B 0D  
003C97  3  3B 54 48 45          .byte ";THE;SKULL;",13
003C9B  3  3B 53 4B 55  
003C9F  3  4C 4C 3B 0D  
003CA3  3  3B 50 49 54          .byte ";PIT;PLANT;",13
003CA7  3  3B 50 4C 41  
003CAB  3  4E 54 3B 0D  
003CAF  3  3B 3B 3B 52          .byte ";;;ROCK;;;;",13
003CB3  3  4F 43 4B 3B  
003CB7  3  3B 3B 3B 0D  
003CBB  3  45 58 54 52          .byte "EXTRA;LIFE;",13
003CBF  3  41 3B 4C 49  
003CC3  3  46 45 3B 0D  
003CC7  3  45 58 54 52          .byte "EXTRA;LIFE;",13
003CCB  3  41 3B 4C 49  
003CCF  3  46 45 3B 0D  
003CD3  3  3B 3B 41 3B          .byte ";;A;SEED;;;",13
003CD7  3  53 45 45 44  
003CDB  3  3B 3B 3B 0D  
003CDF  3  3B 3B 42 41          .byte ";;BALLOON;;",13
003CE3  3  4C 4C 4F 4F  
003CE7  3  4E 3B 3B 0D  
003CEB  3  3B 50 49 43          .byte ";PICK;AXE;;",13
003CEF  3  4B 3B 41 58  
003CF3  3  45 3B 3B 0D  
003CF7  3  3B 3B 42 52          .byte ";;BRICKS;;;",13
003CFB  3  49 43 4B 53  
003CFF  3  3B 3B 3B 0D  
003D03  3  3B 49 43 45          .byte ";ICE;DRILL;",13
003D07  3  3B 44 52 49  
003D0B  3  4C 4C 3B 0D  
003D0F  3  3B 3B 53 50          .byte ";;SPLICER;;",138
003D13  3  4C 49 43 45  
003D17  3  52 3B 3B 8A  
003D1B  3  7A 8A                .byte "z",138
003D1D  3  57 45 4C 4C          .byte "WELL;DONE;FOGGY!!",138
003D21  3  3B 44 4F 4E  
003D25  3  45 3B 46 4F  
003D2F  3  3B 3B 3B 3B          .byte ";;;;;;;;w___________x__y;;;.",13
003D33  3  3B 3B 3B 3B  
003D37  3  77 5F 5F 5F  
003D4C  3  3B 2E 3B 3B          .byte ";.;;;;;;@;;;;;;;;;;;;;;@",13
003D50  3  3B 3B 3B 3B  
003D54  3  40 3B 3B 3B  
003D65  3  3B 3B 3B 3B          .byte ";;;;;;;;z;;;CONTROLS;;;@;.",13
003D69  3  3B 3B 3B 3B  
003D6D  3  7A 3B 3B 3B  
003D80  3  3B 3B 3B 3B          .byte ";;;;;.;;@;;;;;;;;;;;;;;@;;;;;;.",13
003D84  3  3B 2E 3B 3B  
003D88  3  40 3B 3B 3B  
003DA0  3  3B 3B 3B 3B          .byte ";;;;.;;;@;;1;KEYBOARD;;z",13
003DA4  3  2E 3B 3B 3B  
003DA8  3  40 3B 3B 31  
003DB9  3  3B 3B 3B 3B          .byte ";;;;;;;;@;;2;KEMPSTON;;@",13
003DBD  3  3B 3B 3B 3B  
003DC1  3  40 3B 3B 32  
003DD2  3  3B 3B 3B 3B          .byte ";;;;;;;;z;;3;SINCLAIR;;@;;;;.",13
003DD6  3  3B 3B 3B 3B  
003DDA  3  7A 3B 3B 33  
003DF0  3  3B 3B 3B 3B          .byte ";;;;;;.;@;;;;;;;;;;;;;;@;;;;;.",13
003DF4  3  3B 3B 2E 3B  
003DF8  3  40 3B 3B 3B  
003E0F  3  3B 3B 2E 3B          .byte ";;.;;;;;`_xx___________$;;.",13
003E13  3  3B 3B 3B 3B  
003E17  3  60 5F 78 78  
003E2B  3  0D                   .byte 13
003E2C  3  3B 3B 3B 3B          .byte ";;;;;;;;;;KEYS:O,P,Q,A",13
003E30  3  3B 3B 3B 3B  
003E34  3  3B 3B 4B 45  
003E43  3  3B 3B 3B 3B          .byte ";;;;;;;;;;;;;;;I-INV.",13
003E47  3  3B 3B 3B 3B  
003E4B  3  3B 3B 3B 3B  
003E59  3  3B 3B 3B 3B          .byte ";;;;;;;;;;;;;;;SPC-JUMP",138
003E5D  3  3B 3B 3B 3B  
003E61  3  3B 3B 3B 3B  
003E71  3  3B 3B 3B 3B          .byte ";;;;;;;;;RUCKSACK;GAMES",13
003E75  3  3B 3B 3B 3B  
003E79  3  3B 52 55 43  
003E89  3  3B 3B 3B 3B          .byte ";;;;;;;c;2017;JOHN;BLYTHE",138
003E8D  3  3B 3B 3B 63  
003E91  3  3B 32 30 31  
003EA3  3  2F 2B 8A             .byte "/+",138
003EA6  3  3E 8A                .byte ">",138
003EA8  3  3F 8A                .byte "?",138
003EAA  3  3B 3B 3B 3B          .byte ";;;;;;;;;POWERED;BY;AGD",138
003EAE  3  3B 3B 3B 3B  
003EB2  3  3B 50 4F 57  
003EC2  3  3B 3B 3B 3B          .byte ";;;;;;;;;;v",13
003EC6  3  3B 3B 3B 3B  
003ECA  3  3B 3B 76 0D  
003ECE  3  3B 3B 3B 3B          .byte ";;;;;;;;;;u",138
003ED2  3  3B 3B 3B 3B  
003ED6  3  3B 3B 75 8A  
003EDA  3  3B 3B 3B 48          .byte ";;;HOME;AT;LAST.;FOGGY;TAKES;A",13
003EDE  3  4F 4D 45 3B  
003EE2  3  41 54 3B 4C  
003EF9  3  3B 0D                .byte ";",13
003EFB  3  3B 57 45 4C          .byte ";WELL;EARNED;REST;FROM;HOLIDAYS.",13
003EFF  3  4C 3B 45 41  
003F03  3  52 4E 45 44  
003F1C  3  3B 0D                .byte ";",13
003F1E  3  3B 3B 3B 3B          .byte ";;;;TIME;FOR;BIT;OF;TREASURE",13
003F22  3  54 49 4D 45  
003F26  3  3B 46 4F 52  
003F3B  3  3B 0D                .byte ";",13
003F3D  3  3B 3B 3B 3B          .byte ";;;;;;;;HUNTING;INSTEAD!!!",13
003F41  3  3B 3B 3B 3B  
003F45  3  48 55 4E 54  
003F58  3  3B 0D                .byte ";",13
003F5A  3  3B 0D                .byte ";",13
003F5C  3  3B 3B 3B 3B          .byte ";;;;;;;THANKS;FOR;PLAYING!",13
003F60  3  3B 3B 3B 54  
003F64  3  48 41 4E 4B  
003F77  3  3B 0D                .byte ";",13
003F79  3  3B 43 52 45          .byte ";CREDITS..",13
003F7D  3  44 49 54 53  
003F81  3  2E 2E 0D     
003F84  3  3B 0D                .byte ";",13
003F86  3  3B 43 4F 44          .byte ";CODING;AND;GFX;-;JOHN;BLYTHE",13
003F8A  3  49 4E 47 3B  
003F8E  3  41 4E 44 3B  
003FA4  3  3B 41 44 44          .byte ";ADDITIONAL;CODE;-;ANDY;JOHNS",13
003FA8  3  49 54 49 4F  
003FAC  3  4E 41 4C 3B  
003FC2  3  3B 0D                .byte ";",13
003FC4  3  3B 4D 41 4E          .byte ";MANY;THANKS;TO..",13
003FC8  3  59 3B 54 48  
003FCC  3  41 4E 4B 53  
003FD6  3  3B 4A 4F 4E          .byte ";JONATHAN CAULDWELL;FOR;AGD",138
003FDA  3  41 54 48 41  
003FDE  3  4E 20 43 41  
003FF2  3  50 52 45 53          .byte "PRESS;A;KEY",138
003FF6  3  53 3B 41 3B  
003FFA  3  4B 45 59 8A  
003FFE  3  49 53 3B 4F          .byte "IS;OVER..",138
004002  3  56 45 52 2E  
004006  3  2E 8A        
004008  3               nummsg:
004008  3  16                   .byte 22
004009  3               .out .sprintf("MESSAGE SIZE = %d", (* - msgdat))
004009  3               
004009  3               chgfx:
004009  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
00400D  3  00 00 00 00  
004011  3  00 00 00 00  
004019  3  0F 4F 2F 8F          .byte 15,79,47,143,79,31,143,15,31,79,143,175,95,79,47,15
00401D  3  4F 1F 8F 0F  
004021  3  1F 4F 8F AF  
004029  3  4F 6D 0F 6B          .byte 79,109,15,107,109,109,107,30,15,15,62,62,181,61,62,15
00402D  3  6D 6D 6B 1E  
004031  3  0F 0F 3E 3E  
004039  3  0F 0F 0F 8F          .byte 15,15,15,143,79,31,15,15,31,15,15,15,15,15,47,15
00403D  3  4F 1F 0F 0F  
004041  3  1F 0F 0F 0F  
004049  3  7D E5 8F 1E          .byte 125,229,143,30,135,215,143,218,135,31,175,30,135,31,122,235
00404D  3  87 D7 8F DA  
004051  3  87 1F AF 1E  
004059  3  F5 F5 F2 FA          .byte 245,245,242,250,241,245,240,250,240,245,240,242,240,241,240,240
00405D  3  F1 F5 F0 FA  
004061  3  F0 F5 F0 F2  
004069  3  FF FF 7F EF          .byte 255,255,127,239,191,223,95,175,175,95,79,47,143,31,15,15
00406D  3  BF DF 5F AF  
004071  3  AF 5F 4F 2F  
004079  3  DA DA AF B6          .byte 218,218,175,182,222,248,175,242,223,240,190,250,253,244,250,250
00407D  3  DE F8 AF F2  
004081  3  DF F0 BE FA  
004089  3  F5 F5 F2 EB          .byte 245,245,242,235,241,215,240,175,240,95,225,167,210,91,165,165
00408D  3  F1 D7 F0 AF  
004091  3  F0 5F E1 A7  
004099  3  0E 0F 0E 0F          .byte 14,15,14,15,10,10,4,5,10,10,0,0,14,15,0,0
00409D  3  0A 0A 04 05  
0040A1  3  0A 0A 00 00  
0040A9  3  0F 08 0F 0E          .byte 15,8,15,14,10,14,5,7,10,11,1,7,8,11,5,7
0040AD  3  0A 0E 05 07  
0040B1  3  0A 0B 01 07  
0040B9  3  04 0B 05 07          .byte 4,11,5,7,4,11,5,7,0,0,5,7,4,11,5,7
0040BD  3  04 0B 05 07  
0040C1  3  00 00 05 07  
0040C9  3  04 0B 05 07          .byte 4,11,5,7,4,10,4,5,2,2,3,0,0,15,0,0
0040CD  3  04 0A 04 05  
0040D1  3  02 02 03 00  
0040D9  3  7D E5 FA FA          .byte 125,229,250,250,165,165,90,90,15,61,190,190,61,135,75,47
0040DD  3  A5 A5 5A 5A  
0040E1  3  0F 3D BE BE  
0040E9  3  1B 57 AB 27          .byte 27,87,171,39,0,0,175,136,95,0,0,0,76,0,136,0
0040ED  3  00 00 AF 88  
0040F1  3  5F 00 00 00  
0040F9  3  5D 57 8D 27          .byte 93,87,141,39,0,0,1,141,0,93,0,0,0,19,0,1
0040FD  3  00 00 01 8D  
004101  3  00 5D 00 00  
004109  3  00 C8 01 81          .byte 0,200,1,129,16,202,4,132,18,136,1,132,0,202,1,128
00410D  3  10 CA 04 84  
004111  3  12 88 01 84  
004119  3  00 C8 05 80          .byte 0,200,5,128,18,0,34,38,64,136,4,4,2,64,1,128
00411D  3  12 00 22 26  
004121  3  40 88 04 04  
004129  3  0E 0F 0E 0F          .byte 14,15,14,15,10,10,4,5,10,10,0,0,14,15,0,0
00412D  3  0A 0A 04 05  
004131  3  0A 0A 00 00  
004139  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
00413D  3  00 00 00 00  
004141  3  00 00 00 00  
004149  3  F1 F5 F0 F0          .byte 241,245,240,240,244,240,240,242,240,240,240,240,240,240,250,250
00414D  3  F4 F0 F0 F2  
004151  3  F0 F0 F0 F0  
004159  3  66 00 66 00          .byte 102,0,102,0,102,0,255,255,170,170,0,0,68,0,102,0
00415D  3  66 00 FF FF  
004161  3  AA AA 00 00  
004169  3  00 66 00 66          .byte 0,102,0,102,0,102,255,255,170,170,0,0,0,68,0,102
00416D  3  00 66 FF FF  
004171  3  AA AA 00 00  
004179  3  08 04 02 09          .byte 8,4,2,9,1,0,5,10,2,0,9,4,0,1,2,8
00417D  3  01 00 05 0A  
004181  3  02 00 09 04  
004189  3  44 FF 99 FF          .byte 68,255,153,255,0,0,68,255,0,0,153,255,153,85,68,255
00418D  3  00 00 44 FF  
004191  3  00 00 99 FF  
004199  3  FF AA FF DD          .byte 255,170,255,221,0,0,255,170,0,0,255,221,85,85,255,170
00419D  3  00 00 FF AA  
0041A1  3  00 00 FF DD  
0041A9  3  F5 F4 F8 F0          .byte 245,244,248,240,240,245,248,248,240,241,250,240,240,241,242,250
0041AD  3  F0 F5 F8 F8  
0041B1  3  F0 F1 FA F0  
0041B9  3  7D F4 AD B4          .byte 125,244,173,180,210,215,173,248,210,91,175,180,210,91,242,235
0041BD  3  D2 D7 AD F8  
0041C1  3  D2 5B AF B4  
0041C9  3  0F 0F 8F 2F          .byte 15,15,143,47,15,15,175,47,15,15,47,175,15,15,47,175
0041CD  3  0F 0F AF 2F  
0041D1  3  0F 0F 2F AF  
0041D9  3  F0 F0 F8 F2          .byte 240,240,248,242,240,240,250,242,240,240,242,250,240,240,242,250
0041DD  3  F0 F0 FA F2  
0041E1  3  F0 F0 F2 FA  
0041E9  3  F0 D2 AD A7          .byte 240,210,173,167,120,240,175,167,210,210,167,175,240,120,167,175
0041ED  3  78 F0 AF A7  
0041F1  3  D2 D2 A7 AF  
0041F9  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,64,32,16,0,32,64,240,240
0041FD  3  00 00 00 00  
004201  3  40 20 10 00  
004209  3  DD BB FF FF          .byte 221,187,255,255,85,85,170,170,255,255,0,0,17,238,0,204
00420D  3  55 55 AA AA  
004211  3  FF FF 00 00  
004219  3  66 DD FF FF          .byte 102,221,255,255,85,85,170,170,255,255,0,0,119,136,51,0
00421D  3  55 55 AA AA  
004221  3  FF FF 00 00  
004229  3  13 5F 04 00          .byte 19,95,4,0,27,68,170,0,8,0,136,5,95,95,0,0
00422D  3  1B 44 AA 00  
004231  3  08 00 88 05  
004239  3  0F 0C 00 02          .byte 15,12,0,2,0,1,0,5,0,13,10,1,15,15,0,0
00423D  3  00 01 00 05  
004241  3  00 0D 0A 01  
004249  3  FF 00 FF CC          .byte 255,0,255,204,85,119,170,204,255,0,34,204,0,85,0,238
00424D  3  55 77 AA CC  
004251  3  FF 00 22 CC  
004259  3  00 DD 33 FF          .byte 0,221,51,255,255,85,51,170,0,255,17,170,170,0,119,0
00425D  3  FF 55 33 AA  
004261  3  00 FF 11 AA  
004269  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
00426D  3  00 00 00 00  
004271  3  00 00 00 00  
004279  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
00427D  3  00 00 00 00  
004281  3  00 00 00 00  
004289  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
00428D  3  00 00 00 00  
004291  3  00 00 00 00  
004299  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
00429D  3  00 00 00 00  
0042A1  3  00 00 00 00  
0042A9  3  F5 E4 72 C8          .byte 245,228,114,200,177,128,80,0,160,0,64,0,128,0,0,0
0042AD  3  B1 80 50 00  
0042B1  3  A0 00 40 00  
0042B9  3  75 F5 32 EA          .byte 117,245,50,234,17,213,0,170,0,85,0,34,0,17,0,0
0042BD  3  11 D5 00 AA  
0042C1  3  00 55 00 22  
0042C9  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0042CD  3  00 00 00 00  
0042D1  3  00 00 00 00  
0042D9  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0
0042DD  3  00 00 00 00  
0042E1  3  02 00 00 00  
0042E9  3  00 00 00 00          .byte 0,0,0,0,0,0,0,136,0,0,0,0,0,0,0,0
0042ED  3  00 00 00 88  
0042F1  3  00 00 00 00  
0042F9  3  F0 F0 F0 F0          .byte 240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240
0042FD  3  F0 F0 F0 F0  
004301  3  F0 F0 F0 F0  
004309  3  F0 F0 F0 F0          .byte 240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240
00430D  3  F0 F0 F0 F0  
004311  3  F0 F0 F0 F0  
004319  3  80 00 40 00          .byte 128,0,64,0,160,0,208,0,224,128,240,64,240,160,240,208
00431D  3  A0 00 D0 00  
004321  3  E0 80 F0 40  
004329  3  F0 70 F0 F0          .byte 240,112,240,240,240,112,0,0,112,240,240,240,112,240,240,240
00432D  3  F0 70 00 00  
004331  3  70 F0 F0 F0  
004339  3  00 10 00 20          .byte 0,16,0,32,0,80,0,176,16,112,32,240,80,240,176,240
00433D  3  00 50 00 B0  
004341  3  10 70 20 F0  
004349  3  00 00 60 A0          .byte 0,0,96,160,64,0,0,0,64,0,0,0,64,32,0,0
00434D  3  40 00 00 00  
004351  3  40 00 00 00  
004359  3  11 80 10 88          .byte 17,128,16,136,32,68,34,64,100,100,114,234,228,117,250,250
00435D  3  20 44 22 40  
004361  3  64 64 72 EA  
004369  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
00436D  3  00 00 00 00  
004371  3  00 00 00 00  
004379  3  12 42 26 A7          .byte 18,66,38,167,216,216,133,133,82,138,35,34,0,16,0,0
00437D  3  D8 D8 85 85  
004381  3  52 8A 23 22  
004389  3  70 C0 D0 60          .byte 112,192,208,96,176,240,240,240,224,176,208,80,160,160,112,192
00438D  3  B0 F0 F0 F0  
004391  3  E0 B0 D0 50  
004399  3  33 88 FF EE          .byte 51,136,255,238,255,255,221,221,255,51,119,255,153,221,102,34
00439D  3  FF FF DD DD  
0043A1  3  FF 33 77 FF  
0043A9  3  00 00 77 00          .byte 0,0,119,0,238,204,221,238,255,238,255,187,221,255,51,238
0043AD  3  EE CC DD EE  
0043B1  3  FF EE FF BB  
0043B9  3  00 00 00 FF          .byte 0,0,0,255,51,255,102,255,255,238,255,153,238,255,119,0
0043BD  3  33 FF 66 FF  
0043C1  3  FF EE FF 99  
0043C9  3  30 C0 40 E0          .byte 48,192,64,224,176,240,240,240,240,80,96,160,48,64,16,128
0043CD  3  B0 F0 F0 F0  
0043D1  3  F0 50 60 A0  
0043D9  3  00 88 00 80          .byte 0,136,0,128,0,64,0,128,16,0,34,0,16,0,0,128
0043DD  3  00 40 00 80  
0043E1  3  10 00 22 00  
0043E9  3  F5 F5 FA FA          .byte 245,245,250,250,245,245,250,250,245,245,250,250,245,245,250,250
0043ED  3  F5 F5 FA FA  
0043F1  3  F5 F5 FA FA  
0043F9  3  55 55 AA BA          .byte 85,85,170,186,85,117,170,250,85,245,186,250,117,245,250,250
0043FD  3  55 75 AA FA  
004401  3  55 F5 BA FA  
004409  3  00 11 00 22          .byte 0,17,0,34,0,85,0,170,17,85,34,170,85,85,170,170
00440D  3  00 55 00 AA  
004411  3  11 55 22 AA  
004419  3  30 D0 60 80          .byte 48,208,96,128,208,0,160,128,208,0,128,0,192,0,128,0
00441D  3  D0 00 A0 80  
004421  3  D0 00 80 00  
004429  3  B0 C0 10 60          .byte 176,192,16,96,0,176,16,80,0,176,0,16,0,48,0,16
00442D  3  00 B0 10 50  
004431  3  00 B0 00 10  
004439  3  F0 F0 70 50          .byte 240,240,112,80,160,160,16,0,64,32,0,0,0,0,0,0
00443D  3  A0 A0 10 00  
004441  3  40 20 00 00  
004449  3  F5 F5 FA FA          .byte 245,245,250,250,245,245,250,250,245,245,250,250,245,245,250,250
00444D  3  F5 F5 FA FA  
004451  3  F5 F5 FA FA  
004459  3  08 1B 8C 05          .byte 8,27,140,5,78,19,175,1,27,25,141,141,10,95,137,39
00445D  3  4E 13 AF 01  
004461  3  1B 19 8D 8D  
004469  3  FF FF FF AA          .byte 255,255,255,170,221,34,85,34,68,0,68,0,0,0,0,0
00446D  3  DD 22 55 22  
004471  3  44 00 44 00  
004479  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,68,204,255,255
00447D  3  00 00 00 00  
004481  3  00 00 00 00  
004489  3  50 0A A0 05          .byte 80,10,160,5,88,26,36,36,26,88,36,36,18,72,5,160
00448D  3  58 1A 24 24  
004491  3  1A 58 24 24  
004499  3  40 C8 A7 26          .byte 64,200,167,38,218,154,163,163,80,218,4,38,136,0,0,0
00449D  3  DA 9A A3 A3  
0044A1  3  50 DA 04 26  
0044A9  3  00 CA 01 27          .byte 0,202,1,39,2,216,34,132,2,200,5,128,202,0,0,0
0044AD  3  02 D8 22 84  
0044B1  3  02 C8 05 80  
0044B9  3  60 60 50 B0          .byte 96,96,80,176,160,64,80,160,208,176,16,144,96,64,144,160
0044BD  3  A0 40 50 A0  
0044C1  3  D0 B0 10 90  
0044C9  3  00 10 80 23          .byte 0,16,128,35,66,82,5,162,2,66,1,132,0,0,0,0
0044CD  3  42 52 05 A2  
0044D1  3  02 42 01 84  
0044D9  3  FB F0 FB F0          .byte 251,240,251,240,251,240,251,240,251,240,251,240,251,240,251,240
0044DD  3  FB F0 FB F0  
0044E1  3  FB F0 FB F0  
0044E9  3  F0 20 E0 A0          .byte 240,32,224,160,240,32,224,160,240,32,224,160,240,32,224,160
0044ED  3  F0 20 E0 A0  
0044F1  3  F0 20 E0 A0  
0044F9  3               bprop:
0044F9  3  00                   .byte 0
0044FA  3  02                   .byte 2
0044FB  3  02                   .byte 2
0044FC  3  02                   .byte 2
0044FD  3  02                   .byte 2
0044FE  3  02                   .byte 2
0044FF  3  02                   .byte 2
004500  3  02                   .byte 2
004501  3  02                   .byte 2
004502  3  00                   .byte 0
004503  3  00                   .byte 0
004504  3  00                   .byte 0
004505  3  00                   .byte 0
004506  3  02                   .byte 2
004507  3  00                   .byte 0
004508  3  00                   .byte 0
004509  3  00                   .byte 0
00450A  3  00                   .byte 0
00450B  3  00                   .byte 0
00450C  3  00                   .byte 0
00450D  3  05                   .byte 5
00450E  3  03                   .byte 3
00450F  3  03                   .byte 3
004510  3  02                   .byte 2
004511  3  02                   .byte 2
004512  3  02                   .byte 2
004513  3  02                   .byte 2
004514  3  02                   .byte 2
004515  3  02                   .byte 2
004516  3  02                   .byte 2
004517  3  02                   .byte 2
004518  3  00                   .byte 0
004519  3  02                   .byte 2
00451A  3  02                   .byte 2
00451B  3  02                   .byte 2
00451C  3  02                   .byte 2
00451D  3  02                   .byte 2
00451E  3  02                   .byte 2
00451F  3  00                   .byte 0
004520  3  00                   .byte 0
004521  3  00                   .byte 0
004522  3  00                   .byte 0
004523  3  00                   .byte 0
004524  3  00                   .byte 0
004525  3  02                   .byte 2
004526  3  00                   .byte 0
004527  3  00                   .byte 0
004528  3  00                   .byte 0
004529  3  02                   .byte 2
00452A  3  00                   .byte 0
00452B  3  02                   .byte 2
00452C  3  00                   .byte 0
00452D  3  03                   .byte 3
00452E  3  00                   .byte 0
00452F  3  00                   .byte 0
004530  3  01                   .byte 1
004531  3  02                   .byte 2
004532  3  01                   .byte 1
004533  3  01                   .byte 1
004534  3  01                   .byte 1
004535  3  02                   .byte 2
004536  3  00                   .byte 0
004537  3  00                   .byte 0
004538  3  00                   .byte 0
004539  3  00                   .byte 0
00453A  3  02                   .byte 2
00453B  3  02                   .byte 2
00453C  3  02                   .byte 2
00453D  3  02                   .byte 2
00453E  3  02                   .byte 2
00453F  3  00                   .byte 0
004540  3  00                   .byte 0
004541  3  01                   .byte 1
004542  3  01                   .byte 1
004543  3  00                   .byte 0
004544  3  00                   .byte 0
004545  3  00                   .byte 0
004546  3  00                   .byte 0
004547  3  00                   .byte 0
004548  3               .out .sprintf("BLOCKS SIZE = %d", (* - chgfx))
004548  3               
004548  3               sprgfx:
004548  3  00 00 0C 00          .byte 0,0,12,0,23,0,7,192,15,224,30,112,61,168,61,36,125,36,126,32,255,252,198,252,187,4,125,250,125,247,60,15
00454C  3  17 00 07 C0  
004550  3  0F E0 1E 70  
004568  3  00 00 1E 00          .byte 0,0,30,0,7,128,7,192,15,224,31,48,62,212,62,144,126,144,127,16,241,252,238,252,95,4,31,120,15,116,0,12
00456C  3  07 80 07 C0  
004570  3  0F E0 1F 30  
004588  3  10 00 0E 00          .byte 16,0,14,0,7,128,7,192,15,224,31,144,63,104,63,72,127,72,127,136,255,252,252,124,123,132,55,216,7,208,27,192
00458C  3  07 80 07 C0  
004590  3  0F E0 1F 90  
0045A8  3  00 00 1E 00          .byte 0,0,30,0,7,128,7,192,15,224,31,48,62,212,62,144,126,144,127,16,255,252,241,252,110,4,95,120,31,116,15,12
0045AC  3  07 80 07 C0  
0045B0  3  0F E0 1F 30  
0045C8  3  00 00 00 30          .byte 0,0,0,48,0,232,3,224,7,240,14,120,21,188,36,188,36,190,4,126,63,255,63,99,32,221,95,190,239,190,240,60
0045CC  3  00 E8 03 E0  
0045D0  3  07 F0 0E 78  
0045E8  3  00 00 00 78          .byte 0,0,0,120,1,224,3,224,7,240,12,248,43,124,9,124,9,126,8,254,63,143,63,119,32,250,30,248,46,240,48,0
0045EC  3  01 E0 03 E0  
0045F0  3  07 F0 0C F8  
004608  3  00 08 00 70          .byte 0,8,0,112,1,224,3,224,7,240,9,248,22,252,18,252,18,254,17,254,63,255,62,63,33,222,27,236,11,224,3,216
00460C  3  01 E0 03 E0  
004610  3  07 F0 09 F8  
004628  3  00 00 00 78          .byte 0,0,0,120,1,224,3,224,7,240,12,248,43,124,9,124,9,126,8,254,63,255,63,143,32,118,30,250,46,248,48,240
00462C  3  01 E0 03 E0  
004630  3  07 F0 0C F8  
004648  3  03 C0 05 A0          .byte 3,192,5,160,14,112,14,240,31,248,31,248,63,252,63,252,63,252,127,254,127,235,23,87,106,173,245,91,247,224,240,0
00464C  3  0E 70 0E F0  
004650  3  1F F8 1F F8  
004668  3  03 C0 05 A0          .byte 3,192,5,160,13,112,12,240,31,248,31,248,63,252,63,252,63,252,127,254,111,238,151,215,234,173,245,91,103,231,0,0
00466C  3  0D 70 0C F0  
004670  3  1F F8 1F F8  
004688  3  03 C0 05 A0          .byte 3,192,5,160,14,112,14,240,31,248,31,248,63,252,63,252,63,252,127,254,239,254,213,216,170,166,213,79,7,239,0,15
00468C  3  0E 70 0E F0  
004690  3  1F F8 1F F8  
0046A8  3  03 C0 05 A0          .byte 3,192,5,160,14,176,15,48,31,248,31,248,63,252,63,252,63,252,127,254,111,238,151,215,234,173,245,91,103,231,0,0
0046AC  3  0E B0 0F 30  
0046B0  3  1F F8 1F F8  
0046C8  3  66 66 FF FF          .byte 102,102,255,255,128,1,179,205,189,189,191,253,183,237,179,205,179,205,179,205,191,253,191,253,166,101,128,1,255,255,102,102
0046CC  3  80 01 B3 CD  
0046D0  3  BD BD BF FD  
0046E8  3  66 66 FF FF          .byte 102,102,255,255,128,1,191,253,179,205,189,189,191,253,183,237,179,205,179,205,191,253,166,101,160,5,128,1,255,255,102,102
0046EC  3  80 01 BF FD  
0046F0  3  B3 CD BD BD  
004708  3  66 66 FF FF          .byte 102,102,255,255,128,1,191,253,183,237,187,221,189,189,167,229,187,221,191,253,182,109,160,5,160,5,128,1,255,255,102,102
00470C  3  80 01 BF FD  
004710  3  B7 ED BB DD  
004728  3  30 00 30 00          .byte 48,0,48,0,31,251,56,31,55,236,47,244,47,244,47,52,46,84,46,20,47,52,47,244,240,12,223,248,0,12,0,12
00472C  3  1F FB 38 1F  
004730  3  37 EC 2F F4  
004748  3  03 00 03 00          .byte 3,0,3,0,31,248,56,28,55,236,47,244,47,247,46,119,236,180,236,52,46,116,47,244,48,12,31,248,0,192,0,192
00474C  3  1F F8 38 1C  
004750  3  37 EC 2F F4  
004768  3  00 30 00 30          .byte 0,48,0,48,31,248,56,28,247,236,239,244,47,244,44,244,41,116,40,116,44,247,47,247,48,12,31,248,12,0,12,0
00476C  3  1F F8 38 1C  
004770  3  F7 EC EF F4  
004788  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,85,85,255,255
00478C  3  00 00 00 00  
004790  3  00 00 00 00  
0047A8  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,85,85,0,0,0,0,170,170,255,255
0047AC  3  00 00 00 00  
0047B0  3  00 00 00 00  
0047C8  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,170,170,0,0,0,0,0,0,0,0,0,0,85,85,255,255
0047CC  3  00 00 00 00  
0047D0  3  00 00 00 00  
0047E8  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,85,85,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,170,170,255,255
0047EC  3  00 00 00 00  
0047F0  3  00 00 55 55  
004808  3  00 00 38 1C          .byte 0,0,56,28,103,230,92,58,91,218,58,92,58,92,60,60,63,252,56,28,59,220,91,218,92,58,103,230,56,28,0,0
00480C  3  67 E6 5C 3A  
004810  3  5B DA 3A 5C  
004828  3  06 00 18 00          .byte 6,0,24,0,7,224,28,58,27,218,59,29,59,29,60,60,63,252,191,252,184,28,91,216,92,56,7,224,0,24,0,96
00482C  3  07 E0 1C 3A  
004830  3  1B DA 3B 1D  
004848  3  01 E0 00 00          .byte 1,224,0,0,7,224,28,56,27,216,184,220,184,220,188,61,191,253,63,253,59,221,28,56,31,248,7,224,0,0,7,128
00484C  3  07 E0 1C 38  
004850  3  1B D8 B8 DC  
004868  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255
00486C  3  00 00 00 00  
004870  3  00 00 00 00  
004888  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,127,222,255,255
00488C  3  00 00 00 00  
004890  3  00 00 00 00  
0048A8  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,63,128,95,222,255,255
0048AC  3  00 00 00 00  
0048B0  3  00 00 00 00  
0048C8  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,63,128,79,204,127,222,255,255
0048CC  3  00 00 00 00  
0048D0  3  00 00 00 00  
0048E8  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,0,63,128,79,204,79,214,63,158,255,255
0048EC  3  00 00 00 00  
0048F0  3  00 00 00 00  
004908  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,128,17,128,145,32,72,64,72,204,109,214,127,222,63,140,255,255
00490C  3  00 00 00 00  
004910  3  00 00 00 00  
004928  3  00 00 00 00          .byte 0,0,0,0,128,0,0,0,0,64,0,64,0,0,0,12,0,4,0,33,0,17,0,19,128,90,113,158,63,140,255,255
00492C  3  80 00 00 00  
004930  3  00 40 00 40  
004948  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,4,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,19,127,222,255,255
00494C  3  00 00 00 00  
004950  3  00 04 00 08  
004968  3  7F FE C0 03          .byte 127,254,192,3,160,153,176,77,152,37,172,1,150,65,171,33,181,145,186,201,189,101,158,177,175,89,183,173,192,3,127,254
00496C  3  A0 99 B0 4D  
004970  3  98 25 AC 01  
004988  3  00 00 00 00          .byte 0,0,0,0,0,8,0,0,0,8,0,4,0,8,0,4,0,2,0,5,0,2,0,33,0,66,0,36,0,66,0,36
00498C  3  00 08 00 00  
004990  3  00 08 00 04  
0049A8  3  00 00 00 00          .byte 0,0,0,0,0,2,0,0,0,2,0,4,0,2,0,4,0,10,0,84,0,8,0,84,0,136,0,68,0,34,0,68
0049AC  3  00 02 00 00  
0049B0  3  00 02 00 04  
0049C8  3  03 80 03 80          .byte 3,128,3,128,1,128,3,128,3,128,3,128,3,0,3,0,3,128,3,128,3,128,3,128,1,128,3,128,3,128,3,128
0049CC  3  01 80 03 80  
0049D0  3  03 80 03 80  
0049E8  3  07 E0 07 E0          .byte 7,224,7,224,7,224,3,224,3,224,7,224,7,224,7,224,7,224,7,224,7,224,7,224,7,224,7,192,7,224,7,224
0049EC  3  07 E0 03 E0  
0049F0  3  03 E0 07 E0  
004A08  3  1F F8 1F F0          .byte 31,248,31,240,31,240,31,248,31,248,15,248,31,248,31,248,31,248,31,240,31,248,31,248,15,248,15,248,31,248,31,248
004A0C  3  1F F0 1F F8  
004A10  3  1F F8 0F F8  
004A28  3               frmlst:
004A28  3  00 04                .byte 0,4
004A2A  3  04 04                .byte 4,4
004A2C  3  08 04                .byte 8,4
004A2E  3  0C 03                .byte 12,3
004A30  3  0F 03                .byte 15,3
004A32  3  12 04                .byte 18,4
004A34  3  16 03                .byte 22,3
004A36  3  19 08                .byte 25,8
004A38  3  21 01                .byte 33,1
004A3A  3  22 02                .byte 34,2
004A3C  3  24 03 27 00          .byte 36,3,39,0
004A40  3               .out .sprintf("SPRITES SIZE = %d", (* - sprgfx))
004A40  3               
004A40  3               scdat:
004A40  3  A9 01 D7 01          .word 425,471,436,372,323,381,312,298,276,343,255,305,230,299,292,268,350,320,349,203,222,352,366,303,202,225
004A44  3  B4 01 74 01  
004A48  3  43 01 7D 01  
004A74  3  EC 00 7E 01          .word 236,382
004A78  3  02 02 01 01          .byte 2,2,1,1,1,3,1,3,3,2,255,1,4,2,2,1,1,6,2,1,1,1,2,1,3,3,2,1,14,16,16,15,1
004A7C  3  01 03 01 03  
004A80  3  03 02 FF 01  
004A99  3  FF 03 04 01          .byte 255,3,4,1,14,16,16,0,16,0,16,255,0,5,15,1,2,8,3,2,0,17,16,0,15,2,3,1,14,16,0,17,16
004A9D  3  0E 10 10 00  
004AA1  3  10 00 10 FF  
004ABA  3  4A 10 00 4B          .byte 74,16,0,75,255,0,6,16,15,1,3,0,0,0,17,0,0,15,1,14,0,75,0,0,16,0,17,255,0,7,74,16,76
004ABE  3  FF 00 06 10  
004AC2  3  0F 01 03 00  
004ADB  3  02 02 FF 00          .byte 2,2,255,0,7,16,255,0,5,17,255,0,10,17,0,1,3,255,13,4,0,0,0,16,76,255,0,17,1,1,1,14,255,0,4
004ADF  3  07 10 FF 00  
004AE3  3  05 11 FF 00  
004AFE  3  4A 10 FF 00          .byte 74,16,255,0,18,2,1,1,255,0,6,17,255,0,8,13,13,255,0,7,4,24,25,1,255,0,8,13,13,13,21,22,0,0
004B02  3  12 02 01 01  
004B06  3  FF 00 06 11  
004B20  3  02 01 10 FF          .byte 2,1,16,255,0,7,28,28,1,255,0,8,17,0,0,21,22,0,0,1,3,2,0,0,0,19,19,0,0,28,28,1,13,13,13
004B24  3  00 07 1C 1C  
004B28  3  01 FF 00 08  
004B43  3  FF 00 08 15          .byte 255,0,8,21,22,0,0,1,3,1,0,0,0,13,13,13,4,24,25,3,8,1,1,13,13,255,0,6,21,22,0,0,2
004B47  3  16 00 00 01  
004B4B  3  03 01 00 00  
004B64  3  03 01 FF 00          .byte 3,1,255,0,5,16,15,7,3,2,14,17,16,255,0,8,21,22,0,13,1,3,1,255,0,5,17,0,15,1,1,0,0
004B68  3  05 10 0F 07  
004B6C  3  03 02 0E 11  
004B85  3  11 FF 00 05          .byte 17,255,0,5,255,13,6,2,1,3,2,255,0,8,1,1,255,0,8,15,1,2,5,1,2,1,3,1,14,255,0,8,1
004B89  3  FF 0D 06 02  
004B8D  3  01 03 02 FF  
004BA6  3  02 FF 00 0A          .byte 2,255,0,10,6,1,24,25,18,6,18,9,10,255,0,7,2,1,255,0,5,13,13,13,6,0,15,2,77,78,1,14,0,0
004BAA  3  06 01 18 19  
004BAE  3  12 06 12 09  
004BC8  3  0B FF 00 04          .byte 11,255,0,4,19,19,0,1,1,255,0,4,13,7,2,1,13,54,54,2,77,78,2,18,10,0,11,255,0,4,19,19,13
004BCC  3  13 13 00 01  
004BD0  3  01 FF 00 04  
004BE9  3  01 01 00 0D          .byte 1,1,0,13,13,13,1,2,3,3,2,54,54,2,24,25,1,0,11,0,11,255,0,4,13,13,5,3,1,13,1,2,1
004BED  3  0D 0D 01 02  
004BF1  3  03 03 02 36  
004C0A  3  03 03 03 02          .byte 3,3,3,2,2,0,0,1,77,78,1,0,11,0,11,0,0,13,13,1,3,3,1
004C0E  3  02 00 00 01  
004C12  3  4D 4E 01 00  
004C21  3  FF 03 05 01          .byte 255,3,5,1,3,1,1,17,0,0,1,77,78,2,0,11,0,11,0,0,6,1,1,8,255,3,4,1,23,23,3,3,3
004C25  3  03 01 01 11  
004C29  3  00 00 01 4D  
004C42  3  02 10 4C 11          .byte 2,16,76,17,2,24,25,1,0,12,18,11,0,0,0,2,1,3,23,23,1,3,3,3,23,23,23,3,1,16,75,1,3
004C46  3  02 18 19 01  
004C4A  3  00 0C 12 0B  
004C63  3  0C 0A 01 00          .byte 12,10,1,0,0,0,11,0,0,0,2,3,23,23,0,1,2,1,1,23,0,23,1,3,1,16,2,3,3,11,14,0,0,0
004C67  3  00 00 0B 00  
004C6B  3  00 00 02 03  
004C85  3  0B 00 00 00          .byte 11,0,0,0,1,3,23,255,0,4,15,1,2,23,23,23,3,1,2,2,3,1,11,255,0,4,11,13,13,13,2,3,23,23
004C89  3  01 03 17 FF  
004C8D  3  00 04 0F 01  
004CA7  3  FF 00 04 11          .byte 255,0,4,17,1,3,3,23,2,3,3,1,3,1,12,9,9,9,18,13,2,1,1,3,23,23,255,0,6,15,1,255,3,6
004CAB  3  01 03 03 17  
004CAF  3  02 03 03 01  
004CC9  3  07 02 FF 00          .byte 7,2,255,0,5,1,1,3,3,23,0,0,23,255,0,6,19,19,3,3,3,1,1,1,14,255,0,5,2,3,3,23,0
004CCD  3  05 01 01 03  
004CD1  3  03 17 00 00  
004CEA  3  36 36 FF 00          .byte 54,54,255,0,9,1,1,1,14,17,16,76,255,0,5,1,3,23,0,23,54,54,23,0,255,13,5,8,1,1,0,16,0,0
004CEE  3  09 01 01 01  
004CF2  3  0E 11 10 4C  
004D0C  3  10 FF 00 06          .byte 16,255,0,6,2,3,23,0,0,23,23,3,23,1,2,2,2,1,1,2,0,0,16,0,0,17,255,0,5,17,1,1,23,23,23
004D10  3  02 03 17 00  
004D14  3  00 17 17 03  
004D2F  3  03 03 01 03          .byte 3,3,1,3,3,2,1,1,14,16,16,76,0,17,255,0,6,13,13,13,1,3,3,23,3,1,255,3,4,1,1,14,74
004D33  3  03 02 01 01  
004D37  3  0E 10 10 4C  
004D50  3  10 4B FF 00          .byte 16,75,255,0,9,15,1,2,1,3,1,3,1,1,2,1,2,3,6,1,0,0,17,255,0,4,13,13,13,255,0,4,11
004D54  3  09 0F 01 02  
004D58  3  01 03 01 03  
004D71  3  07 01 02 01          .byte 7,1,2,1,1,0,17,11,0,0,1,2,14,255,0,7,2,1,1,255,0,4,12,9,26,24,25,26,9,18,11,18,9
004D75  3  01 00 11 0B  
004D79  3  00 00 01 02  
004D92  3  FF 00 08 0D          .byte 255,0,8,13,13,1,5,2,13,17,255,0,5,29,29,0,0,0,11,255,0,9,17,2,1,2,3,3,1,13,13,19,19
004D96  3  0D 01 05 02  
004D9A  3  0D 11 FF 00  
004DB3  3  00 00 1D 1D          .byte 0,0,29,29,0,0,0,11,255,0,8,13,13,1,255,3,5,2,1,13,13,13,26,24,25,26,255,13,11,2,1,1,255,3,6
004DB7  3  00 00 00 0B  
004DBB  3  FF 00 08 0D  
004DD6  3  07 FF 01 04          .byte 7,255,1,4,2,2,255,1,5,2,1,2,2,1,2,1,1,3,3,6,255,3,6,2,255,3,4,1,3,3,3,2,1
004DDA  3  02 02 FF 01  
004DDE  3  05 02 01 02  
004DF7  3  03                   .byte 3
004DF8  3  FF 00 05 17          .byte 255,0,5,23,3,3,2,1,1,21,22,1,1,2,1,1,21,22,1,1,1,2,3,23,5,23,255,0,4,23,23,3,1
004DFC  3  03 03 02 01  
004E00  3  01 15 16 01  
004E19  3  0E 00 00 15          .byte 14,0,0,21,22,15,14,16,15,1,21,22,17,16,15,1,1,3,23,3,255,0,4,23,3,3,1,0,0,0,21,22,0
004E1D  3  16 0F 0E 10  
004E21  3  0F 01 15 16  
004E3A  3  4A 10 00 02          .byte 74,16,0,2,21,22,0,16,76,15,2,1,3,1,255,0,5,23,3,2,0,0,0,21,22,0,0,17,0,1,21,22,74
004E3E  3  15 16 00 10  
004E42  3  4C 0F 02 01  
004E5B  3  10 00 00 10          .byte 16,0,0,16,15,1,2,255,0,4,23,23,1,14,0,0,0,21,22,255,0,4,8,21,22,0,17,0,0,17,0,16,255,0,5
004E5F  3  0F 01 02 FF  
004E63  3  00 04 17 17  
004E7E  3  17 03 01 4B          .byte 23,3,1,75,0,0,0,21,22,255,0,4,2,21,22,255,0,6,75,255,0,4,23,3,3,2,1,0,0,0,21,22,255,0,4
004E82  3  00 00 00 15  
004E86  3  16 FF 00 04  
004EA1  3  01 15 16 FF          .byte 1,21,22,255,0,12,23,3,1,14,0,0,0,21,22,255,0,4,1,13,13,17,255,0,11,23,3,1,17,0,0,0,21
004EA5  3  00 0C 17 03  
004EA9  3  01 0E 00 00  
004EC2  3  16 FF 00 05          .byte 22,255,0,5,2,1,13,13,255,0,9,23,23,3,8,1,13,21,22,13,13,255,0,5,16,1,1,2,255,13,6,0,0,0
004EC6  3  02 01 0D 0D  
004ECA  3  FF 00 09 17  
004EE4  3  17 03 03 03          .byte 23,3,3,3,2,1,21,22,16,76,255,0,5,16,15,1,7,1,2,1,1,2,1,255,0,4,23,3,1,1,14,21,22
004EE8  3  02 01 15 16  
004EEC  3  10 4C FF 00  
004F05  3  11 FF 00 06          .byte 17,255,0,6,17,0,0,1,3,3,1,3,3,3,255,0,4,23,3,1,14,0,21,22,255,0,10,15,1,1,23,23,23
004F09  3  11 00 00 01  
004F0D  3  03 03 01 03  
004F26  3  03 00 00 00          .byte 3,0,0,0,23,3,3,2,0,0,21,22,255,0,12,15,5,3,1,3,255,0,4,23,3,1,17,0,21,22,255,0,13
004F2A  3  17 03 03 02  
004F2E  3  00 00 15 16  
004F47  3  0F 01 01 01          .byte 15,1,1,1,255,0,4,23,3,1,16,0,21,22,255,0,21,23,3,1,2,0,21,22,0,38,38,255,0,4,38,38,255,0,11
004F4B  3  FF 00 04 17  
004F4F  3  03 01 10 00  
004F6A  3  17 17 03 07          .byte 23,23,3,7,1,17,21,22,31,38,38,31,0,0,0,38,38,31,31,255,0,9,23,3,23,3,1,13,13,13,255,20,4
004F6E  3  01 11 15 16  
004F72  3  1F 26 26 1F  
004F8B  3  0D 0D 0D FF          .byte 13,13,13,255,20,4,255,13,6,255,0,4,23,23,3,3,1,2,255,1,5,2,1,1,8,255,1,4,2,7,1,2,1
004F8F  3  14 04 FF 0D  
004F93  3  06 FF 00 04  
004FAC  3  17 03 01 01          .byte 23,3,1,1,3,1,3,3,1,2,2,1,1,2,1,1,7,1,1,255,3,4,1,2,1,1,3,23,1,1,16,1,3,3
004FB0  3  03 01 03 03  
004FB4  3  01 02 02 01  
004FCE  3  01 01 0E 00          .byte 1,1,14,0,16,0,0,16,76,0,0,0,1,2,1,8,1,14,15,2,1,3,2,14,16,15,2,1,14,0,0,74,16
004FD2  3  10 00 00 10  
004FD6  3  4C 00 00 00  
004FEF  3  00 00 11 FF          .byte 0,0,17,255,0,4,16,15,1,17,16,76,0,15,1,1,1,0,16,76,16,255,0,5,75,255,0,7,17,0,1,0,17
004FF3  3  00 04 10 0F  
004FF7  3  01 11 10 4C  
005010  3  FF 00 04 01          .byte 255,0,4,1,14,74,16,0,17,255,0,15,1,255,0,6,1,0,0,17,255,0,17,2,1,21,22,13,13,13,1,255,0,13
005014  3  0E 4A 10 00  
005018  3  11 FF 00 0F  
005032  3  0D 0D 0D FF          .byte 13,13,13,255,0,6,21,22,15,2,3,2,255,0,13,7,1,1,255,0,6,21,22,0,1,7,1,255,0,6,13,13,13
005036  3  00 06 15 16  
00503A  3  0F 02 03 02  
005053  3  FF 00 04 01          .byte 255,0,4,1,3,1,255,0,6,21,22,0,15,1,1,255,0,13,1,3,8,255,0,6,21,22,0,0,1,1,13,13,255,0,11
005057  3  03 01 FF 00  
00505B  3  06 15 16 00  
005076  3  02 03 01 FF          .byte 2,3,1,255,0,6,21,22,0,0,1,1,14,255,0,12,1,3,1,255,0,8,13,13,1,2,255,0,13,1,1,1,255,0,9
00507A  3  00 06 15 16  
00507E  3  00 00 01 01  
005099  3  0F 02 07 FF          .byte 15,2,7,255,13,6,255,0,7,1,2,1,13,13,255,0,8,1,1,17,6,0,0,6,255,0,8,1,3,2,14,255,0,9
00509D  3  0D 06 FF 00  
0050A1  3  07 01 02 01  
0050BB  3  01 01 0D FF          .byte 1,1,13,255,0,9,13,13,13,1,3,1,255,0,7,13,13,13,2,3,8,13,255,0,10,15,8,1,1,255,0,9,15
0050BF  3  00 09 0D 0D  
0050C3  3  0D 01 03 01  
0050DC  3  01 17 03 01          .byte 1,23,3,1,13,17,255,0,9,1,3,2,17,255,0,8,17,1,0,23,3,1,255,13,4,255,0,5,17,1,3,1,16
0050E0  3  0D 11 FF 00  
0050E4  3  09 01 03 02  
0050FD  3  00 00 00 11          .byte 0,0,0,17,255,13,5,1,0,23,23,3,1,5,1,2,13,13,13,21,22,13,1,23,3,13,21,22,13,13,255,1,4
005101  3  FF 0D 05 01  
005105  3  00 17 17 03  
00511E  3  02 01                .byte 2,1
005120  3  FF 00 07 03          .byte 255,0,7,3,1,21,22,1,3,23,255,0,21,3,1,21,22,1,3,23,255,0,20,23,3,1,21,0,2,3,3,23,255,0,18
005124  3  01 15 16 01  
005128  3  03 17 FF 00  
005143  3  17 03 01 0E          .byte 23,3,1,14,0,0,15,1,2,1,3,23,23,255,0,14,23,3,1,1,255,0,4,74,16,15,2,1,7,3,3,23,255,0,8
005147  3  00 00 0F 01  
00514B  3  02 01 03 17  
005166  3  17 17 03 02          .byte 23,23,3,2,1,2,14,255,0,5,16,76,0,15,1,2,1,1,3,23,23,0,23,0,0,3,1,1,2,14,16,0,0,0
00516A  3  01 02 0E FF  
00516E  3  00 05 10 4C  
005188  3  13 13 00 00          .byte 19,19,0,0,17,255,0,4,16,15,1,2,1,1,3,3,23,23,1,14,0,17,0,17,0,0,0,13,13,255,0,7,17
00518C  3  11 FF 00 04  
005190  3  10 0F 01 02  
0051A9  3  00 00 00 0F          .byte 0,0,0,15,1,1,2,2,1,255,0,42,13,13,255,0,12,255,13,8,17,255,0,19,3,5,1,1,2,1,1,2,13,13
0051AD  3  01 01 02 02  
0051B1  3  01 FF 00 2A  
0051CB  3  FF 00 12 17          .byte 255,0,18,23,255,3,7,5,2,13,13,13,0,0,0,21,22,255,13,10,255,0,4,23,0,0,23,23,3,3,3,2,0,0,0
0051CF  3  FF 03 07 05  
0051D3  3  02 0D 0D 0D  
0051EE  3  15 16 FF 01          .byte 21,22,255,1,5,2,1,1,2,1,255,0,9,23,23,3,1,0,0,0,21,22,2,3,3,3,23,3,3,23,23,3,255,0,10
0051F2  3  05 02 01 01  
0051F6  3  02 01 FF 00  
005211  3  17 03 01 00          .byte 23,3,1,0,0,0,21,22,1,3,23,23,0,0,23,0,0,23,255,0,11,3,2,13,13,0,21,22,1,8,23,255,0,8
005215  3  00 00 15 16  
005219  3  01 03 17 17  
005233  3  36 36 FF 00          .byte 54,54,255,0,7,23,3,1,14,0,0,21,22,1,3,255,0,9,54,54,255,0,8,3,1,0,0,0,21,22,2,3,23
005237  3  07 17 03 01  
00523B  3  0E 00 00 15  
005254  3  FF 00 12 03          .byte 255,0,18,3,1,21,22,13,13,13,1,3,255,0,8
005258  3  01 15 16 0D  
00525C  3  0D 0D 01 03  
005263  3  FF 00 0A 17          .byte 255,0,10,23,3,1,21,22,1,1,1,3,3,23,23,0,0,3,3,23,3,255,0,11,3,1,21,22,0,15,255,1,5
005267  3  03 01 15 16  
00526B  3  01 01 01 03  
005284  3  08 FF 01 05          .byte 8,255,1,5,18,9,9,10,255,0,7,23,1,21,22,0,0,0,16,17,255,0,4,16,76,255,0,5,11,255,0,7,23
005288  3  12 09 09 0A  
00528C  3  FF 00 07 17  
0052A5  3  01 15 16 00          .byte 1,21,22,0,0,0,17,255,0,5,17,255,0,6,11,255,0,8,1,21,22,255,0,16,11,255,0,7,23,1,13,13,19,19
0052A9  3  00 00 11 FF  
0052AD  3  00 05 11 FF  
0052C7  3  11 FF 00 07          .byte 17,255,0,7,17,255,0,5,11,255,0,7,23,3,1,1,255,13,6,0,255,13,6,0,0,0,11,255,0,9,23,3,1,1
0052CB  3  11 FF 00 05  
0052CF  3  0B FF 00 07  
0052E9  3  07 01 01 10          .byte 7,1,1,16,0,15,1,1,3,3,1,0,0,0,12,255,9,5,10,255,0,6,23,23,3,1,17,0,75,1,3,255,23,4
0052ED  3  00 0F 01 01  
0052F1  3  03 03 01 00  
00530B  3  FF 00 08 0B          .byte 255,0,8,11,0,0,23,255,0,5,1,17,40,39,16,17,1,23,0,0,23,23,0,23,0,0,23,23,3,11,24,25,1
00530F  3  00 00 17 FF  
005313  3  00 05 01 11  
00532C  3  03 00 17 00          .byte 3,0,23,0,23,1,16,40,40,16,16,1,0,0,0,255,3,4,2,1,1,3,1,12,77,78,15,1,3,0,0,0,3
005330  3  17 01 10 28  
005334  3  28 10 10 01  
00534D  3  01 0D 0D 01          .byte 1,13,13,1,1,3,0,0,0,1,2,1,1,14,16,16,1,14,17,24,25,0,16,1,255,0,4,23,3,3,23,23,255,0,5
005351  3  01 03 00 00  
005355  3  00 01 02 01  
005370  3  10 00 00 4A          .byte 16,0,0,74,16,17,0,0,0,38,38,0,17,1,23,255,0,12,18,17,18,10,0,17,255,0,4,38,38,0,0,2,23
005374  3  10 11 00 00  
005378  3  00 26 26 00  
005391  3  FF 00 0F 0B          .byte 255,0,15,11,255,0,6,34,35,0,0,1,23,255,0,15,11,0,0,0,19,19,37,32,33,36,0,7,255,0,13,255,13,14
005395  3  FF 00 06 22  
005399  3  23 00 00 01  
0053B3  3  17 17 FF 00          .byte 23,23,255,0,9,54,54,0,2,1,1,3,3,1,5,2,1,3,1,1,3,0,23,255,0,10,54,54,0,23,23,3,3
0053B7  3  09 36 36 00  
0053BB  3  02 01 01 03  
0053D4  3  17 00 17 17          .byte 23,0,23,23,3,23,23,0,23,255,0,15
0053D8  3  03 17 17 00  
0053DC  3  17 FF 00 0F  
0053E0  3  00 00 00 17          .byte 0,0,0,23,3,1,0,0,45,255,0,7,8,255,5,5,8,255,0,8,3,1,14,255,0,12,43,6,42,255,0,6,45
0053E4  3  03 01 00 00  
0053E8  3  2D FF 00 07  
005401  3  00 00 00 03          .byte 0,0,0,3,1,75,255,0,4,46,255,0,8,5,0,46,255,0,10,8,1,255,0,25,23,3,1,19,19,255,0,11,5
005405  3  01 4B FF 00  
005409  3  04 2E FF 00  
005422  3  FF 00 08 17          .byte 255,0,8,23,23,0,23,3,1,255,5,4,8,0,46,255,0,15,3,3,23,3,1,14,0,0,0,43,5,255,0,8,7
005426  3  17 00 17 03  
00542A  3  01 FF 05 04  
005443  3  FF 00 08 FF          .byte 255,0,8,255,1,4,14,0,0,0,45,0,5,255,0,18,16,15,14,0,0,0,46,0,0,5,255,0,18,17,255,0,8
005447  3  01 04 0E 00  
00544B  3  00 00 2D 00  
005464  3  05 05 07 FF          .byte 5,5,7,255,0,13,46,255,0,11,5,42,255,0,26,5,45,255,0,7,7,5,5,5,255,0,5,255,13,4,5,5,7
005468  3  00 0D 2E FF  
00546C  3  00 0B 05 2A  
005485  3  00 00 00 07          .byte 0,0,0,7,255,0,5,7,5,5,42,0,43,7,255,0,5,1,2,1,255,0,17,41,19,8,8,255,0,4,3,7,1
005489  3  FF 00 05 07  
00548D  3  05 05 2A 00  
0054A6  3  FF 00 11 29          .byte 255,0,17,41,41,7,42,255,0,4,23,3,3,13,0,0,7,5,0,5,0,5,0,5,0,5,0,5,0,5,0,5,5
0054AA  3  29 07 2A FF  
0054AE  3  00 04 17 03  
0054C7  3  00 00 00 11          .byte 0,0,0,17,0,0,23,3,1,0,0,38,38,255,0,12,38,38,0,0,17,1,1,2,0,0,3,2,31,31,38,38,255,31,12
0054CB  3  00 00 17 03  
0054CF  3  01 00 00 26  
0054EA  3  26 26 1F 1F          .byte 38,38,31,31,2,2,7,3,0,3,3,1,255,20,20,1,3,23,23,0,23,3,1,1,1,2,1,2,1,1,2,255,1,4
0054EE  3  02 02 07 03  
0054F2  3  00 03 03 01  
00550C  3  02 01 01 05          .byte 2,1,1,5,1,1,1,2,1,3,23,0
005510  3  01 01 01 02  
005514  3  01 03 17 00  
005518  3  03 17 03 17          .byte 3,23,3,23,23,3,3,23,23,3,23,255,0,8,23,3,3,23,23,3,8,3,23,1,1,2,2,1,8,1,1,1,2
00551C  3  17 03 03 17  
005520  3  17 03 17 FF  
005539  3  01 03 17 FF          .byte 1,3,23,255,0,4,23,3,255,1,4,2,1,1,2,1,0,16,0,17,0,0,0,16,76,0,15,1,3,255,0,4,3
00553D  3  00 04 17 03  
005541  3  FF 01 04 02  
00555A  3  02 0E 10 00          .byte 2,14,16,0,0,74,16,17,15,1,0,17,255,0,5,17,0,0,0,15,1,23,0,0,0,1,14,0,75,0,0,0,17
00555E  3  00 4A 10 11  
005562  3  0F 01 00 11  
00557B  3  00 00 01 FF          .byte 0,0,1,255,0,11,17,1,3,23,0,23,1,0,40,40,255,0,7,17,255,0,8,38,0,13,1,23,0,0,0,1,17
00557F  3  00 0B 11 01  
005583  3  03 17 00 17  
00559C  3  FF 00 07 11          .byte 255,0,7,17,0,255,13,5,0,0,255,13,4,1,3,255,0,4,23,1,13,13,0,0,255,13,5,1,1,2,1,1,0,0
0055A0  3  00 FF 0D 05  
0055A4  3  00 00 FF 0D  
0055BE  3  02 01 03 01          .byte 2,1,3,1,3,23,255,0,5,3,7,2,0,0,1,1,2,3,1,3,23,3,3,2,0,0,1,3,23,23,255,0,8
0055C2  3  03 17 FF 00  
0055C6  3  05 03 07 02  
0055DF  3  17 01 00 00          .byte 23,1,0,0,2,3,3,23,3,0,0,23,3,1,0,0,1,3,255,0,11,1,0,0,1,3,23,255,0,5,1,2,0,0
0055E3  3  02 03 03 17  
0055E7  3  03 00 00 17  
005601  3  01 17 FF 00          .byte 1,23,255,0,11,2,0,0,1,23,255,0,6,23,1,0,0,1,3,255,0,10,23,3,1,1,3,23,255,0,6,5,1
005605  3  0B 02 00 00  
005609  3  01 17 FF 00  
005622  3  00 00 01 17          .byte 0,0,1,23,255,0,11,23,3,0,23,255,0,6,23,3,1,1,2,3,0,23,255,0,21,23,3,3,23,255,0,161
005626  3  FF 00 0B 17  
00562A  3  03 00 17 FF  
005642  3  00 00 00 2D          .byte 0,0,0,45,255,0,10,44,255,0,8,7,5,21,22,5,255,0,25,21,22,255,0,12,46,255,0,10,45,0,0,21,22
005646  3  FF 00 0A 2C  
00564A  3  FF 00 08 07  
005663  3  08 FF 00 19          .byte 8,255,0,25,21,22,255,0,28,5,255,0,16,46,255,0,38,7,255,0,5,46,255,0,13,7,5,5,7,255,0,14,8
005667  3  15 16 FF 00  
00566B  3  1C 05 FF 00  
005684  3  05 05 08 FF          .byte 5,5,8,255,0,6,12,10,255,0,6,5,255,0,10,11,255,0,9,11,255,0,4,46,255,0,12,11,255,0,9,11,255,0,6
005688  3  00 06 0C 0A  
00568C  3  FF 00 06 05  
0056A7  3  FF 05 05 07          .byte 255,5,5,7,255,0,5,11,255,0,9,11,0,0,53,255,0,7,12,255,9,5,18,12,10,255,0,5,45,0,0,11,255,0,6
0056AB  3  FF 00 05 0B  
0056AF  3  FF 00 09 0B  
0056CA  3  08 FF 00 09          .byte 8,255,0,9,45,0,11,255,0,6,46,0,11,255,0,10,17,255,0,7,11,255,0,8,11,0,0,53,0,0,0,7,0,0,0
0056CE  3  2D 00 0B FF  
0056D2  3  00 06 2E 00  
0056ED  3  10 FF 00 07          .byte 16,255,0,7,11,255,0,8,11,255,0,7,255,13,5,17,0,0,7,255,5,5,7,255,0,5,11,255,0,6,5,1,1
0056F1  3  0B FF 00 08  
0056F5  3  0B FF 00 07  
00570E  3  02 01 01 0D          .byte 2,1,1,13,21,22,5,42,0,11,0,43,5,255,0,5,11,0,0,53,255,0,4,3,23,23,3,1,2,21,22,5,0,0
005712  3  15 16 05 2A  
005716  3  00 0B 00 2B  
005730  3  0C 09 09 05          .byte 12,9,9,5,18,9,9,10,0,11,255,0,6,6,0,0,0,23,3,1,21,22,8,255,0,5,8,21,22,7,5,5,5
005734  3  12 09 09 0A  
005738  3  00 0B FF 00  
005751  3  07 FF 00 05          .byte 7,255,0,5,5
005755  3  05           
005756  3  17 17 03 17          .byte 23,23,3,23,3,1,21,22,8,5,0,5,0,5,7,21,22,7,255,0,9,8,3,2,1,1,2,14,21,22,255,0,5
00575A  3  03 01 15 16  
00575E  3  08 05 00 05  
005777  3  2B 05 15 16          .byte 43,5,21,22,255,0,11,2,1,14,16,0,0,21,22,255,0,6,5,21,22,255,0,5,45,255,0,4,5,1,2,0,17
00577B  3  FF 00 0B 02  
00577F  3  01 0E 10 00  
005798  3  00 2B 07 05          .byte 0,43,7,5,0,5,0,5,5,5,8,21,22,255,0,7,46,0,0,0,7,6,255,0,10,46,43,5,21,22,255,0,10
00579C  3  00 05 00 05  
0057A0  3  05 05 08 15  
0057B9  3  05 08 05 00          .byte 5,8,5,0,0,0,19,19,255,0,7,5,21,22,0,45,255,0,9,255,13,7,255,0,8,21,22,255,0,9,45,5,255,1,5
0057BD  3  00 00 13 13  
0057C1  3  FF 00 07 05  
0057DC  3  02 05 05 05          .byte 2,5,5,5,7,255,0,4,5,0,22,255,0,11,3,23,3,23,3,1,14,255,0,20,5,0,0,0,23,3,1,0,0
0057E0  3  07 FF 00 04  
0057E4  3  05 00 16 FF  
0057FD  3  2D FF 00 05          .byte 45,255,0,5,5,255,0,5,7,5,0,0,0,21,22,255,0,5,3,2,0,46,255,0,5,5,7,255,0,10,21,22,5
005801  3  05 FF 00 05  
005805  3  07 05 00 00  
00581E  3  00 00 00 17          .byte 0,0,0,23,1,14,255,0,6,5,42,255,0,7,46,0,0,0,21,22,255,0,4,3,1,255,0,20,21,22,5,0,0
005822  3  01 0E FF 00  
005826  3  06 05 2A FF  
00583F  3  17 01 0E FF          .byte 23,1,14,255,0,10,45,255,0,9,21,0,0,0,23,3,2,17,255,0,4,8,255,0,17,5,0,0,3,1,16,76,255,0,24
005843  3  00 0A 2D FF  
005847  3  00 09 15 00  
005862  3  17 01 0D 00          .byte 23,1,13,0,0,0,38,38,0,0,7,0,5,0,5,0,5,0,5,7,38,38,0,0,0,5,0,54,54,1,1,31,31,31
005866  3  00 00 26 26  
00586A  3  00 00 07 00  
005884  3  26 26 FF 1F          .byte 38,38,255,31,12,38,38,31,31,31,5,0,54,54,3,2,255,20,22,13,0,0,0,23,3,2,255,1,7,2,255,1,6
005888  3  0C 26 26 1F  
00588C  3  1F 1F 05 00  
0058A5  3  02 02 01 01          .byte 2,2,1,1,1,2,1,1
0058A9  3  01 02 01 01  
0058AD  3  FF 2C 1C FF          .byte 255,44,28,255,0,33,46,255,0,26,45,255,0,7,19,19,255,0,10,46,0,0,0,8,7,5,5,0,8,0,5,8,0
0058B1  3  00 21 2E FF  
0058B5  3  00 1A 2D FF  
0058CE  3  05 00 07 05          .byte 5,0,7,5,0,6,0,8,5,0,5,0,7,5,0,5,0,8,43,54,54,42,255,0,11,39,38,255,0,10,44,0,54,54
0058D2  3  00 06 00 08  
0058D6  3  05 00 05 00  
0058F0  3  FF 00 0B 2D          .byte 255,0,11,45,40,40,255,0,10,17,255,0,24,45,0,0,13,255,0,13,11,255,0,13,1,255,0,8,46,255,0,4,11
0058F4  3  28 28 FF 00  
0058F8  3  0A 11 FF 00  
005911  3  00 00 00 2D          .byte 0,0,0,45,255,0,5,46,0,0,0,1,255,0,13,11,255,0,13,1,255,0,13,11,255,0,13,1,255,0,12,11,11
005915  3  FF 00 05 2E  
005919  3  00 00 00 01  
005932  3  FF 00 0D 08          .byte 255,0,13,8,255,0,12,11,11,255,0,13,1,255,0,12,11,12,10,255,0,11,75,2,0,0,0,17,255,0,8,12,18
005936  3  FF 00 0C 0B  
00593A  3  0B FF 00 0D  
005953  3  0B 0A FF 00          .byte 11,10,255,0,9,74,16,1,0,0,0,16,76,255,0,9,11,11,0,0,0,17,255,0,5,17,1,3,255,13,9,21,22
005957  3  09 4A 10 01  
00595B  3  00 00 00 10  
005974  3  0D 0D 0D 18          .byte 13,13,13,24,25,255,13,10,1,3,1,2,1,1,1,5,1,1,1,21,22,2,1,1,77,78,1,2,1,1,7,1,1
005978  3  19 FF 0D 0A  
00597C  3  01 03 01 02  
005995  3  02 02 01 03          .byte 2,2,1,3,3,255,0,4,23,0,23,3,2,21,22,2,3,23,32,33,255,0,12
005999  3  03 FF 00 04  
00599D  3  17 00 17 03  
0059AC  3  0E FF 00 09          .byte 14,255,0,9,6,21,22,5,44,44,44,24,77,78,25,255,44,7,255,0,5,46,0,54,54,54,5,21,22,255,0,4,27
0059B0  3  06 15 16 05  
0059B4  3  2C 2C 2C 18  
0059CD  3  18 19 1B 00          .byte 24,25,27,0,0,0,45,255,0,5,45,255,0,4,54,54,54,5,21,22,255,0,5,30,30,255,0,15,54,54,54,7,21
0059D1  3  00 00 2D FF  
0059D5  3  00 05 2D FF  
0059EE  3  16 FF 00 05          .byte 22,255,0,5,30,30,0,0,19,19,255,0,14,43,5,5,7,0,0,7,27,24,25,27,7,5,5,7,5,8,5,255,0,7
0059F2  3  1E 1E 00 00  
0059F6  3  13 13 FF 00  
005A10  3  2D 00 00 00          .byte 45,0,0,0,43,0,42,0,0,43,0,77,78,0,42,43,0,42,43,0,42,255,0,6,46,255,0,11,77,78,255,0,26
005A14  3  2B 00 2A 00  
005A18  3  00 2B 00 4D  
005A31  3  18 19 00 00          .byte 24,25,0,0,45,255,0,18,46,0,0,0,37,32,33,36,255,0,4,46,255,0,17,44,0,0,38,38,255,0,16,75,255,0,9
005A35  3  2D FF 00 12  
005A39  3  2E 00 00 00  
005A54  3  26 26 FF 00          .byte 38,38,255,0,16,16,76,255,0,8,38,38,255,0,15,74,16,255,0,9,38,38,255,0,15,17,16,255,0,9,38,38,255,0,15
005A58  3  10 10 4C FF  
005A5C  3  00 08 26 26  
005A77  3  10 10 4C FF          .byte 16,16,76,255,0,8,38,38,0,0,17,255,0,12,16,16,0,17,255,0,7,38,38,0,0,16,76,255,0,10,17,13,13
005A7B  3  00 08 26 26  
005A7F  3  00 00 11 FF  
005A98  3  11 10 FF 00          .byte 17,16,255,0,7,38,38,0,17,16,255,0,5,255,13,7,1,1,255,13,8,66,67,67,65,255,13,7,1,1,1,3,1
005A9C  3  07 26 26 00  
005AA0  3  11 10 FF 00  
005AB9  3  07 01 0E 0F          .byte 7,1,14,15,1,3,1,1,1,2,1,2,1,66,65,255,1,7,2,0,0,23,255,0,6,23,23,255,0,6,23,0,23
005ABD  3  01 03 01 01  
005AC1  3  01 02 01 02  
005ADA  3  FF 00 08             .byte 255,0,8
005ADD  3  FF 2C 04 0F          .byte 255,44,4,15,255,1,4,2,1,14,0,44,0,15,2,1,3,23,0,0,0,23,23,3,3,1,255,0,6,15,14,0,16
005AE1  3  FF 01 04 02  
005AE5  3  01 0E 00 2C  
005AFE  3  11 FF 00 06          .byte 17,255,0,6,16,1,3,3,23,3,3,1,1,2,14,255,0,9,75,0,46,255,0,5,17,15,1,2,1,1,2,14,16,16
005B02  3  10 01 03 03  
005B06  3  17 03 03 01  
005B20  3  FF 00 04 2E          .byte 255,0,4,46,255,0,16,17,16,45,0,0,17,16,76,255,0,5,46,255,0,15,17,255,0,4,75,255,0,25,46,255,0,12
005B24  3  FF 00 10 11  
005B28  3  10 2D 00 00  
005B42  3  2D FF 00 0C          .byte 45,255,0,12,45,255,0,26,45,255,0,23,46,255,0,11,45,255,0,89,75,255,0,27,17,255,0,26,74,16,17,255,0,4
005B46  3  2D FF 00 1A  
005B4A  3  2D FF 00 17  
005B64  3  0D FF 00 15          .byte 13,255,0,21,16,16,76,0,38,38,5,38,38,255,0,16,17,0,0,13,13,31,31,38,38,5,38,38,31,31,13,13,255,0,4
005B68  3  10 10 4C 00  
005B6C  3  26 26 05 26  
005B87  3  11 00 00 00          .byte 17,0,0,0,255,13,7,1,1,255,20,4,5,255,20,4,1,2,255,13,8,1,1,1,3,1,7,1,14,15,1,3,1,1
005B8B  3  FF 0D 07 01  
005B8F  3  01 FF 14 04  
005BA9  3  06 02 01 02          .byte 6,2,1,2,1,3,8,255,1,7,2,0,0,23,255,0,6,23,23,255,0,8,23,255,0,8
005BAD  3  01 03 08 FF  
005BB1  3  01 07 02 00  
005BC3  3  2C 2C 15 16          .byte 44,44,21,22,0,255,44,4,255,0,4,44,255,0,13,44,0,0,21,22,255,0,26,21,22,255,0,7,46,255,0,18,21
005BC7  3  00 FF 2C 04  
005BCB  3  FF 00 04 2C  
005BE4  3  16 FF 00 12          .byte 22,255,0,18,45,0,40,19,255,0,4,21,22,0,46,255,0,18,40,19,255,0,4,21,22,255,0,19,59,57,57,57,58
005BE8  3  2D 00 28 13  
005BEC  3  FF 00 04 15  
005C05  3  3B 39 3A 3B          .byte 59,57,58,59,58,255,0,4,45,255,0,12,45,0,54,54,54,0,0,59,57,58,255,0,17,45,0,0,54,54,54,255,0,12
005C09  3  3A FF 00 04  
005C0D  3  2D FF 00 0C  
005C27  3  33 18 19 31          .byte 51,24,25,49,0,0,46,255,0,11,45,255,0,8,51,48,48,48,50,49,255,0,21,51,50,50,255,48,4,49,255,0,19
005C2B  3  00 00 2E FF  
005C2F  3  00 0B 2D FF  
005C48  3  33 30 30 32          .byte 51,48,48,50,255,48,5,49,255,0,17,51,255,47,9,48,49,255,0,15,51,48,255,47,9,50,48,49,255,0,7,17,255,0,5
005C4C  3  FF 30 05 31  
005C50  3  FF 00 11 33  
005C6B  3  33 30 30 2F          .byte 51,48,48,47,47,47,48,48,48,50,255,47,5,49,255,0,5,74,16,0,17,0,0,51,50,50,48,48,47,47,47,42,43
005C6F  3  2F 2F 30 30  
005C73  3  30 32 FF 2F  
005C8C  3  30 FF 2F 06          .byte 48,255,47,6,49,255,0,5,16,0,16,0,51,48,48,50,48,48,47,47,47,0,0,50,48,48,48,50,48,48,48,49,0
005C90  3  31 FF 00 05  
005C94  3  10 00 10 00  
005CAD  3  11 00 00 10          .byte 17,0,0,16,255,13,10,50,50,5,5,50,50,255,13,12,1,1,1,3,1,7,1,2,1,1,3,50,52,52,50,1,2
005CB1  3  FF 0D 0A 32  
005CB5  3  32 05 05 32  
005CCE  3  01 03 02 01          .byte 1,3,2,1,7,1,1,8,1,1,2,0,0,23,255,0,6,23,1,50,52,52,50,2,23,0,0,23,23,255,0,7
005CD2  3  07 01 01 08  
005CD6  3  01 01 02 00  
005CEE  3  0D FF 2C 1B          .byte 13,255,44,27,1,17,255,0,7,59,57,57,58,255,0,15,1,16,75,255,0,25,1,16,16,76,255,0,18,45,255,0,5
005CF2  3  01 11 FF 00  
005CF6  3  07 3B 39 39  
005D0F  3  02 0D 0D 11          .byte 2,13,13,17,255,0,24,1,2,1,13,61,255,0,19,46,0,0,0,3,23,3,1,13,255,0,4,45,255,0,10,59,57
005D13  3  FF 00 18 01  
005D17  3  02 01 0D 3D  
005D30  3  3A 00 00 3B          .byte 58,0,0,59,57,58,23,0,23,3,1,255,0,11,59,58,0,0,0,45,255,0,8,3,1,255,0,6,40,39,0,0,59
005D34  3  39 3A 17 00  
005D38  3  17 03 01 FF  
005D51  3  39 3A 2E FF          .byte 57,58,46,255,0,12,23,1,255,0,6,40,40,255,0,19,2,255,0,6,17,255,0,20,1,17,255,0,4,74,16,255,0,20
005D55  3  00 0C 17 01  
005D59  3  FF 00 06 28  
005D73  3  03 0D FF 00          .byte 3,13,255,0,5,16,76,255,0,5,75,255,0,13,3,1,255,0,4,17,16,0,0,17,0,0,74,16,255,0,5,17,255,0,7
005D77  3  05 10 4C FF  
005D7B  3  00 05 4B FF  
005D96  3  17 02 00 00          .byte 23,2,0,0,0,74,16,16,76,0,16,76,0,0,16,76,17,0,0,0,16,0,75,255,0,5,23,1,0,0,17,0,16,16
005D9A  3  00 4A 10 10  
005D9E  3  4C 00 10 4C  
005DB8  3  00 11 10 00          .byte 0,17,16,0,0,17,16,0,16,0,0,74,16,17,16,255,0,5,3,2,13,61,16,0,16,16,0,16,16,19,61,16,16
005DBC  3  00 11 10 00  
005DC0  3  10 00 00 4A  
005DD9  3  00 10 00 00          .byte 0,16,0,0,61,16,16,16,76,0,0,54,54,23,3,1,255,13,22,0,54,54,0,23,7,255,1,4,3,1,1,1,2
005DDD  3  3D 10 10 10  
005DE1  3  4C 00 00 36  
005DFA  3  01 02 01 03          .byte 1,2,1,3,1,1,1,8,255,1,4,2,255,0,9,23,23,255,0,8,23,255,0,8
005DFE  3  01 01 01 08  
005E02  3  FF 01 04 02  
005E12  3  FF 00 0B 32          .byte 255,0,11,50,52,52,50,255,0,24,50,52,52,50,23,255,0,22,23,50,52,52,48,23,23,255,0,19,50,50,50,48,52,52
005E16  3  34 34 32 FF  
005E1A  3  00 18 32 34  
005E34  3  FF 32 04 FF          .byte 255,50,4,255,0,17,23,50,255,0,8,50,255,0,18,50,255,0,8,50,23,255,0,17,48,50,50,50,52,52,50,50,50
005E38  3  00 11 17 32  
005E3C  3  FF 00 08 32  
005E55  3  30 FF 00 13          .byte 48,255,0,19,23,23,50,52,52,50,23,255,0,6,23,255,0,16,48,52,52,50,255,0,4,23,0,23,23,23,255,0,14
005E59  3  17 17 32 34  
005E5D  3  34 32 17 FF  
005E76  3  17 32 34 34          .byte 23,50,52,52,48,0,0,255,50,4,48,255,50,4,255,0,13,50,52,52,50,23,0,50,255,0,4,39,39,17,50,255,0,13
005E7A  3  30 00 00 FF  
005E7E  3  32 04 30 FF  
005E98  3  32 34 34 32          .byte 50,52,52,50,0,0,50,255,0,4,39,39,0,48,23,255,0,9,255,50,4,52,52,50,23,23,48,0,0,255,50,4,48,48
005E9C  3  00 00 32 FF  
005EA0  3  00 04 27 27  
005EBA  3  FF 00 09 17          .byte 255,0,9,23,50,0,0,0,52,52,50,48,50,50,0,0,50,23,23,255,0,12,23,48,0,0,0,52,52,255,0,6,50
005EBE  3  32 00 00 00  
005EC2  3  34 34 32 30  
005EDB  3  17 FF 00 0E          .byte 23,255,0,14,50,19,19,0,52,52,255,0,6,48,255,0,15,255,50,4,52,52,0,0,17,255,50,4,255,0,8,54,54
005EDF  3  32 13 13 00  
005EE3  3  34 34 FF 00  
005EFC  3  FF 00 08 30          .byte 255,0,8,48,52,52,255,50,4,255,0,11,54,54,255,0,7,23,50,52,52,50,255,0,23,50,50,52,52,50,48,255,0,12
005F00  3  34 34 FF 32  
005F04  3  04 FF 00 0B  
005F1E  3  FF 00 0B 32          .byte 255,0,11,50,52,52,50,23,255,0,21,23,48,50,52,52,50,48,255,0,20,23,48,50,0,52,52,0,50,48,23,255,0,14
005F22  3  34 34 32 17  
005F26  3  FF 00 15 17  
005F40  3  17 00 17 17          .byte 23,0,23,23,48,50,0,0,52,52,0,0,50,48,23,0,0,0,23,255,0,8,255,50,4,48,50,0,0,0,52,52,0,0,0
005F44  3  30 32 00 00  
005F48  3  34 34 00 00  
005F63  3  FF 32 04 30          .byte 255,50,4,48,50,50,50,255,0,6,50,255,0,20,50,255,0,6,48,255,0,20,50,255,0,5,23,50,52,52,50,48,255,50,7
005F67  3  32 32 32 FF  
005F6B  3  00 06 32 FF  
005F86  3  30 32 30 FF          .byte 48,50,48,255,50,4,52,52,48,23,255,0,5,50,52,52,50,50,50,48,50,42,255,0,4,43,50,50,48,48,50,52,52
005F8A  3  32 04 34 34  
005F8E  3  30 17 FF 00  
005FA7  3  32 FF 00 06          .byte 50,255,0,6,50,255,0,8,44,39,38,44,255,0,8,48,255,0,6,50,255,0,8,51,39,38,49,255,0,8,50,23,255,0,5
005FAB  3  32 FF 00 08  
005FAF  3  2C 27 26 2C  
005FCA  3  32 34 34 32          .byte 50,52,52,50,48,50,50,42,0,255,50,4,0,43,48,50,50,50,52,52,50,23,255,0,5,50,52,52,50,42,255,0,12
005FCE  3  30 32 32 2A  
005FD2  3  00 FF 32 04  
005FEB  3  2B 32 34 34          .byte 43,50,52,52,50,255,0,5,23,48,52,52,255,0,16,52,52,50,255,0,6,50,52,52,255,0,5,51,0,38,38,0,49
005FEF  3  32 FF 00 05  
005FF3  3  17 30 34 34  
00600C  3  FF 00 05 34          .byte 255,0,5,52,52,50,255,0,5,23,50,52,52,255,0,5,50,31,38,38,31,50,255,0,5,52,52,48,255,0,6,50,52,52
006010  3  34 32 FF 00  
006014  3  05 17 32 34  
00602E  3  FF 00 05 32          .byte 255,0,5,50,255,20,4,50,17,0,38,38,0,52,52,50,255,0,4,54,54,48,52,52,0,0,19,19,0,50,255,68,4
006032  3  FF 14 04 32  
006036  3  11 00 26 26  
00604F  3  32 10 4C 00          .byte 50,16,76,0,0,0,52,52,50,23,0,0,0,54,54,255,50,4,48,255,50,7,48,50,50,50,48,48,255,50,4,255,0,13
006053  3  00 00 34 34  
006057  3  32 17 00 00  
006071  3  17 00 17 FF          .byte 23,0,23,255,0,6,23,23,255,0,7
006075  3  00 06 17 17  
006079  3  FF 00 07     
00607C  3  FF 2C 1C 00          .byte 255,44,28,0,0,0,45,255,0,5,46,255,0,15,45,0,46,255,0,27,44,255,0,18,7,5,5,5,57,58,0,0,46
006080  3  00 00 2D FF  
006084  3  00 05 2E FF  
00609D  3  2C 07 05 05          .byte 44,7,5,5,7,0,6,0,0,8,5,5,7,0,0,5,7,255,0,5,8,255,0,5,44,5,0,0,45,255,0,5,54,54
0060A1  3  07 00 06 00  
0060A5  3  00 08 05 05  
0060BF  3  FF 00 06 2D          .byte 255,0,6,45,255,0,7,59,57,57,5,38,38,0,0,5,0,0,5,54,54,5,0,0,5,255,0,12,44,5,38,38,0
0060C3  3  FF 00 07 3B  
0060C7  3  39 39 05 26  
0060E0  3  3B 3A FF 00          .byte 59,58,255,0,14,59,7,255,0,5,44,8,57,58,0,0,5,0,0,5,45,0,5,0,0,5,255,0,6,5,57,58,0,0
0060E4  3  0E 3B 07 FF  
0060E8  3  00 05 2C 08  
006102  3  2E 2C 05 FF          .byte 46,44,5,255,0,4,8,5,5,8,0,0,8,5,5,7,255,0,6,5,45,255,0,4,44,7,59,58,255,0,8,45,0,0,0
006106  3  00 04 08 05  
00610A  3  05 08 00 00  
006125  3  3B 39 3A 00          .byte 59,57,58,0,0,0,7,0,0,0,59,57,57,255,0,27,44,255,0,27,44,7,57,58,255,0,4,59,57,57,58,0,0,0
006129  3  00 00 07 00  
00612D  3  00 00 3B 39  
006147  3  3B 39 39 3A          .byte 59,57,57,58,59,57,57,7,57,58,0,0,0,44,5,0,45,255,0,7,46,255,0,11,46,255,0,4,44,5,255,0,5
00614B  3  3B 39 39 07  
00614F  3  39 3A 00 00  
006168  3  3B 39 3A FF          .byte 59,57,58,255,0,8,59,58,0,0,5,0,0,59,57,57,58,6,255,0,14,46,255,0,11,44,5,17,0,59,58,255,0,16
00616C  3  00 08 3B 3A  
006170  3  00 00 05 00  
00618A  3  08 FF 00 05          .byte 8,255,0,5,44,5,16,17,255,0,13,19,19,255,0,4,17,0,0,21,22,44,5,5,8,0,8,0,5,0,5,0,8
00618E  3  2C 05 10 11  
006192  3  FF 00 0D 13  
0061AB  3  00 08 00 08          .byte 0,8,0,8,0,5,0,7,0,7,5,5,5,7,21,22,8
0061AF  3  00 05 00 07  
0061B3  3  00 07 05 05  
0061BC  3  FF 2C 0B 18          .byte 255,44,11,24,25,24,25,24,25,255,44,11,0,0,45,255,0,4,46,0,0,0,255,47,6,0,0,45,46,0,0,0,45
0061C0  3  19 18 19 18  
0061C4  3  19 FF 2C 0B  
0061DD  3  FF 00 0E FF          .byte 255,0,14,255,47,6,255,0,22,255,47,6,255,0,11,8,5,5,7,255,0,4,45,38,38,24,25,24,25,24,25,38,38
0061E1  3  2F 06 FF 00  
0061E5  3  16 FF 2F 06  
0061FE  3  FF 00 05 07          .byte 255,0,5,7,5,8,5,7,42,0,43,5,7,0,0,31,38,38,43,42,43,42,43,42,38,38,31,0,0,7,5,42,0
006202  3  05 08 05 07  
006206  3  2A 00 2B 05  
00621F  3  2E 05 4B 00          .byte 46,5,75,0,0,45,0,43,8,5,255,20,12,5,5,42,0,0,45,0,5,13,0,0,0,46,0,43,255,5,14,42,255,0,5
006223  3  00 2D 00 2B  
006227  3  08 05 FF 14  
006242  3  08 01 0D FF          .byte 8,1,13,255,0,25,5,3,2,255,0,25,5,23,1,17,5,5,21,22,5,7,0,0,0,8,5,5,7,0,0,0,7
006246  3  00 19 05 03  
00624A  3  02 FF 00 19  
006263  3  05 05 07 15          .byte 5,5,7,21,22,7,5,8,23,1,16,76,0,21,22,43,5,0,0,0,5,42,43,5,0,0,0,5,42,43,5,21,22
006267  3  16 07 05 08  
00626B  3  17 01 10 4C  
006284  3  00 00 00 03          .byte 0,0,0,3,1,13,0,0,21,22,0,43,5,0,5,42,0,0,43,5,0,5,42,0,0,5,21,22,0,0,0,1,14
006288  3  01 0D 00 00  
00628C  3  15 16 00 2B  
0062A5  3  00 00 00 15          .byte 0,0,0,21,22,255,0,15,255,5,5,7,1,17,0,0,0,21,22,255,0,20,5,1,255,13,4,5,0,6,0,5,255,0,17
0062A9  3  16 FF 00 0F  
0062AD  3  FF 05 05 07  
0062C8  3  07 03 01 01          .byte 7,3,1,1,1,2,17,0,0,0,43,5,0,5,0,7,0,5,0,5,0,7,0,5,0,8,21,22,5,0,23,3,3
0062CC  3  01 02 11 00  
0062D0  3  00 00 2B 05  
0062E9  3  01 0D FF 00          .byte 1,13,255,0,19,21,22,5,0,0,0,23,3,2,255,0,19,21,22,6,0,0,23,23,3,1,0,5,0,53,0,7,0
0062ED  3  13 15 16 05  
0062F1  3  00 00 00 17  
00630A  3  05 00 08 00          .byte 5,0,8,0,7,0,5,0,5,0,8,0,5,0,5
00630E  3  07 00 05 00  
006312  3  05 00 08 00  
006319  3  FF 2C 10 00          .byte 255,44,16,0,0,0,255,44,10,54,54,255,0,9,46,255,0,14,44,44,54,54,45,255,0,20,46,0,0,44,44,255,0,15
00631D  3  00 00 FF 2C  
006321  3  0A 36 36 FF  
00633B  3  3B 39 3A FF          .byte 59,57,58,255,0,6,45,0,44,44,255,0,18,46,255,0,7,44,44,255,0,20,59,58,255,0,4,44,44,255,0,6,59
00633F  3  00 06 2D 00  
006343  3  2C 2C FF 00  
00635C  3  39 39 3A FF          .byte 57,57,58,255,0,16,44,44,38,38,255,0,24,44,44,38,38,255,0,21,59,57,58,44,44,255,0,6,45,255,0,6,59
006360  3  00 10 2C 2C  
006364  3  26 26 FF 00  
00637D  3  3A FF 00 0B          .byte 58,255,0,11,44,44,255,0,26,44,44,255,0,17,45,255,0,5,59,58,0,44,44,255,0,8,59,57,58,255,0,15,44,44
006381  3  2C 2C FF 00  
006385  3  1A 2C 2C FF  
00639F  3  2E FF 00 19          .byte 46,255,0,25,44,44,255,0,21,59,58,0,0,0,44,44,255,0,12,59,57,57,58,255,0,10,44,44,255,0,5,59,57
0063A3  3  2C 2C FF 00  
0063A7  3  15 3B 3A 00  
0063C0  3  3A 00 2E FF          .byte 58,0,46,255,0,14,45,0,44,44,255,0,26,44,59,58,21,22,255,0,8,53,255,0,14,44,44,59,21,22,57,58,255,0,21
0063C4  3  00 0E 2D 00  
0063C8  3  2C 2C FF 00  
0063E3  3  2C                   .byte 44
0063E4  3  FF 2C 0F FF          .byte 255,44,15,255,0,12,44,44,255,0,6,46,255,0,16,54,54,54,44,44,0,0,40,39,255,0,11,45,255,0,7,54,54,54
0063E8  3  00 0C 2C 2C  
0063EC  3  FF 00 06 2E  
006406  3  2C 2C 00 00          .byte 44,44,0,0,38,41,255,0,22,44,44,59,57,57,57,58,255,0,21,44,44,255,0,24,46,0,44,44,255,0,6,45,0,0,0
00640A  3  26 29 FF 00  
00640E  3  16 2C 2C 3B  
006429  3  3B 3A FF 00          .byte 59,58,255,0,7,45,255,0,6,44,44,255,0,26,44,44,255,0,20,19,19,255,0,4,44,44,0,0,45,255,0,10,59
00642D  3  07 2D FF 00  
006431  3  06 2C 2C FF  
00644A  3  3A FF 00 04          .byte 58,255,0,4,59,57,57,58,0,0,0,44,44,255,0,26,44,44,255,0,26,44,44,255,0,5,46,255,0,4,59,58,255,0,10
00644E  3  3B 39 39 3A  
006452  3  00 00 00 2C  
00646D  3  2D 00 00 00          .byte 45,0,0,0,44,44,255,0,26,44,44,0,0,0,59,57,57,58,255,0,19,44,44,255,0,26,44,44,0,0,46,255,0,9
006471  3  2C 2C FF 00  
006475  3  1A 2C 2C 00  
00648F  3  3B 39 39 3A          .byte 59,57,57,58,255,0,4,45,255,0,5,44,44,255,0,26,44,44,255,0,8,53,0,0,53,255,0,9,53,0,0,53,0
006493  3  FF 00 04 2D  
006497  3  FF 00 05 2C  
0064B0  3  2C 3B 39 39          .byte 44,59,57,57,58,59,57,58,255,0,9,59,57,58,255,0,8,44
0064B4  3  3A 3B 39 3A  
0064B8  3  FF 00 09 3B  
0064C2  3  FF 2C 0B 17          .byte 255,44,11,23,3,2,68,62,2,3,23,255,44,10,54,54,41,41,44,255,41,6,64,63,62,42,255,41,9,54,54,44,44
0064C6  3  03 02 44 3E  
0064CA  3  02 03 17 FF  
0064E3  3  36 36 FF 29          .byte 54,54,255,41,8,64,63,62,42,255,41,10,54,54,44,44,44,255,41,8,64,63,1,3,23,255,44,6,41,41,41,255,44,5
0064E7  3  08 40 3F 3E  
0064EB  3  2A FF 29 0A  
006505  3  FF 29 08 40          .byte 255,41,8,64,3,1,44,0,0,44,255,41,8,44,0,0,44,44,255,41,4,44,44,44,23,23,44,255,0,4,44,255,41,8
006509  3  03 01 2C 00  
00650D  3  00 2C FF 29  
006527  3  2C 00 00 2C          .byte 44,0,0,44,44,255,41,4,44,255,0,9,44,41,41,41,255,44,6,0,0,44,44,41,41,41,44,44,255,0,9,44,41,41,41
00652B  3  2C FF 29 04  
00652F  3  2C FF 00 09  
00654A  3  2C FF 00 07          .byte 44,255,0,7,44,44,255,41,4,44,0,255,44,9,41,41,41,44,23,44,23,23,3,1,1,2,44,255,41,4,44,0,66
00654E  3  2C 2C FF 29  
006552  3  04 2C 00 FF  
00656B  3  29 26 26 FF          .byte 41,38,38,255,41,12,64,63,62,62,62,44,44,41,41,41,44,0,66,38,38,38,31,38,255,41,9,64,63,255,62,4,44
00656F  3  29 0C 40 3F  
006573  3  3E 3E 3E 2C  
00658C  3  FF 29 04 2C          .byte 255,41,4,44,0,44,66,47,47,47,65,41,41,41,255,44,4,23,44,23,23,3,1,1,2,44,255,41,4,44,0,0,44
006590  3  00 2C 42 2F  
006594  3  2F 2F 41 29  
0065AD  3  43 43 43 2C          .byte 67,67,67,44,44,41,41,44,255,0,11,44,41,41,41,44,44,0,255,44,6,41,41,41,255,44,10,0,0,44,255,41,4
0065B1  3  2C 29 29 2C  
0065B5  3  FF 00 0B 2C  
0065CE  3  2C 00 2C FF          .byte 44,0,44,255,41,15,54,54,44,0,0,44,255,41,4,44,0,44,255,41,15,54,54,44,0,0,44,66,38,38,38,44,44,44
0065D2  3  29 0F 36 36  
0065D6  3  2C 00 00 2C  
0065F0  3  26 26 26 41          .byte 38,38,38,65,255,44,6,255,41,5,44,44,44,0,0,66,31,31,38,38,255,31,5,38,65,255,0,5,255,44,7,255,0,4
0065F4  3  FF 2C 06 FF  
0065F8  3  29 05 2C 2C  
006612  3  42 FF 2F 09          .byte 66,255,47,9,65,44,255,0,16,44,255,67,9,255,0,18
006616  3  41 2C FF 00  
00661A  3  10 2C FF 43  
006622  3  03 01 0D 00          .byte 3,1,13,0,71,0,255,71,4,6,21,22,6,71,71,255,0,12,23,3,1,13,255,9,6,18,21,22,18,9,10,255,0,13
006626  3  47 00 FF 47  
00662A  3  04 06 15 16  
006644  3  17 03 01 00          .byte 23,3,1,0,6,0,0,6,0,7,21,22,5,0,11,71,71,46,71,71,71,255,0,8,3,2,255,0,4,70,0,0,21
006648  3  06 00 00 06  
00664C  3  00 07 15 16  
006665  3  16 00 00 0C          .byte 22,0,0,12,255,9,6,10,255,0,7,1,1,0,0,0,45,0,0,0,21,22,7,255,0,5,44,44,0,11,255,0,6
006669  3  FF 09 06 0A  
00666D  3  FF 00 07 01  
006686  3  17 01 0E FF          .byte 23,1,14,255,0,7,21,22,255,0,9,11,255,0,5,23,3,2,0,45,255,0,6,21,22,5,0,8,0,8,0,0,0
00668A  3  00 07 15 16  
00668E  3  FF 00 09 0B  
0066A7  3  05 0B 08 00          .byte 5,11,8,0,5,0,26,3,3,1,255,0,8,21,22,0,45,255,0,7,11,255,0,4,53,2,1,14,255,0,8,21,22
0066AB  3  05 00 1A 03  
0066AF  3  03 01 FF 00  
0066C8  3  FF 00 08 2E          .byte 255,0,8,46,11,255,0,27,11,255,0,10,17,255,0,16,11,255,0,4,53,255,13,4,5,16,8,0,5,0,7,21,22
0066CC  3  0B FF 00 1B  
0066D0  3  0B FF 00 0A  
0066E9  3  07 00 08 00          .byte 7,0,8,0,7,0,8,0,8,11,7,0,5,0,26,1,2,1,1,13,16,255,0,4,5,21,22,255,0,9,12,255,9,5
0066ED  3  07 00 08 00  
0066F1  3  08 0B 07 00  
00670B  3  03 03 03 02          .byte 3,3,3,2,1,16,76,0,0,0,7,21,22,5,255,0,14,23,0,23,3,1,13,255,0,5,21,22,255,0,6,46,0,0,0
00670F  3  01 10 4C 00  
006713  3  00 00 07 15  
00672E  3  2D FF 00 07          .byte 45,255,0,7,23,3,1,255,0,4,7,21,22,8,255,0,15,23,3,2,1,14,255,0,4,5,21,22,255,0,4,45,255,0,10
006732  3  17 03 01 FF  
006736  3  00 04 07 15  
006751  3  17 03 01 0E          .byte 23,3,1,14,0,0,0,46,0,0,0,21,22,5,255,0,4,45,34,35,255,0,7,3,2,14,0,0,0,45,0,0,0
006755  3  00 00 00 2E  
006759  3  00 00 00 15  
006772  3  08 15 16 FF          .byte 8,21,22,255,0,5,24,77,78,25,255,0,6,1,14,255,0,8,5,21,22,5,255,0,5,77,78,255,0,7
006776  3  00 05 18 4D  
00677A  3  4E 19 FF 00  
006790  3  FF 00 04 2D          .byte 255,0,4,45,255,0,37,46,255,0,7,255,6,5,255,0,21,46,0,6,70,70,19,6,255,0,7,46,0,0,0,71,0,0,0
006794  3  FF 00 25 2E  
006798  3  FF 00 07 FF  
0067B3  3  47 00 00 00          .byte 71,0,0,0,71,0,71,71,6,19,19,0,6,255,0,11,6,0,6,0,6,0,6,0,6,0,6,24,25,19,19,19,6
0067B7  3  47 00 47 47  
0067BB  3  06 13 13 00  
0067D4  3  FF 00 0B 46          .byte 255,0,11,70,255,0,11,69,38,38,19,6,255,0,11,6,0,0,71,71,0,71,0,19,19,71,0,69,38,38,71,6,0,0,0
0067D8  3  FF 00 0B 45  
0067DC  3  26 26 13 06  
0067F7  3  2E FF 00 08          .byte 46,255,0,8,21,22,6,6,0,6,0,6,6,6,24,25,255,6,4,255,0,11,6,21,22,6,0,0,70,0,0,0,70
0067FB  3  15 16 06 06  
0067FF  3  00 06 00 06  
006818  3  0B 0B 00 00          .byte 11,11,0,0,70,255,0,9,45,0,0,0,21,22,255,0,7,45,12,11,18,9,10,255,0,8,71,0,71,0,6,21,22
00681C  3  46 FF 00 09  
006820  3  2D 00 00 00  
006839  3  06 00 47 FF          .byte 6,0,71,255,0,6,12,255,9,5,255,0,6,255,6,5,21,22,6,6,6,255,0,6,46,0,0,12,9,9,255,0,6
00683D  3  00 06 0C FF  
006841  3  09 05 FF 00  
00685A  3  06 00 00 46          .byte 6,0,0,70,255,0,4,70,6,255,0,13,45,255,0,4,6,255,71,4,0,0,71,71,6,255,0,18,255,6,5,21,22
00685E  3  FF 00 04 46  
006862  3  06 FF 00 0D  
00687B  3  06 06 06 FF          .byte 6,6,6,255,0,19,70,0,0,6,21,22,6,0,70,255,0,10,45,255,0,5,46,255,0,6,21,22,70,0,0,46,255,0,12
00687F  3  00 13 46 00  
006883  3  00 06 15 16  
00689E  3  36 36 FF 00          .byte 54,54,255,0,7,6,21,22,6,255,0,6,46,255,0,8,54,54,255,0,8,21,22,255,0,25,6,21,22,6,255,0,14
0068A2  3  07 06 15 16  
0068A6  3  06 FF 00 06  
0068BF  3  FF 00 17 0B          .byte 255,0,23,11,255,0,9,46,255,0,17,11,255,0,21,45,255,0,5,11,255,0,9,44,0,44,0,44,0,44,0,44,0
0068C3  3  FF 00 09 2E  
0068C7  3  FF 00 11 0B  
0068E0  3  2C 00 2C 00          .byte 44,0,44,0,44,0,0,0,11,255,0,27,11,255,0,27,11,255,0,4,5,0,7,0,5,255,0,15,7,0,5,11,5
0068E4  3  2C 00 00 00  
0068E8  3  0B FF 00 1B  
006901  3  00 05 FF 00          .byte 0,5,255,0,24,12,10,255,0,27,11,255,0,27,11,255,0,27,12,10,0,0,5,0,59,57,58,0,5,0,5,0,5
006905  3  18 0C 0A FF  
006909  3  00 1B 0B FF  
006922  3  00 08 00 06          .byte 0,8,0,6,0,7,0,5,0,5,0,0,0,7,11,5,0,18,255,9,12,10,255,0,11,12,9,9,7,0,59,58,255,0,9
006926  3  00 07 00 05  
00692A  3  00 05 00 00  
006945  3  0C FF 09 09          .byte 12,255,9,9,18,5,18,9,9,255,0,4,45,255,0,18,6,45,0,0,0,5,0,59,58,255,0,20,5,255,0,13,45
006949  3  12 05 12 09  
00694D  3  09 FF 00 04  
006966  3  FF 00 11 08          .byte 255,0,17,8,0,5,0,7,0,5,0,5,0,8,0,5,0,7,0,5,0,7,0,5,0,8,0,7,255,0,17,46,255,0,41
00696A  3  00 05 00 07  
00696E  3  00 05 00 05  
006989  3  FF 00 19 0B          .byte 255,0,25,11,255,0,4,45,255,0,19,46,0,0,11,255,0,27,11,255,0,27,11,255,0,8,44,255,0,8,45,255,0,4
00698D  3  FF 00 04 2D  
006991  3  FF 00 13 2E  
0069AB  3  2C FF 00 04          .byte 44,255,0,4,11,255,0,14,34,35,255,0,11,11,0,0,5,0,7,0,5,0,0,0,5,0,5,8,24,25,5,0,5
0069AF  3  0B FF 00 0E  
0069B3  3  22 23 FF 00  
0069CC  3  00 05 00 00          .byte 0,5,0,0,0,5,0,5,11,5,255,0,5,53,0,0,0,53,0,0,5,24,25,8,0,0,0,53,0,0,0,53,0,0
0069D0  3  00 05 00 05  
0069D4  3  0B 05 FF 00  
0069EE  3  0B FF 00 0D          .byte 11,255,0,13,26,24,25,26,255,0,10,11,255,0,14,29,29,255,0,11,11,255,0,10,19,19,0,0,29,29,255,0,11
0069F2  3  1A 18 19 1A  
0069F6  3  FF 00 0A 0B  
006A0F  3  0B 00 00 05          .byte 11,0,0,5,0,5,0,7,0,5,0,5,7,5,26,24,25,26,0,7,0,5,0,5,0,8,0,7,11,5,0,255,9,12
006A13  3  00 05 00 07  
006A17  3  00 05 00 05  
006A31  3  12 0B FF 00          .byte 18,11,255,0,11,12,9,9,9,10,255,0,11,12,255,9,14,0,11,255,0,13,45,255,0,13,11,0,0,45,255,0,24
006A35  3  0B 0C 09 09  
006A39  3  09 0A FF 00  
006A52  3  0B FF 00 0B          .byte 11,255,0,11,46,255,0,15,11,255,0,22,45,255,0,4,11,255,0,27,11,255,0,26
006A56  3  2E FF 00 0F  
006A5A  3  0B FF 00 16  
006A6A  3  FF 00 15 18          .byte 255,0,21,24,25,255,0,14,45,255,0,11,77,78,255,0,15,46,0,0,0,44,255,0,6,24,25,255,0,7,45,255,0,18
006A6E  3  19 FF 00 0E  
006A72  3  2D FF 00 0B  
006A8C  3  27 26 00 00          .byte 39,38,0,0,0,45,255,0,22,39,38,255,0,24,7,7,24,25,7,7,0,0,0,48,0,48,0,48,0,68,0,48,0
006A90  3  00 2D FF 00  
006A94  3  16 27 26 FF  
006AAD  3  44 00 44 00          .byte 68,0,68,0,0,8,255,7,4,42,77,78,0,7,255,0,24,43,42,0,26,255,0,24,38,0,0,4,255,0,27,27,255,0,24
006AB1  3  00 08 FF 07  
006AB5  3  04 2A 4D 4E  
006AD0  3  22 23 00 07          .byte 34,35,0,7,0,0,0,48,0,48,0,48,0,68,0,48,0,68,0,68,0,0,8,255,7,5,24,25,7,42,0,0,0
006AD4  3  00 00 00 30  
006AD8  3  00 30 00 30  
006AF1  3  FF 09 0C 0A          .byte 255,9,12,10,0,0,0,12,9,9,9,18,11,11,255,0,5,9,9,10,255,0,9,11,255,0,8,11,11,0,0,0,45
006AF5  3  00 00 00 0C  
006AF9  3  09 09 09 12  
006B12  3  00 00 00 0B          .byte 0,0,0,11,255,0,14,46,0,0,0,12,11,10,0,45,255,0,4,11,255,0,11,44,255,0,7,11,11,255,0,6,11
006B16  3  FF 00 0E 2E  
006B1A  3  00 00 00 0C  
006B33  3  FF 00 13 0B          .byte 255,0,19,11,11,255,0,20,45,255,0,5,11,11,255,0,10,46,255,0,15,11,12,9,9,10,255,0,23,11,0,0,0
006B37  3  0B FF 00 14  
006B3B  3  2D FF 00 05  
006B54  3  0B 00                .byte 11,0
006B56  3  FF 00 05 2E          .byte 255,0,5,46,255,0,6,45,0,45,255,0,5,39,255,0,27,39,0,0,46,255,0,24,11,255,0,6,45,57,58,255,0,15
006B5A  3  FF 00 06 2D  
006B5E  3  00 2D FF 00  
006B78  3  2E 00 00 0B          .byte 46,0,0,11,0,71,71,71,34,35,71,0,0,0,59,57,57,58,0,45,0,0,55,75,73,255,0,6,11,71,1,1,1
006B7C  3  00 47 47 47  
006B80  3  22 23 47 00  
006B99  3  18 19 01 FF          .byte 24,25,1,255,0,12,17,0,0,0,46,0,0,0,11,1,14,0,0,77,78,255,0,4,46,255,0,7,55,16,0,0,59
006B9D  3  00 0C 11 00  
006BA1  3  00 00 2E 00  
006BBA  3  3A 00 00 47          .byte 58,0,0,71,1,14,23,23,0,77,78,0,72,73,255,0,5,45,55,72,73,0,16,255,0,5,71,1,12,9,9,10,0
006BBE  3  01 0E 17 17  
006BC2  3  00 4D 4E 00  
006BDB  3  18 19 17 11          .byte 24,25,23,17,255,0,8,17,0,74,16,73,255,0,4,1,14,0,23,0,11,0,15,14,0,16,73,255,0,6,74,16,0,0
006BDF  3  FF 00 08 11  
006BE3  3  00 4A 10 49  
006BFD  3  10 00 2D 4B          .byte 16,0,45,75,0,64,1,0,23,0,0,11,255,0,4,16,255,0,6,61,0,16,73,0,16,76,0,61,0,15,1,255,0,4
006C01  3  00 40 01 00  
006C05  3  17 00 00 0B  
006C1F  3  0B FF 00 04          .byte 11,255,0,4,16,61,0,34,35,0,0,61,13,16,0,0,16,0,0,17,0,0,69,255,0,4,11,255,0,4,16,61,37
006C23  3  10 3D 00 22  
006C27  3  23 00 00 3D  
006C40  3  20 21 24 0D          .byte 32,33,36,13,13,1,13,17,61,16,0,0,16,61,0,69,255,0,4,11,0,0,21,22,13,13,24,25,24,25,1,1,3
006C44  3  0D 01 0D 11  
006C48  3  3D 10 00 00  
006C61  3  01 FF 0D 10          .byte 1,255,13,16,21,22,1,1,1,2,1,1,3,3,23,3,1,1,2,1,1,1,2,2,255,1,6,2,1,21,22,3,3
006C65  3  15 16 01 01  
006C69  3  01 02 01 01  
006C82  3  01 01 03 FF          .byte 1,1,3,255,54,4,255,3,14,11,3,1,21,22,23,23,3,3,44,255,54,4,44,23,23,23,0,0,23,0,23,23,0
006C86  3  36 04 FF 03  
006C8A  3  0E 0B 03 01  
006CA3  3  17 00 17 0B          .byte 23,0,23,11,3,2,21,22,0,0,23,23,255,44,6,255,0,4,23,255,0,8,11,3,2,21,22,255,0,6,23,255,0,14
006CA7  3  03 02 15 16  
006CAB  3  00 00 17 17  
006CC5  3  17 00 0B 03          .byte 23,0,11,3,2,21,22,255,0,23,11,3,1,21,22
006CC9  3  02 15 16 FF  
006CCD  3  00 17 0B 03  
006CD4  3               numsc:
006CD4  3  1C                   .byte 28
006CD5  3               .out .sprintf("SCREENS SIZE = %d", (* - scdat))
006CD5  3               
006CD5  3               nmedat:
006CD5  3  00 5A 70 48          .byte 0,90,112,72,4,3,72,176,6,4,40,208,2,5,64,192,255
006CD9  3  04 03 48 B0  
006CDD  3  06 04 28 D0  
006CE6  3  06 04 48 98          .byte 6,4,72,152,0,0,16,176,5,5,120,144,255
006CEA  3  00 00 10 B0  
006CEE  3  05 05 78 90  
006CF3  3  06 04 20 88          .byte 6,4,32,136,4,6,120,144,0,0,56,80,1,7,128,112,1,7,128,160,255
006CF7  3  04 06 78 90  
006CFB  3  00 00 38 50  
006D08  3  00 00 88 58          .byte 0,0,136,88,4,3,72,152,4,6,96,112,255
006D0C  3  04 03 48 98  
006D10  3  04 06 60 70  
006D15  3  00 00 40 18          .byte 0,0,64,24,6,4,80,152,2,5,40,88,255
006D19  3  06 04 50 98  
006D1D  3  02 05 28 58  
006D22  3  00 00 20 A8          .byte 0,0,32,168,2,5,32,136,5,5,120,72,1,10,104,96,255
006D26  3  02 05 20 88  
006D2A  3  05 05 78 48  
006D33  3  00 00 50 20          .byte 0,0,80,32,6,6,104,168,4,3,8,192,4,6,72,144,1,7,128,64,1,7,128,176,255
006D37  3  06 06 68 A8  
006D3B  3  04 03 08 C0  
006D4C  3  00 00 20 20          .byte 0,0,32,32,4,3,88,56,4,3,24,184,255
006D50  3  04 03 58 38  
006D54  3  04 03 18 B8  
006D59  3  00 00 48 20          .byte 0,0,72,32,6,4,32,104,4,6,16,128,255
006D5D  3  06 04 20 68  
006D61  3  04 06 10 80  
006D66  3  00 00 08 50          .byte 0,0,8,80,2,5,32,56,1,7,128,80,1,7,128,192,6,4,56,136,255
006D6A  3  02 05 20 38  
006D6E  3  01 07 80 50  
006D7B  3  00 00 78 40          .byte 0,0,120,64,2,5,16,112,1,9,80,104,1,9,48,112,255
006D7F  3  02 05 10 70  
006D83  3  01 09 50 68  
006D8C  3  00 00 78 D8          .byte 0,0,120,216,4,3,24,128,2,5,16,192,1,10,72,160,1,10,88,160,1,10,104,160,1,10,120,160,255
006D90  3  04 03 18 80  
006D94  3  02 05 10 C0  
006DA9  3  00 00 78 D8          .byte 0,0,120,216,1,7,120,104,1,7,120,128,4,6,16,120,255
006DAD  3  01 07 78 68  
006DB1  3  01 07 78 80  
006DBA  3  00 00 78 D8          .byte 0,0,120,216,4,3,48,112,2,5,120,96,255
006DBE  3  04 03 30 70  
006DC2  3  02 05 78 60  
006DC7  3  00 00 78 B0          .byte 0,0,120,176,2,5,120,128,255
006DCB  3  02 05 78 80  
006DCF  3  FF           
006DD0  3  00 00 08 70          .byte 0,0,8,112,3,3,32,88,3,3,32,136,2,5,112,88,255
006DD4  3  03 03 20 58  
006DD8  3  03 03 20 88  
006DE1  3  00 00 10 70          .byte 0,0,16,112,6,3,40,48,1,7,112,120,2,5,128,80,6,8,72,80,6,8,72,160,255
006DE5  3  06 03 28 30  
006DE9  3  01 07 70 78  
006DFA  3  00 00 80 D8          .byte 0,0,128,216,2,5,136,144,6,4,88,112,4,3,8,64,4,6,40,112,255
006DFE  3  02 05 88 90  
006E02  3  06 04 58 70  
006E0F  3  00 00 10 D8          .byte 0,0,16,216,1,7,32,88,1,7,32,152,6,6,8,80,6,8,64,120,6,4,104,168,255
006E13  3  01 07 20 58  
006E17  3  01 07 20 98  
006E28  3  00 00 50 60          .byte 0,0,80,96,6,4,56,184,6,6,104,160,255
006E2C  3  06 04 38 B8  
006E30  3  06 06 68 A0  
006E35  3  00 00 88 90          .byte 0,0,136,144,2,5,56,184,6,3,80,128,255
006E39  3  02 05 38 B8  
006E3D  3  06 03 50 80  
006E42  3  00 00 48 D0          .byte 0,0,72,208,1,7,72,88,1,7,128,40,255
006E46  3  01 07 48 58  
006E4A  3  01 07 80 28  
006E4F  3  00 00 48 70          .byte 0,0,72,112,4,3,72,160,255
006E53  3  04 03 48 A0  
006E57  3  FF           
006E58  3  00 00 28 68          .byte 0,0,40,104,6,3,96,104,2,5,40,160,255
006E5C  3  06 03 60 68  
006E60  3  02 05 28 A0  
006E65  3  00 00 48 20          .byte 0,0,72,32,4,8,40,56,4,8,56,72,4,8,72,88,4,8,40,128,4,8,56,144,4,8,72,160,255
006E69  3  04 08 28 38  
006E6D  3  04 08 38 48  
006E82  3  00 00 48 20          .byte 0,0,72,32,5,5,72,80,4,8,40,56,4,8,40,168,255
006E86  3  05 05 48 50  
006E8A  3  04 08 28 38  
006E93  3  00 00 48 20          .byte 0,0,72,32,4,8,24,120,4,8,104,120,1,10,24,184,255
006E97  3  04 08 18 78  
006E9B  3  04 08 68 78  
006EA4  3  00 00 78 40          .byte 0,0,120,64,1,9,0,168,1,1,88,176,255
006EA8  3  01 09 00 A8  
006EAC  3  01 01 58 B0  
006EB1  3               .out .sprintf("POSITIONS SIZE = %d", (* - nmedat))
006EB1  3               
006EB1  3               NUMOBJ = 20
006EB1  3               objdta:
006EB1  3  3F C0 40 20          .byte 63,192,64,32,95,208,95,232,95,244,81,244,84,20,81,148,95,244,95,244,64,4,127,252,42,168,127,252,127,252,0,0,0,128,208,0,128,208
006EB5  3  5F D0 5F E8  
006EB9  3  5F F4 51 F4  
006ED7  3  01 80 02 C0          .byte 1,128,2,192,7,96,14,208,31,248,30,200,31,72,30,200,39,252,79,254,79,234,37,84,0,0,79,254,155,109,159,255,1,56,56,1,56,56
006EDB  3  07 60 0E D0  
006EDF  3  1F F8 1E C8  
006EFD  3  01 80 02 C0          .byte 1,128,2,192,7,96,14,208,31,248,30,200,31,72,30,200,39,252,79,254,79,234,37,84,0,0,79,254,155,109,159,255,254,0,16,254,0,16
006F01  3  07 60 0E D0  
006F05  3  1F F8 1E C8  
006F23  3  01 80 02 C0          .byte 1,128,2,192,7,96,14,208,31,248,30,200,31,72,30,200,39,252,79,254,79,234,37,84,0,0,79,254,155,109,159,255,7,32,168,7,32,168
006F27  3  07 60 0E D0  
006F2B  3  1F F8 1E C8  
006F49  3  3F C0 40 20          .byte 63,192,64,32,95,208,95,232,95,244,81,244,84,20,81,148,95,244,95,244,64,4,127,252,42,168,127,252,127,252,0,0,23,40,200,23,40,200
006F4D  3  5F D0 5F E8  
006F51  3  5F F4 51 F4  
006F6F  3  3F C0 40 20          .byte 63,192,64,32,95,208,95,232,95,244,81,244,84,20,81,148,95,244,95,244,64,4,127,252,42,168,127,252,127,252,0,0,15,80,192,15,80,192
006F73  3  5F D0 5F E8  
006F77  3  5F F4 51 F4  
006F95  3  00 04 00 0C          .byte 0,4,0,12,0,0,1,254,0,170,0,0,64,12,96,12,96,12,96,12,0,0,255,254,170,170,0,0,96,12,96,12,9,8,104,9,8,104
006F99  3  00 00 01 FE  
006F9D  3  00 AA 00 00  
006FBB  3  0F 00 11 80          .byte 15,0,17,128,0,0,2,192,2,192,7,224,27,248,39,252,88,126,121,62,120,122,121,54,121,42,56,84,30,184,7,224,6,104,176,6,104,176
006FBF  3  00 00 02 C0  
006FC3  3  02 C0 07 E0  
006FE1  3  01 00 03 80          .byte 1,0,3,128,7,64,11,160,23,80,47,168,127,84,255,250,85,84,43,168,21,80,11,160,5,64,2,128,1,0,0,0,20,16,40,20,16,40
006FE5  3  07 40 0B A0  
006FE9  3  17 50 2F A8  
007007  3  07 C0 1B B0          .byte 7,192,27,176,61,120,102,204,99,140,97,12,83,148,46,232,20,80,77,100,111,236,53,88,112,28,5,64,123,188,252,126,13,24,208,13,24,208
00700B  3  3D 78 66 CC  
00700F  3  63 8C 61 0C  
00702D  3  07 00 34 00          .byte 7,0,52,0,119,4,244,8,174,12,232,26,238,112,245,192,214,133,187,85,221,223,174,112,87,142,74,250,53,84,15,248,14,64,96,14,64,96
007031  3  77 04 F4 08  
007035  3  AE 0C E8 1A  
007053  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,28,0,46,0,126,0,93,0,235,0,209,0,170,0,124,0,7,32,88,7,32,88
007057  3  00 00 00 00  
00705B  3  00 00 00 00  
007079  3  00 00 00 00          .byte 0,0,0,0,3,192,7,224,1,128,63,252,76,50,93,186,113,142,119,238,119,238,113,142,93,186,76,50,63,252,0,0,17,48,24,17,48,24
00707D  3  03 C0 07 E0  
007081  3  01 80 3F FC  
00709F  3  00 00 00 00          .byte 0,0,0,0,3,192,7,224,1,128,63,252,76,50,93,186,113,142,119,238,119,238,113,142,93,186,76,50,63,252,0,0,19,56,24,19,56,24
0070A3  3  03 C0 07 E0  
0070A7  3  01 80 3F FC  
0070C5  3  00 00 01 80          .byte 0,0,1,128,7,224,9,112,19,248,19,152,63,188,57,244,121,190,79,254,94,226,127,194,95,194,43,196,149,91,98,166,254,0,16,254,0,16
0070C9  3  07 E0 09 70  
0070CD  3  13 F8 13 98  
0070EB  3  07 C0 09 E0          .byte 7,192,9,224,25,240,23,240,31,240,31,176,15,32,7,192,1,0,1,0,0,128,0,128,0,64,2,32,5,32,0,192,10,40,136,10,40,136
0070EF  3  19 F0 17 F0  
0070F3  3  1F F0 1F B0  
007111  3  00 00 78 00          .byte 0,0,120,0,30,0,7,0,3,160,1,80,0,224,1,80,3,184,7,28,14,12,20,6,40,6,80,2,160,2,64,0,21,8,216,21,8,216
007115  3  1E 00 07 00  
007119  3  03 A0 01 50  
007137  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,254,254,234,234,212,212,170,170,212,212,170,170,212,212,14,16,24,14,16,24
00713B  3  00 00 00 00  
00713F  3  00 00 00 00  
00715D  3  00 00 00 00          .byte 0,0,0,0,0,0,0,8,55,228,85,122,79,245,86,122,53,164,3,200,4,32,13,176,16,8,53,172,49,140,31,248,6,24,64,6,24,64
007161  3  00 00 00 08  
007165  3  37 E4 55 7A  
007183  3  78 00 84 00          .byte 120,0,132,0,165,80,133,88,132,0,120,26,128,2,192,127,199,201,207,201,204,127,205,89,204,111,237,217,109,239,12,127,26,64,184,26,64,184
007187  3  A5 50 85 58  
00718B  3  84 00 78 1A  
0071A9  3               .out .sprintf("OBJECTS SIZE = %d", (* - objdta))
0071A9  3               
0071A9  3               font:
0071A9  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0
0071AD  3  00 00 00 00  
0071B1  3  00 30 78 78          .byte 0,48,120,120,48,48,0,48
0071B5  3  30 30 00 30  
0071B9  3  00 18 06 06          .byte 0,24,6,6,9,17,32,64
0071BD  3  09 11 20 40  
0071C1  3  18 34 3C 5E          .byte 24,52,60,94,126,114,114,60
0071C5  3  7E 72 72 3C  
0071C9  3  00 5E 7E 7E          .byte 0,94,126,126,42,82,4,120
0071CD  3  2A 52 04 78  
0071D1  3  02 02 0E 42          .byte 2,2,14,66,126,66,126,66
0071D5  3  7E 42 7E 42  
0071D9  3  7E BD 99 5A          .byte 126,189,153,90,36,60,0,24
0071DD  3  24 3C 00 18  
0071E1  3  7C B9 F6 E8          .byte 124,185,246,232,213,239,189,126
0071E5  3  D5 EF BD 7E  
0071E9  3  00 0C 18 18          .byte 0,12,24,24,24,24,12,0
0071ED  3  18 18 0C 00  
0071F1  3  00 60 30 30          .byte 0,96,48,48,48,48,96,0
0071F5  3  30 30 60 00  
0071F9  3  18 34 72 FF          .byte 24,52,114,255,149,90,52,24
0071FD  3  95 5A 34 18  
007201  3  1C 3E 7F 7F          .byte 28,62,127,127,87,71,71,62
007205  3  57 47 47 3E  
007209  3  00 00 00 00          .byte 0,0,0,0,0,24,24,48
00720D  3  00 18 18 30  
007211  3  00 00 00 00          .byte 0,0,0,0,126,0,0,0
007215  3  7E 00 00 00  
007219  3  00 00 00 00          .byte 0,0,0,0,0,0,16,0
00721D  3  00 00 10 00  
007221  3  38 7C FE FE          .byte 56,124,254,254,234,226,226,124
007225  3  EA E2 E2 7C  
007229  3  7C FE CE D6          .byte 124,254,206,214,230,254,124,0
00722D  3  E6 FE 7C 00  
007231  3  18 78 78 18          .byte 24,120,120,24,24,126,126,0
007235  3  18 7E 7E 00  
007239  3  FC FE 06 7C          .byte 252,254,6,124,192,254,254,0
00723D  3  C0 FE FE 00  
007241  3  FC FE 06 3E          .byte 252,254,6,62,6,254,252,0
007245  3  06 FE FC 00  
007249  3  D8 D8 D8 D8          .byte 216,216,216,216,254,254,24,0
00724D  3  FE FE 18 00  
007251  3  FE FE C0 FC          .byte 254,254,192,252,6,254,252,0
007255  3  06 FE FC 00  
007259  3  7C FC C0 FC          .byte 124,252,192,252,198,254,124,0
00725D  3  C6 FE 7C 00  
007261  3  FE FE 06 0E          .byte 254,254,6,14,28,24,24,0
007265  3  1C 18 18 00  
007269  3  7C FE C6 7C          .byte 124,254,198,124,198,254,124,0
00726D  3  C6 FE 7C 00  
007271  3  7C FE C6 FE          .byte 124,254,198,254,126,6,6,0
007275  3  7E 06 06 00  
007279  3  00 00 00 30          .byte 0,0,0,48,0,0,48,0
00727D  3  00 00 30 00  
007281  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0
007285  3  00 00 00 00  
007289  3  78 7C 7E 7E          .byte 120,124,126,126,126,66,66,126
00728D  3  7E 42 42 7E  
007291  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0
007295  3  00 00 00 00  
007299  3  00 18 34 24          .byte 0,24,52,36,126,171,126,36
00729D  3  7E AB 7E 24  
0072A1  3  3C 0E 07 07          .byte 60,14,7,7,7,7,14,60
0072A5  3  07 07 0E 3C  
0072A9  3  00 4E 56 4E          .byte 0,78,86,78,86,78,86,74
0072AD  3  56 4E 56 4A  
0072B1  3  3C 7E 06 7E          .byte 60,126,6,126,126,102,102,0
0072B5  3  7E 66 66 00  
0072B9  3  78 7E 06 7C          .byte 120,126,6,124,102,126,124,0
0072BD  3  66 7E 7C 00  
0072C1  3  3E 7E 00 60          .byte 62,126,0,96,96,126,62,0
0072C5  3  60 7E 3E 00  
0072C9  3  7C 7E 06 66          .byte 124,126,6,102,102,126,124,0
0072CD  3  66 7E 7C 00  
0072D1  3  3E 7E 00 7C          .byte 62,126,0,124,96,126,62,0
0072D5  3  60 7E 3E 00  
0072D9  3  3E 7E 00 7C          .byte 62,126,0,124,96,96,96,0
0072DD  3  60 60 60 00  
0072E1  3  3E 7E 00 6E          .byte 62,126,0,110,102,126,62,0
0072E5  3  66 7E 3E 00  
0072E9  3  66 66 06 7E          .byte 102,102,6,126,102,102,102,0
0072ED  3  66 66 66 00  
0072F1  3  7E 7E 00 18          .byte 126,126,0,24,24,126,126,0
0072F5  3  18 7E 7E 00  
0072F9  3  06 06 00 06          .byte 6,6,0,6,6,126,124,0
0072FD  3  06 7E 7C 00  
007301  3  66 6E 1C 78          .byte 102,110,28,120,124,110,102,0
007305  3  7C 6E 66 00  
007309  3  60 60 00 60          .byte 96,96,0,96,96,126,62,0
00730D  3  60 7E 3E 00  
007311  3  63 77 1F 6B          .byte 99,119,31,107,99,99,99,0
007315  3  63 63 63 00  
007319  3  7C 7E 06 66          .byte 124,126,6,102,102,102,102,0
00731D  3  66 66 66 00  
007321  3  3C 7E 06 66          .byte 60,126,6,102,102,126,60,0
007325  3  66 7E 3C 00  
007329  3  7C 7E 06 7E          .byte 124,126,6,126,124,96,96,0
00732D  3  7C 60 60 00  
007331  3  3C 7E 06 66          .byte 60,126,6,102,102,112,54,6
007335  3  66 70 36 06  
007339  3  7C 7E 06 7E          .byte 124,126,6,126,124,110,102,0
00733D  3  7C 6E 66 00  
007341  3  3E 7E 00 3C          .byte 62,126,0,60,14,126,124,0
007345  3  0E 7E 7C 00  
007349  3  7E 7E 00 18          .byte 126,126,0,24,24,24,24,0
00734D  3  18 18 18 00  
007351  3  66 66 06 66          .byte 102,102,6,102,102,126,62,0
007355  3  66 7E 3E 00  
007359  3  66 66 06 66          .byte 102,102,6,102,126,60,24,0
00735D  3  7E 3C 18 00  
007361  3  63 63 03 6B          .byte 99,99,3,107,127,119,99,0
007365  3  7F 77 63 00  
007369  3  63 77 2E 1C          .byte 99,119,46,28,62,119,99,0
00736D  3  3E 77 63 00  
007371  3  66 66 06 7E          .byte 102,102,6,126,6,62,60,0
007375  3  06 3E 3C 00  
007379  3  7E 7E 00 0C          .byte 126,126,0,12,24,62,126,0
00737D  3  18 3E 7E 00  
007381  3  1E 0C 0C 0C          .byte 30,12,12,12,12,12,12,30
007385  3  0C 0C 0C 1E  
007389  3  00 00 C0 60          .byte 0,0,192,96,48,24,12,0
00738D  3  30 18 0C 00  
007391  3  00 F0 30 30          .byte 0,240,48,48,48,48,240,0
007395  3  30 30 F0 00  
007399  3  3C 4E 5E 7E          .byte 60,78,94,126,122,60,8,24
00739D  3  7A 3C 08 18  
0073A1  3  00 00 7F 7F          .byte 0,0,127,127,42,85,0,127
0073A5  3  2A 55 00 7F  
0073A9  3  00 56 4B 55          .byte 0,86,75,85,74,69,32,31
0073AD  3  4A 45 20 1F  
0073B1  3  00 00 3C 06          .byte 0,0,60,6,62,102,62,0
0073B5  3  3E 66 3E 00  
0073B9  3  00 60 60 7C          .byte 0,96,96,124,102,102,124,0
0073BD  3  66 66 7C 00  
0073C1  3  3C 42 99 A1          .byte 60,66,153,161,161,153,66,60
0073C5  3  A1 99 42 3C  
0073C9  3  00 06 06 3E          .byte 0,6,6,62,102,102,62,0
0073CD  3  66 66 3E 00  
0073D1  3  00 00 3C 66          .byte 0,0,60,102,124,96,60,0
0073D5  3  7C 60 3C 00  
0073D9  3  00 1C 30 38          .byte 0,28,48,56,48,48,48,0
0073DD  3  30 30 30 00  
0073E1  3  00 00 38 6C          .byte 0,0,56,108,108,60,12,120
0073E5  3  6C 3C 0C 78  
0073E9  3  00 60 60 7C          .byte 0,96,96,124,102,102,102,0
0073ED  3  66 66 66 00  
0073F1  3  00 18 00 38          .byte 0,24,0,56,24,24,60,0
0073F5  3  18 18 3C 00  
0073F9  3  00 06 00 06          .byte 0,6,0,6,6,6,102,60
0073FD  3  06 06 66 3C  
007401  3  00 60 6C 78          .byte 0,96,108,120,120,108,102,0
007405  3  78 6C 66 00  
007409  3  00 30 30 30          .byte 0,48,48,48,48,48,28,0
00740D  3  30 30 1C 00  
007411  3  00 00 36 7F          .byte 0,0,54,127,127,107,99,0
007415  3  7F 6B 63 00  
007419  3  00 00 7C 66          .byte 0,0,124,102,102,102,102,0
00741D  3  66 66 66 00  
007421  3  00 00 3C 66          .byte 0,0,60,102,102,102,60,0
007425  3  66 66 3C 00  
007429  3  00 00 7C 66          .byte 0,0,124,102,102,124,96,96
00742D  3  66 7C 60 60  
007431  3  00 00 3E 66          .byte 0,0,62,102,102,62,6,7
007435  3  66 3E 06 07  
007439  3  00 00 1E 33          .byte 0,0,30,51,48,48,48,0
00743D  3  30 30 30 00  
007441  3  00 00 3E 60          .byte 0,0,62,96,60,6,124,0
007445  3  3C 06 7C 00  
007449  3  00 30 7C 30          .byte 0,48,124,48,48,48,28,0
00744D  3  30 30 1C 00  
007451  3  D4 E0 E0 E0          .byte 212,224,224,224,224,224,224,192
007455  3  E0 E0 E0 C0  
007459  3  7F FE D5 E0          .byte 127,254,213,224,224,224,252,248
00745D  3  E0 E0 FC F8  
007461  3  00 00 1F 27          .byte 0,0,31,39,74,85,72,87
007465  3  4A 55 48 57  
007469  3  7E 81 B1 B1          .byte 126,129,177,177,129,133,129,126
00746D  3  81 85 81 7E  
007471  3  00 00 78 7C          .byte 0,0,120,124,46,86,14,86
007475  3  2E 56 0E 56  
007479  3  00 28 28 5C          .byte 0,40,40,92,92,92,0,40
00747D  3  5C 5C 00 28  
007481  3  00 1E 18 70          .byte 0,30,24,112,24,24,30,0
007485  3  18 18 1E 00  
007489  3  00 18 18 18          .byte 0,24,24,24,24,24,24,0
00748D  3  18 18 18 00  
007491  3  00 F0 30 1C          .byte 0,240,48,28,48,48,240,0
007495  3  30 30 F0 00  
007499  3  00 3C 78 00          .byte 0,60,120,0,0,0,0,0
00749D  3  00 00 00 00  
0074A1  3  3C 42 99 A1          .byte 60,66,153,161,161,153,66,60
0074A5  3  A1 99 42 3C  
0074A9  3               .out .sprintf("FONT SIZE = %d", (* - font))
0074A9  3               
0074A9  3               jtab:
0074A9  3  F9 FA FB FE          .byte 249,250,251,254,254,255,255,255,0,0,0,1,1,1,2,2,6,7,6,15,16,99
0074AD  3  FE FF FF FF  
0074B1  3  00 00 00 01  
0074BF  3  42 61 68 48  keys:   .byte 66,97,104,72,73,16,55,48,49,17,18
0074C3  3  49 10 37 30  
0074C7  3  31 11 12     
0074CA  3               .out .sprintf("KEYS SIZE = %d", (* - keys))
0074CA  3               
0074CA  3               data_end:
0074CA  3               .out .sprintf("TOTAL DATA SIZE = %d", (* - data_start))
0074CA  3               
0074CA  2               
0074CA  1               
0074CA  1               end_asm:
0074CA  1               
0074CA  1               ;----------------------------------------------------------------------
0074CA  1               ; RELOCATION OF BEEB CODE FROM LOAD ADDRESS
0074CA  1               ;----------------------------------------------------------------------
0074CA  1               
0074CA  1               relocate:
0074CA  1               ; Issue *TAPE otherwise DFS goes mental that we've overwritten workspace from &E00 - &1100
0074CA  1               
0074CA  1  A9 8C            lda #$8C
0074CC  1  A2 0C            ldx #$0C
0074CE  1  A0 00            ldy #$00
0074D0  1  20 F4 FF         jsr OSBYTE					; *FX &8C,0,0 - *TAPE 1200
0074D3  1               
0074D3  1  78           	sei
0074D4  1  A9 7F        	lda #$7f
0074D6  1  8D 4E FE     	sta $fe4e					; disable all interupts
0074D9  1  A9 82        	lda #$82
0074DB  1  8D 4E FE     	sta $fe4e					; enable vsync interupt only
0074DE  1  58           	cli
0074DF  1               
0074DF  1  A9 04        	lda #4						; select SWRAM
0074E1  1  85 F4            sta $f4
0074E3  1  8D 30 FE         sta $fe30
0074E6  1               
0074E6  1               ; Other one off initialisation could happen here...
0074E6  1               
0074E6  1               ; Relocate all code down to &E00
0074E6  1  A2 2E        	ldx #>(data_start - start_asm) + 1
0074E8  1  A0 00        	ldy #0
0074EA  1               reloop:
0074EA  1  B9 00 12     	lda load_address, y
0074ED  1  99 00 0E     	sta asm_code, y
0074F0  1  C8           	iny
0074F1  1  D0 F7        	bne reloop
0074F3  1  EE EC 78     	inc reloop + 2 + load_address - asm_code
0074F6  1  EE EF 78     	inc reloop + 5 + load_address - asm_code
0074F9  1  CA           	dex
0074FA  1  D0 EE        	bne reloop
0074FC  1               
0074FC  1               ; Relocate all data up to &8000
0074FC  1  A2 39        	ldx #>(end_asm - data_start) + 1
0074FE  1  A0 00        	ldy #0
007500  1               uploop:
007500  1  B9 DB 3F     	lda data_start + load_address - asm_code, y
007503  1  99 00 80     	sta data_address, y
007506  1  C8           	iny
007507  1  D0 F7        	bne uploop
007509  1  EE 02 79     	inc uploop + 2 + load_address - asm_code
00750C  1  EE 05 79     	inc uploop + 5 + load_address - asm_code
00750F  1  CA           	dex
007510  1  D0 EE        	bne uploop
007512  1               
007512  1  4C 03 0E     	jmp boot_game
007512  1               
