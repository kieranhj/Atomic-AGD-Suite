ca65 V2.17 - Git cc5c093
Main file   : game.asm
Current file: game.asm

000000r 1               ;----------------------------------------------
000000r 1               ; BBC AGD Engine
000000r 1               ; Z80 conversion by Kees van Oss 2017
000000r 1               ; BBC Micro version by Kieran Connell 2018
000000r 1               ;----------------------------------------------
000000r 1               
000000r 1               .DEFINE asm_code $0e00		; assembly address _BEEB
000000r 1               .DEFINE load_address $1200	; load address _BEEB
000000r 1               
000000r 1               ;----------------------------------------------------------------------
000000r 1               ; BBC MICRO PLATFORM DEFINES
000000r 1               ;----------------------------------------------------------------------
000000r 1               
000000r 1               ; _BEEB MOS calls
000000r 1               
000000r 1               	OSBYTE	 = $fff4
000000r 1               	OSFILE	 = $ffdd
000000r 1               	OSWRCH	 = $ffee
000000r 1               	OSASCI	 = $ffe3
000000r 1               	OSWORD	 = $fff1
000000r 1               	OSFIND	 = $ffce
000000r 1               	OSGBPB	 = $ffd1
000000r 1               	OSARGS	 = $ffda
000000r 1               
000000r 1               	PAL_black = 0 ^ 7
000000r 1               	PAL_red = 1 ^ 7
000000r 1               	PAL_green = 2 ^ 7
000000r 1               	PAL_yellow = 3 ^ 7
000000r 1               	PAL_blue = 4 ^ 7
000000r 1               	PAL_magenta = 5 ^ 7
000000r 1               	PAL_cyan = 6 ^ 7
000000r 1               	PAL_white = 7 ^ 7
000000r 1               
000000r 1               ; System constants
000000r 1               
000000r 1               	ScreenSize  = $1800	; Startaddress video RAM _BEEB
000000r 1               	ScreenAddr 	= $8000 - ScreenSize	; Screen size bytes _BEEB
000000r 1               	ScreenRowBytes = 256				; 40 columns
000000r 1               
000000r 1               	SpriteMaxY	= 177	; used for clipping bottom of screen
000000r 1               
000000r 1               ; AGD Engine Workspace
000000r 1               
000000r 1               	MAP 		= $300				; properties map buffer (3x256 bytes)
000000r 1               	SCADTB_lb	= MAP + $300
000000r 1               	SCADTB_hb	= SCADTB_lb + $100
000000r 1               
000000r 1               .if pflag
000000r 1                   SHRAPN 		= $B00 - (NUMSHR * SHRSIZ)	; shrapnel table (55x6 bytes)
000000r 1               .endif
000000r 1               
000000r 1               	sprtab		= $B00				; NUMSPR*TABSIZ
000000r 1               
000000r 1               	.macro DEBUG_PAL pal
000000r 1               		SET_PAL pal
000000r 1               	.endmacro
000000r 1               
000000r 1               	.macro SET_PAL pal
000000r 1               		lda #$00+pal
000000r 1               		sta $fe21
000000r 1               		lda #$10+pal
000000r 1               		sta $fe21
000000r 1               		lda #$20+pal
000000r 1               		sta $fe21
000000r 1               		lda #$30+pal
000000r 1               		sta $fe21
000000r 1               		lda #$40+pal
000000r 1               		sta $fe21
000000r 1               		lda #$50+pal
000000r 1               		sta $fe21
000000r 1               		lda #$60+pal
000000r 1               		sta $fe21
000000r 1               		lda #$70+pal
000000r 1               		sta $fe21
000000r 1               	.endmacro
000000r 1               
000000r 1               ;----------------------------------------------------------------------
000000r 1               ; ZERO PAGE SEGMENT
000000r 1               ;----------------------------------------------------------------------
000000r 1               
000000r 1               .segment "ZEROPAGE"
000000r 1               
000000r 1               .include "z80-zp.inc"
000000r 2               ;ws	 = $60
000000r 2               
000000r 2  xx           z80_f: .res 1;	 = ws+$00
000001r 2  xx           z80_a: .res 1;	 = ws+$01
000002r 2               z80_af	 = z80_f
000002r 2               
000002r 2  xx           z80_c: .res 1;	 = ws+$02
000003r 2  xx           z80_b: .res 1;	 = ws+$03
000004r 2               z80_bc	 = z80_c
000004r 2               
000004r 2  xx           z80_e: .res 1;	 = ws+$04
000005r 2  xx           z80_d: .res 1;	 = ws+$05
000006r 2               z80_de	 = z80_e
000006r 2               
000006r 2  xx           z80_l: .res 1;	 = ws+$06
000007r 2  xx           z80_h: .res 1;	 = ws+$07
000008r 2               z80_hl	 = z80_l
000008r 2               
000008r 2  xx           z80_x: .res 1;    = ws+$08
000009r 2  xx           z80_i: .res 1;    = ws+$09
00000Ar 2               z80_ix	 = z80_x
00000Ar 2               
00000Ar 2  xx xx        z80_iy: .res 2;	 = ws+$0a
00000Cr 2               
00000Cr 2  xx           z80_fp: .res 1;	 = ws+$0c
00000Dr 2  xx           z80_ap: .res 1;	 = ws+$0d
00000Er 2               
00000Er 2  xx           z80_cp: .res 1;	 = ws+$0e
00000Fr 2  xx           z80_bp: .res 1;	 = ws+$0f
000010r 2               z80_bcp	 = z80_cp
000010r 2               
000010r 2  xx           z80_ep: .res 1;	 = ws+$10
000011r 2  xx           z80_dp: .res 1;	 = ws+$11
000012r 2               z80_dep	 = z80_ep
000012r 2               
000012r 2  xx           z80_lp: .res 1;	 = ws+$12
000013r 2  xx           z80_hp: .res 1;	 = ws+$13
000014r 2               z80_hlp	 = z80_lp
000014r 2               
000014r 2  xx xx        z80_sp: .res 2;   = ws+$14
000016r 2               
000016r 2  xx           z80_reg0: .res 1; = ws+$16
000017r 2  xx           z80_reg1: .res 1; = ws+$17
000018r 2  xx           z80_reg2: .res 1; = ws+$18
000019r 2  xx           z80_reg3: .res 1; = ws+$19
00001Ar 2               
00001Ar 2               ;z80_r: .res 1;	 = ws+$1a
00001Ar 2               
00001Ar 1               .include "engine-zp.inc"
00001Ar 2               ;----------------------------------------------------------------------
00001Ar 2               ; AGD 6502 Engine Zero Page Variables
00001Ar 2               ;----------------------------------------------------------------------
00001Ar 2               
00001Ar 2               ; Variables start here.
00001Ar 2               
00001Ar 2  xx           scno:	.res 1			; present screen number.
00001Br 2  xx           numlif:	.res 1			; number of lives.
00001Cr 2               
00001Cr 2  xx           vara:	.res 1			; general-purpose variable.
00001Dr 2  xx           varb:	.res 1			; general-purpose variable.
00001Er 2  xx           varc:	.res 1			; general-purpose variable.
00001Fr 2  xx           vard:	.res 1			; general-purpose variable.
000020r 2  xx           vare:	.res 1			; general-purpose variable.
000021r 2  xx           varf:	.res 1			; general-purpose variable.
000022r 2  xx           varg:	.res 1			; general-purpose variable.
000023r 2  xx           varh:	.res 1			; general-purpose variable.
000024r 2  xx           vari:	.res 1			; general-purpose variable.
000025r 2  xx           varj:	.res 1			; general-purpose variable.
000026r 2  xx           vark:	.res 1			; general-purpose variable.
000027r 2  xx           varl:	.res 1			; general-purpose variable.
000028r 2  xx           varm:	.res 1			; general-purpose variable.
000029r 2  xx           varn:	.res 1			; general-purpose variable.
00002Ar 2  xx           varo:	.res 1			; general-purpose variable.
00002Br 2  xx           varp:	.res 1			; general-purpose variable.
00002Cr 2  xx           varq:	.res 1			; general-purpose variable.
00002Dr 2  xx           varr:	.res 1			; general-purpose variable.
00002Er 2  xx           vars:	.res 1			; general-purpose variable.
00002Fr 2  xx           vart:	.res 1			; general-purpose variable.
000030r 2  xx           varu:	.res 1			; general-purpose variable.
000031r 2  xx           varv:	.res 1			; general-purpose variable.
000032r 2  xx           varw:	.res 1			; general-purpose variable.
000033r 2  xx           varz:	.res 1			; general-purpose variable.
000034r 2               
000034r 2  xx           charx:	.res 1			; cursor x position.
000035r 2  xx           chary:	.res 1			; cursor y position.
000036r 2               
000036r 2  xx           clock:	.res 1			; last clock reading.
000037r 2  xx           varrnd:	.res 1	        ; last random number.
000038r 2  xx           varobj:	.res 1  	    ; last object number.
000039r 2  xx           varopt:	.res 1     		; last option chosen from menu.
00003Ar 2  xx           varblk:	.res 1  		; block type.
00003Br 2  xx           nexlev:	.res 1			; next level flag.
00003Cr 2  xx           restfl:	.res 1			; restart screen flag.
00003Dr 2  xx           deadf:	.res 1			; dead flag.
00003Er 2  xx           gamwon:	.res 1			; game won flag.
00003Fr 2  xx           dispx:	.res 1			; cursor x position.
000040r 2  xx           dispy:	.res 1			; cursor y position.
000041r 2               
000041r 2  xx           contrl:	.res 1			; control = keyboard, 1 = Kempston, 2 = Sinclair, 3 = Mouse.
000042r 2  xx           joyval:	.res 1			; joystick reading.
000043r 2  xx           frmno:	.res 1			; selected frame.
000044r 2               
000044r 2               ;----------------------------------------------------
000044r 2               ; Missing vars
000044r 2               ;----------------------------------------------------
000044r 2               
000044r 2  xx           loopa:		.res 1
000045r 2  xx           loopb:		.res 1
000046r 2  xx           loopc:		.res 1
000047r 2  xx xx        FontPtr:    .res 2
000049r 2               
000049r 2               ; Local vars
000049r 2               
000049r 2  xx xx        scraddr:    .res 2
00004Br 2  xx xx        fntaddr:    .res 2
00004Dr 2  xx xx        tileaddr:   .res 2
00004Fr 2  xx xx        bufaddr:    .res 2
000051r 2               
000051r 2  xx xx        tmp:        .res 2
000053r 2  xx xx        scr_l:      .res 2
000055r 2  xx xx        scr_r:      .res 2
000057r 2  xx xx        scr_txt:    .res 2
000059r 2               
000059r 2  xx           xtmp:	    .res 1
00005Ar 2  xx           spcnt:	    .res 1
00005Br 2  xx xx        spptr:	    .res 2		; spawned sprite pointer.
00005Dr 2  xx           seed:	    .res 1		; seed for random numbers.
00005Er 2               
00005Er 2  xx           ccnt:       .res 1
00005Fr 2  xx           flag:	    .res 1
000060r 2  xx           rcol:	    .res 1
000061r 2  xx           rrow:	    .res 1
000062r 2               
000062r 2  xx           combyt:	    .res 1		; byte type compressed.
000063r 2  xx           comcnt:	    .res 1		; compression counter.
000064r 2  xx           prtmod:	    .res 1      ; print mode, 0 = standard, 1 = double-height.
000065r 2  xx           qscnt:	    .res 1
000066r 2               
000066r 2  xx           sprptr:	    .res 1      ; not a ptr
000067r 2  xx           sprcnt:	    .res 1
000068r 2               
000068r 2  xx xx        skptr:	    .res 2		; search pointer.
00006Ar 2  xx           sktptr:	    .res 1      ; not a ptr
00006Br 2  xx           tmproom:	.res 1
00006Cr 2  xx xx        ogptr:	    .res 2		; original sprite pointer.
00006Er 2               
00006Er 2  xx xx xx     spr:	    .res 3      ; static sprite data
000071r 2               
000071r 2               .if mflag
000071r 2               TmpAddr:	.res 2
000071r 2               bwid:	    .res 1     ; box/menu width.
000071r 2               blen:	    .res 1     ; box/menu height.
000071r 2               btop:	    .res 1     ; box coordinates.
000071r 2               blft:	    .res 1
000071r 2               .endif
000071r 2               
000071r 2               .if pflag
000071r 2               shrctr:	    .res 1
000071r 2               explcnt:	.res 1
000071r 2               seed3:	    .res 1
000071r 2               .endif
000071r 2               
000071r 1               
000071r 1               ;----------------------------------------------------------------------
000071r 1               ; ZCODE SEGMENT
000071r 1               ;----------------------------------------------------------------------
000071r 1               
000071r 1               .segment "CODE"
000000r 1               .org asm_code
000E00  1               
000E00  1               start_asm:
000E00  1               
000E00  1  4C 5E 65     	jmp relocate + load_address - asm_code
000E03  1               
000E03  1               boot_game:
000E03  1               
000E03  1               ; Zero ZP vars
000E03  1               
000E03  1               clear_zp:
000E03  1  A2 00        	ldx #0
000E05  1  8A           	txa
000E06  1               	:
000E06  1  95 00        	sta $00, x
000E08  1  E8           	inx
000E09  1  E0 A0        	cpx #$a0
000E0B  1  D0 F9        	bne :-
000E0D  1               
000E0D  1               	; Init non-zero vars
000E0D  1  A9 03        	lda #3
000E0F  1  85 rr        	sta numlif
000E11  1               
000E11  1  A2 FF        	ldx #255
000E13  1  86 rr        	stx varrnd
000E15  1  86 rr        	stx varopt
000E17  1  86 rr        	stx varblk
000E19  1  CA           	dex
000E1A  1  86 rr        	stx varobj
000E1C  1               
000E1C  1               	; Call AGD Engine start game
000E1C  1  20 B3 10     	jsr start_game
000E1F  1               
000E1F  1                   ; Wait for keypress
000E1F  1  A2 FF        	ldx #$ff
000E21  1  A0 7F        	ldy #$7f
000E23  1  A9 81        	lda #$81
000E25  1  20 F4 FF     	jsr OSBYTE
000E28  1               
000E28  1               	; Restart or exit
000E28  1  4C 03 0E     	jmp boot_game
000E2B  1               
000E2B  1               ;----------------------------------------------------------------------
000E2B  1               ; PLATFORM SPECIFIC ENGINE CODE
000E2B  1               ;----------------------------------------------------------------------
000E2B  1               
000E2B  1               	.include "z80.asm"
000E2B  2               ;------------------------------------------------------
000E2B  2               ; z80.asm
000E2B  2               ; spectrum stuff
000E2B  2               ; adresses
000E2B  2               
000E2B  2               ;ws	 = $60
000E2B  2               
000E2B  2               ;z80_f	 = ws+$00
000E2B  2               ;z80_a	 = ws+$01
000E2B  2               ;z80_af	 = z80_f
000E2B  2               
000E2B  2               ;z80_c	 = ws+$02
000E2B  2               ;z80_b	 = ws+$03
000E2B  2               ;z80_bc	 = z80_c
000E2B  2               
000E2B  2               ;z80_e	 = ws+$04
000E2B  2               ;z80_d	 = ws+$05
000E2B  2               ;z80_de	 = z80_e
000E2B  2               
000E2B  2               ;z80_l	 = ws+$06
000E2B  2               ;z80_h	 = ws+$07
000E2B  2               ;z80_hl	 = z80_l
000E2B  2               
000E2B  2               ;z80_x    = ws+$08
000E2B  2               ;z80_i    = ws+$09
000E2B  2               ;z80_ix	 = z80_x
000E2B  2               
000E2B  2               ;z80_iy	 = ws+$0a
000E2B  2               
000E2B  2               ;z80_fp	 = ws+$0c
000E2B  2               ;z80_ap	 = ws+$0d
000E2B  2               
000E2B  2               ;z80_cp	 = ws+$0e
000E2B  2               ;z80_bp	 = ws+$0f
000E2B  2               ;z80_bcp = z80_cp
000E2B  2               
000E2B  2               ;z80_ep	 = ws+$10
000E2B  2               ;z80_dp	 = ws+$11
000E2B  2               ;z80_dep = z80_ep
000E2B  2               
000E2B  2               ;z80_lp	 = ws+$12
000E2B  2               ;z80_hp	 = ws+$13
000E2B  2               ;z80_hlp = z80_lp
000E2B  2               
000E2B  2               ;z80_sp   = ws+$14
000E2B  2               
000E2B  2               ;z80_reg0 = ws+$16
000E2B  2               ;z80_reg1 = ws+$17
000E2B  2               ;z80_reg2 = ws+$18
000E2B  2               ;z80_reg3 = ws+$19
000E2B  2               
000E2B  2               ;z80_r	 = ws+$1a
000E2B  2               
000E2B  2               ; Contains seperatly 1 bit set
000E2B  2               ; _BEEB this is not safe memory to use as required by MOS
000E2B  2               
000E2B  2               _bitmem0	= $f8
000E2B  2               _bitmem1	= $f9
000E2B  2               _bitmem2	= $fa
000E2B  2               _bitmem3	= $fb
000E2B  2               _bitmem4	= $fc
000E2B  2               _bitmem5	= $fd
000E2B  2               _bitmem6	= $fe
000E2B  2               _bitmem7	= $ff
000E2B  2               
000E2B  2               ; constants
000E2B  2               _bitvalue0	= $01
000E2B  2               _bitvalue1	= $02
000E2B  2               _bitvalue2	= $04
000E2B  2               _bitvalue3	= $08
000E2B  2               _bitvalue4	= $10
000E2B  2               _bitvalue5	= $20
000E2B  2               _bitvalue6	= $40
000E2B  2               _bitvalue7	= $80
000E2B  2               
000E2B  2               _notbitvalue0	= $fe
000E2B  2               _notbitvalue1	= $fd
000E2B  2               _notbitvalue2	= $fb
000E2B  2               _notbitvalue3	= $f7
000E2B  2               _notbitvalue4	= $ef
000E2B  2               _notbitvalue5	= $df
000E2B  2               _notbitvalue6	= $bf
000E2B  2               _notbitvalue7	= $7f
000E2B  2               
000E2B  2               
000E2B  2               ;add_hl_bc:
000E2B  2               ;		lda z80_l
000E2B  2               ;		clc
000E2B  2               ;		adc z80_c
000E2B  2               ;		sta z80_l
000E2B  2               ;		lda z80_h
000E2B  2               ;		adc z80_b
000E2B  2               ;		sta z80_h
000E2B  2               ;		rts
000E2B  2               ;
000E2B  2               ;add_ix_de:
000E2B  2               ;		lda z80_ix
000E2B  2               ;		clc
000E2B  2               ;		adc z80_e
000E2B  2               ;		sta z80_ix
000E2B  2               ;		lda z80_ix+1
000E2B  2               ;		adc z80_d
000E2B  2               ;		sta z80_ix+1
000E2B  2               ;		rts
000E2B  2               ;
000E2B  2               ;add_iy_de:
000E2B  2               ;		lda z80_iy
000E2B  2               ;		clc
000E2B  2               ;		adc z80_e
000E2B  2               ;		sta z80_iy
000E2B  2               ;		lda z80_iy+1
000E2B  2               ;		adc z80_d
000E2B  2               ;		sta z80_iy+1
000E2B  2               ;		rts
000E2B  2               ;
000E2B  2               ;add_hl_de:
000E2B  2               ;		lda z80_l
000E2B  2               ;		clc
000E2B  2               ;		adc z80_e
000E2B  2               ;		sta z80_l
000E2B  2               ;		lda z80_h
000E2B  2               ;		adc z80_d
000E2B  2               ;		sta z80_h
000E2B  2               ;		rts
000E2B  2               ;
000E2B  2               ;add_ix_bc:
000E2B  2               ;		lda z80_ix
000E2B  2               ;		clc
000E2B  2               ;		adc z80_c
000E2B  2               ;		sta z80_ix
000E2B  2               ;		lda z80_ix+1
000E2B  2               ;		adc z80_b
000E2B  2               ;		sta z80_ix+1
000E2B  2               ;		rts
000E2B  2               ;
000E2B  2               ;add_iy_bc:
000E2B  2               ;		lda z80_iy
000E2B  2               ;		clc
000E2B  2               ;		adc z80_c
000E2B  2               ;		sta z80_iy
000E2B  2               ;		lda z80_iy+1
000E2B  2               ;		adc z80_b
000E2B  2               ;		sta z80_iy+1
000E2B  2               ;		rts
000E2B  2               ;
000E2B  2               ;sbc_hl_de:
000E2B  2               ;		lda z80_l
000E2B  2               ;		sbc z80_e
000E2B  2               ;		sta z80_l
000E2B  2               ;		lda z80_h
000E2B  2               ;		sbc z80_d
000E2B  2               ;		sta z80_h
000E2B  2               ;		rts
000E2B  2               ;
000E2B  2               ;sbc_hl_bc:
000E2B  2               ;		lda z80_l
000E2B  2               ;		sbc z80_c
000E2B  2               ;		sta z80_l
000E2B  2               ;		lda z80_h
000E2B  2               ;		sbc z80_b
000E2B  2               ;		sta z80_h
000E2B  2               ;		rts
000E2B  2               ;
000E2B  2               ;cmp_hl_bc:
000E2B  2               ;		lda z80_l
000E2B  2               ;		cmp z80_c
000E2B  2               ;		bne cmp_hl_bc_end
000E2B  2               ;		lda z80_h
000E2B  2               ;		cmp z80_b
000E2B  2               ;cmp_hl_bc_end:
000E2B  2               ;		rts
000E2B  2               ;
000E2B  2               ;cmp_iy_ix:
000E2B  2               ;		lda z80_iy
000E2B  2               ;		cmp z80_ix
000E2B  2               ;		bne cmp_iy_ix_end
000E2B  2               ;		lda z80_iy+1
000E2B  2               ;		cmp z80_ix+1
000E2B  2               ;cmp_iy_ix_end:
000E2B  2               ;		rts
000E2B  2               ;
000E2B  2               ;dec_hl:
000E2B  2               ;		lda z80_l
000E2B  2               ;		bne dec_hl_no_dec_h
000E2B  2               ;		dec z80_h
000E2B  2               ;dec_hl_no_dec_h:
000E2B  2               ;		dec z80_l
000E2B  2               ;		rts
000E2B  2               ;
000E2B  2               ;dec_ix:
000E2B  2               ;		lda z80_ix
000E2B  2               ;		bne dec_ix_no_dec_h
000E2B  2               ;		dec z80_ix+1
000E2B  2               ;dec_ix_no_dec_h:
000E2B  2               ;		dec z80_ix
000E2B  2               ;		rts
000E2B  2               ;
000E2B  2               ;dec_bc:
000E2B  2               ;		lda z80_c
000E2B  2               ;		bne dec_bc_no_dec_b
000E2B  2               ;		dec z80_b
000E2B  2               ;dec_bc_no_dec_b:
000E2B  2               ;		dec z80_c
000E2B  2               ;		rts
000E2B  2               ;
000E2B  2               ;dec_de:
000E2B  2               ;		lda z80_e
000E2B  2               ;		bne dec_de_no_dec_d
000E2B  2               ;		dec z80_d
000E2B  2               ;dec_de_no_dec_d:
000E2B  2               ;		dec z80_e
000E2B  2               ;		rts
000E2B  2               ;
000E2B  2               ;ex_af_afs:
000E2B  2               ;	rts
000E2B  2               ;ex_de_hl:
000E2B  2               ;		lda z80_e
000E2B  2               ;		ldx z80_l
000E2B  2               ;		stx z80_e
000E2B  2               ;		sta z80_l
000E2B  2               ;		lda z80_d
000E2B  2               ;		ldx z80_h
000E2B  2               ;		stx z80_d
000E2B  2               ;		sta z80_h
000E2B  2               ;		rts
000E2B  2               ;
000E2B  2               exx:
000E2B  2  A5 rr        		lda z80_c
000E2D  2  A4 rr        		ldy z80_cp
000E2F  2  84 rr        		sty z80_c
000E31  2  85 rr        		sta z80_cp
000E33  2  A5 rr        		lda z80_b
000E35  2  A4 rr        		ldy z80_bp
000E37  2  84 rr        		sty z80_b
000E39  2  85 rr        		sta z80_bp
000E3B  2  A5 rr        		lda z80_e
000E3D  2  A4 rr        		ldy z80_ep
000E3F  2  84 rr        		sty z80_e
000E41  2  85 rr        		sta z80_ep
000E43  2  A5 rr        		lda z80_d
000E45  2  A4 rr        		ldy z80_dp
000E47  2  84 rr        		sty z80_d
000E49  2  85 rr        		sta z80_dp
000E4B  2  A5 rr        		lda scraddr
000E4D  2  A4 rr        		ldy z80_lp
000E4F  2  84 rr        		sty scraddr
000E51  2  85 rr        		sta z80_lp
000E53  2  A5 rr        		lda scraddr+1
000E55  2  A4 rr        		ldy z80_hp
000E57  2  84 rr        		sty scraddr+1
000E59  2  85 rr        		sta z80_hp
000E5B  2  60           		rts
000E5C  2               
000E5C  2               ;ex_sp_hl:
000E5C  2               ;		tsx
000E5C  2               ;		lda $0103,x
000E5C  2               ;		ldy z80_h
000E5C  2               ;		sta z80_h
000E5C  2               ;		tya
000E5C  2               ;		sta $0103,x
000E5C  2               ;		lda $0104,x
000E5C  2               ;		ldy z80_l
000E5C  2               ;		sta z80_l
000E5C  2               ;		tya
000E5C  2               ;		sta $104,x
000E5C  2               ;		rts
000E5C  2               ;
000E5C  2               ;ldi:
000E5C  2               ;	rts
000E5C  2               ;ldir:
000E5C  2               ;		ldy #$00
000E5C  2               ;		ldx z80_b
000E5C  2               ;		beq ldir_last_page
000E5C  2               ;ldir_loop:
000E5C  2               ;		lda (z80_hl),y
000E5C  2               ;		sta (z80_de),y
000E5C  2               ;		iny
000E5C  2               ;		bne ldir_loop
000E5C  2               ;		inc z80_h
000E5C  2               ;		inc z80_d
000E5C  2               ;		dex
000E5C  2               ;		bne ldir_loop
000E5C  2               ;ldir_last_page:
000E5C  2               ;		lda z80_c
000E5C  2               ;		beq ldir_end
000E5C  2               ;ldir_last_page_loop:
000E5C  2               ;		lda (z80_hl),y
000E5C  2               ;		sta (z80_de),y
000E5C  2               ;		iny
000E5C  2               ;		cpy z80_c
000E5C  2               ;		bne ldir_last_page_loop
000E5C  2               ;ldir_end:
000E5C  2               ;		stx z80_c
000E5C  2               ;		stx z80_b
000E5C  2               ;		tya
000E5C  2               ;		clc
000E5C  2               ;		adc z80_l
000E5C  2               ;		sta z80_l
000E5C  2               ;		bcc *+4
000E5C  2               ;		inc z80_h
000E5C  2               ;		tya
000E5C  2               ;		clc
000E5C  2               ;		adc z80_e
000E5C  2               ;		sta z80_e
000E5C  2               ;		bcc *+4
000E5C  2               ;		inc z80_d
000E5C  2               ;		rts
000E5C  2               ;
000E5C  2               ;lddr:		ldy #$00
000E5C  2               ;lddr_loop:
000E5C  2               ;		lda (z80_hl),y
000E5C  2               ;		sta (z80_de),y
000E5C  2               ;		jsr dec_hl
000E5C  2               ;		jsr dec_de
000E5C  2               ;		jsr dec_bc
000E5C  2               ;		lda z80_b
000E5C  2               ;		ora z80_c
000E5C  2               ;		bne lddr_loop
000E5C  2               ;		rts
000E5C  2               ;ei:
000E5C  2               ;		rts
000E5C  2               ;di:
000E5C  2               ;		rts
000E5C  2               
000E5C  2               ;-------------------------------------------------------------
000E5C  2               ; Set bits in bitmem
000E5C  2               ;-------------------------------------------------------------
000E5C  2               
000E5C  2               .if 0
000E5C  2               z80_init:
000E5C  2               	ldx #$00
000E5C  2               	lda #$01
000E5C  2               z80_init_loop:
000E5C  2               	sta _bitmem0,x
000E5C  2               	inx
000E5C  2               	asl a
000E5C  2               	bne z80_init_loop
000E5C  2               	rts
000E5C  2               .endif
000E5C  2               
000E5C  2               push_af:
000E5C  2               push_bc:
000E5C  2               push_de:
000E5C  2               push_hl:
000E5C  2               
000E5C  2               pop_af:
000E5C  2               pop_bc:
000E5C  2               pop_de:
000E5C  2               pop_ix:
000E5C  2               pop_hl:
000E5C  2               
000E5C  2               add_hl_hl:
000E5C  2               
000E5C  2               inc_bc:
000E5C  2               inc_de:
000E5C  2               inc_hl:
000E5C  2               inc_ix:
000E5C  2               inc_sp:
000E5C  2               
000E5C  2               cpir:
000E5C  2               
000E5C  2               ex_af_af:
000E5C  2               ;	rts
000E5C  2               
000E5C  1               	.include "bbc.inc"
000E5C  2               ;----------------------------------------------------------------------
000E5C  2               ; BBC Platform Specific functions
000E5C  2               ;----------------------------------------------------------------------
000E5C  2               
000E5C  2               ;--------------------------------------------------------
000E5C  2               ; Keys
000E5C  2               ;
000E5C  2               ; Out: joyval=x65FUDLR (bit cleared if key pressed)
000E5C  2               ;             ||||||||
000E5C  2               ;             |||||||+> Right    KEY 0  - X
000E5C  2               ;             ||||||+-> Left     KEY 1  - Z
000E5C  2               ;             |||||+--> Down     KEY 2  - .
000E5C  2               ;             ||||+---> Up       KEY 3  - ;
000E5C  2               ;             |||+----> Fire1    KEY 4  - SPC
000E5C  2               ;             ||+-----> Fire2    KEY 5  - Q
000E5C  2               ;             |+------> Fire3    KEY 6  - P
000E5C  2               ;             +-------> Not used
000E5C  2               ;
000E5C  2               ;                       Option1  KEY 7  - 1
000E5C  2               ;                       Option2  KEY 8  - 2
000E5C  2               ;                       Option3  KEY 9  - 3
000E5C  2               ;                       Option4  KEY 10 - 4
000E5C  2               ;--------------------------------------------------------
000E5C  2               
000E5C  2               ;              X   Z   .   ;  SPC  Q   P
000E5C  2               ;keys:   .byte $42,$61,$68,$48,$62,$10,$37       ; Keys defined by game designer.
000E5C  2               ;        .byte $30,$31,$11,$12                   ; menu options.
000E5C  2               
000E5C  2  42 61 68 48  jkeys:  .byte $42,$61,$68,$48,$62,$10,$37       ; Keys defined by game designer.
000E60  2  62 10 37     
000E63  2  30 31 11 12          .byte $30,$31,$11,$12                   ; menu options.
000E67  2               
000E67  2               ;----------------------------------------------------
000E67  2               ; Wait for keypress.
000E67  2               ;----------------------------------------------------
000E67  2               
000E67  2               prskey:
000E67  2  8A           	txa
000E68  2  48           	pha
000E69  2               prsloop:
000E69  2  20 BC 0E     	jsr vsync
000E6C  2               
000E6C  2  A9 79        	lda #$79
000E6E  2  A2 01        	ldx #$01
000E70  2  20 F4 FF     	jsr OSBYTE
000E73  2               
000E73  2  E0 FF        	cpx #$ff
000E75  2  F0 F2        	beq prsloop		; wait until key pressed
000E77  2  68           	pla
000E78  2  AA           	tax
000E79  2  60           	rts
000E7A  2               
000E7A  2               ;--------------------------------------------------------
000E7A  2               ; Keyboard test routine.
000E7A  2               ;
000E7A  2               ; Input:
000E7A  2               ;  A = key to read, high nibble=row and low nibble=col
000E7A  2               ;
000E7A  2               ; Output:
000E7A  2               ;  carry clr = key pressed
000E7A  2               ;  carry set = key not pressed
000E7A  2               ;--------------------------------------------------------
000E7A  2               
000E7A  2               ktest:
000E7A  2  85 rr        	sta z80_a		; save key
000E7C  2  98           	tya
000E7D  2  48           	pha
000E7E  2               
000E7E  2               ; _BEEB keyboard read
000E7E  2  A5 rr        	lda z80_a
000E80  2  49 80        	eor #$80		; _BEEB just look for this key
000E82  2  AA           	tax
000E83  2               
000E83  2  A9 79        	lda #$79
000E85  2  20 F4 FF     	jsr OSBYTE
000E88  2               
000E88  2  8A           	txa
000E89  2  30 04        	bmi pressed 	; _BEEB X is negative if key is pressed
000E8B  2               
000E8B  2  38           	sec			; key not pressed
000E8C  2  68           	pla
000E8D  2  A8           	tay
000E8E  2  60           	rts
000E8F  2               
000E8F  2               pressed:
000E8F  2  18           	clc			; key pressed
000E90  2  68           	pla
000E91  2  A8           	tay
000E92  2  60           	rts
000E93  2               
000E93  2               ;---------------------------------------------------------------
000E93  2               ; Getkey in column,row format
000E93  2               ;
000E93  2               ; Output:
000E93  2               ;  A = high nibble=row and low nibble=column key in matrix
000E93  2               ;---------------------------------------------------------------
000E93  2               
000E93  2               kget:
000E93  2  86 rr        	stx xtmp
000E95  2               
000E95  2               kget1:
000E95  2  A9 79        	lda #$79			; _BEEB read keyboard with OSBYTE &79
000E97  2  A2 01        	ldx #$01
000E99  2  20 F4 FF     	jsr OSBYTE
000E9C  2               
000E9C  2  E0 FF        	cpx #$ff
000E9E  2  F0 F5        	beq kget1
000EA0  2               
000EA0  2  8A           	txa
000EA1  2               
000EA1  2  A6 rr        	ldx xtmp
000EA3  2  60           	rts
000EA4  2               
000EA4  2               ;----------------------------------------------------
000EA4  2               ; AtoMMC joystick controls.
000EA4  2               ; _BEEB TODO
000EA4  2               ;----------------------------------------------------
000EA4  2               
000EA4  2               joyinit:
000EA4  2               joysin:
000EA4  2  60           	rts
000EA5  2               
000EA5  2               
000EA5  2               ;----------------------------------------------------
000EA5  2               ; Delay routine 1/50 sec
000EA5  2               ;
000EA5  2               ; Wait 1/60 sec = 16666 usec
000EA5  2               ; Wait 208 x 16 =  3328 usec
000EA5  2               ;                 19994 usec
000EA5  2               ; rts           =     6 usec
000EA5  2               ; Total         = 20000 usec
000EA5  2               ;----------------------------------------------------
000EA5  2               
000EA5  2               delay:
000EA5  2  85 rr        	sta xtmp
000EA7  2               del_loop:
000EA7  2  A9 13        	lda #19
000EA9  2  20 F4 FF     	jsr OSBYTE		; wait for vsync _BEEB
000EAC  2               
000EAC  2  A0 D0        	ldy #208		; wait 208 x 16 = 3328 usec
000EAE  2               delay1:
000EAE  2  61 80        	adc ($80,x)		;	 6 usec
000EB0  2  61 80        	adc ($80,x)		;	 6 usec
000EB2  2  88           	dey			;	 2 usec
000EB3  2  D0 F9        	bne delay1		;	 2 usec
000EB5  2  EA           	nop			; 2 usec
000EB6  2  EA           	nop			; 2 usec
000EB7  2               				; tot: 20000 usec
000EB7  2  C6 rr        	dec xtmp
000EB9  2  D0 EC        	bne del_loop
000EBB  2  60           	rts
000EBC  2               
000EBC  2               ;-------------------------------------------------------------
000EBC  2               ; Screen synchronisation.
000EBC  2               ;
000EBC  2               ;  - read joystick/keyboard
000EBC  2               ;  - handle sound
000EBC  2               ;  - sync framerate with clock
000EBC  2               ;  - handle shrapnel every even frame
000EBC  2               ;-------------------------------------------------------------
000EBC  2               
000EBC  2               vsync:
000EBC  2  48           	pha
000EBD  2  98           	tya
000EBE  2  48           	pha
000EBF  2  8A           	txa
000EC0  2  48           	pha
000EC1  2  20 34 1C     	jsr joykey		; read joystick/keyboard.
000EC4  2               vsync1:
000EC4  2               ;	lda Timer2_High		; sync framerate with clock
000EC4  2               ;	bne vsync1
000EC4  2               ;	lda #>50000
000EC4  2               ;	sta Timer2_High
000EC4  2               ;	lda #<50000
000EC4  2               ;	sta Timer2_Low
000EC4  2               
000EC4  2  A9 13        	lda #19
000EC6  2  20 F4 FF     	jsr OSBYTE		; _BEEB vsync
000EC9  2               
000EC9  2  A5 rr        	lda clock
000ECB  2  29 01        	and #1
000ECD  2  D0 03        	bne:+
000ECF  2  20 A8 11     	jsr proshr		; handle shrapnel every even frame
000ED2  2               :
000ED2  2  AD DD 0E     	lda sndtyp
000ED5  2  F0 00        	beq sndskip
000ED7  2               ; _BEEB TODO SOUND
000ED7  2               ;sndloop:
000ED7  2               ;	lda SpeakerBit		; handle sound
000ED7  2               ;	ldy sndtyp
000ED7  2               ;sndwait:
000ED7  2               ;	dey
000ED7  2               ;	bne sndwait
000ED7  2               ;	eor #4
000ED7  2               ;	sta SpeakerBit
000ED7  2               ;	dec sndtyp
000ED7  2               ;	bne sndloop
000ED7  2               sndskip:
000ED7  2  68           	pla
000ED8  2  AA           	tax
000ED9  2  68           	pla
000EDA  2  A8           	tay
000EDB  2  68           	pla
000EDC  2  60           	rts
000EDD  2               
000EDD  2  00           sndtyp:	.byte 0
000EDE  2               
000EDE  2               ;----------------------------------------------------------------------
000EDE  2               ; BBC video hardware fns
000EDE  2               ;----------------------------------------------------------------------
000EDE  2               
000EDE  2               screeninit:
000EDE  2  A2 0D        	ldx #13
000EE0  2               crtcloop:
000EE0  2  8E 00 FE     	stx $FE00
000EE3  2  BD 00 0F     	lda crtc_regs_high,x
000EE6  2  8D 01 FE     	sta $FE01
000EE9  2  CA           	dex
000EEA  2  10 F4        	bpl crtcloop
000EEC  2               
000EEC  2                   ; Set ULA
000EEC  2  A9 88            lda #$88            ; MODE 4
000EEE  2  8D 48 02         sta $248            ; Tell the OS or it will mess with ULA settings at vsync
000EF1  2  8D 20 FE         sta $FE20
000EF4  2               
000EF4  2               ; fall through to palette
000EF4  2               
000EF4  2               setpal:
000EF4  2  A2 0F        	ldx #15
000EF6  2               palloop:
000EF6  2  BD 0E 0F     	lda ula_pal,x
000EF9  2  8D 21 FE     	sta $fe21
000EFC  2  CA           	dex
000EFD  2  10 F7        	bpl palloop
000EFF  2  60           	rts
000F00  2               
000F00  2               crtc_regs_high:
000F00  2  3F           	.byte 63				; R0  horizontal total
000F01  2  20           	.byte 32				; R1  horizontal displayed
000F02  2  31           	.byte 49				; R2  horizontal position
000F03  2  24           	.byte $24				; R3  sync width 40 = &28
000F04  2  26           	.byte 38				; R4  vertical total
000F05  2  00           	.byte 0					; R5  vertical total adjust
000F06  2  18           	.byte 24				; R6  vertical displayed
000F07  2  23           	.byte 35				; R7  vertical position; 35=top of screen
000F08  2  00           	.byte $00				; R8  interlace
000F09  2  07           	.byte 7					; R9  scanlines per row
000F0A  2  20           	.byte 32				; R10 cursor start
000F0B  2  08           	.byte 8					; R11 cursor end
000F0C  2  0D           	.byte >(ScreenAddr/8)	; R12 screen start address, high
000F0D  2  00           	.byte <(ScreenAddr/8)	; R13 screen start address, low
000F0E  2               
000F0E  2               ula_pal:
000F0E  2  07           	.byte $00 + PAL_black
000F0F  2  17           	.byte $10 + PAL_black
000F10  2  27           	.byte $20 + PAL_black
000F11  2  37           	.byte $30 + PAL_black
000F12  2  47           	.byte $40 + PAL_black
000F13  2  57           	.byte $50 + PAL_black
000F14  2  67           	.byte $60 + PAL_black
000F15  2  77           	.byte $70 + PAL_black
000F16  2  80           	.byte $80 + PAL_white
000F17  2  90           	.byte $90 + PAL_white
000F18  2  A0           	.byte $a0 + PAL_white
000F19  2  B0           	.byte $b0 + PAL_white
000F1A  2  C0           	.byte $c0 + PAL_white
000F1B  2  D0           	.byte $d0 + PAL_white
000F1C  2  E0           	.byte $e0 + PAL_white
000F1D  2  F0           	.byte $f0 + PAL_white
000F1E  2               
000F1E  2               ;----------------------------------------------------
000F1E  2               ; Draw sprite
000F1E  2               ;----------------------------------------------------
000F1E  2               
000F1E  2               sprite:
000F1E  2  86 rr        	stx xtmp		; Save X-reg
000F20  2  20 70 0F     	jsr scadd 		; get screen address in scraddr.
000F23  2               
000F23  2  A5 rr        	lda dispx 		; x position.
000F25  2  29 07        	and #7 			; position straddling cells.
000F27  2  85 rr        	sta z80_b		; store in b register.
000F29  2               
000F29  2  A5 rr        	lda z80_l		; store sprite graphic address.
000F2B  2  8D 3C 0F     	sta sprit1+1
000F2E  2  8D 42 0F     	sta sprit2+1
000F31  2  A5 rr        	lda z80_h
000F33  2  8D 3D 0F     	sta sprit1+2
000F36  2  8D 43 0F     	sta sprit2+2
000F39  2               
000F39  2  A2 00        	ldx #0			; pixel height.
000F3B  2               sprit1:
000F3B  2  BD 3D 58     	lda objdta,x		; fetch first byte.
000F3E  2  85 rr        	sta spr
000F40  2  E8           	inx
000F41  2               sprit2:
000F41  2  BD 3D 58     	lda objdta,x
000F44  2  85 rr        	sta spr+1
000F46  2               
000F46  2  A9 00        	lda #0
000F48  2  85 rr        	sta spr+2
000F4A  2  20 AE 18     	jsr sprit7		; shift sprite
000F4D  2               
000F4D  2  A5 rr        	lda spr			; fetch graphic.
000F4F  2  A0 00        	ldy #0			; _BEEB
000F51  2  51 rr        	eor (scraddr),y		; merge with screen image.
000F53  2  91 rr        	sta (scraddr),y		; write to screen.
000F55  2               
000F55  2  A5 rr        	lda spr+1		; fetch graphic.
000F57  2  A0 08        	ldy #8			; _BEEB
000F59  2  51 rr        	eor (scraddr),y		; merge with screen image.
000F5B  2  91 rr        	sta (scraddr),y		; write to screen.
000F5D  2               
000F5D  2  A5 rr        	lda spr+2		; fetch graphic.
000F5F  2  A0 10        	ldy #16			; _BEEB
000F61  2  51 rr        	eor (scraddr),y		; merge with screen image.
000F63  2  91 rr        	sta (scraddr),y		; write to screen.
000F65  2               
000F65  2  20 D2 0F     	jsr nline
000F68  2               
000F68  2  E8           	inx			; next source byte.
000F69  2  E0 20        	cpx #32
000F6B  2  D0 CE        	bne sprit1		; repeat
000F6D  2               
000F6D  2  A6 rr        	ldx xtmp		; retreive X-reg
000F6F  2  60           	rts
000F70  2               
000F70  2               ;------------------------------------------------------------------
000F70  2               ; This routine returns a screen address for (dispx, dispy) in scraddr.
000F70  2               ;------------------------------------------------------------------
000F70  2               
000F70  2               scadd:
000F70  2  A6 rr        	ldx dispy
000F72  2  A5 rr        	lda dispx
000F74  2  29 F8        	and #$f8
000F76  2  18           	clc
000F77  2  7D 00 06     	adc SCADTB_lb,x
000F7A  2  85 rr        	sta scraddr
000F7C  2  BD 00 07     	lda SCADTB_hb,x
000F7F  2  69 00        	adc #0
000F81  2  85 rr        	sta scraddr+1
000F83  2  60           	rts
000F84  2               
000F84  2               ;-----------------------------------------------------------------
000F84  2               ; These are the sprite routines.
000F84  2               ; sspria = single sprite, old (ix).
000F84  2               ; ssprib = single sprite, new (ix+5).
000F84  2               ; sspric = both sprites, old (ix) and new (ix+5).
000F84  2               ;-----------------------------------------------------------------
000F84  2               
000F84  2               sspria:
000F84  2  20 82 1F     	jsr gsprad		; get old sprite address.
000F87  2               sspri2:
000F87  2  A2 10        	ldx #16			; vertical lines.
000F89  2               sspri0:
000F89  2  20 A8 0F     	jsr dline		; draw a line.
000F8C  2  CA           	dex
000F8D  2  D0 FA        	bne sspri0		; repeat 16 times
000F8F  2  60           	rts
000F90  2               
000F90  2               ;-----------------------------------------------------------------
000F90  2               
000F90  2               ssprib:
000F90  2  20 63 1F     	jsr gspran 		; get new sprite address.
000F93  2  4C 87 0F     	jmp sspri2
000F96  2               
000F96  2               ;-----------------------------------------------------------------
000F96  2               
000F96  2               sspric:
000F96  2  20 82 1F     	jsr gsprad 		; get old sprite address.
000F99  2  20 2B 0E     	jsr exx  		; store addresses.
000F9C  2  20 63 1F     	jsr gspran 		; get new sprite addresses.
000F9F  2               
000F9F  2  A2 10        	ldx #16
000FA1  2               lloop:
000FA1  2  20 EB 0F     	jsr ddline 		; draw a line.
000FA4  2  CA           	dex
000FA5  2  D0 FA        	bne lloop
000FA7  2  60           	rts
000FA8  2               
000FA8  2               ;-------------------------------------------------------------
000FA8  2               ; Drop through.
000FA8  2               ; Line drawn, now work out next target address.
000FA8  2               ;
000FA8  2               ; Input:
000FA8  2               ;  B  = right mask
000FA8  2               ;  C  = left mask
000FA8  2               ;  DE = spriteaddress
000FA8  2               ;  scraddr = screen address
000FA8  2               ;-------------------------------------------------------------
000FA8  2               
000FA8  2               dline:
000FA8  2  A0 00        	ldy #0
000FAA  2  B1 rr        	lda (z80_de),y 		; graphic data.
000FAC  2  25 rr        	and z80_c 			; mask away what's not needed.
000FAE  2               
000FAE  2               ; _BEEB screen arrangement
000FAE  2  51 rr        	eor (scraddr),y 	; XOR with what's there.
000FB0  2  91 rr        	sta (scraddr),y 	; bung it in.
000FB2  2               
000FB2  2  B1 rr        	lda (z80_de),y 		; fetch data.
000FB4  2  25 rr        	and z80_b 			; mask away unwanted
000FB6  2               
000FB6  2               ; _BEEB screen arrangement
000FB6  2  A0 10        	ldy #16
000FB8  2  51 rr        	eor (scraddr),y 	; XOR with what's there.
000FBA  2  91 rr        	sta (scraddr),y 	; bung it in.
000FBC  2               
000FBC  2  E6 rr        	inc z80_e			; next graphic.
000FBE  2  D0 02        	bne :+
000FC0  2  E6 rr        	inc z80_d
000FC2  2               :
000FC2  2  A0 00        	ldy #0
000FC4  2  B1 rr        	lda (z80_de),y 		; second bit of data.
000FC6  2               
000FC6  2               ; _BEEB screen arrangement
000FC6  2  A0 08        	ldy #8
000FC8  2  51 rr        	eor (scraddr),y 	; XOR with what's there.
000FCA  2  91 rr        	sta (scraddr),y 	; bung it in.
000FCC  2               
000FCC  2  E6 rr        	inc z80_e			; next graphic.
000FCE  2  D0 02        	bne :+
000FD0  2  E6 rr        	inc z80_d
000FD2  2               :
000FD2  2               
000FD2  2               ;----------------------------------------------------------------------
000FD2  2               ; Line drawn, now work out next target address.
000FD2  2               ;----------------------------------------------------------------------
000FD2  2               
000FD2  2               ; _BEEB screen arrangement
000FD2  2               
000FD2  2               nline:
000FD2  2  A5 rr        	lda scraddr 		; get low byte of address.
000FD4  2  29 07        	and #7
000FD6  2  C9 07        	cmp #7				; is this last line of row?
000FD8  2  F0 03        	beq beeb_next_row
000FDA  2               
000FDA  2               	; within same row
000FDA  2  E6 rr        	inc scraddr			; new low byte of address.
000FDC  2               ;	bne :+
000FDC  2               ;	inc scraddr+1		; new high byte of address.
000FDC  2               :
000FDC  2  60           	rts
000FDD  2               
000FDD  2               beeb_next_row:
000FDD  2  18           	clc
000FDE  2  A5 rr        	lda scraddr
000FE0  2  69 F9        	adc #<(ScreenRowBytes-7)
000FE2  2  85 rr        	sta scraddr			; new low byte of address.
000FE4  2  A5 rr        	lda scraddr+1
000FE6  2  69 00        	adc #>(ScreenRowBytes-7)
000FE8  2  85 rr        	sta scraddr+1		; new high byte of address.
000FEA  2  60           	rts
000FEB  2               
000FEB  2               ;-------------------------------------------------------------
000FEB  2               ; Drop through.
000FEB  2               ; Line drawn, now work out next target address.
000FEB  2               ;
000FEB  2               ; Input:
000FEB  2               ;  B  = right mask
000FEB  2               ;  C  = left mask
000FEB  2               ;  DE = spriteaddress
000FEB  2               ;  scraddr = screen address
000FEB  2               ;-------------------------------------------------------------
000FEB  2               
000FEB  2               ddline:
000FEB  2               
000FEB  2               ; NEW SPRITE
000FEB  2               
000FEB  2  A0 00        	ldy #0
000FED  2  B1 rr        	lda (z80_de),y 		; graphic data.
000FEF  2  25 rr        	and z80_c 			; mask away what's not needed.
000FF1  2               
000FF1  2               ; _BEEB screen arrangement
000FF1  2  51 rr        	eor (scraddr),y 	; XOR with what's there.
000FF3  2  91 rr        	sta (scraddr),y 	; bung it in.
000FF5  2               
000FF5  2  B1 rr        	lda (z80_de),y 		; fetch data.
000FF7  2  25 rr        	and z80_b 			; mask away unwanted
000FF9  2               
000FF9  2               ; _BEEB screen arrangement
000FF9  2  A0 10        	ldy #16
000FFB  2  51 rr        	eor (scraddr),y 	; XOR with what's there.
000FFD  2  91 rr        	sta (scraddr),y 	; bung it in.
000FFF  2               
000FFF  2  E6 rr        	inc z80_e			; next graphic.
001001  2  D0 02        	bne :+
001003  2  E6 rr        	inc z80_d
001005  2               :
001005  2  A0 00        	ldy #0
001007  2  B1 rr        	lda (z80_de),y 		; second bit of data.
001009  2               
001009  2               ; _BEEB screen arrangement
001009  2  A0 08        	ldy #8
00100B  2  51 rr        	eor (scraddr),y 	; XOR with what's there.
00100D  2  91 rr        	sta (scraddr),y 	; bung it in.
00100F  2               
00100F  2  E6 rr        	inc z80_e			; next graphic.
001011  2  D0 02        	bne :+
001013  2  E6 rr        	inc z80_d
001015  2               :
001015  2               
001015  2               ; _BEEB next row
001015  2               
001015  2  A5 rr        	lda scraddr 		; get low byte of address.
001017  2  29 07        	and #7
001019  2  C9 07        	cmp #7				; is this last line of row?
00101B  2  F0 05        	beq :+
00101D  2               
00101D  2               	; within same row can't increment page
00101D  2  E6 rr        	inc scraddr			; new low byte of address.
00101F  2  4C 2F 10     	jmp ddline2
001022  2               
001022  2               :
001022  2  18           	clc
001023  2  A5 rr        	lda scraddr
001025  2  69 F9        	adc #<(ScreenRowBytes-7)
001027  2  85 rr        	sta scraddr			; new low byte of address.
001029  2  A5 rr        	lda scraddr+1
00102B  2  69 00        	adc #>(ScreenRowBytes-7)
00102D  2  85 rr        	sta scraddr+1		; new high byte of address.
00102F  2               
00102F  2               ; OLD SPRITE
00102F  2               
00102F  2               ddline2:
00102F  2               
00102F  2  A0 00        	ldy #0
001031  2  B1 rr        	lda (z80_dep),y 		; graphic data.
001033  2  25 rr        	and z80_cp 			; mask away what's not needed.
001035  2               
001035  2               ; _BEEB screen arrangement
001035  2  51 rr        	eor (z80_hlp),y 	; XOR with what's there.
001037  2  91 rr        	sta (z80_hlp),y 	; bung it in.
001039  2               
001039  2  B1 rr        	lda (z80_dep),y 		; fetch data.
00103B  2  25 rr        	and z80_bp 			; mask awayh unwanted
00103D  2               
00103D  2               ; _BEEB screen arrangement
00103D  2  A0 10        	ldy #16
00103F  2  51 rr        	eor (z80_hlp),y 	; XOR with what's there.
001041  2  91 rr        	sta (z80_hlp),y 	; bung it in.
001043  2               
001043  2  E6 rr        	inc z80_ep			; next graphic.
001045  2  D0 02        	bne :+
001047  2  E6 rr        	inc z80_dp
001049  2               :
001049  2  A0 00        	ldy #0
00104B  2  B1 rr        	lda (z80_dep),y 		; second bit of data.
00104D  2               
00104D  2               ; _BEEB screen arrangement
00104D  2  A0 08        	ldy #8
00104F  2  51 rr        	eor (z80_hlp),y 	; XOR with what's there.
001051  2  91 rr        	sta (z80_hlp),y 	; bung it in.
001053  2               
001053  2  E6 rr        	inc z80_ep			; next graphic.
001055  2  D0 02        	bne :+
001057  2  E6 rr        	inc z80_dp
001059  2               :
001059  2               
001059  2               ; _BEEB screen arrangement
001059  2               
001059  2  A5 rr        	lda z80_lp 		; get low byte of address.
00105B  2  29 07        	and #7
00105D  2  C9 07        	cmp #7				; is this last line of row?
00105F  2  F0 03        	beq :+
001061  2               
001061  2               	; within same row can't increment page
001061  2  E6 rr        	inc z80_lp			; new low byte of address.
001063  2  60           	rts
001064  2               
001064  2               :
001064  2  18           	clc
001065  2  A5 rr        	lda z80_lp
001067  2  69 F9        	adc #<(ScreenRowBytes-7)
001069  2  85 rr        	sta z80_lp			; new low byte of address.
00106B  2  A5 rr        	lda z80_lp+1
00106D  2  69 00        	adc #>(ScreenRowBytes-7)
00106F  2  85 rr        	sta z80_lp+1		; new high byte of address.
001071  2  60           	rts
001072  2               
001072  2               ;----------------------------------------------------
001072  2               ; Display character in A at dispx,dispy.
001072  2               ;
001072  2               ; Input:
001072  2               ;  A 	   = character to print
001072  2               ;----------------------------------------------------
001072  2               
001072  2               pchar:
001072  2  85 rr        	sta fntaddr
001074  2  A9 00        	lda #0
001076  2  85 rr        	sta fntaddr+1
001078  2  06 rr        	asl fntaddr  		; multiply char by 8.
00107A  2  26 rr        	rol fntaddr+1
00107C  2  06 rr        	asl fntaddr
00107E  2  26 rr        	rol fntaddr+1
001080  2  06 rr        	asl fntaddr
001082  2  26 rr        	rol fntaddr+1
001084  2               
001084  2  A5 rr        	lda fntaddr
001086  2  18           	clc
001087  2  65 rr        	adc FontPtr
001089  2  85 rr        	sta fntaddr		; that's the low byte.
00108B  2  A5 rr        	lda fntaddr+1
00108D  2  65 rr        	adc FontPtr+1
00108F  2  85 rr        	sta fntaddr+1		; add displacement.
001091  2               pchark:
001091  2  20 F4 17     	jsr gprad		; get screen address.
001094  2  A2 07        	ldx #7			; lines to write.
001096  2               pchar0:
001096  2  A0 00        	ldy #0
001098  2  B1 rr        	lda (fntaddr),y 	; get image byte.
00109A  2  BC AB 10     	ldy scrtab,x		; Get rowoffset
00109D  2               
00109D  2  49 00        	eor #TxtInvert		; Invert
00109F  2               
00109F  2  91 rr        	sta (scraddr),y 	; copy to screen.
0010A1  2  E6 rr        	inc fntaddr		; next image byte.
0010A3  2  D0 02        	bne :+
0010A5  2  E6 rr        	inc fntaddr+1
0010A7  2               :
0010A7  2  CA           	dex			; next screen row down.
0010A8  2  10 EC        	bpl pchar0		; repeat.
0010AA  2  60           	rts
0010AB  2               
0010AB  2  07 06 05 04  scrtab:		.byte $07,$06,$05,$04,$03,$02,$01,$00
0010AF  2  03 02 01 00  
0010B3  2               ;scrtab:	.byte $e0,$c0,$a0,$80,$60,$40,$20,$00
0010B3  2               
0010B3  1               
0010B3  1               ;----------------------------------------------------------------------
0010B3  1               ; AGD 6502 ENGINE CODE + COMPILED GAME SCRIPT
0010B3  1               ;----------------------------------------------------------------------
0010B3  1               
0010B3  1               start_game:
0010B3  1               
0010B3  1               	.include "game.inc"
0010B3  2               .include "darktricks.inc"
0010B3  3               ; Game engine code --------------------------------------------------------------
0010B3  3               
0010B3  3               ; Arcade Game Designer.
0010B3  3               ; (C) 2008 Jonathan Cauldwell.
0010B3  3               ; ZX Spectrum Next Engine v0.1.
0010B3  3               
0010B3  3               ; Global definitions ------------------------------------------------------------
0010B3  3               
0010B3  3               	FONT = font			; Font address
0010B3  3               
0010B3  3               ; Block characteristics.
0010B3  3               
0010B3  3               	PLATFM = 1			; platform.
0010B3  3               	WALL = PLATFM + 1	; solid wall.
0010B3  3               	LADDER = WALL + 1	; ladder.
0010B3  3               	FODDER = LADDER + 1	; fodder block.
0010B3  3               	DEADLY = FODDER + 1	; deadly block.
0010B3  3               	CUSTOM = DEADLY + 1	; custom block.
0010B3  3               	WATER  = CUSTOM + 1	; water block.
0010B3  3                   COLECT = WATER + 1      ; collectable block.
0010B3  3                   NUMTYP = COLECT + 1     ; number of types.
0010B3  3               
0010B3  3               ; Sprites.
0010B3  3               
0010B3  3               	NUMSPR = 12			; number of sprites.
0010B3  3               	TABSIZ = 17			; size of each entry.
0010B3  3               	SPRBUF = NUMSPR * TABSIZ; size of entire table.
0010B3  3               	NMESIZ = 4			; bytes stored in nmetab for each sprite.
0010B3  3               
0010B3  3               ; Sprite table variable offsets.
0010B3  3               
0010B3  3               	var_Type = 0		; sprite type
0010B3  3               	var_Image = 1		; sprite time number
0010B3  3               	var_Frame = 2		; sprite frame
0010B3  3               	var_Y = 3			; sprite y coordinate
0010B3  3               	var_X = 4			; sprite X coordinate
0010B3  3               
0010B3  3               	var_newType = 5		; sprite new type
0010B3  3               	var_newImage = 6	; sprite new image number
0010B3  3               	var_newFrame = 7	; sprite new frame
0010B3  3               	var_newY = 8		; sprite new y coordinate
0010B3  3               	var_newX = 9		; sprite new x coordinate
0010B3  3               
0010B3  3               	var_Direction = 10	; sprite direction
0010B3  3               	var_Param1 = 11		; sprite parameter 1
0010B3  3               	var_Param2 = 12		; sprite parameter 2
0010B3  3               
0010B3  3               	var_jumpLo = 13		; sprite jump ptr low
0010B3  3               	var_jumpHi = 14		; sprite jump ptr high
0010B3  3               	var_dataLo = 15		; sprite data ptr low
0010B3  3               	var_dataHi = 16		; sprite data ptr high
0010B3  3               
0010B3  3               ; Particle engine.
0010B3  3               
0010B3  3               	NUMSHR = 55			; pieces of shrapnel.
0010B3  3               	SHRSIZ = 6			; bytes per particle.
0010B3  3               
0010B3  3               ; Conditional compilation flags
0010B3  3               ; Flags are set in commandline assembly
0010B3  3               
0010B3  3               ;	mflag = 0 		; MENU + INV
0010B3  3               ;	pflag = 0		; Particle engine
0010B3  3               ;	sflag = 0		; scrollytext
0010B3  3               ;	fflag = 1		; Fontflag
0010B3  3               
0010B3  3               .if iflag
0010B3  3               	TxtInvert   = $ff	; Invert byte for character printing
0010B3  3               	ScrFillByte = $ff	; Screen fill byte for CLS
0010B3  3               .else
0010B3  3               	TxtInvert   = $00	; Invert byte for character printing
0010B3  3               	ScrFillByte = $00	; Screen fill byte for CLS
0010B3  3               .endif
0010B3  3               
0010B3  3               	ASCII_NEWLINE = 13
0010B3  3               
0010B3  3               ;===============================================================
0010B3  3               ; Game starts here
0010B3  3               ;===============================================================
0010B3  3               
0010B3  3               ;--------------------------------------------------------------
0010B3  3               ; If a font is required...
0010B3  3               ;--------------------------------------------------------------
0010B3  3               
0010B3  3  A9 53        	lda #<(FONT-256)	; address of font.
0010B5  3  85 rr        	sta FontPtr
0010B7  3  A9 5D        	lda #>(FONT-256)
0010B9  3  85 rr        	sta FontPtr+1
0010BB  3               
0010BB  3  20 A9 11     	jsr game	 		; start the game.
0010BE  3  60           	rts
0010BF  3               
0010BF  3               ; Don't change the order of these four.
0010BF  3               ; Menu routine relies on winlft following wintop.
0010BF  3               
0010BF  3  01           wintop:	.byte WINDOWTOP		; top of window.
0010C0  3  01           winlft:	.byte WINDOWLFT		; left edge.
0010C1  3  16           winhgt:	.byte WINDOWHGT		; window height.
0010C2  3  1E           winwid:	.byte WINDOWWID		; window width.
0010C3  3  29           numob:	.byte NUMOBJ		; number of objects in game.
0010C4  3               
0010C4  3               ; Pixel versions of wintop, winlft, winhgt, winwid.
0010C4  3               
0010C4  3  08           wntopx:	.byte (8 * WINDOWTOP)
0010C5  3  08           wnlftx:	.byte (8 * WINDOWLFT)
0010C6  3  A8           wnbotx:	.byte ((WINDOWTOP * 8) + (WINDOWHGT * 8) - 16)
0010C7  3  E6           wnrgtx:	.byte ((WINDOWLFT * 8) + (WINDOWWID * 8) - 16)-2
0010C8  3               
0010C8  3               ; Make sure pointers are arranged in the same order as the data itself.
0010C8  3               
0010C8  3  0A 3A        frmptr:	.word frmlst         ; sprite frames.
0010CA  3               
0010CA  3               ; Assorted game routines which can go in contended memory.
0010CA  3               
0010CA  3               ;--------------------------------------------------------------
0010CA  3               ; Modify for inventory.
0010CA  3               ; called by the INV command
0010CA  3               ;
0010CA  3               ; Input:
0010CA  3               ;  X   = message nr with objects seperated with ,
0010CA  3               ;
0010CA  3               ; Output:
0010CA  3               ;  OPT = selected line nr of INV menu
0010CA  3               ;--------------------------------------------------------------
0010CA  3               
0010CA  3               .if mflag
0010CA  3               minve:
0010CA  3               	lda #<(invdis)		; routine address.
0010CA  3               	sta mod0+1		; set up menu routine.
0010CA  3               	sta mod2+1		; set up count routine.
0010CA  3               	lda #>(invdis)
0010CA  3               	sta mod0+2
0010CA  3               	sta mod2+2
0010CA  3               	lda #<(fopt)		; find option from available objects.
0010CA  3               	sta mod1+1		; set up routine.
0010CA  3               	lda #>(fopt)
0010CA  3               	sta mod1+1+1
0010CA  3               	jmp dbox		; do menu routine.
0010CA  3               
0010CA  3               ;--------------------------------------------------------------
0010CA  3               ; Modify for menu.
0010CA  3               ; called by the MENU command
0010CA  3               ;
0010CA  3               ; Input:
0010CA  3               ;  X   = message nr with menu items seperated with ,
0010CA  3               ;
0010CA  3               ; Output:
0010CA  3               ;  OPT = selected line nr of MENU menu
0010CA  3               ;--------------------------------------------------------------
0010CA  3               
0010CA  3               mmenu:
0010CA  3               	lda #<(always)		; routine address.
0010CA  3               	sta mod0+1		; set up routine.
0010CA  3               	sta mod2+1		; set up count routine.
0010CA  3               	lda #>(always)
0010CA  3               	sta mod0+2
0010CA  3               	sta mod2+2
0010CA  3               
0010CA  3               	lda #<(fstd)		; standard option selection.
0010CA  3               	sta mod1+1		; set up routine.
0010CA  3               	lda #>(fstd)
0010CA  3               	sta mod1+2
0010CA  3               
0010CA  3               ; Drop through into box routine.
0010CA  3               
0010CA  3               ;--------------------------------------------------------------
0010CA  3               ; Work out size of box for message or menu.
0010CA  3               ;--------------------------------------------------------------
0010CA  3               
0010CA  3               dbox:
0010CA  3               	lda #<(msgdat)		; pointer to messages.
0010CA  3               	sta z80_l
0010CA  3               	lda #>(msgdat)
0010CA  3               	sta z80_h
0010CA  3               
0010CA  3               	jsr getwrd		; get message number.
0010CA  3               
0010CA  3               	lda z80_h		; store pointer to message.
0010CA  3               	sta TmpAddr
0010CA  3               	lda z80_l
0010CA  3               	sta TmpAddr+1
0010CA  3               
0010CA  3               	lda #1			; height.
0010CA  3               	sta z80_d
0010CA  3               	lda #0			; start at object zero.
0010CA  3               	sta combyt		; store number of object in combyt.
0010CA  3               	sta z80_e		; maximum width.
0010CA  3               dbox5:
0010CA  3               	lda #0			; this line"s width.
0010CA  3               	sta z80_b
0010CA  3               mod2:
0010CA  3               	jsr always		; item in player"s possession?
0010CA  3               	cmp #255
0010CA  3               	bne dbox6		; not in inventory, skip this line.
0010CA  3               	inc z80_d		; add to tally.
0010CA  3               dbox6:
0010CA  3               	ldy #0			; get character.
0010CA  3               	lda (z80_hl),y
0010CA  3               	sta z80_a
0010CA  3               	inc z80_l		; next character.
0010CA  3               	bne :+
0010CA  3               	inc z80_h
0010CA  3               :
0010CA  3               	lda z80_a		; reached end of line?
0010CA  3               	cmp #','
0010CA  3               	beq dbox3		; yes.
0010CA  3               	cmp #ASCII_NEWLINE
0010CA  3               	beq dbox3		; yes.
0010CA  3               	inc z80_b		; add to this line"s width.
0010CA  3               	lda z80_a
0010CA  3               	bmi dbox4		; end of message? yes, end count.
0010CA  3               	jmp dbox6		; repeat until we find the end.
0010CA  3               dbox3:
0010CA  3               	lda z80_e		; maximum line width.
0010CA  3               	cmp z80_b		; have we exceeded longest so far?
0010CA  3               	bpl dbox5		; no, carry on looking.
0010CA  3               	lda z80_b		; make this the widest so far.
0010CA  3               	sta z80_e
0010CA  3               	jmp dbox5		; keep looking.
0010CA  3               dbox4:
0010CA  3               	lda z80_e		; maximum line width.
0010CA  3               	cmp z80_b		; have we exceeded longest so far?
0010CA  3               	bpl dbox8		; no, carry on looking.
0010CA  3               	lda z80_b		; final line is the longest so far.
0010CA  3               	sta z80_e
0010CA  3               dbox8:
0010CA  3               	dec z80_d		; decrement items found.
0010CA  3               	bne :+			; total was zero.
0010CA  3               	jmp dbox15
0010CA  3               :
0010CA  3               	lda z80_e		; longest line.
0010CA  3               	bne :+			; was it zero?
0010CA  3               	jmp dbox15		; total was zero.
0010CA  3               :
0010CA  3               	sta bwid		; set up size.
0010CA  3               	lda z80_d
0010CA  3               	sta blen
0010CA  3               
0010CA  3               ;--------------------------------------------------------------
0010CA  3               ; That's set up our box size.
0010CA  3               ;--------------------------------------------------------------
0010CA  3               
0010CA  3               	lda winhgt		; window height in characters.
0010CA  3               	sec
0010CA  3               	sbc z80_d		; subtract height of box.
0010CA  3               	lsr a			; divide by 2.
0010CA  3               	clc
0010CA  3               	adc wintop		; add top edge of window.
0010CA  3               	sta btop		; set up box top.
0010CA  3               
0010CA  3               	lda winwid		; window width in characters.
0010CA  3               	sec
0010CA  3               	sbc z80_e		; subtract box width.
0010CA  3               	lsr a			; divide by 2.
0010CA  3               	clc
0010CA  3               	adc winlft		; add left edge of window.
0010CA  3               	sta blft		; box left.
0010CA  3               
0010CA  3               	lda FontPtr		; font.
0010CA  3               	sta grbase		; set up for text display.
0010CA  3               	lda FontPtr+1
0010CA  3               	sta grbase+1
0010CA  3               
0010CA  3               	lda TmpAddr+1		; restore message pointer.
0010CA  3               	sta z80_l
0010CA  3               	lda TmpAddr
0010CA  3               	sta z80_h
0010CA  3               
0010CA  3               	lda btop		; box top.
0010CA  3               	sta dispy		; set display coordinate.
0010CA  3               	lda #0			; start at object zero.
0010CA  3               	sta combyt		; store number of object in combyt.
0010CA  3               dbox2:
0010CA  3               	lda combyt		; get object number.
0010CA  3               	sta z80_a
0010CA  3               mod0:
0010CA  3               	jsr always		; check inventory for display.
0010CA  3               	cmp #255
0010CA  3               	beq :+
0010CA  3               	jmp dbox13		; not in inventory, skip this line.
0010CA  3               :
0010CA  3               	lda blft		; box left.
0010CA  3               	sta dispx		; set left display position.
0010CA  3               	lda bwid		; box width.
0010CA  3               	sta z80_b		; store width.
0010CA  3               dbox0:
0010CA  3               	ldy #0			; get character.
0010CA  3               	lda (z80_hl),y
0010CA  3               	cmp #','		; end of line?
0010CA  3               	beq dbox1		; yes, next one.
0010CA  3               	cmp #ASCII_NEWLINE			; end of line?
0010CA  3               	beq dbox1		; yes, next one.
0010CA  3               
0010CA  3               	dec z80_b		; one less to display.
0010CA  3               	and #127		; remove terminator.
0010CA  3               
0010CA  3               	jsr pchr		; display on screen.
0010CA  3               
0010CA  3               	ldy #0
0010CA  3               	lda (z80_hl),y		; get character.
0010CA  3               	sta z80_a
0010CA  3               	inc z80_l		; next character.
0010CA  3               	bne :+
0010CA  3               	inc z80_h
0010CA  3               :
0010CA  3               	lda z80_a
0010CA  3               	cmp #128		; end of message?
0010CA  3               	bmi :+
0010CA  3               	jmp dbox7		; yes, job done.
0010CA  3               :
0010CA  3               	lda z80_b		; chars remaining.
0010CA  3               	beq :+			; are any left?
0010CA  3               	jmp dbox0		; yes, continue.
0010CA  3               :
0010CA  3               ;---------------------------------------------------
0010CA  3               ; Reached limit of characters per line.
0010CA  3               ;---------------------------------------------------
0010CA  3               
0010CA  3               dbox9:
0010CA  3               	ldy #0
0010CA  3               	lda (z80_hl),y		; get character.
0010CA  3               	inc z80_l		; next one.
0010CA  3               	bne :+
0010CA  3               	inc z80_h
0010CA  3               :
0010CA  3               	cmp #','		; another line?
0010CA  3               	beq dbox10		; yes, do next line.
0010CA  3               	cmp #ASCII_NEWLINE			; another line?
0010CA  3               	beq dbox10		; yes, do next line.
0010CA  3               	cmp #128		; end of message?
0010CA  3               	bcs :+
0010CA  3               	jmp dbox11		; yes, finish message.
0010CA  3               :
0010CA  3               	jmp dbox9
0010CA  3               
0010CA  3               ;---------------------------------------------------
0010CA  3               ; Fill box to end of line.
0010CA  3               ;---------------------------------------------------
0010CA  3               
0010CA  3               dboxf:
0010CA  3               	lda #32			; space character.
0010CA  3               	jsr pchr		; display character.
0010CA  3               	dec z80_b
0010CA  3               	beq :+
0010CA  3               	jmp dboxf		; repeat for remaining chars on line.
0010CA  3               :
0010CA  3               	rts
0010CA  3               dbox1:
0010CA  3               	inc z80_l		; skip character.
0010CA  3               	bne :+
0010CA  3               	inc z80_h
0010CA  3               :
0010CA  3               	jsr dboxf		; fill box out to right side.
0010CA  3               dbox10:
0010CA  3               	inc dispy		; y coordinate down a line next position.
0010CA  3               	jmp dbox2		; next line.
0010CA  3               dbox7:
0010CA  3               	lda z80_b		; chars remaining.
0010CA  3               	bne :+			; are any left?
0010CA  3               	jmp dbox11		; no, nothing to draw.
0010CA  3               :
0010CA  3               	jsr dboxf		; fill message to line.
0010CA  3               
0010CA  3               ;------------------------------------------------------
0010CA  3               ; Drawn the box menu, now select option.
0010CA  3               ;------------------------------------------------------
0010CA  3               
0010CA  3               dbox11:
0010CA  3               	lda btop		; box top.
0010CA  3               	sta dispy		; set bar position.
0010CA  3               dbox14:
0010CA  3               	jsr joykey		; get controls.
0010CA  3               	cmp #$7f		; anything pressed?
0010CA  3               	bne dbox14		; yes, debounce it.
0010CA  3               	jsr dbar		; draw bar.
0010CA  3               dbox12:
0010CA  3               	jsr joykey		; get controls.
0010CA  3               	cmp #$7f		; anything pressed?
0010CA  3               	beq dbox12		; no, nothing.
0010CA  3               	and #16			; fire button pressed?
0010CA  3               	bne :+
0010CA  3               mod1:
0010CA  3               	jmp fstd		; yes, job done.
0010CA  3               :
0010CA  3               	jsr dbar		; delete bar.
0010CA  3               
0010CA  3               	lda joyval		; joystick reading.
0010CA  3               	and #8			; going up?
0010CA  3               	beq dboxu		; yes, go up.
0010CA  3               
0010CA  3               	ldx dispy		; vertical position of bar.
0010CA  3               	inx			; look down.
0010CA  3               	txa
0010CA  3               	sec
0010CA  3               	sbc btop		; find distance from top.
0010CA  3               	cmp blen		; top of box.
0010CA  3               	bne :+
0010CA  3               	jmp dbox14		; yes, go no further.
0010CA  3               :
0010CA  3               	inc dispy		; move bar.
0010CA  3               	jmp dbox14		; continue.
0010CA  3               dboxu:
0010CA  3               	lda dispy		; vertical position of bar.
0010CA  3               	cmp btop		; are we at the top?
0010CA  3               	bne :+
0010CA  3               	jmp dbox14		; yes, go no further.
0010CA  3               :
0010CA  3               	dec dispy		; move bar.
0010CA  3               	jmp dbox14		; continue.
0010CA  3               fstd:
0010CA  3               	lda dispy		; bar position.
0010CA  3               	sec
0010CA  3               	sbc btop		; find selected option.
0010CA  3               	sta varopt		; store the option.
0010CA  3               	jmp redraw		; redraw the screen.
0010CA  3               
0010CA  3               ;------------------------------------------------------
0010CA  3               ; Option not available.  Skip this line.
0010CA  3               ;------------------------------------------------------
0010CA  3               
0010CA  3               dbox13:
0010CA  3               	ldy #0
0010CA  3               	lda (z80_hl),y		; get character.
0010CA  3               	inc z80_l		; next one.
0010CA  3               	bne :+
0010CA  3               	inc z80_h
0010CA  3               :
0010CA  3               	cmp #','		; another line?
0010CA  3               	bne :+
0010CA  3               	jmp dbox2		; yes, do next line.
0010CA  3               :
0010CA  3               	cmp #ASCII_NEWLINE			; another line?
0010CA  3               	bne :+
0010CA  3               	jmp dbox2		; yes, do next line.
0010CA  3               :
0010CA  3               
0010CA  3               	bpl :+			; end of message?
0010CA  3               	jmp dbox11		; yes, finish message.
0010CA  3               :
0010CA  3               	jmp dbox13
0010CA  3               dbox15:
0010CA  3               	lda TmpAddr		; pop message pointer from the stack.
0010CA  3               	sta z80_h
0010CA  3               	lda TmpAddr+1
0010CA  3               	sta z80_l
0010CA  3               	rts
0010CA  3               
0010CA  3               ;------------------------------------------------------
0010CA  3               ; Invert bar
0010CA  3               ;------------------------------------------------------
0010CA  3               
0010CA  3               dbar:
0010CA  3               	lda blft		; box left.
0010CA  3               	sta dispx		; set display coordinate.
0010CA  3               	jsr gprad		; get printing address.
0010CA  3               
0010CA  3               	lda bwid		; box width.
0010CA  3               	sta z80_c		; loop counter in c.
0010CA  3               	lda z80_h
0010CA  3               	sta z80_d		; store screen address high byte.
0010CA  3               dbar1:
0010CA  3               	ldx #7			; pixel height in b.
0010CA  3               dbar0:
0010CA  3               	ldy scrtab,x
0010CA  3               	lda (scraddr),y		; get screen byte.
0010CA  3               	eor #255		; reverse all bits.
0010CA  3               	sta (scraddr),y		; write back to screen.
0010CA  3               	dex			; next line down.
0010CA  3               	bpl dbar0		; draw rest of character.
0010CA  3               
0010CA  3               	clc
0010CA  3               	lda scraddr		; one char right.
0010CA  3               	adc #8
0010CA  3               	sta scraddr
0010CA  3               	bcc :+
0010CA  3               	inc scraddr+1
0010CA  3               :
0010CA  3               
0010CA  3               	dec z80_c		; decrement character counter.
0010CA  3               	beq :+
0010CA  3               	jmp dbar1		; repeat for whole line.
0010CA  3               :
0010CA  3               	rts
0010CA  3               
0010CA  3               ;------------------------------------------------------
0010CA  3               ; Point to object
0010CA  3               ;
0010CA  3               ; Input:
0010CA  3               ;  -
0010CA  3               ;
0010CA  3               ; Output:
0010CA  3               ;  A = object number, A=255 if already in possession
0010CA  3               ;------------------------------------------------------
0010CA  3               
0010CA  3               invdis:
0010CA  3               	lda z80_l		; store message text pointer.
0010CA  3               	pha
0010CA  3               	lda z80_h
0010CA  3               	pha
0010CA  3               	lda combyt		; object number.
0010CA  3               	inc combyt		; ready for next one.
0010CA  3               	jsr gotob		; check if we have object.
0010CA  3               	tay
0010CA  3               	pla
0010CA  3               	sta z80_h
0010CA  3               	pla
0010CA  3               	sta z80_l
0010CA  3               	tya
0010CA  3               	rts
0010CA  3               
0010CA  3               ;------------------------------------------------------
0010CA  3               ; Find option selected.
0010CA  3               ;
0010CA  3               ; Input:
0010CA  3               ;  -
0010CA  3               ;
0010CA  3               ; Output:
0010CA  3               ;  OPT = selected object
0010CA  3               ;------------------------------------------------------
0010CA  3               
0010CA  3               fopt:
0010CA  3               	lda dispy
0010CA  3               	sec
0010CA  3               	sbc btop		; find selected option.
0010CA  3               	sta tmp+2		; option selected in b register.
0010CA  3               	inc tmp+2
0010CA  3               
0010CA  3               	lda #0			; set to first item.
0010CA  3               	sta combyt		; object number.
0010CA  3               fopt0:
0010CA  3               	jsr fobj		; find next object in inventory.
0010CA  3               	dec tmp+2
0010CA  3               	bne fopt0		; repeat for relevant steps down the list.
0010CA  3               
0010CA  3               	lda combyt		; get option.
0010CA  3               	sta varopt		; store the option.
0010CA  3               	dec varopt		; one less, due to where we increment combyt.
0010CA  3               	jmp redraw		; redraw the screen.
0010CA  3               fobj:
0010CA  3               	ldy combyt		; object number.
0010CA  3               	inc combyt		; ready for next item.
0010CA  3               	tya
0010CA  3               	jsr gotob		; do we have this item?
0010CA  3               	cmp #255
0010CA  3               	bne :+
0010CA  3               	rts
0010CA  3               :
0010CA  3               	jmp fobj		; yes, it's on the list.
0010CA  3               .endif
0010CA  3               
0010CA  3               ;----------------------------------------------------
0010CA  3               ; Clear sprite table.
0010CA  3               ;
0010CA  3               ; sprtab[0] - sprtab[SPRBUF-1] = 255
0010CA  3               ;----------------------------------------------------
0010CA  3               
0010CA  3               xspr:
0010CA  3  A9 FF        	lda #255		; clear byte.
0010CC  3  A2 00        	ldx #0			; length of table.
0010CE  3               xspr0:
0010CE  3  9D 00 0B     	sta sprtab,x		; sprite table.
0010D1  3  E8           	inx			; move to next byte.
0010D2  3  E0 CC        	cpx #SPRBUF
0010D4  3  D0 F8        	bne xspr0		; repeat for rest of table.
0010D6  3  60           	rts
0010D7  3               
0010D7  3               ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
0010D7  3               ; Sound, NOT IMPLEMENTED!!!
0010D7  3               ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
0010D7  3               ;
0010D7  3               ;silenc:
0010D7  3               ;	jsr silen1 		; silence channel 1.
0010D7  3               ;	jsr silen2 		; silence channel 2.
0010D7  3               ;	jsr silen3 		; silence channel 3.
0010D7  3               ;	jmp plsnd 		; play all channels to switch them off.
0010D7  3               ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
0010D7  3               
0010D7  3               ;-------------------------------------------------------------
0010D7  3               ; Initialise all objects.
0010D7  3               ;
0010D7  3               ; Reset current room,y,x to start room,y,x for all objects
0010D7  3               ;-------------------------------------------------------------
0010D7  3               
0010D7  3               iniob:
0010D7  3  A9 3D        	lda #<objdta 		; objects table.
0010D9  3  85 rr        	sta z80_x
0010DB  3  A9 58        	lda #>objdta
0010DD  3  85 rr        	sta z80_i
0010DF  3               
0010DF  3  AE C3 10     	ldx numob 		; number of objects in the game.
0010E2  3               iniob0:
0010E2  3  A0 23        	ldy #35
0010E4  3  B1 rr        	lda (z80_ix),y 		; start screen.
0010E6  3  A0 20        	ldy #32
0010E8  3  91 rr        	sta (z80_ix),y 		; set start screen.
0010EA  3               
0010EA  3  A0 24        	ldy #36
0010EC  3  B1 rr        	lda (z80_ix),y 		; find start y.
0010EE  3  A0 21        	ldy #33
0010F0  3  91 rr        	sta (z80_ix),y 		; set start y.
0010F2  3               
0010F2  3  A0 25        	ldy #37
0010F4  3  B1 rr        	lda (z80_ix),y 		; get initial x.
0010F6  3  A0 22        	ldy #34
0010F8  3  91 rr        	sta (z80_ix),y 		; set x coord.
0010FA  3               
0010FA  3  18           	clc 			; point to next object.
0010FB  3  A5 rr        	lda z80_x
0010FD  3  69 26        	adc #38			; distance between objects.
0010FF  3  85 rr        	sta z80_x
001101  3  90 02        	bcc :+
001103  3  E6 rr        	inc z80_i
001105  3               :
001105  3  CA           	dex 			; repeat.
001106  3  D0 DA        	bne iniob0
001108  3               
001108  3  60           	rts
001109  3               
001109  3               ;-----------------------------------------------
001109  3               ; Redraw the screen.
001109  3               ;
001109  3               ; Remove old copy of all sprites for redraw.
001109  3               ;-----------------------------------------------
001109  3               
001109  3               redraw:
001109  3  A5 rr        	lda z80_i 		; place sprite pointer on stack.
00110B  3  48           	pha
00110C  3  A5 rr        	lda z80_x
00110E  3  48           	pha
00110F  3               
00110F  3  20 F2 18     	jsr droom		; show screen layout.
001112  3  20 D8 14     	jsr shwob		; draw objects.
001115  3               numsp0:
001115  3  A9 0C        	lda #NUMSPR		; sprites to draw.
001117  3  85 rr        	sta tmp
001119  3               
001119  3  A9 00        	lda #<sprtab		; sprite table.
00111B  3  85 rr        	sta z80_x
00111D  3  A9 0B        	lda #>sprtab
00111F  3  85 rr        	sta z80_i
001121  3               redrw0:
001121  3  A0 00        	ldy #0
001123  3  B1 rr        	lda (z80_ix),y		; old sprite type.
001125  3  C9 FF        	cmp #255		; is it enabled?
001127  3  F0 0B        	beq redrw1 		; no, find next one.
001129  3               
001129  3  A0 03        	ldy #var_Y
00112B  3  B1 rr        	lda (z80_ix),y 		; sprite y.
00112D  3  C9 B1        	cmp #177		; beyond maximum?
00112F  3  B0 03        	bcs redrw1		; yes, nothing to draw.
001131  3               
001131  3  20 84 0F     	jsr sspria		; show single sprite.
001134  3               
001134  3               redrw1:
001134  3  18           	clc			; next sprite.
001135  3  A5 rr        	lda z80_x
001137  3  69 11        	adc #TABSIZ		; distance to next odd/even entry.
001139  3  85 rr        	sta z80_x
00113B  3  90 02        	bcc :+
00113D  3  E6 rr        	inc z80_i
00113F  3               :
00113F  3  C6 rr        	dec tmp			; repeat for remaining sprites.
001141  3  D0 DE        	bne redrw0
001143  3               
001143  3               rpblc1:
001143  3               ;	jsr dshrp		; redraw shrapnel.
001143  3               
001143  3  68           	pla			; retrieve sprite pointer.
001144  3  85 rr        	sta z80_x
001146  3  68           	pla
001147  3  85 rr        	sta z80_i
001149  3               
001149  3  60           	rts
00114A  3               
00114A  3               ;----------------------------------------------------------------------
00114A  3               ; Clear screen routine.
00114A  3               ;
00114A  3               ; Fill screenmem $8000-$97ff with ScrFillByte
00114A  3               ;----------------------------------------------------------------------
00114A  3               
00114A  3               cls:
00114A  3  A9 68        	lda #>ScreenAddr		; screen address.
00114C  3  8D 55 11     	sta clsloop+2
00114F  3  A9 00        	lda #ScrFillByte
001151  3  A0 00        	ldy #0
001153  3               clsloop:
001153  3  99 00 68     	sta ScreenAddr,y
001156  3  C8           	iny
001157  3  D0 FA        	bne clsloop
001159  3  EE 55 11     	inc clsloop+2
00115C  3  AE 55 11     	ldx clsloop+2
00115F  3  E0 80        	cpx #>(ScreenAddr+ScreenSize)		; _BEEB
001161  3  D0 F0        	bne clsloop
001163  3  60           	rts
001164  3               
001164  3               ;----------------------------------------------------------------------
001164  3               ; FODDER check
001164  3               ;----------------------------------------------------------------------
001164  3               
001164  3               fdchk:
001164  3  A0 00        	ldy #0
001166  3  B1 rr        	lda (z80_hl),y	 	; fetch cell.
001168  3  C9 04        	cmp #FODDER 		; is it fodder?
00116A  3  F0 01        	beq :+
00116C  3  60           	rts 			; no.
00116D  3               :
00116D  3  A9 00        	lda #0
00116F  3  A0 00        	ldy #0
001171  3  91 rr        	sta (z80_hl),y 		; rewrite block type.
001173  3               
001173  3  A5 rr        	lda z80_h		; store pointer to block.
001175  3  48           	pha
001176  3  A5 rr        	lda z80_l
001178  3  48           	pha
001179  3               
001179  3  38           	sec			; set carry flag for subtraction.
00117A  3  A5 rr        	lda z80_l 		; find simple displacement for block.
00117C  3  E9 00        	sbc #<MAP
00117E  3  85 rr        	sta z80_l
001180  3  A5 rr        	lda z80_h
001182  3  E9 03        	sbc #>MAP
001184  3  85 rr        	sta z80_h
001186  3               
001186  3  A5 rr        	lda z80_l		; low byte is y coordinate.
001188  3  29 1F        	and #31 		; column position 0 - 31.
00118A  3  85 rr        	sta dispx		; set up x position.
00118C  3               
00118C  3  06 rr        	asl z80_l		; multiply displacement by 8.
00118E  3  26 rr        	rol z80_h
001190  3  06 rr        	asl z80_l
001192  3  26 rr        	rol z80_h
001194  3  06 rr        	asl z80_l
001196  3  26 rr        	rol z80_h
001198  3               
001198  3  A5 rr        	lda z80_h		; x coordinate now in h.
00119A  3  85 rr        	sta dispy		; set the display coordinate.
00119C  3               
00119C  3  A9 00        	lda #0 			; block to write.
00119E  3  20 4F 18     	jsr pattr 		; write block.
0011A1  3               
0011A1  3  68           	pla 			; restore block pointer.
0011A2  3  85 rr        	sta z80_l
0011A4  3  68           	pla
0011A5  3  85 rr        	sta z80_h
0011A7  3               
0011A7  3  60           	rts
0011A8  3               
0011A8  3               ;----------------------------------------------------
0011A8  3               ; Scrolly text and puzzle variables.
0011A8  3               ;----------------------------------------------------
0011A8  3               
0011A8  3               .if sflag
0011A8  3               txtbit:	.byte 128		; bit to write.
0011A8  3               txtwid:	.byte 16		; width of ticker message.
0011A8  3               txtpos:	.word msgdat
0011A8  3               txtini:	.word msgdat
0011A8  3               txtscr:	.word ScreenAddr
0011A8  3               .endif
0011A8  3               
0011A8  3               ;----------------------------------------------------
0011A8  3               ; Specialist routines.
0011A8  3               ; Process shrapnel.
0011A8  3               ;----------------------------------------------------
0011A8  3               proshr:
0011A8  3               .if pflag
0011A8  3               	lda #<SHRAPN		; table.
0011A8  3               	sta z80_x
0011A8  3               	lda #>SHRAPN
0011A8  3               	sta z80_i
0011A8  3               
0011A8  3               	lda #NUMSHR		; shrapnel pieces to process.
0011A8  3               	sta shrctr
0011A8  3               prosh0:
0011A8  3               	ldy #0
0011A8  3               	lda (z80_ix),y		; on/off marker.
0011A8  3               	asl a
0011A8  3               proshx:
0011A8  3               	bcs :+
0011A8  3               	jsr prosh1 		; on, so process it.
0011A8  3               :
0011A8  3               	clc
0011A8  3               	lda z80_x
0011A8  3               	adc #SHRSIZ
0011A8  3               	sta z80_x
0011A8  3               	bcc :+
0011A8  3               	inc z80_i
0011A8  3               :
0011A8  3               	dec shrctr		; round again.
0011A8  3               	bne prosh0
0011A8  3               .endif
0011A8  3               .if sflag
0011A8  3               	jsr scrly
0011A8  3               .endif
0011A8  3  60           	rts
0011A9  3               
0011A9  3               .if pflag
0011A9  3               ;----------------------------------------------------
0011A9  3               ; Proces shrapnel piece
0011A9  3               ;----------------------------------------------------
0011A9  3               
0011A9  3               prosh1:
0011A9  3               	jsr plot 		; delete the pixel.
0011A9  3               
0011A9  3               	lda #<shrptr		; shrapnel routine pointers.
0011A9  3               	sta z80_l
0011A9  3               	lda #>shrptr
0011A9  3               	sta z80_h
0011A9  3               
0011A9  3               	ldy #0
0011A9  3               	lda (z80_ix),y		; restore shrapnel type.
0011A9  3               	jsr prosh2 		; run the routine.
0011A9  3               	jsr chkxy		; check x and y are good before we redisplay.
0011A9  3               
0011A9  3               	lda #<SHRSIZ 		; distance to next.
0011A9  3               	sta z80_e
0011A9  3               	lda #>SHRSIZ
0011A9  3               	sta z80_d
0011A9  3               	rts
0011A9  3               
0011A9  3               ;----------------------------------------------------
0011A9  3               ; Run the routine
0011A9  3               ;----------------------------------------------------
0011A9  3               
0011A9  3               prosh2:
0011A9  3               	asl a 			; 2 bytes per address.
0011A9  3               	tay
0011A9  3               	lda shrptr,y
0011A9  3               	sta z80_l
0011A9  3               	lda shrptr+1,y 		; fetch high byte from table.
0011A9  3               	sta z80_h
0011A9  3               	jmp (z80_hl) 		; jump to routine.
0011A9  3               
0011A9  3               ;----------------------------------------------------
0011A9  3               ; Paricle routine table
0011A9  3               ;----------------------------------------------------
0011A9  3               
0011A9  3               shrptr:	.word laser		; laser.
0011A9  3               	.word trail		; vapour trail.
0011A9  3               	.word shrap		; shrapnel from explosion.
0011A9  3               	.word dotl		; horizontal starfield left.
0011A9  3               	.word dotr		; horizontal starfield right.
0011A9  3               	.word dotu		; vertical starfield up.
0011A9  3               	.word dotd		; vertical starfield down.
0011A9  3               	.word ptcusr		; user particle.
0011A9  3               
0011A9  3               ;----------------------------------------------------
0011A9  3               ; Explosion shrapnel.
0011A9  3               ;----------------------------------------------------
0011A9  3               
0011A9  3               shrap:
0011A9  3               	ldy #1
0011A9  3               	lda (z80_ix),y 		; get the angle.
0011A9  3               	clc
0011A9  3               	adc #<shrsin		; shrapnel sine table.
0011A9  3               	sta z80_l
0011A9  3               	lda #>shrsin
0011A9  3               	adc #0
0011A9  3               	sta z80_h
0011A9  3               
0011A9  3               	ldy #0
0011A9  3               	lda (z80_hl),y 		; fetch value from table.
0011A9  3               	sta z80_e
0011A9  3               	inc z80_l 		; next byte of table.
0011A9  3               	bne :+
0011A9  3               	inc z80_h
0011A9  3               :
0011A9  3               	ldy #0
0011A9  3               	lda (z80_hl),y		; fetch value from table.
0011A9  3               	sta z80_d
0011A9  3               	inc z80_l		; next byte of table.
0011A9  3               	bne :+
0011A9  3               	inc z80_h
0011A9  3               :
0011A9  3               	ldy #0
0011A9  3               	lda (z80_hl),y 		; fetch value from table.
0011A9  3               	sta z80_c
0011A9  3               	inc z80_l 		; next byte of table.
0011A9  3               	bne :+
0011A9  3               	inc z80_h
0011A9  3               :
0011A9  3               	ldy #0
0011A9  3               	lda (z80_hl),y 		; fetch value from table.
0011A9  3               	sta z80_b
0011A9  3               
0011A9  3               	ldy #2
0011A9  3               	lda (z80_ix),y 		; x coordinate in hl.
0011A9  3               	clc
0011A9  3               	adc z80_e		; add sine lb
0011A9  3               	sta (z80_ix),y		; store new coordinate lb.
0011A9  3               	ldy #3
0011A9  3               	lda (z80_ix),y
0011A9  3               	adc z80_d		; add sine hb
0011A9  3               	sta (z80_ix),y		; store new coordinate hb.
0011A9  3               
0011A9  3               	ldy #4
0011A9  3               	lda (z80_ix),y	 	; y coordinate in hl.
0011A9  3               	clc
0011A9  3               	adc z80_c		; add cosine lb
0011A9  3               	sta (z80_ix),y		; store new coordinate lb.
0011A9  3               	ldy #5
0011A9  3               	lda (z80_ix),y
0011A9  3               	adc z80_b		; add cosine lb
0011A9  3               	sta (z80_ix),y		; store new coordinate hb.
0011A9  3               
0011A9  3               	rts
0011A9  3               
0011A9  3               ;----------------------------------------------------
0011A9  3               ; Move dots
0011A9  3               ;----------------------------------------------------
0011A9  3               
0011A9  3               dotl:
0011A9  3               	ldy #5
0011A9  3               	lda (z80_ix),y
0011A9  3               	sec
0011A9  3               	sbc #1		 	; move left.
0011A9  3               	sta (z80_ix),y
0011A9  3               	rts
0011A9  3               dotr:
0011A9  3               	ldy #5
0011A9  3               	lda (z80_ix),y
0011A9  3               	clc
0011A9  3               	adc #1		 	; move left.
0011A9  3               	sta (z80_ix),y
0011A9  3               	rts
0011A9  3               dotu:
0011A9  3               	ldy #3
0011A9  3               	lda (z80_ix),y
0011A9  3               	sec
0011A9  3               	sbc #1		 	; move up.
0011A9  3               	sta (z80_ix),y
0011A9  3               	rts
0011A9  3               dotd:
0011A9  3               	ldy #3
0011A9  3               	lda (z80_ix),y
0011A9  3               	clc
0011A9  3               	adc #1			; move down.
0011A9  3               	sta (z80_ix),y
0011A9  3               	rts
0011A9  3               
0011A9  3               ;----------------------------------------------------
0011A9  3               ; Check if coordinates are ok before redrawing at new position.
0011A9  3               ;
0011A9  3               ; left:   X>L		X=L	Ok
0011A9  3               ; right:  R+15>X	X=R	Ok
0011A9  3               ; top:    Y>T		Y=T	Ok
0011A9  3               ; bottom: B+15>Y	Y=B	Ok
0011A9  3               ;----------------------------------------------------
0011A9  3               
0011A9  3               chkxy:
0011A9  3               
0011A9  3               ; top:    Y>T		Y=T	Ok
0011A9  3               
0011A9  3               	ldy #3
0011A9  3               	lda (z80_ix),y	 	; fetch shrapnel coordinate.
0011A9  3               	cmp wntopx		; window top.
0011A9  3               	bcs :+			; compare with top window limit.
0011A9  3               	jmp kilshr		; out of window, kill shrapnel.
0011A9  3               :
0011A9  3               ; left:   X>L		X=L	Ok
0011A9  3               
0011A9  3               	ldy #5
0011A9  3               	lda (z80_ix),y	 	; fetch shrapnel coordinate.
0011A9  3               	cmp wnlftx		; left edge.
0011A9  3               	bcs :+			; compare with left window limit.
0011A9  3               	jmp kilshr		; out of window, kill shrapnel.
0011A9  3               :
0011A9  3               ; bottom: B+15>Y	Y=B	Ok
0011A9  3               
0011A9  3               	lda wnbotx		; point to bottom.
0011A9  3               	clc
0011A9  3               	adc #15
0011A9  3               	ldy #3
0011A9  3               	cmp (z80_ix),y	 	; fetch shrapnel coordinate.
0011A9  3               	bcs :+			; compare with shrapnel x coordinate.
0011A9  3               	jmp kilshr		; off screen, kill shrapnel..
0011A9  3               :
0011A9  3               ; right:  R+15>X	X=R	Ok
0011A9  3               
0011A9  3               	lda wnrgtx		; point to right edge.
0011A9  3               	clc
0011A9  3               	adc #15
0011A9  3               	ldy #5
0011A9  3               	cmp (z80_ix),y	 	; fetch shrapnel coordinate.
0011A9  3               	bcs :+			; compare with window limit.
0011A9  3               	jmp kilshr		; off screen, kill shrapnel.
0011A9  3               :
0011A9  3               
0011A9  3               ;----------------------------------------------------
0011A9  3               ; Drop through.
0011A9  3               ; Display shrapnel.
0011A9  3               ;----------------------------------------------------
0011A9  3               
0011A9  3               plot:
0011A9  3               	ldy #3
0011A9  3               	lda (z80_ix),y		; y integer.
0011A9  3               	sta dispy	 	; workspace coordinates.
0011A9  3               	ldy #5
0011A9  3               	lda (z80_ix),y	 	; x integer.
0011A9  3               	sta dispx 		; workspace coordinates.
0011A9  3               
0011A9  3               	ldy #0
0011A9  3               	lda (z80_ix),y 		; type.
0011A9  3               	bne :+			; is it a laser?
0011A9  3               	jmp plot1 		; yes, draw laser instead.
0011A9  3               :
0011A9  3               plot0:
0011A9  3               	lda dispx		; which pixel within byte do we
0011A9  3               	and #7			; want to set first?
0011A9  3               	tay
0011A9  3               	lda dots,y 		; table of small pixel positions.
0011A9  3               	sta z80_e 		; get value.
0011A9  3               
0011A9  3               	jsr scadd 		; screen address.
0011A9  3               	ldy #0
0011A9  3               	lda (scraddr),y		; see what's already there.
0011A9  3               	eor z80_e
0011A9  3               	sta (scraddr),y 	; put back on screen.
0011A9  3               	rts
0011A9  3               
0011A9  3               plot1:
0011A9  3               	jsr scadd 		; screen address.
0011A9  3               	ldy #0
0011A9  3               	lda (scraddr),y 	; fetch byte there.
0011A9  3               	eor #255 		; toggle all bits.
0011A9  3               	sta (scraddr),y 	; new byte.
0011A9  3               	rts
0011A9  3               
0011A9  3               ;----------------------------------------------------
0011A9  3               ; Switch off shrapnel
0011A9  3               ;----------------------------------------------------
0011A9  3               
0011A9  3               kilshr:
0011A9  3               	lda #128
0011A9  3               	ldy #0
0011A9  3               	sta (z80_ix),y	; switch off shrapnel.
0011A9  3               	rts
0011A9  3               
0011A9  3               ;----------------------------------------------------
0011A9  3               ; Sine/cosine table
0011A9  3               ;----------------------------------------------------
0011A9  3               
0011A9  3               shrsin:	.word 0,1024,391,946,724,724,946,391
0011A9  3               	.word 1024,0,946,65144,724,64811,391,64589
0011A9  3               	.word 0,64512,65144,64589,64811,64811,64589,65144
0011A9  3               	.word 64512,0,64589,391,64811,724,65144,946
0011A9  3               
0011A9  3               ;----------------------------------------------------
0011A9  3               ; Create trail
0011A9  3               ;----------------------------------------------------
0011A9  3               
0011A9  3               trail:
0011A9  3               	ldy #1
0011A9  3               	lda (z80_ix),y 	; time remaining.
0011A9  3               	sec
0011A9  3               	sbc #1
0011A9  3               	sta (z80_ix),y
0011A9  3               	bne :+
0011A9  3               	jmp trailk		; time to switch it off.
0011A9  3               :
0011A9  3               	jsr qrand		; get a random number.
0011A9  3               	lsr a 			; x or y axis?
0011A9  3               	bcc :+
0011A9  3               	jmp trailv		; use y.
0011A9  3               :
0011A9  3               ; Trail horizontal
0011A9  3               
0011A9  3               	lsr a 			; which direction?
0011A9  3               	bcc :+
0011A9  3               	jmp traill		; go left.
0011A9  3               :
0011A9  3               ; Trail right
0011A9  3               
0011A9  3               	ldy #5
0011A9  3               	lda (z80_ix),y
0011A9  3               	clc
0011A9  3               	adc #1	 		; go right.
0011A9  3               	sta (z80_ix),y
0011A9  3               	rts
0011A9  3               
0011A9  3               ; Trail left
0011A9  3               
0011A9  3               traill:
0011A9  3               	ldy #5
0011A9  3               	lda (z80_ix),y
0011A9  3               	sec
0011A9  3               	sbc #1 			; go left.
0011A9  3               	sta (z80_ix),y
0011A9  3               	rts
0011A9  3               
0011A9  3               ; Trail vertical
0011A9  3               
0011A9  3               trailv:
0011A9  3               	lsr a		 	; which direction?
0011A9  3               	bcc :+
0011A9  3               	jmp trailu		; go up.
0011A9  3               :
0011A9  3               ; Trail down
0011A9  3               
0011A9  3               	ldy #3
0011A9  3               	lda (z80_ix),y
0011A9  3               	clc
0011A9  3               	adc #1 			; go down.
0011A9  3               	sta (z80_ix),y
0011A9  3               	rts
0011A9  3               
0011A9  3               ; Trail up
0011A9  3               
0011A9  3               trailu:
0011A9  3               	ldy #3
0011A9  3               	lda (z80_ix),y
0011A9  3               	sec
0011A9  3               	sbc #1 			; go up.
0011A9  3               	sta (z80_ix),y
0011A9  3               	rts
0011A9  3               
0011A9  3               ; Kill trail
0011A9  3               
0011A9  3               trailk:
0011A9  3               	lda #200		; set off-screen to kill vapour trail.
0011A9  3               	ldy #3
0011A9  3               	sta (z80_ix),y
0011A9  3               	rts
0011A9  3               
0011A9  3               ;----------------------------------------------------
0011A9  3               ; Create laser beam
0011A9  3               ;----------------------------------------------------
0011A9  3               
0011A9  3               laser:
0011A9  3               	ldy #1
0011A9  3               	lda (z80_ix),y 		; direction.
0011A9  3               	ror a 			; left or right?
0011A9  3               	bcs :+
0011A9  3               	jmp laserl		; move left.
0011A9  3               :
0011A9  3               ; Laser right
0011A9  3               
0011A9  3               	lda #8			; distance to travel.
0011A9  3               	sta z80_b
0011A9  3               	jmp laserm		; move laser.
0011A9  3               
0011A9  3               ; Laser left
0011A9  3               
0011A9  3               laserl:
0011A9  3               	lda #248		; distance to travel.
0011A9  3               	sta z80_b
0011A9  3               laserm:
0011A9  3               	ldy #5
0011A9  3               	lda (z80_ix),y		; x position.
0011A9  3               	clc
0011A9  3               	adc z80_b		; add distance.
0011A9  3               	sta (z80_ix),y		; set new x coordinate.
0011A9  3               
0011A9  3               ; Test new block.
0011A9  3               
0011A9  3               	sta dispx 		; set x for block collision detection purposes.
0011A9  3               	ldy #3
0011A9  3               	lda (z80_ix),y 		; get y.
0011A9  3               	sta dispy		; set coordinate for collision test.
0011A9  3               	jsr tstbl 		; get block type there.
0011A9  3               	cmp #WALL		; is it solid?
0011A9  3               	bne :+
0011A9  3               	jmp trailk		; yes, it cannot pass.
0011A9  3               :
0011A9  3                       cmp #FODDER             ; is it fodder?
0011A9  3                       bne :+
0011A9  3                       jsr fdchk               ; remove fodder block.
0011A9  3                       jmp trailk              ; destroy laser.
0011A9  3               :
0011A9  3                       rts                     ; no, ignore it.
0011A9  3               
0011A9  3               ;----------------------------------------------------
0011A9  3               ; Dots mask
0011A9  3               ;----------------------------------------------------
0011A9  3               
0011A9  3               dots:	.byte 128,64,32,16,8,4,2,1
0011A9  3               
0011A9  3               
0011A9  3               ;----------------------------------------------------
0011A9  3               ; Plot, preserving de.
0011A9  3               ;----------------------------------------------------
0011A9  3               
0011A9  3               plotde:
0011A9  3               	lda z80_d 		; put de on stack.
0011A9  3               	pha
0011A9  3               	lda z80_e
0011A9  3               	pha
0011A9  3               
0011A9  3               	jsr plot 		; plot pixel.
0011A9  3               
0011A9  3               	pla			; restore de from stack.
0011A9  3               	sta z80_e
0011A9  3               	pla
0011A9  3               	sta z80_d
0011A9  3               
0011A9  3               	rts
0011A9  3               
0011A9  3               ;----------------------------------------------------
0011A9  3               ; Shoot a laser.
0011A9  3               ;----------------------------------------------------
0011A9  3               
0011A9  3               shoot:
0011A9  3               	sta z80_c		; store direction in c register.
0011A9  3               	ldy #8
0011A9  3               	lda (z80_ix),y 		; y coordinate.
0011A9  3               shoot1:
0011A9  3               	clc
0011A9  3               	adc #7 			; down 7 pixels.
0011A9  3               	sta z80_l 		; puty y coordinate in l.
0011A9  3               
0011A9  3               	ldy #9
0011A9  3               	lda (z80_ix),y 		; x coordinate in h.
0011A9  3               	sta z80_h
0011A9  3               
0011A9  3               	lda z80_i		; store pointer to sprite.
0011A9  3               	pha
0011A9  3               	lda z80_x
0011A9  3               	pha
0011A9  3               
0011A9  3               	jsr fpslot 		; find particle slot.
0011A9  3               	bcs :+
0011A9  3               	jmp vapou2		; failed, restore ix.
0011A9  3               :
0011A9  3               	lda #0
0011A9  3               	ldy #0
0011A9  3               	sta (z80_ix),y 		; set up a laser.
0011A9  3               
0011A9  3               	lda z80_c
0011A9  3               	ldy #1
0011A9  3               	sta (z80_ix),y 		; set the direction.
0011A9  3               
0011A9  3               	lda z80_l
0011A9  3               	ldy #3
0011A9  3               	sta (z80_ix),y		; set y coordinate.
0011A9  3               
0011A9  3               	ror z80_c		; check direction we want.
0011A9  3               	bcc :+
0011A9  3               	jmp shootr		; shoot right.
0011A9  3               :
0011A9  3               	lda z80_h		; X position.
0011A9  3               shoot0:
0011A9  3               	and #248		; align on character boundary.
0011A9  3               	ldy #5
0011A9  3               	sta (z80_ix),y		; set x coordinate.
0011A9  3               	jmp vapou0 		; draw first image.
0011A9  3               shootr:
0011A9  3               	lda z80_h		; x position.
0011A9  3               	clc
0011A9  3               	adc #15			; look right.
0011A9  3               	jmp shoot0		; align and continue.
0011A9  3               
0011A9  3               ;----------------------------------------------------
0011A9  3               ; Create a bit of vapour trail.
0011A9  3               ;----------------------------------------------------
0011A9  3               
0011A9  3               vapour:
0011A9  3               	lda z80_i		; store pointer to sprite.
0011A9  3               	pha
0011A9  3               	lda z80_x
0011A9  3               	pha
0011A9  3               
0011A9  3               	ldy #8
0011A9  3               	lda (z80_ix),y 		; y coordinate.
0011A9  3               	clc
0011A9  3               	adc #7			; mid-point of sprite.
0011A9  3               	sta z80_l
0011A9  3               
0011A9  3               	ldy #9
0011A9  3               	lda (z80_ix),y 		; x coordinate.
0011A9  3               	adc #7
0011A9  3               	sta z80_h
0011A9  3               
0011A9  3               	jsr fpslot 		; find particle slot.
0011A9  3               	bcc :+
0011A9  3               	jmp vapou1		; no, we can use it.
0011A9  3               :
0011A9  3               vapou2:
0011A9  3               	pla
0011A9  3               	sta z80_x
0011A9  3               	pla
0011A9  3               	sta z80_i
0011A9  3               	rts
0011A9  3               vapou1:
0011A9  3               	lda z80_l
0011A9  3               	ldy #3
0011A9  3               	sta (z80_ix),y		; set up y.
0011A9  3               
0011A9  3               	lda z80_h
0011A9  3               	ldy #5
0011A9  3               	sta (z80_ix),y 		; set up x coordinate.
0011A9  3               
0011A9  3               	jsr qrand		; get quick random number.
0011A9  3               	and #15			; random time.
0011A9  3               	clc
0011A9  3               	adc #15			; minimum time on screen.
0011A9  3               	ldy #1
0011A9  3               	sta (z80_ix),y		; set time on screen.
0011A9  3               
0011A9  3               	lda #1
0011A9  3               	ldy #0
0011A9  3               	sta (z80_ix),y		; define particle as vapour trail.
0011A9  3               vapou0:
0011A9  3               	jsr chkxy		; plot first position.
0011A9  3               	jmp vapou2
0011A9  3               
0011A9  3               ;----------------------------------------------------
0011A9  3               ; Create a user particle.
0011A9  3               ;----------------------------------------------------
0011A9  3               
0011A9  3               ptusr:
0011A9  3               	sta z80_f		; store timer.
0011A9  3               
0011A9  3               	ldy #8
0011A9  3               	lda (z80_ix),y 		; y coordinate.
0011A9  3               	clc
0011A9  3               	adc #7			; mid-point of sprite.
0011A9  3               	sta z80_l
0011A9  3               
0011A9  3               	ldy #9
0011A9  3               	lda (z80_ix),y 		; x coordinate.
0011A9  3               	clc
0011A9  3               	adc #7			; mid-point of sprite.
0011A9  3               	sta z80_h
0011A9  3               
0011A9  3               	jsr fpslot 		; find particle slot.
0011A9  3               	bcs ptusr1
0011A9  3               	rts 			; out of slots, can't generate anything.
0011A9  3               ptusr1:
0011A9  3               	lda z80_l
0011A9  3               	ldy #3
0011A9  3               	sta (z80_ix),y 		; set up y.
0011A9  3               
0011A9  3               	lda z80_h
0011A9  3               	ldy #5
0011A9  3               	sta (z80_ix),y		; set up x coordinate.
0011A9  3               
0011A9  3               	lda z80_f 		; restore timer.
0011A9  3               	ldy #1
0011A9  3               	sta (z80_ix),y		; set time on screen.
0011A9  3               
0011A9  3               	lda #7
0011A9  3               	ldy #0
0011A9  3               	sta (z80_ix),y		; define particle as user particle.
0011A9  3               
0011A9  3               	jmp chkxy		; plot first position.
0011A9  3               
0011A9  3               ;----------------------------------------------------
0011A9  3               ; Create a vertical or horizontal star.
0011A9  3               ;----------------------------------------------------
0011A9  3               
0011A9  3               star:
0011A9  3               	lda z80_i		; store pointer to sprite.
0011A9  3               	pha
0011A9  3               	lda z80_x
0011A9  3               	pha
0011A9  3               
0011A9  3               	jsr fpslot 		; find particle slot.
0011A9  3               	bcs star7		; found one we can use.
0011A9  3               star0:
0011A9  3               	pla 			; restore sprite pointer.
0011A9  3               	sta z80_x
0011A9  3               	pla
0011A9  3               	sta z80_i
0011A9  3               	rts 			; out of slots, can't generate anything.
0011A9  3               star7:
0011A9  3               	lda z80_c		; direction.
0011A9  3               	and #3 			; is it left?
0011A9  3               	bne :+
0011A9  3               	jmp star1 		; yes, it's left.
0011A9  3               :
0011A9  3               	cmp #1 			; is it right?
0011A9  3               	bne :+
0011A9  3               	jmp star2 		; yes, it's right.
0011A9  3               :
0011A9  3               	cmp #2 			; is it up?
0011A9  3               	bne :+
0011A9  3               	jmp star3 		; yes, it's up.
0011A9  3               :
0011A9  3               	ldy wntopx 		; get edge of screen.
0011A9  3               	iny			; down one pixel.
0011A9  3               	tya
0011A9  3               star8:
0011A9  3               	ldy #3
0011A9  3               	sta (z80_ix),y 		; set y coord.
0011A9  3               	jsr qrand 		; get quick random number.
0011A9  3               star9:
0011A9  3               	ldy #5
0011A9  3               	sta (z80_ix),y		; set x position.
0011A9  3               
0011A9  3               	lda z80_c		; direction.
0011A9  3               	and #3			; zero to three.
0011A9  3               	clc
0011A9  3               	adc #3			; 3 to 6 for starfield.
0011A9  3               	ldy #0
0011A9  3               	sta (z80_ix),y		; define particle as star.
0011A9  3               	jsr chkxy		; plot first position.
0011A9  3               	jmp star0
0011A9  3               star1:
0011A9  3               	jsr qrand		; get quick random number.
0011A9  3               	ldy #3
0011A9  3               	sta (z80_ix),y 		; set y coord.
0011A9  3               
0011A9  3               	lda wnrgtx 		; get edge of screen.
0011A9  3               	clc
0011A9  3               	adc #15			; add width of sprite minus 1.
0011A9  3               	jmp star9
0011A9  3               star2:
0011A9  3               	jsr qrand 		; get quick random number.
0011A9  3               	ldy #3
0011A9  3               	sta (z80_ix),y		; set y coord.
0011A9  3               
0011A9  3               	lda wnlftx		; get edge of screen.
0011A9  3               	jmp star9
0011A9  3               star3:
0011A9  3               	lda wnbotx 		; get edge of screen.
0011A9  3               	clc
0011A9  3               	adc #15 		; height of sprite minus one pixel.
0011A9  3               	jmp star8
0011A9  3               
0011A9  3               ;----------------------------------------------------
0011A9  3               ; Find particle slot for lasers or vapour trail.
0011A9  3               ; can't use alternate accumulator.
0011A9  3               ;----------------------------------------------------
0011A9  3               
0011A9  3               fpslot:
0011A9  3               	lda #<SHRAPN 		; shrapnel table.
0011A9  3               	sta z80_x
0011A9  3               	lda #>SHRAPN
0011A9  3               	sta z80_i
0011A9  3               
0011A9  3               	lda #NUMSHR		; number of pieces in table.
0011A9  3               	sta z80_b
0011A9  3               fpslt0:
0011A9  3               	ldy #0
0011A9  3               	lda (z80_ix),y		; get type.
0011A9  3               	asl a  			; is this slot in use?
0011A9  3               	bcc :+
0011A9  3               	rts			; no, we can use it.
0011A9  3               :
0011A9  3               	clc			; point to more shrapnel.
0011A9  3               	lda z80_x
0011A9  3               	adc #SHRSIZ
0011A9  3               	sta z80_x
0011A9  3               	bcc :+
0011A9  3               	inc z80_i
0011A9  3               :
0011A9  3               	dec z80_b		; repeat for all shrapnel.
0011A9  3               	bne fpslt0
0011A9  3               
0011A9  3               	clc
0011A9  3               	rts 			; out of slots, can't generate anything.
0011A9  3               
0011A9  3               ;----------------------------------------------------
0011A9  3               ; Create an explosion at sprite position.
0011A9  3               ;----------------------------------------------------
0011A9  3               
0011A9  3               explod:
0011A9  3               	sta z80_c 		; particles to create.
0011A9  3               
0011A9  3               	lda z80_i 		; store pointer to sprite.
0011A9  3               	pha
0011A9  3               	lda z80_x
0011A9  3               	pha
0011A9  3               
0011A9  3               	ldy #8
0011A9  3               	lda (z80_ix),y 		; y coordinate.
0011A9  3               	sta z80_l
0011A9  3               	ldy #9
0011A9  3               	lda (z80_ix),y		; x coordinate.
0011A9  3               	sta z80_h
0011A9  3               
0011A9  3               	lda #<SHRAPN		; shrapnel table.
0011A9  3               	sta z80_x
0011A9  3               	lda #>SHRAPN
0011A9  3               	sta z80_i
0011A9  3               
0011A9  3               	lda #NUMSHR		; number of pieces in table.
0011A9  3               	sta explcnt
0011A9  3               expld0:
0011A9  3               	ldy #0
0011A9  3               	lda (z80_ix),y		; get type.
0011A9  3               	asl a 			; is this slot in use?
0011A9  3               	bcs expld1		; no, we can use it.
0011A9  3               expld2:
0011A9  3               	clc
0011A9  3               	lda z80_x
0011A9  3               	adc #SHRSIZ
0011A9  3               	sta z80_x
0011A9  3               	bcc :+
0011A9  3               	inc z80_i
0011A9  3               :
0011A9  3               	dec explcnt		; repeat for all shrapnel.
0011A9  3               	bne expld0
0011A9  3               expld3:
0011A9  3               	pla			; restore sprite pointer.
0011A9  3               	sta z80_x
0011A9  3               	pla
0011A9  3               	sta z80_i
0011A9  3               	rts 			; out of slots, can't generate any more.
0011A9  3               
0011A9  3               expld1:
0011A9  3               	lda z80_c		; shrapnel counter.
0011A9  3               	and #15			; 0 to 15.
0011A9  3               	clc			; add to x.
0011A9  3               	adc z80_l
0011A9  3               	ldy #3
0011A9  3               	sta (z80_ix),y		; y coord.
0011A9  3               
0011A9  3               	lda seed3 		; crap random number.
0011A9  3               	and #15			; 0 to 15.
0011A9  3               	clc 			; add to y.
0011A9  3               	adc z80_h
0011A9  3               	ldy #5
0011A9  3               	sta (z80_ix),y		; x coord.
0011A9  3               
0011A9  3               	lda #2
0011A9  3               	ldy #0
0011A9  3               	sta (z80_ix),y		; switch it on.
0011A9  3               
0011A9  3               	jsr chkxy		; plot first position.
0011A9  3               	jsr qrand		; quick random angle.
0011A9  3               	and #60 		; keep within range.
0011A9  3               	ldy #1
0011A9  3               	sta (z80_ix),y		; angle.
0011A9  3               
0011A9  3               	dec z80_c		; one less piece of shrapnel to generate.
0011A9  3               	bne expld2 		; back to main explosion loop.
0011A9  3               	jmp expld3 		; restore sprite pointer and exit.
0011A9  3               
0011A9  3               ;----------------------------------------------------
0011A9  3               ; Quick random
0011A9  3               ;----------------------------------------------------
0011A9  3               
0011A9  3               qrand:
0011A9  3               	jsr random		; r register.
0011A9  3               	eor seed3		; combine with seed.
0011A9  3               	sta seed3 		; new seed.
0011A9  3               	rts
0011A9  3               
0011A9  3               ;----------------------------------------------------
0011A9  3               ; Display all shrapnel.
0011A9  3               ;----------------------------------------------------
0011A9  3               
0011A9  3               dshrp:
0011A9  3               	lda #<plotde		; display routine.
0011A9  3               	sta proshx+1
0011A9  3               	lda #>plotde
0011A9  3               	sta proshx+2
0011A9  3               	jsr proshr		; process shrapnel.
0011A9  3               
0011A9  3               	lda #<prosh1		; processing routine.
0011A9  3               	sta proshx+1
0011A9  3               	lda #>prosh1
0011A9  3               	sta proshx+2
0011A9  3               	rts
0011A9  3               
0011A9  3               ;------------------------------------------------------
0011A9  3               ; Particle engine.
0011A9  3               ;
0011A9  3               ; Init particle data for 55 particles in SHRAPN table.
0011A9  3               ; Every particle has 6 bytes.
0011A9  3               ;
0011A9  3               ; global:	-
0011A9  3               ; local:	x,y,hl
0011A9  3               ; calls:	-
0011A9  3               ;------------------------------------------------------
0011A9  3               
0011A9  3               inishr:
0011A9  3               	lda #<SHRAPN 		; table.
0011A9  3               	sta z80_l
0011A9  3               	lda #>SHRAPN
0011A9  3               	sta z80_h
0011A9  3               
0011A9  3               	ldy #0
0011A9  3               	ldx #NUMSHR		; shrapnel pieces to process.
0011A9  3               inish0:
0011A9  3               	lda #255 		; kill the shrapnel.
0011A9  3               	sta (z80_hl),y
0011A9  3               
0011A9  3               	clc 			; point there.
0011A9  3               	lda z80_l
0011A9  3               	adc #SHRSIZ		; distance to next.
0011A9  3               	sta z80_l
0011A9  3               	bcc :+
0011A9  3               	inc z80_h
0011A9  3               :
0011A9  3               	dex
0011A9  3               	bne inish0 		; round again.
0011A9  3               	rts
0011A9  3               
0011A9  3               ;------------------------------------------------------
0011A9  3               ; Check for collision between laser and sprite.
0011A9  3               ;------------------------------------------------------
0011A9  3               
0011A9  3               lcol:
0011A9  3               	lda #<SHRAPN		; shrapnel table.
0011A9  3               	sta z80_l
0011A9  3               	lda #>SHRAPN
0011A9  3               	sta z80_h
0011A9  3               
0011A9  3               	lda #NUMSHR		; number of pieces in table.
0011A9  3               	sta z80_b
0011A9  3               lcol0:
0011A9  3               	ldy #0
0011A9  3               	lda (z80_hl),y 		; get type.
0011A9  3               	beq lcol1		; yes, check collision.
0011A9  3               lcol3:
0011A9  3               	clc			; point to more shrapnel.
0011A9  3               	lda z80_l
0011A9  3               	adc #SHRSIZ
0011A9  3               	sta z80_l
0011A9  3               	bcc :+
0011A9  3               	inc z80_h
0011A9  3               :
0011A9  3               	dec z80_b		; repeat for all shrapnel.
0011A9  3               	bne lcol0
0011A9  3               	rts 			; no collision, carry not set.
0011A9  3               lcol1:
0011A9  3               	ldy #3
0011A9  3               	lda (z80_hl),y		; get y.
0011A9  3               	sec
0011A9  3               	ldy #8
0011A9  3               	sbc (z80_ix),y		; subtract sprite y.
0011A9  3               lcolh:
0011A9  3               	cmp #16 		; within range?
0011A9  3               	bcc :+
0011A9  3               	jmp lcol2		; no, missed.
0011A9  3               :
0011A9  3               	ldy #5
0011A9  3               	lda (z80_hl),y 		; get x.
0011A9  3               	sec
0011A9  3               	ldy #9
0011A9  3               	sbc (z80_ix),y 		; subtract sprite y.
0011A9  3               	cmp #16			; within range?
0011A9  3               	bcs :+
0011A9  3               	jmp lcol4 		; yes, collision occurred.
0011A9  3               :
0011A9  3               lcol2:
0011A9  3               	jmp lcol3
0011A9  3               lcol4:
0011A9  3               	sec
0011A9  3               	rts 			; return with carry set for collision.
0011A9  3               .endif
0011A9  3               
0011A9  3               ;------------------------------------------------------
0011A9  3               ; Main game engine code starts here.
0011A9  3               ; After initialisation, mloop is the main loop
0011A9  3               ;------------------------------------------------------
0011A9  3               
0011A9  3               game:
0011A9  3               
0011A9  3               ; Set up screen address table.
0011A9  3               
0011A9  3               setsat:
0011A9  3  A9 00        	lda #<ScreenAddr		; start of screen.
0011AB  3  85 rr        	sta scraddr
0011AD  3  A9 68        	lda #>ScreenAddr
0011AF  3  85 rr        	sta scraddr+1
0011B1  3               
0011B1  3  A0 00        	ldy #0			; vertical lines on screen.
0011B3  3               setsa0:
0011B3  3  A5 rr        	lda scraddr
0011B5  3  99 00 06     	sta SCADTB_lb,y		; write low byte.
0011B8  3  A5 rr        	lda scraddr+1
0011BA  3  99 00 07     	sta SCADTB_hb,y		; write high byte.
0011BD  3  20 D2 0F     	jsr nline		; next line down.
0011C0  3  C8           	iny			; next position in table.
0011C1  3  D0 F0        	bne setsa0
0011C3  3               
0011C3  3               ; Init graphics mode
0011C3  3               
0011C3  3  20 DE 0E     	jsr screeninit
0011C6  3               
0011C6  3               ; Init AtoMMC joystick
0011C6  3  20 A4 0E     	jsr joyinit		; AtoMMC joystick on PORT B
0011C9  3               
0011C9  3               rpblc2:
0011C9  3               .if pflag
0011C9  3               	jsr inishr 		; initialise particle engine.
0011C9  3               .endif
0011C9  3               evintr:
0011C9  3  20 8A 29     	jsr evnt12 		; call intro/menu event.
0011CC  3               
0011CC  3  A9 02        	lda #WALL 		; write default property.
0011CE  3  A2 00        	ldx #0
0011D0  3               clrmap:
0011D0  3  9D 00 03     	sta MAP,x 		; block properties.
0011D3  3  9D 00 04     	sta MAP+256,x
0011D6  3  9D 00 05     	sta MAP+512,x
0011D9  3  E8           	inx			; next byte.
0011DA  3  D0 F4        	bne clrmap
0011DC  3               
0011DC  3  20 D7 10     	jsr iniob 		; initialise objects.
0011DF  3               
0011DF  3  A9 00        	lda #0			; put zero in accumulator.
0011E1  3  85 rr        	sta gamwon		; reset game won flag.
0011E3  3               
0011E3  3  20 88 14     	jsr inisc 		; init the score.
0011E6  3               mapst:
0011E6  3  AD A7 24     	lda stmap 		; start position on map.
0011E9  3  8D 23 24     	sta roomtb		; set up position in table, if there is one.
0011EC  3               
0011EC  3               inipbl:
0011EC  3  20 E1 20     	jsr initsc 		; set up first screen.
0011EF  3               
0011EF  3  A9 12        	lda #<ssprit 		; default to spare sprite in table.
0011F1  3  85 rr        	sta z80_x
0011F3  3  A9 24        	lda #>ssprit
0011F5  3  85 rr        	sta z80_i
0011F7  3               evini:
0011F7  3  20 E3 29     	jsr evnt13 		; initialisation.
0011FA  3               
0011FA  3               ; Two restarts.
0011FA  3               ; First restart - clear all sprites and initialise everything.
0011FA  3               
0011FA  3               rstrt:
0011FA  3  20 28 14     	jsr rsevt 		; restart events.
0011FD  3  20 CA 10     	jsr xspr 		; clear sprite table.
001200  3  20 43 22     	jsr sprlst 		; fetch pointer to screen sprites.
001203  3  20 CC 22     	jsr ispr 		; initialise sprite table.
001206  3               
001206  3  4C 15 12     	jmp rstrt0
001209  3               
001209  3               ; Second restart - clear all but player, and don't initialise him.
001209  3               
001209  3               rstrtn:
001209  3  20 28 14     	jsr rsevt		; restart events.
00120C  3  20 70 22     	jsr nspr 		; clear all non-player sprites.
00120F  3  20 43 22     	jsr sprlst 		; fetch pointer to screen sprites.
001212  3  20 09 23     	jsr kspr 		; initialise sprite table, no more players.
001215  3               
001215  3               ; Set up the player and/or enemy sprites.
001215  3               
001215  3               rstrt0:
001215  3  A9 00        	lda #0 			; zero in accumulator.
001217  3  85 rr        	sta nexlev 		; reset next level flag.
001219  3  85 rr        	sta restfl 		; reset restart flag.
00121B  3  85 rr        	sta deadf 		; reset dead flag.
00121D  3  20 F2 18     	jsr droom 		; show screen layout.
001220  3               rpblc0:
001220  3               .if pflag
001220  3               	jsr inishr 		; initialise particle engine.
001220  3               .endif
001220  3  20 D8 14     	jsr shwob		; draw objects.
001223  3               
001223  3  A9 00        	lda #<sprtab 		; address of sprite table, even sprites.
001225  3  85 rr        	sta z80_x
001227  3  A9 0B        	lda #>sprtab
001229  3  85 rr        	sta z80_i
00122B  3               
00122B  3  20 B2 1E     	jsr dspr 		; display sprites.
00122E  3               
00122E  3  A9 11        	lda #<(sprtab+TABSIZ) 	; address of first odd sprite.
001230  3  85 rr        	sta z80_x
001232  3  A9 0B        	lda #>(sprtab+TABSIZ)
001234  3  85 rr        	sta z80_i
001236  3  20 B2 1E     	jsr dspr 		; display sprites.
001239  3               mloop:
001239  3  20 BC 0E     	jsr vsync 		; synchronise with display.
00123C  3               
00123C  3  A9 00        	lda #<sprtab 		; address of sprite table, even sprites.
00123E  3  85 rr        	sta z80_x
001240  3  A9 0B        	lda #>sprtab
001242  3  85 rr        	sta z80_i
001244  3               
001244  3  A9 06 8D 21  DEBUG_PAL PAL_red
001248  3  FE A9 16 8D  
00124C  3  21 FE A9 26  
00126C  3  20 B2 1E     	jsr dspr 		; display even sprites.
00126F  3  A9 07 8D 21  DEBUG_PAL PAL_black
001273  3  FE A9 17 8D  
001277  3  21 FE A9 27  
001297  3               
001297  3  20 D7 14     	jsr plsnd 		; play sounds.
00129A  3  20 BC 0E     	jsr vsync 		; synchronise with display.
00129D  3               
00129D  3  A9 11        	lda #<(sprtab+TABSIZ) 	; address of first odd sprite.
00129F  3  85 rr        	sta z80_x
0012A1  3  A9 0B        	lda #>(sprtab+TABSIZ)
0012A3  3  85 rr        	sta z80_i
0012A5  3               
0012A5  3  A9 06 8D 21  DEBUG_PAL PAL_red
0012A9  3  FE A9 16 8D  
0012AD  3  21 FE A9 26  
0012CD  3  20 B2 1E     	jsr dspr 		; display odd sprites.
0012D0  3  A9 07 8D 21  DEBUG_PAL PAL_black
0012D4  3  FE A9 17 8D  
0012D8  3  21 FE A9 27  
0012F8  3               
0012F8  3  A9 12        	lda #<(ssprit) 		; point to spare sprite for spawning purposes.
0012FA  3  85 rr        	sta z80_x
0012FC  3  A9 24        	lda #>(ssprit)
0012FE  3  85 rr        	sta z80_i
001300  3               evlp1:
001300  3  A9 05 8D 21  DEBUG_PAL PAL_green
001304  3  FE A9 15 8D  
001308  3  21 FE A9 25  
001328  3  20 6A 29     	jsr evnt10 		; called once per main loop.
00132B  3  20 30 1E     	jsr pspr 		; process sprites.
00132E  3  A9 07 8D 21  DEBUG_PAL PAL_black
001332  3  FE A9 17 8D  
001336  3  21 FE A9 27  
001356  3               
001356  3               ; Main loop events.
001356  3               
001356  3  A9 12        	lda #<ssprit 		; point to spare sprite for spawning purposes.
001358  3  85 rr        	sta z80_x
00135A  3  A9 24        	lda #>ssprit
00135C  3  85 rr        	sta z80_i
00135E  3  A9 05 8D 21  DEBUG_PAL PAL_green
001362  3  FE A9 15 8D  
001366  3  21 FE A9 25  
001386  3               evlp2:
001386  3  20 82 29     	jsr evnt11 		; called once per main loop.
001389  3               bsortx:
001389  3  20 A6 1D     	jsr bsort 		; sort sprites.
00138C  3  A9 07 8D 21  DEBUG_PAL PAL_black
001390  3  FE A9 17 8D  
001394  3  21 FE A9 27  
0013B4  3               
0013B4  3  A5 rr        	lda nexlev		; finished level flag.
0013B6  3  D0 1F        	bne newlev		; is set, go to next level.
0013B8  3  A5 rr        	lda gamwon		; finished game flag.
0013BA  3  D0 2A        	bne evwon		; is set, finish the game.
0013BC  3  A5 rr        	lda restfl 		; finished level flag.
0013BE  3  C9 01        	cmp #1			; has it been set?
0013C0  3  D0 03        	bne :+
0013C2  3  4C FA 11     	jmp rstrt		; yes, go to next level.
0013C5  3               :
0013C5  3  C9 02        	cmp #2			; has it been set?
0013C7  3  D0 03        	bne :+
0013C9  3  4C 09 12     	jmp rstrtn		; yes, go to next level.
0013CC  3               :
0013CC  3  A5 rr        	lda deadf 		; dead flag.
0013CE  3  D0 1C        	bne pdead		; yes, player dead.
0013D0  3               
0013D0  3               ; back to start of main loop.
0013D0  3               
0013D0  3  E6 rr        	inc frmno
0013D2  3  E6 rr        	inc clock
0013D4  3  4C 39 12     	jmp mloop		; switched to a jmp mloop during test mode.
0013D7  3               
0013D7  3               ;----------------------------------------------------------
0013D7  3               ; New level
0013D7  3               ;----------------------------------------------------------
0013D7  3               
0013D7  3               newlev:
0013D7  3  A5 rr        	lda scno 			; current screen.
0013D9  3  18           	clc
0013DA  3  69 01        	adc #1				; next screen.
0013DC  3  CD 9D 55     	cmp numsc			; total number of screens.
0013DF  3  B0 05        	bcs evwon			; yes, game finished.
0013E1  3  85 rr        	sta scno			; set new level number.
0013E3  3  4C FA 11     	jmp rstrt			; restart, clearing all aliens.
0013E6  3               
0013E6  3               evwon:
0013E6  3  20 92 2A     	jsr evnt18		 	; game completed.
0013E9  3  4C FD 13     	jmp tidyup			; tidy up and return to BASIC/calling routine.
0013EC  3               
0013EC  3               ;----------------------------------------------------------
0013EC  3               ; Player dead.
0013EC  3               ;----------------------------------------------------------
0013EC  3               
0013EC  3               pdead:
0013EC  3  A9 00        	lda #0				; zeroise accumulator.
0013EE  3  85 rr        	sta deadf			; reset dead flag.
0013F0  3               evdie:
0013F0  3  20 23 2A     	jsr evnt16 			; death subroutine.
0013F3  3  A5 rr        	lda numlif			; number of lives.
0013F5  3  F0 03        	beq :+
0013F7  3  4C FA 11     	jmp rstrt 			; restart game.
0013FA  3               :
0013FA  3               evfail:
0013FA  3  20 68 2A     	jsr evnt17 			; failure event.
0013FD  3               
0013FD  3               ;----------------------------------------------------------
0013FD  3               ; Tidy things up
0013FD  3               ;----------------------------------------------------------
0013FD  3               
0013FD  3               tidyup:
0013FD  3  A0 00        	ldy #0				; digits to check.
0013FF  3               tidyu2:
0013FF  3  B9 A2 16     	lda score,y 			; get score digit.
001402  3  CD A8 16     	cmp hiscor 			; are we larger than high score digit?
001405  3  90 07        	bcc tidyu0			; high score is bigger.
001407  3  D0 0E        	bne tidyu1			; score is greater, record new high score.
001409  3  C8           	iny				; next digit of high score.
00140A  3  C0 06        	cpy #6
00140C  3  D0 F1        	bne tidyu2			; repeat for all digits
00140E  3               tidyu0:
00140E  3  A9 A2        	lda #<score			; return pointing to score.
001410  3  85 rr        	sta z80_c
001412  3  A9 16        	lda #>score
001414  3  85 rr        	sta z80_b
001416  3  60           	rts
001417  3               tidyu1:
001417  3  A0 05        	ldy #5
001419  3               tidyu3:
001419  3  B9 A2 16     	lda score,y			; score.
00141C  3  99 A8 16     	sta hiscor,y			; high score.
00141F  3  88           	dey
001420  3  10 F7        	bpl tidyu3 			; copy score to high score.
001422  3               evnewh:
001422  3  20 BE 2A     	jsr evnt19			; new high score event.
001425  3  4C 0E 14     	jmp tidyu0			; tidy up.
001428  3               
001428  3               ;--------------------------------------------------
001428  3               ; Restart event.
001428  3               ;--------------------------------------------------
001428  3               
001428  3               rsevt:
001428  3  A9 12        	lda #<ssprit 			; default to spare element in table.
00142A  3  85 rr        	sta z80_x
00142C  3  A9 24        	lda #>ssprit
00142E  3  85 rr        	sta z80_i
001430  3               evrs:
001430  3  4C 21 2A     	jmp evnt14	 		; call restart event.
001433  3               
001433  3               ;------------------------------------------------------------------
001433  3               ; Copy number passed in a to string position bc, right-justified.
001433  3               ;
001433  3               ; Input:
001433  3               ;  A  = number
001433  3               ;  BC = string address
001433  3               ;
001433  3               ; Output:
001433  3               ;  BC = string with number
001433  3               ;-----------------------------------------------------------------
001433  3               
001433  3               num2ch:
001433  3  85 rr        	sta z80_d		; Save number
001435  3               
001435  3  A9 00        	lda #0
001437  3  85 rr        	sta flag
001439  3               numdg3:
001439  3  A2 64        	ldx #100		; hundreds column.
00143B  3  86 rr        	stx z80_e
00143D  3  20 4D 14     	jsr numdg		; show digit.
001440  3               numdg2:
001440  3  A2 0A        	ldx #10			; tens column.
001442  3  86 rr        	stx z80_e
001444  3  20 4D 14     	jsr numdg		; show digit.
001447  3               
001447  3  E6 rr        	inc flag
001449  3  A2 01        	ldx #1			; units column.
00144B  3  86 rr        	stx z80_e
00144D  3               numdg:
00144D  3  A9 30        	lda #48			; clear digit.
00144F  3  85 rr        	sta z80_a
001451  3               numdg1:
001451  3  A5 rr        	lda z80_d
001453  3  C5 rr        	cmp z80_e
001455  3  90 0E        	bcc numdg0		; nothing to show.
001457  3  38           	sec
001458  3  A5 rr        	lda z80_d
00145A  3  E5 rr        	sbc z80_e		; subtract from column.
00145C  3  85 rr        	sta z80_d
00145E  3  E6 rr        	inc z80_a		; increment digit.
001460  3  E6 rr        	inc flag
001462  3  4C 51 14     	jmp numdg1		; repeat until column is zero.
001465  3               numdg0:
001465  3  A0 00        	ldy #0
001467  3  A5 rr        	lda z80_a
001469  3  91 rr        	sta (z80_bc),y		; write digit to buffer.
00146B  3  A5 rr        	lda flag
00146D  3  F0 06        	beq :+
00146F  3  E6 rr        	inc z80_c		; next buffer position.
001471  3  D0 02        	bne :+
001473  3  E6 rr        	inc z80_b
001475  3               :
001475  3  60           	rts
001476  3               num2dd:
001476  3  85 rr        	sta z80_d		; Save number
001478  3               
001478  3  A9 01        	lda #1
00147A  3  85 rr        	sta flag
00147C  3               
00147C  3  4C 40 14     	jmp numdg2
00147F  3               num2td:
00147F  3  85 rr        	sta z80_d		; Save number
001481  3               
001481  3  A9 01        	lda #1
001483  3  85 rr        	sta flag
001485  3  4C 39 14     	jmp numdg3
001488  3               
001488  3               ;---------------------------------------------------------
001488  3               ; Reset score to "000000"
001488  3               ;---------------------------------------------------------
001488  3               
001488  3               inisc:
001488  3  A9 30        	lda #'0'
00148A  3  A2 05        	ldx #5			; digits to initialise.
00148C  3               inisc0:
00148C  3  9D A2 16     	sta score,x 		; write zero digit.
00148F  3  CA           	dex			; next column.
001490  3  10 FA        	bpl inisc0		; repeat for all digits.
001492  3               
001492  3  60           	rts
001493  3               
001493  3               ;-----------------------------------------------------
001493  3               ; Multiply h by d and return in hl.
001493  3               ;
001493  3               ; Input:
001493  3               ;  H = first number
001493  3               ;  D = second number
001493  3               ;
001493  3               ; Output:
001493  3               ;  HL = result H x D
001493  3               ;-----------------------------------------------------
001493  3               
001493  3               imul:
001493  3  A5 rr        	lda z80_d		; HL = H * D
001495  3  85 rr        	sta z80_e
001497  3  A5 rr        	lda z80_h
001499  3  85 rr        	sta z80_c		; make c first multiplier.
00149B  3               imul0:
00149B  3  A9 00        	lda #0			; zeroise total.
00149D  3  85 rr        	sta z80_l
00149F  3  85 rr        	sta z80_h
0014A1  3               
0014A1  3  A5 rr        	lda z80_h
0014A3  3  85 rr        	sta z80_d		; zeroise high byte.
0014A5  3               
0014A5  3  A9 08        	lda #8			; repeat 8 times.
0014A7  3  85 rr        	sta z80_b
0014A9  3               imul1:
0014A9  3  46 rr        	lsr z80_c		; rotate rightmost bit into carry.
0014AB  3  90 0E        	bcc imul2		; wasn't set.
0014AD  3  18           	clc			; bit was set, so add de.
0014AE  3  A5 rr        	lda z80_l
0014B0  3  65 rr        	adc z80_e
0014B2  3  85 rr        	sta z80_l
0014B4  3  A5 rr        	lda z80_h
0014B6  3  65 rr        	adc z80_d
0014B8  3  85 rr        	sta z80_h
0014BA  3  18           	clc 			; reset carry.
0014BB  3               imul2:
0014BB  3  06 rr        	asl z80_e 		; shift de 1 bit left.
0014BD  3  26 rr        	rol z80_d
0014BF  3  C6 rr        	dec z80_b
0014C1  3  D0 E6        	bne imul1		; repeat 8 times.
0014C3  3               
0014C3  3  60           	rts
0014C4  3               
0014C4  3               ;-----------------------------------------------
0014C4  3               ; Divide d by e and return in d, remainder in a.
0014C4  3               ;
0014C4  3               ; Input:
0014C4  3               ;  D = first number
0014C4  3               ;  E = second number
0014C4  3               ;
0014C4  3               ; Output:
0014C4  3               ;  D = result D/E
0014C4  3               ;  A = remainder
0014C4  3               ;-----------------------------------------------
0014C4  3               
0014C4  3               idiv:
0014C4  3  A9 00        	lda #0
0014C6  3  A0 08        	ldy #8		 	; bits to shift.
0014C8  3  06 rr        	asl z80_d
0014CA  3               idiv0:
0014CA  3  2A           	rol a 			; multiply d by 2.
0014CB  3  C5 rr        	cmp z80_e 		; test if e is smaller.
0014CD  3  90 02        	bcc idiv1		; e is greater, no division this time.
0014CF  3  E5 rr        	sbc z80_e		; subtract it.
0014D1  3               idiv1:
0014D1  3  26 rr        	rol z80_d		; rotate into d.
0014D3  3  88           	dey
0014D4  3  D0 F4        	bne idiv0		; repeat
0014D6  3  60           	rts
0014D7  3               
0014D7  3               ;---------------------------------------------------
0014D7  3               ; Play AY sound effect
0014D7  3               ;---------------------------------------------------
0014D7  3               
0014D7  3               plsnd:
0014D7  3  60           	rts
0014D8  3               
0014D8  3               ;---------------------------------------------------
0014D8  3               ; Objects handling.
0014D8  3               ; 32 bytes for image
0014D8  3               ; 3 for room, y and x
0014D8  3               ; 3 for starting room, y and x.
0014D8  3               ; 254 = disabled.
0014D8  3               ; 255 = object in player"s pockets.
0014D8  3               ;---------------------------------------------------
0014D8  3               
0014D8  3               ;---------------------------------------------------
0014D8  3               ; Show items present.
0014D8  3               ;---------------------------------------------------
0014D8  3               
0014D8  3               shwob:
0014D8  3  A9 3D        	lda #<objdta 			; objects table.
0014DA  3  85 rr        	sta z80_l
0014DC  3  A9 58        	lda #>objdta
0014DE  3  85 rr        	sta z80_h
0014E0  3               
0014E0  3  AD C3 10     	lda numob 			; number of objects in the game.
0014E3  3  85 rr        	sta sprcnt
0014E5  3               shwob0:
0014E5  3  A0 20        	ldy #32 			; distance to room number.
0014E7  3  B1 rr        	lda (z80_hl),y 			; same as an item?
0014E9  3  C5 rr        	cmp scno 			; current location.
0014EB  3  D0 03        	bne :+
0014ED  3  20 02 15     	jsr dobj 			; yes, display object.
0014F0  3               :
0014F0  3  18           	clc
0014F1  3  A5 rr        	lda z80_l
0014F3  3  69 26        	adc #38 			; distance to next item.
0014F5  3  85 rr        	sta z80_l
0014F7  3  A5 rr        	lda z80_h
0014F9  3  69 00        	adc #0
0014FB  3  85 rr        	sta z80_h	 		; point to it.
0014FD  3  C6 rr        	dec sprcnt
0014FF  3  D0 E4        	bne shwob0 			; repeat for others.
001501  3  60           	rts
001502  3               
001502  3               ;---------------------------------------------------
001502  3               ; Display object.
001502  3               ; hl must point to object's start address.
001502  3               ;
001502  3               ; Input:
001502  3               ;  HL = object address
001502  3               ;---------------------------------------------------
001502  3               
001502  3               dobj:
001502  3  A0 21        	ldy #33
001504  3  B1 rr        	lda (z80_hl),y 			; point to y.
001506  3  85 rr        	sta dispy
001508  3  C8           	iny
001509  3  B1 rr        	lda (z80_hl),y 			; point to x.
00150B  3  85 rr        	sta dispx
00150D  3               dobj1:
00150D  3  4C 1E 0F     	jmp sprite 			; draw this sprite.
001510  3               
001510  3               ;--------------------------------------
001510  3               ; Remove an object.
001510  3               ;
001510  3               ; Input:
001510  3               ;  A = object number
001510  3               ;--------------------------------------
001510  3               
001510  3               remob:
001510  3  CD C3 10     	cmp numob			; number of objects in game.
001513  3  90 01        	bcc :+				; are we checking past the end?
001515  3  60           	rts				; yes, can't get non-existent item.
001516  3               :
001516  3  48           	pha				; remember object.
001517  3  20 25 15     	jsr getob			; pick it up if we haven't already got it.
00151A  3  68           	pla				; retrieve object number.
00151B  3  20 54 15     	jsr gotob			; get its address.
00151E  3  A9 FE        	lda #254
001520  3  A0 20        	ldy #32
001522  3  91 rr        	sta (z80_hl),y			; remove it.
001524  3  60           	rts
001525  3               
001525  3               ;---------------------------------------------------
001525  3               ; Pick up object number held in the accumulator.
001525  3               ;
001525  3               ; Input:
001525  3               ;  A = object number
001525  3               ;---------------------------------------------------
001525  3               
001525  3               getob:
001525  3  CD C3 10     	cmp numob 		; number of objects in game.
001528  3  90 01        	bcc :+			; are we checking past the end?
00152A  3  60           	rts			; yes, can't get non-existent item.
00152B  3               :
00152B  3  20 54 15     	jsr gotob 		; check if we already have it.
00152E  3  C9 FF        	cmp #255
001530  3  D0 01        	bne :+
001532  3  60           	rts			; we already do.
001533  3               :
001533  3  A0 20        	ldy #32
001535  3  B1 rr        	lda (z80_hl),y		; is it on this screen?
001537  3  C5 rr        	cmp scno 		; current screen.
001539  3  D0 14        	bne getob0		; not on screen, so nothing to delete.
00153B  3               
00153B  3  A9 FF        	lda #255
00153D  3  91 rr        	sta (z80_hl),y		; pick it up.
00153F  3  C8           	iny 			; point to y coord.
001540  3               getob1:
001540  3  A0 21        	ldy #33
001542  3  B1 rr        	lda (z80_hl),y		; y coord.
001544  3  85 rr        	sta dispy
001546  3  A0 22        	ldy #34
001548  3  B1 rr        	lda (z80_hl),y 		; x coord.
00154A  3  85 rr        	sta dispx
00154C  3  4C 0D 15     	jmp dobj1 		; delete object sprite.
00154F  3               getob0:
00154F  3  A9 FF        	lda #255
001551  3  91 rr        	sta (z80_hl),y 		; pick it up.
001553  3  60           	rts
001554  3               
001554  3               ;-----------------------------------------------------------------
001554  3               ; Got object check.
001554  3               ; Call with object in accumulator, returns zero set if in pockets.
001554  3               ;
001554  3               ; Input:
001554  3               ;  A = object number
001554  3               ;-----------------------------------------------------------------
001554  3               
001554  3               gotob:
001554  3  CD C3 10     	cmp numob 		; number of objects in game.
001557  3  90 03        	bcc :+ 			; are we checking past the end?
001559  3  4C 60 15     	jmp gotob0 		; yes, we can't have a non-existent object.
00155C  3               :
00155C  3  20 65 15     	jsr findob		; find the object.
00155F  3               gotob1:
00155F  3  60           	rts
001560  3               
001560  3               gotob0:
001560  3  A9 FE        	lda #254 		; missing.
001562  3  4C 5F 15     	jmp gotob1
001565  3               
001565  3               findob:
001565  3  48           	pha			; save object number
001566  3  A9 3D        	lda #<objdta 		; objects.
001568  3  85 rr        	sta z80_l
00156A  3  A9 58        	lda #>objdta
00156C  3  85 rr        	sta z80_h
00156E  3  68           	pla			; retreive object number
00156F  3  F0 0F        	beq fndob1 		; is it zero? yes, skip loop.
001571  3  AA           	tax 			; loop counter
001572  3               fndob2:
001572  3  18           	clc
001573  3  A5 rr        	lda z80_l
001575  3  69 26        	adc #38 		; size of each object.
001577  3  85 rr        	sta z80_l
001579  3  90 02        	bcc :+
00157B  3  E6 rr        	inc z80_h
00157D  3               :
00157D  3  CA           	dex 			; repeat until we find address.
00157E  3  D0 F2        	bne fndob2
001580  3               fndob1:
001580  3  A0 20        	ldy #32			; distance to room it's in.
001582  3  B1 rr        	lda (z80_hl),y		; fetch status.
001584  3  60           	rts
001585  3               
001585  3               ;---------------------------------------------
001585  3               ; Drop object number at (dispx, dispy).
001585  3               ;
001585  3               ; Input:
001585  3               ;  A = object number
001585  3               ;---------------------------------------------
001585  3               
001585  3               drpob:
001585  3  CD C3 10     	cmp numob 		; are we checking past the end?
001588  3  90 01        	bcc :+
00158A  3  60           	rts			; yes, can't drop non-existent item.
00158B  3               :
00158B  3  20 54 15     	jsr gotob		; make sure object is in inventory.
00158E  3  C5 rr        	cmp scno		; already on this screen?
001590  3  D0 01        	bne :+
001592  3  60           	rts			; yes, nothing to do.
001593  3               :
001593  3  A0 20        	ldy #32
001595  3  A5 rr        	lda scno
001597  3  91 rr        	sta (z80_hl),y		; bring onto screen.
001599  3  A5 rr        	lda dispy		; sprite y coordinate.
00159B  3  C8           	iny
00159C  3  91 rr        	sta (z80_hl),y		; point to object y.
00159E  3  A5 rr        	lda dispx 		; sprite x coordinate.
0015A0  3  C8           	iny
0015A1  3  91 rr        	sta (z80_hl),y 		; point to object x
0015A3  3  4C 02 15     	jmp dobj		; draw the object sprite.
0015A6  3               
0015A6  3               ;-----------------------------------------------
0015A6  3               ; Seek objects at sprite position.
0015A6  3               ;
0015A6  3               ; Output:
0015A6  3               ;  A = object number, if not found A=255
0015A6  3               ;-----------------------------------------------
0015A6  3               
0015A6  3               skobj:
0015A6  3  A9 3D        	lda #<objdta 		; pointer to objects.
0015A8  3  85 rr        	sta z80_l
0015AA  3  A9 58        	lda #>objdta
0015AC  3  85 rr        	sta z80_h
0015AE  3               
0015AE  3  AD C3 10     	lda numob 		; number of objects in game.
0015B1  3  85 rr        	sta z80_b 		; set up the loop counter.
0015B3  3               skobj0:
0015B3  3  A5 rr        	lda scno		; current room number.
0015B5  3  A0 20        	ldy #32
0015B7  3  D1 rr        	cmp (z80_hl),y		; is object in here?
0015B9  3  D0 03        	bne :+
0015BB  3  20 D0 15     	jsr skobj1		; yes, check coordinates.
0015BE  3               :
0015BE  3  18           	clc			; point to next object in table.
0015BF  3  A5 rr        	lda z80_l
0015C1  3  69 26        	adc #38			; size of each object.
0015C3  3  85 rr        	sta z80_l
0015C5  3  90 02        	bcc :+
0015C7  3  E6 rr        	inc z80_h
0015C9  3               :
0015C9  3  C6 rr        	dec z80_b
0015CB  3  D0 E6        	bne skobj0		; repeat for all objects.
0015CD  3               
0015CD  3  A9 FF        	lda #255		; end of list and nothing found, return 255.
0015CF  3  60           	rts
0015D0  3               
0015D0  3               skobj1:
0015D0  3  A0 21        	ldy #33			; point to y coordinate.
0015D2  3  B1 rr        	lda (z80_hl),y		; point to y coordinate.
0015D4  3  38           	sec
0015D5  3  A0 08        	ldy #var_newY
0015D7  3  F1 rr        	sbc (z80_ix),y 		; subtract sprite y.
0015D9  3  18           	clc
0015DA  3  69 0F        	adc #15			; add sprite height minus one.
0015DC  3  C9 1F        	cmp #31			; within range?
0015DE  3  90 03        	bcc :+
0015E0  3  4C FE 15     	jmp skobj2		; no, ignore object.
0015E3  3               :
0015E3  3  A0 22        	ldy #34			; point to x coordinate now.
0015E5  3  B1 rr        	lda (z80_hl),y 		; get coordinate.
0015E7  3  38           	sec
0015E8  3  A0 09        	ldy #var_newX
0015EA  3  F1 rr        	sbc (z80_ix),y 		; subtract the sprite x.
0015EC  3  18           	clc			; add sprite width minus one.
0015ED  3  69 0F        	adc #15
0015EF  3  C9 1F        	cmp #31			; within range?
0015F1  3  90 03        	bcc :+
0015F3  3  4C FE 15     	jmp skobj2		; no, ignore object.
0015F6  3               :
0015F6  3  68           	pla			; remove return address from stack.
0015F7  3  68           	pla
0015F8  3               
0015F8  3  AD C3 10     	lda numob 		; objects in game.
0015FB  3  38           	sec
0015FC  3  E5 rr        	sbc z80_b		; subtract loop counter.
0015FE  3               skobj2:
0015FE  3  60           	rts			; accumulator now points to object.
0015FF  3               
0015FF  3               
0015FF  3               ;---------------------------------------------------------------------
0015FF  3               ; Spawn a new sprite.
0015FF  3               ;---------------------------------------------------------------------
0015FF  3               
0015FF  3               spawn:
0015FF  3  A9 00        	lda #<sprtab		; sprite table.
001601  3  85 rr        	sta z80_l
001603  3  A9 0B        	lda #>sprtab
001605  3  85 rr        	sta z80_h
001607  3               numsp1:
001607  3  A9 0C        	lda #NUMSPR		; number of sprites.
001609  3  85 rr        	sta spcnt
00160B  3               spaw0:
00160B  3  A0 00        	ldy #var_Type
00160D  3  B1 rr        	lda (z80_hl),y		; get sprite type.
00160F  3  C9 FF        	cmp #255		; is it an unused slot?
001611  3  F0 0F        	beq spaw1 		; yes, we can use this one.
001613  3               
001613  3  18           	clc 			; point to next sprite in table.
001614  3  A5 rr        	lda z80_l
001616  3  69 11        	adc #TABSIZ		; size of each entry.
001618  3  85 rr        	sta z80_l
00161A  3  90 02        	bcc :+
00161C  3  E6 rr        	inc z80_h
00161E  3               :
00161E  3  C6 rr        	dec spcnt		; one less iteration.
001620  3  D0 E9        	bne spaw0		; keep going until we find a slot.
001622  3               
001622  3               ; Didn't find one but drop through and set up a dummy sprite instead.
001622  3               
001622  3               spaw1:
001622  3  A5 rr        	lda z80_i		; address of original sprite.
001624  3  48           	pha
001625  3  A5 rr        	lda z80_x
001627  3  48           	pha
001628  3               
001628  3  A5 rr        	lda z80_l		; store spawned sprite address.
00162A  3  85 rr        	sta spptr
00162C  3  A5 rr        	lda z80_h
00162E  3  85 rr        	sta spptr+1
001630  3               
001630  3  A5 rr        	lda z80_c
001632  3  A0 00        	ldy #var_Type
001634  3  91 rr        	sta (z80_hl),y 		; set the type.
001636  3  A0 05        	ldy #var_newType
001638  3  91 rr        	sta (z80_hl),y		; copy
00163A  3               
00163A  3  A5 rr        	lda z80_b
00163C  3  A0 01        	ldy #var_Image
00163E  3  91 rr        	sta (z80_hl),y		; set the image.
001640  3  A0 06        	ldy #var_newImage
001642  3  91 rr        	sta (z80_hl),y		; copy
001644  3               
001644  3  A9 00        	lda #0 				; frame zero.
001646  3  A0 02        	ldy #var_Frame
001648  3  91 rr        	sta (z80_hl),y		; set frame.
00164A  3  A0 07        	ldy #var_newFrame
00164C  3  91 rr        	sta (z80_hl),y		; copy
00164E  3               
00164E  3  A0 09        	ldy #9
001650  3  B1 rr        	lda (z80_ix),y 		; x coordinate.
001652  3  A0 04        	ldy #var_X
001654  3  91 rr        	sta (z80_hl),y		; set sprite coordinate.
001656  3  A0 09        	ldy #var_newX
001658  3  91 rr        	sta (z80_hl),y		; copy
00165A  3               
00165A  3  A0 08        	ldy #8
00165C  3  B1 rr        	lda (z80_ix),y 		; y coordinate.
00165E  3  A0 03        	ldy #var_Y
001660  3  91 rr        	sta (z80_hl),y		; set sprite coordinate.
001662  3  A0 08        	ldy #var_newY
001664  3  91 rr        	sta (z80_hl),y		; copy
001666  3               
001666  3  A0 0A        	ldy #10				; direction of original.
001668  3  B1 rr        	lda (z80_ix),y
00166A  3  A0 0A        	ldy #var_Direction
00166C  3  91 rr        	sta (z80_hl),y		; direction
00166E  3               
00166E  3  A9 00        	lda #0
001670  3  A0 0D        	ldy #var_jumpLo
001672  3  91 rr        	sta (z80_hl),y		; reset parameter.
001674  3  C8           	iny
001675  3  91 rr        	sta (z80_hl),y		; reset parameter.
001677  3  C8           	iny
001678  3  91 rr        	sta (z80_hl),y		; reset parameter.
00167A  3  C8           	iny
00167B  3  91 rr        	sta (z80_hl),y		; reset parameter.
00167D  3               rtssp:
00167D  3  A5 rr        	lda spptr			; address of new sprite.
00167F  3  85 rr        	sta z80_x
001681  3  A5 rr        	lda spptr+1
001683  3  85 rr        	sta z80_i
001685  3               evis1:
001685  3  20 69 29     	jsr evnt09 			; call sprite initialisation event.
001688  3               
001688  3  A5 rr        	lda spptr 			; address of new sprite.
00168A  3  85 rr        	sta z80_x
00168C  3  A5 rr        	lda spptr+1
00168E  3  85 rr        	sta z80_i
001690  3               
001690  3               	; _BEEB clipping code copied from CPC Engine - MISSING?!
001690  3  A0 03        	ldy #var_Y
001692  3  B1 rr        	lda (z80_hl), y		; old x coord
001694  3  C9 B1        	cmp #SpriteMaxY     ; beyond maximum?
001696  3  B0 03        	bcs :+				; yes, don't draw it.
001698  3               
001698  3  20 84 0F     	jsr sspria 			; display the new sprite.
00169B  3               :
00169B  3  68           	pla					; address of original sprite.
00169C  3  85 rr        	sta z80_x
00169E  3  68           	pla
00169F  3  85 rr        	sta z80_i
0016A1  3               
0016A1  3  60           	rts
0016A2  3               
0016A2  3  30 30 30 30  score:	.byte "000000"		; player"s score.
0016A6  3  30 30        
0016A8  3  30 30 30 30  hiscor:	.byte "000000"		; high score.
0016AC  3  30 30        
0016AE  3  30 30 30 30  bonus:	.byte "000000"		; bonus.
0016B2  3  30 30        
0016B4  3  00 68        grbase:	.word ScreenAddr	; graphics base address.
0016B6  3               
0016B6  3               ;----------------------------------------------------
0016B6  3               ; Check y-pos
0016B6  3               ;----------------------------------------------------
0016B6  3               
0016B6  3               checkx:
0016B6  3  A5 rr        	lda dispy		; y position.
0016B8  3  C9 18        	cmp #24			; off screen?
0016BA  3  B0 01        	bcs :+
0016BC  3  60           	rts			; no, it's okay.
0016BD  3               :
0016BD  3  68           	pla			; remove return address from stack.
0016BE  3  85 rr        	sta z80_l
0016C0  3  68           	pla
0016C1  3  85 rr        	sta z80_h
0016C3  3  60           	rts
0016C4  3               
0016C4  3               ;-----------------------------------------------
0016C4  3               ; Displays the current high score.
0016C4  3               ;-----------------------------------------------
0016C4  3               
0016C4  3               dhisc:
0016C4  3  A9 A8        	lda #<hiscor 		; high score text.
0016C6  3  85 rr        	sta z80_l
0016C8  3  A9 16        	lda #>hiscor
0016CA  3  85 rr        	sta z80_h
0016CC  3  4C D7 16     	jmp dscor1		; check in printable range then show 6 digits.
0016CF  3               
0016CF  3               ;------------------------------------------------------
0016CF  3               ; Displays the current score.
0016CF  3               ;------------------------------------------------------
0016CF  3               
0016CF  3               dscor:
0016CF  3  A9 A2        	lda #<score		; score text.
0016D1  3  85 rr        	sta z80_l
0016D3  3  A9 16        	lda #>score
0016D5  3  85 rr        	sta z80_h
0016D7  3               dscor1:
0016D7  3  20 7A 1D     	jsr preprt		; set up font and print position.
0016DA  3  20 B6 16     	jsr checkx		; make sure we're in a printable range.
0016DD  3               
0016DD  3  A9 06        	lda #6			; digits to display.
0016DF  3  85 rr        	sta z80_b
0016E1  3  A5 rr        	lda prtmod		; get print mode.
0016E3  3  F0 03        	beq :+			; standard size text?
0016E5  3  4C 04 17     	jmp bscor0		; no, show double-height.
0016E8  3               :
0016E8  3               dscor0:
0016E8  3  A0 00        	ldy #0
0016EA  3  B1 rr        	lda (z80_hl),y 		; fetch character.
0016EC  3  20 72 10     	jsr pchar 		; display character.
0016EF  3  E6 rr        	inc dispx		; move along x coordinate
0016F1  3               
0016F1  3  E6 rr        	inc z80_l		; next score column.
0016F3  3  D0 02        	bne :+
0016F5  3  E6 rr        	inc z80_h
0016F7  3               :
0016F7  3  C6 rr        	dec z80_b
0016F9  3  D0 ED        	bne dscor0 		; repeat for all digits.
0016FB  3               dscor2:
0016FB  3  A5 rr        	lda dispx 		; set up display coordinates.
0016FD  3  85 rr        	sta charx
0016FF  3  A5 rr        	lda dispy
001701  3  85 rr        	sta chary
001703  3  60           	rts
001704  3               
001704  3               ;------------------------------------------------------
001704  3               ; Displays the current score in double-height characters.
001704  3               ;
001704  3               ; Input:
001704  3               ;  B  = digit number
001704  3               ;  HL = score string
001704  3               ;------------------------------------------------------
001704  3               
001704  3               bscor0:
001704  3  A0 00        	ldy #0
001706  3               
001706  3  B1 rr        	lda (z80_hl),y 		; fetch character.
001708  3  20 FD 1C     	jsr bchar 		; display big char.
00170B  3               
00170B  3  E6 rr        	inc z80_l 		; next score column.
00170D  3  D0 02        	bne :+
00170F  3  E6 rr        	inc z80_h
001711  3               :
001711  3  C6 rr        	dec z80_b
001713  3  F0 03        	beq :+
001715  3  4C 04 17     	jmp bscor0 		; repeat for all digits.
001718  3               :
001718  3  4C FB 16     	jmp dscor2 		; tidy up line and column variables.
00171B  3               
00171B  3               ;-----------------------------------------------------
00171B  3               ; Adds number in the hl pair to the score.
00171B  3               ;-----------------------------------------------------
00171B  3               
00171B  3               addsc:
00171B  3  A9 A3        	lda #<(score+1) 	; ten thousands column.
00171D  3  85 rr        	sta z80_e
00171F  3  A9 16        	lda #>(score+1)
001721  3  85 rr        	sta z80_d
001723  3  A9 10        	lda #<10000		; amount to add each time.
001725  3  85 rr        	sta z80_c
001727  3  A9 27        	lda #>10000
001729  3  85 rr        	sta z80_b
00172B  3  20 6F 17     	jsr incsc		; add to score.
00172E  3               
00172E  3  E6 rr        	inc z80_e		; thousands column.
001730  3  D0 02        	bne :+
001732  3  E6 rr        	inc z80_d
001734  3               :
001734  3  A9 E8        	lda #<1000		; amount to add each time.
001736  3  85 rr        	sta z80_c
001738  3  A9 03        	lda #>1000
00173A  3  85 rr        	sta z80_b
00173C  3  20 6F 17     	jsr incsc 		; add to score.
00173F  3               
00173F  3  E6 rr        	inc z80_e		; hundreds column.
001741  3  D0 02        	bne :+
001743  3  E6 rr        	inc z80_d
001745  3               :
001745  3  A9 64        	lda #<100		; amount to add each time.
001747  3  85 rr        	sta z80_c
001749  3  A9 00        	lda #>100
00174B  3  85 rr        	sta z80_b
00174D  3  20 6F 17     	jsr incsc		; add to score.
001750  3               
001750  3  E6 rr        	inc z80_e 		; tens column.
001752  3  D0 02        	bne :+
001754  3  E6 rr        	inc z80_d
001756  3               :
001756  3  A9 0A        	lda #<10		; amount to add each time.
001758  3  85 rr        	sta z80_c
00175A  3  A9 00        	lda #>10
00175C  3  85 rr        	sta z80_b
00175E  3  20 6F 17     	jsr incsc 		; add to score.
001761  3               
001761  3  E6 rr        	inc z80_e		; units column.
001763  3  D0 02        	bne :+
001765  3  E6 rr        	inc z80_d
001767  3               :
001767  3  A9 01        	lda #<1			; units.
001769  3  85 rr        	sta z80_c
00176B  3  A9 00        	lda #>1
00176D  3  85 rr        	sta z80_b
00176F  3               incsc:
00176F  3  A5 rr        	lda z80_h		; store amount to add.
001771  3  48           	pha
001772  3  A5 rr        	lda z80_l
001774  3  48           	pha
001775  3               
001775  3  38           	sec			; subtract from amount to add.
001776  3  A5 rr        	lda z80_l
001778  3  E5 rr        	sbc z80_c
00177A  3  85 rr        	sta z80_l
00177C  3  A5 rr        	lda z80_h
00177E  3  E5 rr        	sbc z80_b
001780  3  85 rr        	sta z80_h
001782  3  90 14        	bcc incsc0		; too much, restore value.
001784  3               
001784  3  68           	pla			; delete the previous amount from the stack.
001785  3  68           	pla
001786  3               
001786  3  A5 rr        	lda z80_d 		; store column position.
001788  3  48           	pha
001789  3  A5 rr        	lda z80_e
00178B  3  48           	pha
00178C  3  20 9F 17     	jsr incsc2		; do the increment.
00178F  3               
00178F  3  68           	pla			; restore column.
001790  3  85 rr        	sta z80_e
001792  3  68           	pla
001793  3  85 rr        	sta z80_d
001795  3  4C 6F 17     	jmp incsc		; repeat until all added.
001798  3               
001798  3               incsc0:
001798  3  68           	pla			; restore previous value.
001799  3  85 rr        	sta z80_l
00179B  3  68           	pla
00179C  3  85 rr        	sta z80_h
00179E  3  60           	rts
00179F  3               incsc2:
00179F  3  A0 00        	ldy #0
0017A1  3  B1 rr        	lda (z80_de),y 		; get amount.
0017A3  3  18           	clc
0017A4  3  69 01        	adc #1			; add one to column.
0017A6  3  91 rr        	sta (z80_de),y		; write new column total.
0017A8  3  C9 3A        	cmp #'9'+1		; gone beyond range of digits?
0017AA  3  B0 01        	bcs :+
0017AC  3  60           	rts			; no, carry on.
0017AD  3               :
0017AD  3  A9 30        	lda #'0'		; make it zero.
0017AF  3  91 rr        	sta (z80_de),y		; write new column total.
0017B1  3  C6 rr        	dec z80_e		; back one column.
0017B3  3  D0 02        	bne :+
0017B5  3  C6 rr        	dec z80_d
0017B7  3               :
0017B7  3  4C 9F 17     	jmp incsc2
0017BA  3               
0017BA  3               ;------------------------------------
0017BA  3               ; Add bonus to score and reset bonus
0017BA  3               ;------------------------------------
0017BA  3               
0017BA  3               addbo:
0017BA  3  A2 05        	ldx #5			; last digit.
0017BC  3  18           	clc			; clear carry.
0017BD  3               addbo0:
0017BD  3  BD A2 16     	lda score,x		; get score.
0017C0  3  7D AE 16     	adc bonus,x		; add bonus.
0017C3  3  38           	sec			; 0 to 18.
0017C4  3  E9 30        	sbc #48
0017C6  3  48           	pha
0017C7  3  A9 30        	lda #'0'
0017C9  3  9D AE 16     	sta bonus,x		; zeroise bonus.
0017CC  3  68           	pla
0017CD  3  C9 3A        	cmp #58			; carried?
0017CF  3  B0 07        	bcs addbo2		; no, do next one.
0017D1  3  38           	sec
0017D2  3  E9 0A        	sbc #10			; subtract 10.
0017D4  3  38           	sec
0017D5  3  4C D9 17     	jmp addbo1
0017D8  3               addbo2:
0017D8  3  18           	clc
0017D9  3               addbo1:
0017D9  3  9D A2 16     	sta score,x		; write new score.
0017DC  3  CA           	dex			; next digit.
0017DD  3  10 DE        	bpl addbo0		; repeat for all 6 digits.
0017DF  3  60           	rts
0017E0  3               
0017E0  3               ;------------------------------------
0017E0  3               ; Swap score and bonus.
0017E0  3               ;------------------------------------
0017E0  3               
0017E0  3               swpsb:
0017E0  3  A2 05        	ldx #5			; digits to add.
0017E2  3               swpsb0:
0017E2  3  BD A2 16     	lda score,x 		; get score digits.
0017E5  3  48           	pha			; save digit
0017E6  3  BD AE 16     	lda bonus,x 		; get bonus digits.
0017E9  3  9D A2 16     	sta score,x		; switch score-bonus
0017EC  3  68           	pla
0017ED  3  9D AE 16     	sta bonus,x
0017F0  3  CA           	dex 			; repeat for all 6 digits.
0017F1  3  10 EF        	bpl swpsb0
0017F3  3  60           	rts
0017F4  3               
0017F4  3               ;----------------------------------------------------
0017F4  3               ; Get print address.
0017F4  3               ;----------------------------------------------------
0017F4  3               
0017F4  3               gprad:
0017F4  3  98           	tya
0017F5  3  48           	pha
0017F6  3               
0017F6  3  A5 rr        	lda dispx 		; x coordinate.
0017F8  3  85 rr        	sta scraddr
0017FA  3  A9 00        	lda #0
0017FC  3  85 rr        	sta scraddr+1
0017FE  3  06 rr        	asl scraddr  	; multiply char by 8
001800  3  26 rr        	rol scraddr+1
001802  3  06 rr        	asl scraddr
001804  3  26 rr        	rol scraddr+1
001806  3  06 rr        	asl scraddr
001808  3  26 rr        	rol scraddr+1
00180A  3               
00180A  3  A5 rr        	lda dispy		; y coordinate.
00180C  3  0A           	asl a
00180D  3  0A           	asl a
00180E  3  0A           	asl a			; multiply char by 8
00180F  3  A8           	tay
001810  3               
001810  3  18           	clc
001811  3  A5 rr        	lda scraddr
001813  3  79 00 06     	adc SCADTB_lb,y
001816  3  85 rr        	sta scraddr
001818  3  A5 rr        	lda scraddr+1
00181A  3  79 00 07     	adc SCADTB_hb,y
00181D  3  85 rr        	sta scraddr+1
00181F  3               
00181F  3  68           	pla
001820  3  A8           	tay
001821  3  60           	rts
001822  3               
001822  3               ;--------------------------------------------------------------
001822  3               ; Get property buffer address of char at (dispx, dispy) in hl.
001822  3               ;
001822  3               ; Output:
001822  3               ;  bufaddr = MAP + dispy*32 + dispx
001822  3               ;--------------------------------------------------------------
001822  3               
001822  3               pradd:
001822  3  A5 rr        	lda dispy 		; y coordinate.
001824  3  85 rr        	sta bufaddr
001826  3  A9 00        	lda #0
001828  3  85 rr        	sta bufaddr+1
00182A  3  06 rr        	asl bufaddr  		; multiply char by 32
00182C  3  26 rr        	rol bufaddr+1
00182E  3  06 rr        	asl bufaddr
001830  3  26 rr        	rol bufaddr+1
001832  3  06 rr        	asl bufaddr
001834  3  26 rr        	rol bufaddr+1
001836  3  06 rr        	asl bufaddr
001838  3  26 rr        	rol bufaddr+1
00183A  3  06 rr        	asl bufaddr
00183C  3  26 rr        	rol bufaddr+1
00183E  3  18           	clc			; add address of MAP graphics.
00183F  3  A5 rr        	lda bufaddr
001841  3  65 rr        	adc dispx
001843  3  69 00        	adc #<MAP
001845  3  85 rr        	sta bufaddr
001847  3  A5 rr        	lda bufaddr+1
001849  3  69 03        	adc #>MAP
00184B  3  85 rr        	sta bufaddr+1
00184D  3  60           	rts
00184E  3               
00184E  3               ;----------------------------------------------
00184E  3               ; Print attributes, properties and pixels.
00184E  3               ;
00184E  3               ; Input:
00184E  3               ;  A	= tile number
00184E  3               ;----------------------------------------------
00184E  3               
00184E  3  00           colpatt:	.byte 0
00184F  3               
00184F  3               pattr:
00184F  3  85 rr        	sta z80_b		; store cell in b register for now.
001851  3  AA           	tax
001852  3  BD 6E 2D     	lda bprop,x 		; block properties.
001855  3  85 rr        	sta z80_c
001857  3  C9 08        	cmp #COLECT
001859  3  D0 05        	bne :+
00185B  3  A5 rr        	lda z80_b
00185D  3  8D 4E 18     	sta colpatt
001860  3               :
001860  3  20 22 18     	jsr pradd 		; get property buffer address.
001863  3  A5 rr        	lda z80_c
001865  3  A0 00        	ldy #0
001867  3  91 rr        	sta (bufaddr),y 	; write property.
001869  3  A5 rr        	lda z80_b 		; restore cell.
00186B  3               
00186B  3               ; Print attributes, no properties.
00186B  3               
00186B  3               panp:
00186B  3  85 rr        	sta z80_e		; displacement in e.
00186D  3  A9 00        	lda #0
00186F  3  85 rr        	sta z80_d		; no high byte.
001871  3  06 rr        	asl z80_e  		; multiply char by 8.
001873  3  26 rr        	rol z80_d
001875  3  06 rr        	asl z80_e
001877  3  26 rr        	rol z80_d
001879  3  06 rr        	asl z80_e
00187B  3  26 rr        	rol z80_d
00187D  3  18           	clc
00187E  3  A5 rr        	lda z80_e
001880  3  69 8E        	adc #<chgfx 		; address of graphics.
001882  3  85 rr        	sta tileaddr
001884  3  A5 rr        	lda z80_d
001886  3  69 2C        	adc #>chgfx
001888  3  85 rr        	sta tileaddr+1
00188A  3  20 F4 17     	jsr gprad 		; get screen address.
00188D  3  A2 07        	ldx #7			; number of pixel rows to write.
00188F  3               panp0:
00188F  3  A0 00        	ldy #0
001891  3  B1 rr        	lda (tileaddr),y 	; get image byte.
001893  3  49 00        	eor #TxtInvert		; Invert
001895  3  BC AB 10     	ldy scrtab,x
001898  3  91 rr        	sta (scraddr),y 	; copy to screen.
00189A  3  E6 rr        	inc tileaddr 		; next image byte.
00189C  3  D0 02        	bne :+
00189E  3  E6 rr        	inc tileaddr+1
0018A0  3               :
0018A0  3  CA           	dex	 		; repeat for 8 pixel rows.
0018A1  3  10 EC        	bpl panp0
0018A3  3  E6 rr        	inc dispx 		; move along one.
0018A5  3  E6 rr        	inc charx
0018A7  3  60           	rts
0018A8  3               
0018A8  3               ;----------------------------------------------
0018A8  3               ; Print character pixels, no more.
0018A8  3               ;
0018A8  3               ; Input:
0018A8  3               ;  A	= character to print
0018A8  3               ;----------------------------------------------
0018A8  3               
0018A8  3               pchr:
0018A8  3  20 72 10     	jsr pchar 		; show character in accumulator.
0018AB  3  E6 rr        	inc dispx		; move along one.
0018AD  3  60           	rts
0018AE  3               
0018AE  3               ;----------------------------------------------------
0018AE  3               ; Shifter sprite routine for objects.
0018AE  3               ;----------------------------------------------------
0018AE  3               
0018AE  3               sprit7:
0018AE  3  A5 rr        	lda z80_b
0018B0  3  F0 0A        	beq sprit0
0018B2  3  A8           	tay
0018B3  3               sprit3:
0018B3  3  46 rr        	lsr spr			; shift into position.
0018B5  3  66 rr        	ror spr+1
0018B7  3  66 rr        	ror spr+2
0018B9  3  88           	dey				; one less iteration.
0018BA  3  D0 F7        	bne sprit3
0018BC  3               sprit0:
0018BC  3  60           	rts 			; now apply to screen.
0018BD  3               
0018BD  3               ;-----------------------------------------------------------
0018BD  3               ; Get room address.
0018BD  3               ;-----------------------------------------------------------
0018BD  3               
0018BD  3               groom:
0018BD  3  A6 rr        	ldx scno 		; screen number.
0018BF  3  A0 00        	ldy #0
0018C1  3               groomx:
0018C1  3  A9 20        	lda #<scdat 		; pointer to screens.
0018C3  3  85 rr        	sta z80_l
0018C5  3  A9 3A        	lda #>scdat
0018C7  3  85 rr        	sta z80_h
0018C9  3               groom1:
0018C9  3  E0 00        	cpx #0			; is it the first one?
0018CB  3  F0 15        	beq groom0 		; no more screens to skip.
0018CD  3               
0018CD  3  18           	clc
0018CE  3  A5 rr        	lda z80_l
0018D0  3  79 20 3A     	adc scdat,y 		; low byte of screen size.
0018D3  3  85 rr        	sta z80_l
0018D5  3  C8           	iny			; point to high byte.
0018D6  3  A5 rr        	lda z80_h
0018D8  3  79 20 3A     	adc scdat,y 		; high byte of screen size.
0018DB  3  85 rr        	sta z80_h
0018DD  3  C8           	iny			; next address.
0018DE  3               
0018DE  3  CA           	dex 			; one less iteration.
0018DF  3  4C C9 18     	jmp groom1 		; loop until we reach the end.
0018E2  3               groom0:
0018E2  3  AD 9D 55     	lda numsc 		; add displacement.
0018E5  3  0A           	asl a
0018E6  3  18           	clc			; add double displacement to address.
0018E7  3  65 rr        	adc z80_l
0018E9  3  85 rr        	sta z80_l
0018EB  3  A5 rr        	lda z80_h
0018ED  3  69 00        	adc #0
0018EF  3  85 rr        	sta z80_h
0018F1  3  60           	rts
0018F2  3               
0018F2  3               ;-----------------------------------------------------------
0018F2  3               ; Draw present room.
0018F2  3               ;-----------------------------------------------------------
0018F2  3               
0018F2  3               droom:
0018F2  3  AD BF 10     	lda wintop 		; window top.
0018F5  3  85 rr        	sta dispy		; set cursor y position.
0018F7  3               droom2:
0018F7  3  20 BD 18     	jsr groom 		; get address of current room.
0018FA  3  A9 00        	lda #0	 		; zero in accumulator.
0018FC  3  85 rr        	sta comcnt 		; reset compression counter.
0018FE  3  AD C1 10     	lda winhgt 		; height of window.
001901  3  85 rr        	sta rrow		; set row counter
001903  3               droom0:
001903  3  AD C0 10     	lda winlft 		; window left edge.
001906  3  85 rr        	sta dispx 		; set cursor x position.
001908  3  AD C2 10     	lda winwid 		; width of window.
00190B  3  85 rr        	sta rcol		; set column counter
00190D  3               droom1:
00190D  3  20 1E 19     	jsr flbyt 		; decompress next byte on the fly.
001910  3  20 4F 18     	jsr pattr 		; show attributes and block.
001913  3  C6 rr        	dec rcol		; one less column.
001915  3  D0 F6        	bne droom1 		; repeat for entire line.
001917  3  E6 rr        	inc dispy		; move down one line.
001919  3  C6 rr        	dec rrow 		; one less row.
00191B  3  D0 E6        	bne droom0 		; repeat for all rows.
00191D  3  60           	rts
00191E  3               
00191E  3               ;----------------------------------------------
00191E  3               ; Decompress bytes on-the-fly.
00191E  3               ;----------------------------------------------
00191E  3               
00191E  3               flbyt:
00191E  3  A5 rr        	lda comcnt 		; compression counter.
001920  3  D0 21        	bne flbyt1		; any more to decompress?  yes.
001922  3               
001922  3  A0 00        	ldy #0
001924  3  B1 rr        	lda (z80_hl),y 		; fetch next byte.
001926  3  E6 rr        	inc z80_l 		; point to next cell.
001928  3  D0 02        	bne :+
00192A  3  E6 rr        	inc z80_h
00192C  3               :
00192C  3  C9 FF        	cmp #255 		; is this byte a control code?
00192E  3  F0 01        	beq :+
001930  3  60           	rts 			; no, this byte is uncompressed.
001931  3               :
001931  3  B1 rr        	lda (z80_hl),y 		; fetch byte type.
001933  3  85 rr        	sta combyt 		; set up the type.
001935  3  E6 rr        	inc z80_l 		; point to quantity.
001937  3  D0 02        	bne :+
001939  3  E6 rr        	inc z80_h
00193B  3               :
00193B  3  B1 rr        	lda (z80_hl),y 		; get quantity.
00193D  3  E6 rr        	inc z80_l 		; point to next byte.
00193F  3  D0 02        	bne :+
001941  3  E6 rr        	inc z80_h
001943  3               :
001943  3               flbyt1:
001943  3  85 rr        	sta comcnt 		; store new quantity.
001945  3  C6 rr        	dec comcnt		; one less.
001947  3  A5 rr        	lda combyt 		; byte to expand.
001949  3  60           	rts
00194A  3               
00194A  3               ;------------------------------------------
00194A  3               ; Ladder down check.
00194A  3               ;
00194A  3               ; Input:
00194A  3               ;  IX = sprite pointer
00194A  3               ;------------------------------------------
00194A  3               
00194A  3               laddd:
00194A  3  A0 09        	ldy #9
00194C  3  B1 rr        	lda (z80_ix),y		; x coordinate.
00194E  3  85 rr        	sta dispx
001950  3               
001950  3  A0 08        	ldy #8
001952  3  B1 rr        	lda (z80_ix),y		; y coordinate.
001954  3  29 FE        	and #254		; make it even.
001956  3  91 rr        	sta (z80_ix),y 		; reset it.
001958  3               numsp5:
001958  3  18           	clc 			; look down 16 pixels.
001959  3  69 10        	adc #16
00195B  3  85 rr        	sta dispy		; coords in dispx,dispy.
00195D  3  4C 73 19     	jmp laddv
001960  3               
001960  3               ;------------------------------------------
001960  3               ; Ladder up check.
001960  3               ;
001960  3               ; Input:
001960  3               ;  IX = sprite pointer
001960  3               ;
001960  3               ; Output:
001960  3               ;  A  = 0 is ok, A <>0 is not ok
001960  3               ;------------------------------------------
001960  3               
001960  3               laddu:
001960  3  A0 09        	ldy #9
001962  3  B1 rr        	lda (z80_ix),y		; x coordinate.
001964  3  85 rr        	sta dispx
001966  3               
001966  3  A0 08        	ldy #8
001968  3  B1 rr        	lda (z80_ix),y		; y coordinate.
00196A  3  29 FE        	and #254 		; make it even.
00196C  3  91 rr        	sta (z80_ix),y		; reset it.
00196E  3               numsp6:
00196E  3  18           	clc 			; look 2 pixels above feet.
00196F  3  69 0E        	adc #14
001971  3  85 rr        	sta dispy		; coords in dispx,dispy.
001973  3               laddv:
001973  3  20 C1 1B     	jsr tstbl 		; get map address.
001976  3  20 80 1A     	jsr ldchk 		; standard ladder check.
001979  3  F0 01        	beq :+
00197B  3  60           	rts 			; no way through.
00197C  3               :
00197C  3  E6 rr        	inc bufaddr 		; look right one cell.
00197E  3  D0 02        	bne :+
001980  3  E6 rr        	inc bufaddr+1
001982  3               :
001982  3  20 80 1A     	jsr ldchk 		; do the check.
001985  3  F0 01        	beq :+
001987  3  60           	rts 			; impassable.
001988  3               :
001988  3  A5 rr        	lda dispx 		; y coordinate.
00198A  3  29 07        	and #7 			; position straddling block cells.
00198C  3  D0 01        	bne :+
00198E  3  60           	rts 			; no more checks needed.
00198F  3               :
00198F  3  E6 rr        	inc bufaddr 		; look to third cell.
001991  3  D0 02        	bne :+
001993  3  E6 rr        	inc bufaddr+1
001995  3               :
001995  3  20 80 1A     	jsr ldchk 		; do the check.
001998  3  60           	rts  			; return with zero flag set accordingly.
001999  3               
001999  3               ;---------------------------------------------------------
001999  3               ; Can go up check.
001999  3               ;
001999  3               ; Input:
001999  3               ;  IX = sprite pointer
001999  3               ;
001999  3               ; Output:
001999  3               ;  A  = 0 is ok, A <>0 is not ok
001999  3               ;---------------------------------------------------------
001999  3               
001999  3               cangu:
001999  3  A0 09        	ldy #9
00199B  3  B1 rr        	lda (z80_ix),y		; x coordinate.
00199D  3  85 rr        	sta dispx
00199F  3  A0 08        	ldy #8
0019A1  3  B1 rr        	lda (z80_ix),y 		; y coordinate.
0019A3  3  38           	sec
0019A4  3  E9 02        	sbc #2
0019A6  3  85 rr        	sta dispy		; coords in dispx,dispy.
0019A8  3  20 C1 1B     	jsr tstbl 		; get map address.
0019AB  3  20 4B 1A     	jsr lrchk 		; standard left/right check.
0019AE  3  F0 01        	beq :+
0019B0  3  60           	rts			; no way through.
0019B1  3               :
0019B1  3  E6 rr        	inc bufaddr		; look right one cell.
0019B3  3  D0 02        	bne :+
0019B5  3  E6 rr        	inc bufaddr+1
0019B7  3               :
0019B7  3  20 4B 1A     	jsr lrchk 		; do the check.
0019BA  3  F0 01        	beq :+
0019BC  3  60           	rts			; impassable.
0019BD  3               :
0019BD  3  A5 rr        	lda dispx		; x coordinate.
0019BF  3  29 07        	and #7			; position straddling block cells.
0019C1  3  D0 01        	bne :+
0019C3  3  60           	rts			; no more checks needed.
0019C4  3               :
0019C4  3  E6 rr        	inc bufaddr		; look to third cell.
0019C6  3  D0 02        	bne :+
0019C8  3  E6 rr        	inc bufaddr+1
0019CA  3               :
0019CA  3  20 4B 1A     	jsr lrchk		; do the check.
0019CD  3  60           	rts 			; return with zero flag set accordingly.
0019CE  3               
0019CE  3               ;---------------------------------------------------------
0019CE  3               ; Can go down check.
0019CE  3               ;
0019CE  3               ; Input:
0019CE  3               ;  IX = sprite pointer
0019CE  3               ;
0019CE  3               ; Output:
0019CE  3               ;  A  = 0 is ok, A <>0 is not ok
0019CE  3               ;---------------------------------------------------------
0019CE  3               
0019CE  3               cangd:
0019CE  3  A0 09        	ldy #9
0019D0  3  B1 rr        	lda (z80_ix),y 		; x coordinate.
0019D2  3  85 rr        	sta dispx
0019D4  3  A0 08        	ldy #8
0019D6  3  B1 rr        	lda (z80_ix),y		; y coordinate.
0019D8  3               numsp3:
0019D8  3  18           	clc
0019D9  3  69 10        	adc #16 		; look down 16 pixels.
0019DB  3  85 rr        	sta dispy		; coords in dispx,dispy.
0019DD  3  20 C1 1B     	jsr tstbl 		; get map address.
0019E0  3  20 60 1A     	jsr plchk 		; block, platform check.
0019E3  3  F0 01        	beq :+
0019E5  3  60           	rts			; no way through.
0019E6  3               :
0019E6  3  E6 rr        	inc bufaddr		; look right one cell.
0019E8  3  D0 02        	bne :+
0019EA  3  E6 rr        	inc bufaddr+1
0019EC  3               :
0019EC  3  20 60 1A     	jsr plchk		; block, platform check.
0019EF  3  F0 01        	beq :+
0019F1  3  60           	rts			; impassable.
0019F2  3               :
0019F2  3  A5 rr        	lda dispx		; x coordinate.
0019F4  3  29 07        	and #7			; position straddling block cells.
0019F6  3  D0 01        	bne :+
0019F8  3  60           	rts			; no more checks needed.
0019F9  3               :
0019F9  3  E6 rr        	inc bufaddr		; look to third cell.
0019FB  3  D0 02        	bne :+
0019FD  3  E6 rr        	inc bufaddr+1
0019FF  3               :
0019FF  3  20 60 1A     	jsr plchk		; block, platform check.
001A02  3  60           	rts			; return with zero flag set accordingly.
001A03  3               
001A03  3               ;---------------------------------------------------------
001A03  3               ; Can go left check.
001A03  3               ;
001A03  3               ; Input:
001A03  3               ;  IX = sprite pointer
001A03  3               ;
001A03  3               ; Output:
001A03  3               ;  A  = 0 is ok, A <>0 is not ok
001A03  3               ;---------------------------------------------------------
001A03  3               
001A03  3               cangl:
001A03  3  A0 08        	ldy #8
001A05  3  B1 rr        	lda (z80_ix),y 		; y coordinate.
001A07  3  85 rr        	sta dispy
001A09  3  A0 09        	ldy #9
001A0B  3  B1 rr        	lda (z80_ix),y 		; x coordinate.
001A0D  3  38           	sec
001A0E  3  E9 02        	sbc #2			; look left 2 pixels.
001A10  3  85 rr        	sta dispx		; coords in dispx,dispy.
001A12  3  4C 24 1A     	jmp cangh		; test if we can go there.
001A15  3               
001A15  3               ;---------------------------------------------------------
001A15  3               ; Can go right check.
001A15  3               ;
001A15  3               ; Input:
001A15  3               ;  IX = sprite pointer
001A15  3               ;
001A15  3               ; Output:
001A15  3               ;  A  = 0 is ok, A <>0 is not ok
001A15  3               ;---------------------------------------------------------
001A15  3               
001A15  3               cangr:
001A15  3  A0 08        	ldy #8
001A17  3  B1 rr        	lda (z80_ix),y		; y coordinate.
001A19  3  85 rr        	sta dispy
001A1B  3  A0 09        	ldy #9
001A1D  3  B1 rr        	lda (z80_ix),y		; x coordinate.
001A1F  3  18           	clc
001A20  3  69 10        	adc #16			; look right 16 pixels.
001A22  3  85 rr        	sta dispx		; coords in dispx,dispy.
001A24  3               cangh:
001A24  3               cangh2:
001A24  3  A9 03        	lda #3			; default rows to write.
001A26  3  85 rr        	sta z80_b
001A28  3  A5 rr        	lda dispy		; y position.
001A2A  3  29 07        	and #7			; does x straddle cells?
001A2C  3  D0 02        	bne cangh0		; yes, loop counter is good.
001A2E  3  C6 rr        	dec z80_b		; one less row to write.
001A30  3               cangh0:
001A30  3  20 C1 1B     	jsr tstbl		; get map address.
001A33  3               cangh1:
001A33  3  20 4B 1A     	jsr lrchk		; standard left/right check.
001A36  3  F0 01        	beq :+
001A38  3  60           	rts			; no way through.
001A39  3               :
001A39  3  48           	pha
001A3A  3  18           	clc
001A3B  3  A5 rr        	lda bufaddr
001A3D  3  69 20        	adc #32			; look down.
001A3F  3  85 rr        	sta bufaddr
001A41  3  90 02        	bcc :+
001A43  3  E6 rr        	inc bufaddr+1
001A45  3               :
001A45  3  68           	pla
001A46  3               
001A46  3  C6 rr        	dec z80_b
001A48  3  D0 E9        	bne cangh1
001A4A  3  60           	rts
001A4B  3               
001A4B  3               ;-------------------------------------
001A4B  3               ; Check left/right movement is okay.
001A4B  3               ;
001A4B  3               ; Input:
001A4B  3               ;  bufaddr = MAP + x/8 + y/8*32
001A4B  3               ;
001A4B  3               ; Output:
001A4B  3               ;  A  = 0 is ok, A <>0 is not ok
001A4B  3               ;-------------------------------------
001A4B  3               
001A4B  3               lrchk:
001A4B  3  A0 00        	ldy #0
001A4D  3  B1 rr        	lda (bufaddr),y		; fetch map cell.
001A4F  3  C9 02        	cmp #WALL 		; is it passable?
001A51  3  F0 0A        	beq lrchkx		; no.
001A53  3               
001A53  3  C9 04        	cmp #FODDER		; fodder has to be dug.
001A55  3  F0 06        	beq lrchkx		; not passable.
001A57  3  A9 00        	lda #0
001A59  3  60           	rts
001A5A  3               
001A5A  3               ;--------------------------------------------------------------
001A5A  3               ; Called by mmenu
001A5A  3               ;--------------------------------------------------------------
001A5A  3               
001A5A  3               always:
001A5A  3  A9 FF        	lda #255		; report it as okay.
001A5C  3  60           	rts
001A5D  3               
001A5D  3               lrchkx:
001A5D  3  A9 01        	lda #1 			; reset all bits.
001A5F  3  60           	rts
001A60  3               
001A60  3               
001A60  3               ;--------------------------------------------------------------
001A60  3               ; Check platform or solid item is not in way.
001A60  3               ;
001A60  3               ; Input:
001A60  3               ;  bufaddr = MAP + x/8 + y/8*32
001A60  3               ;
001A60  3               ; Output:
001A60  3               ;  A  = 0 is ok, A <>0 is not ok
001A60  3               ;--------------------------------------------------------------
001A60  3               
001A60  3               plchk:
001A60  3  A0 00        	ldy #0
001A62  3  B1 rr        	lda (bufaddr),y 	; fetch map cell.
001A64  3  C9 02        	cmp #WALL 		; is it passable?
001A66  3  F0 F5        	beq lrchkx		; no.
001A68  3               
001A68  3  C9 04        	cmp #FODDER		; fodder has to be dug.
001A6A  3  F0 F1        	beq lrchkx		; not passable.
001A6C  3               
001A6C  3  C9 01        	cmp #PLATFM		; platform is solid.
001A6E  3  F0 07        	beq plchkx		; not passable.
001A70  3               
001A70  3  C9 03        	cmp #LADDER		; is it a ladder?
001A72  3  F0 E9        	beq lrchkx		; on ladder, deny movement.
001A74  3               plchk0:
001A74  3  A9 00        	lda #0			; report as ok
001A76  3  60           	rts
001A77  3               plchkx:
001A77  3  A5 rr        	lda dispy		; x coordinate.
001A79  3  29 07        	and #7			; position straddling blocks.
001A7B  3  F0 E0        	beq lrchkx		; on platform, deny movement.
001A7D  3  4C 74 1A     	jmp plchk0
001A80  3               
001A80  3               ;--------------------------------------------------------------
001A80  3               ; Check ladder is available.
001A80  3               ;
001A80  3               ; Input:
001A80  3               ;  bufaddr = MAP + x/8 + y/8*32
001A80  3               ;
001A80  3               ; Output:
001A80  3               ;  A  = 0 is ok, A <>0 is not ok
001A80  3               ;--------------------------------------------------------------
001A80  3               
001A80  3               ldchk:
001A80  3  A0 00        	ldy #0
001A82  3  B1 rr        	lda (bufaddr),y 	; fetch cell.
001A84  3  C9 03        	cmp #LADDER 		; is it a ladder?
001A86  3  F0 03        	beq :+
001A88  3  A9 01        	lda #1
001A8A  3  60           	rts  			; return with zero flag set accordingly.
001A8B  3               :
001A8B  3  A9 00        	lda #0
001A8D  3  60           	rts
001A8E  3               
001A8E  3               ;--------------------------------------------------------------
001A8E  3               ; Get collectables.
001A8E  3               ;--------------------------------------------------------------
001A8E  3               
001A8E  3               getcol:
001A8E  3  A9 08            lda #COLECT             ; collectable blocks.
001A90  3  85 rr            sta z80_b
001A92  3  20 06 1B         jsr tded                ; test for collectable blocks.
001A95  3  C5 rr            cmp z80_b               ; did we find one?
001A97  3  F0 01            beq :+
001A99  3  60               rts                     ; none were found, job done.
001A9A  3               :
001A9A  3  20 A3 1A         jsr gtblk               ; get block.
001A9D  3               
001A9D  3  20 BF 2A         jsr evnt20              ; collected block event.
001AA0  3  4C 8E 1A         jmp getcol              ; repeat until none left.
001AA3  3               
001AA3  3               ; Get collectable block.
001AA3  3               
001AA3  3               gtblk:
001AA3  3  A0 00        	ldy #0
001AA5  3  B1 rr        	lda (bufaddr),y
001AA7  3  85 rr        	sta z80_a
001AA9  3  A9 00                lda #0
001AAB  3  91 rr                sta (bufaddr),y		; make it empty now.
001AAD  3               
001AAD  3  A5 rr        	lda bufaddr		; set dispx
001AAF  3  29 1F        	and #31
001AB1  3  85 rr        	sta dispx
001AB3  3               
001AB3  3  A5 rr        	lda bufaddr+1		; Set dispy
001AB5  3  38           	sec
001AB6  3  E9 03        	sbc #>MAP
001AB8  3  85 rr        	sta bufaddr+1
001ABA  3  06 rr        	asl bufaddr
001ABC  3  26 rr        	rol bufaddr+1
001ABE  3  06 rr        	asl bufaddr
001AC0  3  26 rr        	rol bufaddr+1
001AC2  3  06 rr        	asl bufaddr
001AC4  3  26 rr        	rol bufaddr+1
001AC6  3  A5 rr        	lda bufaddr+1
001AC8  3  85 rr        	sta dispy
001ACA  3               
001ACA  3  AD 4E 18     	lda colpatt		; get blocknr
001ACD  3  85 rr        	sta z80_e		; displacement in e.
001ACF  3  A9 00        	lda #0
001AD1  3  85 rr        	sta z80_d		; no high byte.
001AD3  3  06 rr        	asl z80_e  		; multiply char by 8.
001AD5  3  26 rr        	rol z80_d
001AD7  3  06 rr        	asl z80_e
001AD9  3  26 rr        	rol z80_d
001ADB  3  06 rr        	asl z80_e
001ADD  3  26 rr        	rol z80_d
001ADF  3  18           	clc
001AE0  3  A5 rr        	lda z80_e
001AE2  3  69 8E        	adc #<chgfx 		; address of graphics.
001AE4  3  85 rr        	sta tileaddr
001AE6  3  A5 rr        	lda z80_d
001AE8  3  69 2C        	adc #>chgfx
001AEA  3  85 rr        	sta tileaddr+1
001AEC  3  20 F4 17     	jsr gprad 		; get screen address.
001AEF  3  A2 07        	ldx #7			; number of pixel rows to write.
001AF1  3               gtblk0:
001AF1  3  A0 00        	ldy #0
001AF3  3  B1 rr        	lda (tileaddr),y 	; get image byte.
001AF5  3  BC AB 10     	ldy scrtab,x
001AF8  3  51 rr        	eor (scraddr),y 	; XOR tile on screen
001AFA  3  91 rr        	sta (scraddr),y 	; copy to screen.
001AFC  3  E6 rr        	inc tileaddr 		; next image byte.
001AFE  3  D0 02        	bne :+
001B00  3  E6 rr        	inc tileaddr+1
001B02  3               :
001B02  3  CA           	dex	 		; repeat for 8 pixel rows.
001B03  3  10 EC        	bpl gtblk0
001B05  3  60           	rts
001B06  3               
001B06  3               ;--------------------------------------------------------------
001B06  3               ; Touched deadly block check.
001B06  3               ; returns with DEADLY (must be non-zero) in accumulator if true.
001B06  3               ;
001B06  3               ; Input:
001B06  3               ;  IX = sprite address
001B06  3               ;
001B06  3               ; Output:
001B06  3               ;  A  = 0 is ok, A=5 is not ok
001B06  3               ;--------------------------------------------------------------
001B06  3               
001B06  3               tded:
001B06  3  A0 08        	ldy #8
001B08  3  B1 rr        	lda (z80_ix),y 		; y coordinate.
001B0A  3  85 rr        	sta dispy
001B0C  3  C8           	iny
001B0D  3  B1 rr        	lda (z80_ix),y 		; x coordinate.
001B0F  3  85 rr        	sta dispx		; coords in dispx,dispy.
001B11  3  20 C1 1B     	jsr tstbl		; get map address.
001B14  3  48           	pha
001B15  3  A9 1F        	lda #31			; default distance to next line down.
001B17  3  85 rr        	sta z80_e
001B19  3  68           	pla
001B1A  3  C5 rr        	cmp z80_b		; is this the required block?
001B1C  3  D0 01        	bne :+
001B1E  3  60           	rts			; yes.
001B1F  3               :
001B1F  3  E6 rr        	inc bufaddr 		; next cell.
001B21  3  D0 02        	bne :+
001B23  3  E6 rr        	inc bufaddr+1
001B25  3               :
001B25  3  A0 00        	ldy #0
001B27  3  B1 rr        	lda (bufaddr),y		; fetch type.
001B29  3  C5 rr        	cmp z80_b 		; is this deadly/custom?
001B2B  3  D0 01        	bne :+
001B2D  3  60           	rts			; yes.
001B2E  3               :
001B2E  3  A5 rr        	lda dispx		; horizontal position.
001B30  3  85 rr        	sta z80_c 		; store column in c register.
001B32  3  29 07        	and #7			; is it straddling cells?
001B34  3  D0 03        	bne :+
001B36  3  4C 4A 1B     	jmp tded0		; no.
001B39  3               :
001B39  3  E6 rr        	inc bufaddr 		; last cell.
001B3B  3  D0 02        	bne :+
001B3D  3  E6 rr        	inc bufaddr+1
001B3F  3               :
001B3F  3  A0 00        	ldy #0
001B41  3  B1 rr        	lda (bufaddr),y 	; fetch type.
001B43  3  C5 rr        	cmp z80_b		; is this the block?
001B45  3  D0 01        	bne :+
001B47  3  60           	rts			; yes.
001B48  3               :
001B48  3  C6 rr        	dec z80_e		; one less cell to next row down.
001B4A  3               tded0:
001B4A  3  18           	clc 			; point to next row.
001B4B  3  A5 rr        	lda bufaddr
001B4D  3  65 rr        	adc z80_e
001B4F  3  85 rr        	sta bufaddr
001B51  3  90 02        	bcc :+
001B53  3  E6 rr        	inc bufaddr+1
001B55  3               :
001B55  3  A0 00        	ldy #0
001B57  3  B1 rr        	lda (bufaddr),y		; fetch left cell block.
001B59  3  C5 rr        	cmp z80_b		; is this fatal?
001B5B  3  D0 01        	bne :+
001B5D  3  60           	rts			; yes.
001B5E  3               :
001B5E  3  E6 rr        	inc bufaddr 		; next cell.
001B60  3  D0 02        	bne :+
001B62  3  E6 rr        	inc bufaddr+1
001B64  3               :
001B64  3  A0 00        	ldy #0
001B66  3  B1 rr        	lda (bufaddr),y 	; fetch type.
001B68  3  C5 rr        	cmp z80_b		; is this fatal?
001B6A  3  D0 01        	bne :+
001B6C  3  60           	rts			; yes.
001B6D  3               :
001B6D  3  A5 rr        	lda z80_c		; horizontal position.
001B6F  3  29 07        	and #7			; is it straddling cells?
001B71  3  D0 03        	bne :+
001B73  3  4C 85 1B     	jmp tded1 		; no.
001B76  3               :
001B76  3  E6 rr        	inc bufaddr		; last cell.
001B78  3  D0 02        	bne :+
001B7A  3  E6 rr        	inc bufaddr+1
001B7C  3               :
001B7C  3  A0 00        	ldy #0
001B7E  3  B1 rr        	lda (bufaddr),y		; fetch type.
001B80  3  C5 rr        	cmp z80_b		; is this fatal?
001B82  3  D0 01        	bne :+
001B84  3  60           	rts			; yes.
001B85  3               :
001B85  3               tded1:
001B85  3  A5 rr        	lda dispy		; vertical position.
001B87  3  29 07        	and #7 			; is it straddling cells?
001B89  3  D0 01        	bne :+
001B8B  3  60           	rts			; no, job done.
001B8C  3               :
001B8C  3  18           	clc			; point to next row.
001B8D  3  A5 rr        	lda bufaddr
001B8F  3  65 rr        	adc z80_e
001B91  3  85 rr        	sta bufaddr
001B93  3  90 02        	bcc :+
001B95  3  E6 rr        	inc bufaddr+1
001B97  3               :
001B97  3  A0 00        	ldy #0
001B99  3  B1 rr        	lda (bufaddr),y 	; fetch left cell block.
001B9B  3  C5 rr        	cmp z80_b		; is this fatal?
001B9D  3  D0 01        	bne :+
001B9F  3  60           	rts			; yes.
001BA0  3               :
001BA0  3  E6 rr        	inc bufaddr		; next cell.
001BA2  3  D0 02        	bne :+
001BA4  3  E6 rr        	inc bufaddr+1
001BA6  3               :
001BA6  3  A0 00        	ldy #0
001BA8  3  B1 rr        	lda (bufaddr),y 	; fetch type.
001BAA  3  C5 rr        	cmp z80_b		; is this fatal?
001BAC  3  D0 01        	bne :+
001BAE  3  60           	rts			; yes.
001BAF  3               :
001BAF  3  A5 rr        	lda z80_c		; horizontal position.
001BB1  3  29 07        	and #7			; is it straddling cells?
001BB3  3  D0 01        	bne :+
001BB5  3  60           	rts			; no.
001BB6  3               :
001BB6  3  E6 rr        	inc bufaddr		; last cell.
001BB8  3  D0 02        	bne :+
001BBA  3  E6 rr        	inc bufaddr+1
001BBC  3               :
001BBC  3  A0 00        	ldy #0
001BBE  3  B1 rr        	lda (bufaddr),y		; fetch final type.
001BC0  3  60           	rts 			; return with final type in accumulator.
001BC1  3               
001BC1  3               ;---------------------------------------------------
001BC1  3               ; Fetch block type at (dispx, dispy).
001BC1  3               ;
001BC1  3               ; Output:
001BC1  3               ;  A = block type
001BC1  3               ;---------------------------------------------------
001BC1  3               
001BC1  3               tstbl:
001BC1  3  A5 rr        	lda dispy 		; fetch y coord.
001BC3  3  4A           	lsr a			; bufaddr = y/8
001BC4  3  4A           	lsr a
001BC5  3  4A           	lsr a
001BC6  3  85 rr        	sta bufaddr
001BC8  3  A9 00        	lda #0
001BCA  3  85 rr        	sta bufaddr+1
001BCC  3               
001BCC  3  06 rr        	asl bufaddr  		; bufaddr = y/8 * 32
001BCE  3  26 rr        	rol bufaddr+1
001BD0  3  06 rr        	asl bufaddr
001BD2  3  26 rr        	rol bufaddr+1
001BD4  3  06 rr        	asl bufaddr
001BD6  3  26 rr        	rol bufaddr+1
001BD8  3  06 rr        	asl bufaddr
001BDA  3  26 rr        	rol bufaddr+1
001BDC  3  06 rr        	asl bufaddr
001BDE  3  26 rr        	rol bufaddr+1
001BE0  3               
001BE0  3  A5 rr        	lda dispx		; x/8
001BE2  3  4A           	lsr a
001BE3  3  4A           	lsr a
001BE4  3  4A           	lsr a
001BE5  3               
001BE5  3  18           	clc			; bufaddr = MAP + x/8 + y/8*32
001BE6  3  65 rr        	adc bufaddr
001BE8  3  69 00        	adc #<MAP
001BEA  3  85 rr        	sta bufaddr
001BEC  3  A5 rr        	lda bufaddr+1
001BEE  3  69 03        	adc #>MAP
001BF0  3  85 rr        	sta bufaddr+1
001BF2  3               
001BF2  3  A0 00        	ldy #0
001BF4  3  B1 rr        	lda (bufaddr),y 	; fetch byte there.
001BF6  3  60           	rts
001BF7  3               
001BF7  3               ;-------------------------------------------------------------------
001BF7  3               ; Jump - if we can.
001BF7  3               ; Requires initial speed to be set up in accumulator prior to call.
001BF7  3               ;
001BF7  3               ; Input:
001BF7  3               ;  IX = sprite address
001BF7  3               ;-------------------------------------------------------------------
001BF7  3               
001BF7  3               jump:
001BF7  3  A0 0D        	ldy #var_jumpLo
001BF9  3  B1 rr        	lda (z80_ix),y		; jump table low.
001BFB  3  A0 0E        	ldy #var_jumpHi
001BFD  3  11 rr        	ora (z80_ix),y		; jump table high.
001BFF  3  F0 01        	beq :+
001C01  3  60           	rts			; already in the air.
001C02  3               :
001C02  3  A9 1C        	lda #>jtab
001C04  3  A0 0E        	ldy #var_jumpHi
001C06  3  91 rr        	sta (z80_ix),y		; set jump high.
001C08  3  A9 0F        	lda #<jtab		; jump table start.
001C0A  3  A0 0D        	ldy #var_jumpLo
001C0C  3  91 rr        	sta (z80_ix),y		; set jump low.
001C0E  3  60           	rts
001C0F  3               
001C0F  3               ; Jump table.
001C0F  3               
001C0F  3               jtab:
001C0F  3  F8 FA FC     	.byte 248,250,252
001C12  3  FE FE FF     	.byte 254,254,255
001C15  3  FF FF 00 00  	.byte 255,255,0,0
001C19  3  00 01 01 01  	.byte 0,1,1,1,2,2
001C1D  3  02 02        
001C1F  3  04 06 08 08  	.byte 4,6,8,8,8,99
001C23  3  08 63        
001C25  3               
001C25  3               ;------------------------------------------------
001C25  3               ; Random numbers code.
001C25  3               ; Pseudo-random number generator, 8-bit.
001C25  3               ;
001C25  3               ; Output:
001C25  3               ;  RND = random number
001C25  3               ;------------------------------------------------
001C25  3               
001C25  3               random:
001C25  3  A5 rr        	lda seed		; get last random number.
001C27  3  0A           	asl a
001C28  3  0A           	asl a
001C29  3  18           	clc
001C2A  3  65 rr        	adc seed
001C2C  3  18           	clc
001C2D  3  69 45        	adc #$45
001C2F  3  85 rr        	sta seed		; store new seed.
001C31  3  85 rr        	sta varrnd		; return number in variable.
001C33  3  60           	rts
001C34  3               
001C34  3               ;-------------------------------------------------------
001C34  3               ; Joystick and keyboard reading routines.
001C34  3               ;
001C34  3               ; contrl = 0, Keyboard
001C34  3               ;          1, JoyKeyb
001C34  3               ;          2, JoyMMC
001C34  3               ;-------------------------------------------------------
001C34  3               
001C34  3               joykey:
001C34  3  A5 rr        	lda contrl 		; control flag.
001C36  3  C9 01        	cmp #1
001C38  3  D0 03        	bne :+
001C3A  3  4C 58 1C     	jmp joyjoy 		; read keyboard joystick
001C3D  3               :
001C3D  3  C9 02        	cmp #2
001C3F  3  D0 03        	bne :+
001C41  3  4C A4 0E     	jmp joysin 		; read MMC joystick.
001C44  3               :
001C44  3               ; Keyboard controls.
001C44  3               
001C44  3  A9 00        	lda #0		 	; zero reading.
001C46  3  85 rr        	sta z80_e
001C48  3               
001C48  3  A0 06        	ldy #6	 		; address of last key.
001C4A  3               joyke0:
001C4A  3  B9 53 61     	lda keys,y 		; get key from table.
001C4D  3  20 7A 0E     	jsr ktest		; being pressed?
001C50  3  26 rr        	rol z80_e 		; rotate into reading.
001C52  3               
001C52  3  88           	dey		 	; next key.
001C53  3  10 F5        	bpl joyke0 		; repeat for all keys.
001C55  3  4C 69 1C     	jmp joyjo1 		; store the value.
001C58  3               
001C58  3               ; Keyboard joystick controls.
001C58  3               
001C58  3               joyjoy:
001C58  3  A9 00        	lda #0		 	; zero reading.
001C5A  3  85 rr        	sta z80_e
001C5C  3               
001C5C  3  A0 06        	ldy #6	 		; address of last key.
001C5E  3               joyjo3:
001C5E  3  B9 5C 0E     	lda jkeys,y 		; get key from table.
001C61  3  20 7A 0E     	jsr ktest		; being pressed?
001C64  3  26 rr        	rol z80_e 		; rotate into reading.
001C66  3               
001C66  3  88           	dey		 	; next key.
001C67  3  10 F5        	bpl joyjo3 		; repeat for all keys.
001C69  3               joyjo1:
001C69  3  A5 rr        	lda z80_e 		; copy e register to accumulator.
001C6B  3               joyjo2:
001C6B  3  85 rr        	sta joyval		; remember value.
001C6D  3  60           	rts
001C6E  3               
001C6E  3               ;---------------------------------------------------------------
001C6E  3               ; Display message.
001C6E  3               ;
001C6E  3               ; Input:
001C6E  3               ;  A = message number
001C6E  3               ;---------------------------------------------------------------
001C6E  3               
001C6E  3               dmsg:
001C6E  3  AA           	tax
001C6F  3  A9 C1        	lda #<msgdat		; pointer to messages.
001C71  3  85 rr        	sta z80_l
001C73  3  A9 2A        	lda #>msgdat
001C75  3  85 rr        	sta z80_h
001C77  3  20 8D 1D     	jsr getwrd		; get message number.
001C7A  3               dmsg3:
001C7A  3  20 7A 1D     	jsr preprt		; pre-printing stuff.
001C7D  3  20 B6 16     	jsr checkx		; make sure we"re in a printable range.
001C80  3  A5 rr        	lda prtmod		; print mode.
001C82  3  D0 47        	bne bmsg1		; no, double-height text.
001C84  3               dmsg0:
001C84  3  A5 rr        	lda z80_h		; store string pointer.
001C86  3  48           	pha
001C87  3  A5 rr        	lda z80_l
001C89  3  48           	pha
001C8A  3               
001C8A  3  A0 00        	ldy #0
001C8C  3  B1 rr        	lda (z80_hl),y		; fetch byte to display.
001C8E  3  29 7F        	and #127		; remove any end marker.
001C90  3  C9 0D        	cmp #ASCII_NEWLINE
001C92  3  F0 24        	beq dmsg1
001C94  3  20 72 10     	jsr pchar		; display character.
001C97  3  20 65 1D     	jsr nexpos 		; display position.
001C9A  3  D0 03        	bne dmsg2		; not on a new line.
001C9C  3  20 6C 1D     	jsr nexlin		; next line down.
001C9F  3               dmsg2:
001C9F  3  68           	pla			; retrieve string pointer
001CA0  3  85 rr        	sta z80_l
001CA2  3  68           	pla
001CA3  3  85 rr        	sta z80_h
001CA5  3               
001CA5  3  A0 00        	ldy #0
001CA7  3  B1 rr        	lda (z80_hl),y		; fetch last character.
001CA9  3  0A           	asl a  			; was it the end?
001CAA  3  90 03        	bcc :+
001CAC  3  4C FB 16     	jmp dscor2		; yes, job done.
001CAF  3               :
001CAF  3  E6 rr        	inc z80_l		; next character to display.
001CB1  3  D0 02        	bne :+
001CB3  3  E6 rr        	inc z80_h
001CB5  3               :
001CB5  3  4C 84 1C     	jmp dmsg0
001CB8  3               dmsg1:
001CB8  3  E6 rr        	inc dispy
001CBA  3  A5 rr        	lda dispy
001CBC  3  C9 18        	cmp #24
001CBE  3  90 04        	bcc dmsg4
001CC0  3  A9 00        	lda #0
001CC2  3  85 rr        	sta dispy
001CC4  3               dmsg4:
001CC4  3  A9 00        	lda #0
001CC6  3  85 rr        	sta dispx
001CC8  3  4C 9F 1C     	jmp dmsg2
001CCB  3               
001CCB  3               ;----------------------------------------------------------
001CCB  3               ; Display message in big text.
001CCB  3               ;
001CCB  3               ; Input:
001CCB  3               ;  HL = string pointer
001CCB  3               ;----------------------------------------------------------
001CCB  3               
001CCB  3               bmsg1:
001CCB  3  A0 00        	ldy #0
001CCD  3  B1 rr        	lda (z80_hl),y 		; get character to display.
001CCF  3  29 7F        	and #127		; only want 7 bits.
001CD1  3  C9 0D        	cmp #ASCII_NEWLINE
001CD3  3  F0 13        	beq bmsg2
001CD5  3  20 FD 1C     	jsr bchar 		; display big char.
001CD8  3               bmsg3:
001CD8  3  A0 00        	ldy #0
001CDA  3  B1 rr        	lda (z80_hl),y 		; look at last character.
001CDC  3  48           	pha
001CDD  3  E6 rr        	inc z80_l 		; next character in list.
001CDF  3  D0 02        	bne :+
001CE1  3  E6 rr        	inc z80_h
001CE3  3               :
001CE3  3  68           	pla
001CE4  3  0A           	asl a  			; was terminator flag set?
001CE5  3  90 E4        	bcc bmsg1		; no, keep going.
001CE7  3               :
001CE7  3  60           	rts
001CE8  3               bmsg2:
001CE8  3  A9 00        	lda #0
001CEA  3  85 rr        	sta dispx
001CEC  3  E6 rr        	inc dispy
001CEE  3  E6 rr        	inc dispy
001CF0  3  A5 rr        	lda dispy
001CF2  3  C9 17        	cmp #23
001CF4  3  90 E2        	bcc bmsg3
001CF6  3  A9 00        	lda #0
001CF8  3  85 rr        	sta dispy
001CFA  3  4C D8 1C     	jmp bmsg3
001CFD  3               
001CFD  3               ;----------------------------------------------------------
001CFD  3               ; Big character display.
001CFD  3               ;
001CFD  3               ; Input:
001CFD  3               ;  A = character
001CFD  3               ;----------------------------------------------------------
001CFD  3               
001CFD  3               bchar:
001CFD  3  85 rr        	sta z80_e		; save char in lb
001CFF  3  A9 00        	lda #0
001D01  3  85 rr        	sta z80_d		; reset hb
001D03  3               
001D03  3  06 rr        	asl z80_e 		; multiply char by 8.
001D05  3  26 rr        	rol z80_d
001D07  3  06 rr        	asl z80_e
001D09  3  26 rr        	rol z80_d
001D0B  3  06 rr        	asl z80_e
001D0D  3  26 rr        	rol z80_d		; de = a*8
001D0F  3               
001D0F  3  18           	clc			; de = FontPtr + a*8
001D10  3  A5 rr        	lda z80_e
001D12  3  65 rr        	adc FontPtr 		; address of font.
001D14  3  85 rr        	sta z80_e
001D16  3  A5 rr        	lda z80_d
001D18  3  65 rr        	adc FontPtr+1
001D1A  3  85 rr        	sta z80_d
001D1C  3               
001D1C  3  20 F4 17     	jsr gprad 		; get screen address.
001D1F  3               
001D1F  3  A2 00        	ldx #0			; height of character in font.
001D21  3               bchar0:
001D21  3  A0 00        	ldy #0
001D23  3  B1 rr        	lda (z80_de),y 		; get a bit of the font.
001D25  3               
001D25  3  49 00        	eor #TxtInvert		; Invert
001D27  3               
001D27  3  91 rr        	sta (scraddr),y
001D29  3  48           	pha
001D2A  3  20 D2 0F     	jsr nline 		; next line down.
001D2D  3  68           	pla
001D2E  3  91 rr        	sta (scraddr),y
001D30  3  20 D2 0F     	jsr nline 		; next line down.
001D33  3               
001D33  3  18           	clc
001D34  3  E6 rr        	inc z80_e 		; next line of font.
001D36  3  D0 02        	bne :+
001D38  3  E6 rr        	inc z80_d
001D3A  3               :
001D3A  3  E8           	inx
001D3B  3  E0 08        	cpx #8
001D3D  3  D0 E2        	bne bchar0
001D3F  3               
001D3F  3  20 65 1D     	jsr nexpos		; display position.
001D42  3  D0 05        	bne bchar2 		; not on a new line.
001D44  3               bchar3:
001D44  3  E6 rr        	inc dispy
001D46  3  20 6C 1D     	jsr nexlin 		; next line check.
001D49  3               bchar2:
001D49  3  4C FB 16     	jmp dscor2		; tidy up line and column variables.
001D4C  3               
001D4C  3               
001D4C  3               ;-------------------------------------------------
001D4C  3               ; Display a character.
001D4C  3               ;
001D4C  3               ; Input:
001D4C  3               ;  A = character
001D4C  3               ;-------------------------------------------------
001D4C  3               
001D4C  3               achar:
001D4C  3  85 rr        	sta z80_b 		; copy to b.
001D4E  3  20 7A 1D     	jsr preprt 		; get ready to print.
001D51  3  A5 rr        	lda z80_b		; character in accumulator.
001D53  3  A6 rr        	ldx prtmod 		; print mode.
001D55  3  F0 03        	beq :+
001D57  3  4C FD 1C     	jmp bchar 		; no, double-height text.
001D5A  3               :
001D5A  3  20 72 10     	jsr pchar 		; display character.
001D5D  3  20 65 1D     	jsr nexpos 		; display position.
001D60  3  F0 E2        	beq bchar3		; next line down.
001D62  3  4C 49 1D     	jmp bchar2 		; tidy up.
001D65  3               
001D65  3               
001D65  3               ;-------------------------------------------------
001D65  3               ; Get next print column position.
001D65  3               ;-------------------------------------------------
001D65  3               
001D65  3               nexpos:
001D65  3  E6 rr        	inc dispx		; move along one position.
001D67  3  A5 rr        	lda dispx 		; get coordinate.
001D69  3  29 1F        	and #31
001D6B  3  60           	rts 			; return with status in zero flag.
001D6C  3               
001D6C  3               ;-------------------------------------------------
001D6C  3               ; Get next print line position.
001D6C  3               ;-------------------------------------------------
001D6C  3               
001D6C  3               nexlin:
001D6C  3  E6 rr        	inc dispy 		; newline.
001D6E  3  A5 rr        	lda dispy		; vertical position.
001D70  3  C9 18        	cmp #24			; past screen edge?
001D72  3  B0 01        	bcs :+
001D74  3  60           	rts			; no, still okay.
001D75  3               :
001D75  3  A9 00        	lda #0			; restart at top.
001D77  3  85 rr        	sta dispy
001D79  3  60           	rts
001D7A  3               
001D7A  3               ;--------------------------------------------------------
001D7A  3               ; Pre-print preliminaries.
001D7A  3               ;--------------------------------------------------------
001D7A  3               
001D7A  3               preprt:
001D7A  3  A5 rr        	lda FontPtr		; font pointer.
001D7C  3  8D B4 16     	sta grbase		; set up graphics base.
001D7F  3  A5 rr        	lda FontPtr+1
001D81  3  8D B5 16     	sta grbase+1
001D84  3               prescr:
001D84  3  A5 rr        	lda charx 		; display coordinates.
001D86  3  85 rr        	sta dispx		; set up general coordinates.
001D88  3  A5 rr        	lda chary
001D8A  3  85 rr        	sta dispy
001D8C  3  60           	rts
001D8D  3               
001D8D  3               ;--------------------------------------------------------------
001D8D  3               ; Get messagenr x in hl
001D8D  3               ;
001D8D  3               ; Input:
001D8D  3               ;  HL = pointer to message list
001D8D  3               ;  X  = message number.
001D8D  3               ;--------------------------------------------------------------
001D8D  3               
001D8D  3               getwrd:
001D8D  3  E0 00        	cpx #0
001D8F  3  D0 01        	bne:+ 			; first word in list?
001D91  3  60           	rts 			; yep, don't search.
001D92  3               :
001D92  3  A0 00        	ldy #0
001D94  3               getwd0:
001D94  3  B1 rr        	lda (z80_hl),y
001D96  3  48           	pha
001D97  3  E6 rr        	inc z80_l
001D99  3  D0 02        	bne :+
001D9B  3  E6 rr        	inc z80_h
001D9D  3               :
001D9D  3  68           	pla
001D9E  3  C9 80        	cmp #128		; found end?
001DA0  3  30 F2        	bmi getwd0		; no, carry on.
001DA2  3  CA           	dex			; until we have right number.
001DA3  3  D0 EF        	bne getwd0
001DA5  3  60           	rts
001DA6  3               
001DA6  3               ;-----------------------------------------------------------
001DA6  3               ; Bubble sort.
001DA6  3               ;-----------------------------------------------------------
001DA6  3               
001DA6  3               bsort:
001DA6  3  A9 0B        	lda #NUMSPR - 1		; sprites to swap.
001DA8  3  85 rr        	sta qscnt
001DAA  3               
001DAA  3  A9 00        	lda #<sprtab 		; sprite table.
001DAC  3  85 rr        	sta z80_x
001DAE  3  A9 0B        	lda #>sprtab
001DB0  3  85 rr        	sta z80_i
001DB2  3               bsort0:
001DB2  3  A0 00        	ldy #0
001DB4  3  B1 rr        	lda (z80_ix),y 		; first sprite type.
001DB6  3  C9 FF        	cmp #255 		; is it switched off?
001DB8  3  F0 30        	beq swemp		; yes, may need to switch another in here.
001DBA  3               
001DBA  3  A0 11        	ldy #TABSIZ
001DBC  3  B1 rr        	lda (z80_ix),y 		; check next slot exists.
001DBE  3  C9 FF        	cmp #255 		; is it enabled?
001DC0  3  F0 0A        	beq bsort2 		; no, nothing to swap.
001DC2  3               
001DC2  3  A0 14        	ldy #TABSIZ+3
001DC4  3  B1 rr        	lda (z80_ix),y 		; fetch next sprite's coordinate.
001DC6  3  A0 03        	ldy #3
001DC8  3  D1 rr        	cmp (z80_ix),y 		; compare with this x coordinate.
001DCA  3  90 10        	bcc bsort1		; next sprite is higher - may need to switch.
001DCC  3               bsort2:
001DCC  3  18           	clc
001DCD  3  A5 rr        	lda z80_x
001DCF  3  69 11        	adc #TABSIZ 		; distance to next odd/even entry.
001DD1  3  85 rr        	sta z80_x
001DD3  3  90 02        	bcc :+
001DD5  3  E6 rr        	inc z80_i
001DD7  3               :
001DD7  3  C6 rr        	dec qscnt
001DD9  3  D0 D7        	bne bsort0		; repeat for remaining sprites.
001DDB  3  60           	rts
001DDC  3               
001DDC  3               bsort1:
001DDC  3  A0 11        	ldy #TABSIZ
001DDE  3  B1 rr        	lda (z80_ix),y		; sprite on/off flag.
001DE0  3  C9 FF        	cmp #255		; is it enabled?
001DE2  3  F0 E8        	beq bsort2		; no, nothing to swap.
001DE4  3  20 F8 1D     	jsr swspr		; swap positions.
001DE7  3  4C CC 1D     	jmp bsort2
001DEA  3               swemp:
001DEA  3  A0 11        	ldy #TABSIZ
001DEC  3  B1 rr        	lda (z80_ix),y		; next table entry.
001DEE  3  C9 FF        	cmp #255		; is that one on?
001DF0  3  F0 DA        	beq bsort2		; no, nothing to swap.
001DF2  3  20 F8 1D     	jsr swspr		; swap positions.
001DF5  3  4C CC 1D     	jmp bsort2
001DF8  3               
001DF8  3               ; Swap sprites.
001DF8  3               
001DF8  3               swspr:
001DF8  3  A5 rr        	lda z80_x		; table address
001DFA  3  85 rr        	sta z80_e		; copy to de pair.
001DFC  3  85 rr        	sta z80_l		; copy to hl pair.
001DFE  3  A5 rr        	lda z80_i
001E00  3  85 rr        	sta z80_h
001E02  3  85 rr        	sta z80_d
001E04  3               
001E04  3  18           	clc
001E05  3  A5 rr        	lda z80_l
001E07  3  69 11        	adc #TABSIZ		; distance to second entry.
001E09  3  85 rr        	sta z80_l
001E0B  3  90 02        	bcc :+
001E0D  3  E6 rr        	inc z80_h
001E0F  3               :
001E0F  3  A9 11        	lda #TABSIZ		; bytes to swap.
001E11  3  85 rr        	sta z80_b
001E13  3  A0 00        	ldy #0
001E15  3               swspr0:
001E15  3  B1 rr        	lda (z80_hl),y		; fetch second byte.
001E17  3  48           	pha
001E18  3  B1 rr        	lda (z80_de),y 		; fetch first byte.
001E1A  3  91 rr        	sta (z80_hl),y 		; copy to second.
001E1C  3  68           	pla
001E1D  3  91 rr        	sta (z80_de),y 		; copy to first sprite entry.
001E1F  3               
001E1F  3  E6 rr        	inc z80_e 		; next byte.
001E21  3  D0 02        	bne :+
001E23  3  E6 rr        	inc z80_d
001E25  3               :
001E25  3  E6 rr        	inc z80_l 		; next byte.
001E27  3  D0 02        	bne :+
001E29  3  E6 rr        	inc z80_h
001E2B  3               :
001E2B  3  C6 rr        	dec z80_b
001E2D  3  D0 E6        	bne swspr0 		; swap all bytes in table entry.
001E2F  3  60           	rts
001E30  3               
001E30  3               ;----------------------------------------------------
001E30  3               ; Process sprites.
001E30  3               ;----------------------------------------------------
001E30  3               
001E30  3               pspr:
001E30  3  A9 0C        	lda #NUMSPR		; sprites to process.
001E32  3  85 rr        	sta sprptr
001E34  3               
001E34  3  A9 00        	lda #<sprtab 		; sprite table.
001E36  3  85 rr        	sta z80_x
001E38  3  A9 0B        	lda #>sprtab
001E3A  3  85 rr        	sta z80_i
001E3C  3               pspr1:
001E3C  3  A0 00        	ldy #0
001E3E  3  B1 rr        	lda (z80_ix),y		; fetch sprite type.
001E40  3  C9 09        	cmp #9 			; within range of sprite types?
001E42  3  B0 03        	bcs :+
001E44  3  20 57 1E     	jsr pspr2 		; yes, process this one.
001E47  3               :
001E47  3  18           	clc
001E48  3  A5 rr        	lda z80_x
001E4A  3  69 11        	adc #TABSIZ 		; distance to next odd/even entry.
001E4C  3  85 rr        	sta z80_x
001E4E  3  90 02        	bcc :+
001E50  3  E6 rr        	inc z80_i		; next sprite.
001E52  3               :
001E52  3  C6 rr        	dec sprptr 		; repeat for remaining sprites.
001E54  3  D0 E6        	bne pspr1
001E56  3  60           	rts
001E57  3               
001E57  3               pspr2:
001E57  3  A5 rr        	lda z80_x 		; store original sprite pointer.
001E59  3  85 rr        	sta ogptr
001E5B  3  A5 rr        	lda z80_i
001E5D  3  85 rr        	sta ogptr+1
001E5F  3  20 6B 1E     	jsr pspr3		; do the routine.
001E62  3               rtorg:
001E62  3  A5 rr        	lda ogptr 		; restore original pointer to sprite.
001E64  3  85 rr        	sta z80_x
001E66  3  A5 rr        	lda ogptr+1
001E68  3  85 rr        	sta z80_i
001E6A  3               rtorg0:
001E6A  3  60           	rts
001E6B  3               
001E6B  3               pspr3:
001E6B  3  A9 A0        	lda #<evtyp0		; sprite type events list.
001E6D  3  85 rr        	sta z80_l
001E6F  3  A9 1E        	lda #>evtyp0
001E71  3  85 rr        	sta z80_h
001E73  3               pspr4:
001E73  3  B1 rr        	lda (z80_ix),y
001E75  3  0A           	asl a			; double accumulator.
001E76  3  18           	clc
001E77  3  65 rr        	adc z80_l
001E79  3  85 rr        	sta z80_l
001E7B  3  90 02        	bcc :+
001E7D  3  E6 rr        	inc z80_h
001E7F  3               :
001E7F  3  B1 rr        	lda (z80_hl),y
001E81  3  85 rr        	sta z80_e 		; copy to de.
001E83  3  48           	pha
001E84  3               
001E84  3  E6 rr        	inc z80_l 		; next byte of address.
001E86  3  D0 02        	bne :+
001E88  3  E6 rr        	inc z80_h
001E8A  3               :
001E8A  3  B1 rr        	lda (z80_hl),y 		; address high.
001E8C  3  85 rr        	sta z80_d
001E8E  3               
001E8E  3  48           	pha	 		; swap address into hl.
001E8F  3  A5 rr        	lda z80_h
001E91  3  85 rr        	sta z80_d
001E93  3  68           	pla
001E94  3  85 rr        	sta z80_h
001E96  3  68           	pla
001E97  3  85 rr        	sta z80_l
001E99  3  A5 rr        	lda z80_l
001E9B  3  85 rr        	sta z80_e
001E9D  3               
001E9D  3  6C rr rr     	jmp (z80_hl) 		; go there.
001EA0  3               
001EA0  3               ; Address of each sprite type's routine.
001EA0  3               
001EA0  3  A8 24        evtyp0:	.word evnt00
001EA2  3  97 26        evtyp1:	.word evnt01
001EA4  3  FE 26        evtyp2:	.word evnt02
001EA6  3  C3 27        evtyp3:	.word evnt03
001EA8  3  31 28        evtyp4:	.word evnt04
001EAA  3  32 28        evtyp5:	.word evnt05
001EAC  3  A7 28        evtyp6:	.word evnt06
001EAE  3  A8 28        evtyp7:	.word evnt07
001EB0  3  42 29        evtyp8:	.word evnt08
001EB2  3               
001EB2  3               ;--------------------------------------------------------------
001EB2  3               ; Display sprites.
001EB2  3               ;
001EB2  3               ; Input:
001EB2  3               ;  IX = sprite table
001EB2  3               ;--------------------------------------------------------------
001EB2  3               
001EB2  3               dspr:
001EB2  3  A9 06        	lda #(NUMSPR/2)		; number of sprites to display.
001EB4  3  85 rr        	sta sprcnt
001EB6  3               
001EB6  3               dspr0:
001EB6  3  A0 00        	ldy #var_Type
001EB8  3  B1 rr        	lda (z80_ix),y 		; get sprite type.
001EBA  3  C9 FF        	cmp #255 			; is it enabled?
001EBC  3  D0 45        	bne dspr1 			; yes, it needs deleting.
001EBE  3               
001EBE  3               dspr5:
001EBE  3  A0 05        	ldy #var_newType
001EC0  3  B1 rr        	lda (z80_ix),y 		; new type.
001EC2  3  C9 FF        	cmp #255			; is it enabled?
001EC4  3  F0 03        	beq dspr2			; no, skip
001EC6  3  4C 52 1F     	jmp dspr3 			; yes, it needs drawing.
001EC9  3               
001EC9  3               dspr2:
001EC9  3  A0 05        	ldy #var_newType
001ECB  3  B1 rr        	lda (z80_ix),y 		; copy new type.
001ECD  3  A0 00        	ldy #var_Type
001ECF  3  91 rr        	sta (z80_ix),y
001ED1  3  A0 06        	ldy #var_newImage
001ED3  3  B1 rr        	lda (z80_ix),y 		; copy new image number.
001ED5  3  A0 01        	ldy #var_Image
001ED7  3  91 rr        	sta (z80_ix),y
001ED9  3  A0 07        	ldy #var_newFrame
001EDB  3  B1 rr        	lda (z80_ix),y 		; copy new frame.
001EDD  3  A0 02        	ldy #var_Frame
001EDF  3  91 rr        	sta (z80_ix),y
001EE1  3  A0 08        	ldy #var_newY
001EE3  3  B1 rr        	lda (z80_ix),y 		; copy new y.
001EE5  3  A0 03        	ldy #var_Y
001EE7  3  91 rr        	sta (z80_ix),y
001EE9  3  A0 09        	ldy #var_newX
001EEB  3  B1 rr        	lda (z80_ix),y 		; copy new x.
001EED  3  A0 04        	ldy #var_X
001EEF  3  91 rr        	sta (z80_ix),y
001EF1  3               
001EF1  3  18           	clc
001EF2  3  A5 rr        	lda z80_x
001EF4  3  69 22        	adc #(TABSIZ*2)		; distance to next odd/even entry.
001EF6  3  85 rr        	sta z80_x
001EF8  3  A5 rr        	lda z80_i
001EFA  3  69 00        	adc #0
001EFC  3  85 rr        	sta z80_i 			; next sprite.
001EFE  3  C6 rr        	dec sprcnt
001F00  3  D0 B4        	bne dspr0			; repeat for remaining sprites.
001F02  3  60           	rts
001F03  3               
001F03  3               dspr1:
001F03  3               	; _BEEB clipping code copied from CPC Engine
001F03  3  A0 03        	ldy #var_Y
001F05  3  B1 rr        	lda (z80_ix), y		; old x coord
001F07  3  C9 B1        	cmp #SpriteMaxY     ; beyond maximum?
001F09  3  B0 B3        	bcs dspr5			; yes, don't delete it.
001F0B  3               
001F0B  3  A0 05        	ldy #var_newType
001F0D  3  B1 rr        	lda (z80_ix),y 		; type of new sprite.
001F0F  3  C9 FF        	cmp #255			; is this enabled?
001F11  3  D0 06        	bne dspr4 			; yes, display both.
001F13  3               
001F13  3               dspr6:
001F13  3  20 84 0F     	jsr sspria 			; show single sprite.
001F16  3  4C C9 1E     	jmp dspr2
001F19  3               
001F19  3               ; Displaying two sprites.  Don't bother redrawing if nothing has changed.
001F19  3               
001F19  3               dspr4:
001F19  3               	; _BEEB clipping code copied from CPC Engine
001F19  3  A0 08        	ldy #var_newY
001F1B  3  B1 rr        	lda (z80_ix), y		; old x coord
001F1D  3  C9 B1        	cmp #SpriteMaxY     ; beyond maximum?
001F1F  3  B0 F2        	bcs dspr6			; yes, don't display it.
001F21  3               
001F21  3  A0 04        	ldy #var_X
001F23  3  B1 rr        	lda (z80_ix),y		; old x.
001F25  3  A0 09        	ldy #var_newX
001F27  3  D1 rr        	cmp (z80_ix),y 		; compare with new value.
001F29  3  D0 21        	bne dspr7 			; they differ, need to redraw.
001F2B  3               
001F2B  3  A0 03        	ldy #var_Y
001F2D  3  B1 rr        	lda (z80_ix),y		; old y.
001F2F  3  A0 08        	ldy #var_newY
001F31  3  D1 rr        	cmp (z80_ix),y 		; compare against new value.
001F33  3  D0 17        	bne dspr7			; they differ, need to redraw.
001F35  3               
001F35  3  A0 02        	ldy #var_Frame
001F37  3  B1 rr        	lda (z80_ix),y 		; old frame.
001F39  3  A0 07        	ldy #var_newFrame
001F3B  3  D1 rr        	cmp (z80_ix),y 		; compare against new value.
001F3D  3  D0 0D        	bne dspr7 			; they differ, need to redraw.
001F3F  3               
001F3F  3  A0 01        	ldy #var_Image
001F41  3  B1 rr        	lda (z80_ix),y 		; old image.
001F43  3  A0 06        	ldy #var_newImage
001F45  3  D1 rr        	cmp (z80_ix),y 		; compare against new value.
001F47  3  D0 03        	bne dspr7 			; they differ, need to redraw.
001F49  3  4C C9 1E     	jmp dspr2			; everything is the same, don't redraw.
001F4C  3               
001F4C  3               dspr7:
001F4C  3  20 96 0F     	jsr sspric 			; delete old sprite, draw new one simultaneously.
001F4F  3  4C C9 1E     	jmp dspr2
001F52  3               
001F52  3               dspr3:
001F52  3               	; _BEEB clipping code copied from CPC Engine
001F52  3  A0 08        	ldy #var_newY
001F54  3  B1 rr        	lda (z80_ix), y		; old x coord
001F56  3  C9 B1        	cmp #SpriteMaxY     ; beyond maximum?
001F58  3  90 03        	bcc :+				; no, continue
001F5A  3  4C C9 1E     	jmp dspr2			; yes, don't display it.
001F5D  3               :
001F5D  3  20 90 0F     	jsr ssprib 			; show single sprite.
001F60  3  4C C9 1E     	jmp dspr2
001F63  3               
001F63  3               ;-----------------------------------------
001F63  3               ; Get sprite address calculations.
001F63  3               ; gspran = new sprite, gsprad = old sprite.
001F63  3               ;
001F63  3               ; Input:
001F63  3               ;  IX = sprite address
001F63  3               ;-----------------------------------------
001F63  3               
001F63  3               gspran:
001F63  3  A0 08        	ldy #var_newY
001F65  3  B1 rr        	lda (z80_ix),y 		; new y coordinate.
001F67  3  85 rr        	sta dispy
001F69  3  A0 09        	ldy #var_newX
001F6B  3  B1 rr        	lda (z80_ix),y 		; new x coordinate.
001F6D  3  85 rr        	sta dispx
001F6F  3  A0 06        	ldy #var_newImage
001F71  3  B1 rr        	lda (z80_ix),y 		; new sprite image.
001F73  3  20 34 22     	jsr gfrm		; fetch start frame for this sprite.
001F76  3               
001F76  3  A0 00        	ldy #0
001F78  3  B1 rr        	lda (z80_hl),y 		; frame in accumulator.
001F7A  3  A0 07        	ldy #var_newFrame
001F7C  3  18           	clc
001F7D  3  71 rr        	adc (z80_ix),y 		; new add frame number.
001F7F  3  4C 9E 1F     	jmp gspra0
001F82  3               
001F82  3               ;-----------------------------------------
001F82  3               ; Calculate old sprite address
001F82  3               ;
001F82  3               ; Input:
001F82  3               ;  IX = sprite address
001F82  3               ;
001F82  3               ; Output:
001F82  3               ;  B  = right byte mask
001F82  3               ;  C  = left byte mask
001F82  3               ;  DE = spriteframe address
001F82  3               ;  scraddr = screenaddress(dispx,dispy)
001F82  3               ;-----------------------------------------
001F82  3               
001F82  3               gsprad:
001F82  3  A0 03        	ldy #var_Y
001F84  3  B1 rr        	lda (z80_ix),y		; y coordinate.
001F86  3  85 rr        	sta dispy
001F88  3  A0 04        	ldy #var_X
001F8A  3  B1 rr        	lda (z80_ix),y		; x coordinate.
001F8C  3  85 rr        	sta dispx
001F8E  3  A0 01        	ldy #var_Image
001F90  3  B1 rr        	lda (z80_ix),y 		; sprite image.
001F92  3  20 34 22     	jsr gfrm 		; fetch start frame for this sprite.
001F95  3               
001F95  3  A0 00        	ldy #0
001F97  3  B1 rr        	lda (z80_hl),y 		; frame in accumulator.
001F99  3  A0 02        	ldy #var_Frame
001F9B  3  18           	clc
001F9C  3  71 rr        	adc (z80_ix),y 		; add frame number.
001F9E  3               
001F9E  3               gspra0:
001F9E  3  4A           	lsr a	  		; multiply by 128.
001F9F  3  85 rr        	sta z80_d 		; store in d.
001FA1  3  A9 00        	lda #0
001FA3  3  6A           	ror a
001FA4  3  85 rr        	sta z80_e 		; got low byte.
001FA6  3               
001FA6  3  18           	clc 			; address of play sprites.
001FA7  3  A5 rr        	lda z80_e
001FA9  3  69 8A        	adc #<sprgfx
001FAB  3  85 rr        	sta z80_e
001FAD  3  A5 rr        	lda z80_d
001FAF  3  69 2D        	adc #>sprgfx
001FB1  3  85 rr        	sta z80_d
001FB3  3               
001FB3  3  A5 rr        	lda dispx 		; y coordinate.
001FB5  3  29 06        	and #6 			; position within byte boundary.
001FB7  3  AA           	tax	 		; low byte of table displacement.
001FB8  3               
001FB8  3  0A           	asl a	  		; multiply by 32.
001FB9  3  0A           	asl a  			; already a multiple
001FBA  3  0A           	asl a  			; of 2, so just 4
001FBB  3  0A           	asl a  			; shifts needed.
001FBC  3               
001FBC  3  18           	clc 			; add to sprite address.
001FBD  3  65 rr        	adc z80_e
001FBF  3  85 rr        	sta z80_e
001FC1  3  90 02        	bcc :+
001FC3  3  E6 rr        	inc z80_d
001FC5  3               :
001FC5  3  BD D2 1F     	lda spmask,x		 ; pointer to mask table.
001FC8  3  85 rr        	sta z80_c 		; left mask.
001FCA  3  BD D3 1F     	lda spmask+1,x
001FCD  3  85 rr        	sta z80_b 		; right mask.
001FCF  3               ; Drop into screen address routine.
001FCF  3  4C 70 0F     	jmp scadd
001FD2  3               
001FD2  3  FF 00 3F C0  spmask:	.byte 255,0,63,192,15,240,3,252
001FD6  3  0F F0 03 FC  
001FDA  3               
001FDA  3               
001FDA  3               ;-----------------------------------------------------------
001FDA  3               ; Animates a sprite.
001FDA  3               ;
001FDA  3               ; Input:
001FDA  3               ;  IX = sprite address
001FDA  3               ;  HL = last sprite address
001FDA  3               ;-----------------------------------------------------------
001FDA  3               
001FDA  3               animsp:
001FDA  3  25 rr        	and frmno
001FDC  3  F0 01        	beq :+
001FDE  3  60           	rts
001FDF  3               :
001FDF  3  A0 06        	ldy #var_newImage
001FE1  3  B1 rr        	lda (z80_ix),y		; sprite image
001FE3  3  20 34 22     	jsr gfrm		; get frame data.
001FE6  3               
001FE6  3  E6 rr        	inc z80_l		; point to frames.
001FE8  3  D0 02        	bne :+
001FEA  3  E6 rr        	inc z80_h
001FEC  3               :
001FEC  3  A0 07        	ldy #var_newFrame
001FEE  3  B1 rr        	lda (z80_ix),y		; sprite frame.
001FF0  3  18           	clc
001FF1  3  69 01        	adc #1			; next one along.
001FF3  3  A0 00        	ldy #0
001FF5  3  D1 rr        	cmp (z80_hl),y		; reached the last frame?
001FF7  3  90 02        	bcc anims0		; no, not yet.
001FF9  3  A9 00        	lda #0			; start at first frame.
001FFB  3               anims0:
001FFB  3  A0 07        	ldy #var_newFrame
001FFD  3  91 rr        	sta (z80_ix),y		; new frame.
001FFF  3  60           	rts
002000  3               
002000  3               ;--------------------------------------------------------------
002000  3               ; Animate back
002000  3               ;
002000  3               ; Input:
002000  3               ;  IX = sprite address
002000  3               ;  HL = last sprite address
002000  3               ;--------------------------------------------------------------
002000  3               
002000  3               animbk:
002000  3  25 rr        	and frmno
002002  3  F0 01        	beq :+
002004  3  60           	rts
002005  3               :
002005  3  A0 06        	ldy #var_newImage
002007  3  B1 rr        	lda (z80_ix),y		; sprite image.
002009  3  20 34 22     	jsr gfrm		; get frame data.
00200C  3               
00200C  3  E6 rr        	inc z80_l 		; point to frames.
00200E  3  D0 02        	bne :+
002010  3  E6 rr        	inc z80_h
002012  3               :
002012  3  A0 07        	ldy #var_newFrame
002014  3  B1 rr        	lda (z80_ix),y 		; sprite frame.
002016  3  F0 03        	beq :+
002018  3  4C 1F 20     	jmp rtanb0 		; yes, start at end.
00201B  3               :
00201B  3  A0 00        	ldy #0
00201D  3  B1 rr        	lda (z80_hl),y 		; last sprite.
00201F  3               rtanb0:
00201F  3  38           	sec
002020  3  E9 01        	sbc #1			; next one along.
002022  3  4C FB 1F     	jmp anims0		; set new frame.
002025  3               
002025  3               ;--------------------------------------------------------------
002025  3               ; Check for collision with other sprite, strict enforcement.
002025  3               ;
002025  3               ; Input:
002025  3               ;  b		= sprite to test for
002025  3               ;  ix		= current sprite pointer
002025  3               ;
002025  3               ; global:	b
002025  3               ; local:	x,y,hl,de,skptr
002025  3               ; calls:	-
002025  3               ;--------------------------------------------------------------
002025  3               
002025  3               sktyp:
002025  3  A9 00        	lda #<sprtab				; sprite table.
002027  3  85 rr        	sta z80_l
002029  3  A9 0B        	lda #>sprtab
00202B  3  85 rr        	sta z80_h
00202D  3               numsp2:
00202D  3  A9 0C        	lda #NUMSPR				; number of sprites.
00202F  3  85 rr        	sta sktptr
002031  3               sktyp0:
002031  3  A5 rr        	lda z80_l 				; store pointer to sprite.
002033  3  85 rr        	sta skptr
002035  3  A5 rr        	lda z80_h
002037  3  85 rr        	sta skptr+1
002039  3               
002039  3  A0 00        	ldy #0
00203B  3  B1 rr        	lda (z80_hl),y 				; get sprite type.
00203D  3  C5 rr        	cmp z80_b				; is it the type we seek?
00203F  3  F0 1D        	beq coltyp				; yes, we can use this one.
002041  3               :
002041  3               sktyp1:
002041  3  18           	clc
002042  3  A5 rr        	lda skptr				; retrieve sprite pointer.
002044  3  69 11        	adc #TABSIZ				; size of each entry.
002046  3  85 rr        	sta z80_l
002048  3  A5 rr        	lda skptr+1
00204A  3  69 00        	adc #0
00204C  3  85 rr        	sta z80_h
00204E  3  C6 rr        	dec sktptr					; one less iteration.
002050  3  D0 DF        	bne sktyp0				; keep going until we find a slot.
002052  3               :
002052  3  A9 00        	lda #0					; default to ROM address - no sprite.
002054  3  85 rr        	sta z80_l
002056  3  85 rr        	sta z80_h
002058  3  85 rr        	sta skptr				; store pointer to sprite.
00205A  3  85 rr        	sta skptr+1
00205C  3               
00205C  3  18           	clc					; don't return with zero flag set.
00205D  3  60           	rts 					; didn't find one.
00205E  3               
00205E  3               coltyp:
00205E  3  A0 00        	ldy #0
002060  3  B1 rr        	lda (z80_ix),y				; current sprite type.
002062  3  C5 rr        	cmp z80_b				; seeking sprite of same type?
002064  3  F0 3D        	beq colty1				; yes, need to check we're not detecting ourselves.
002066  3               colty0:
002066  3  A0 09        	ldy #9					; distance to x position in table.
002068  3  B1 rr        	lda (z80_hl),y				; fetch x coordinate.
00206A  3  85 rr        	sta z80_e
00206C  3  88           	dey
00206D  3  B1 rr        	lda (z80_hl),y				; fetch y coordinate.
00206F  3  85 rr        	sta z80_d
002071  3               
002071  3               ; Drop into collision detection.
002071  3               
002071  3               colc16:
002071  3  A0 09        	ldy #9
002073  3  B1 rr        	lda (z80_ix),y			 	; x coord.
002075  3  38           	sec					; subtract x.
002076  3  E5 rr        	sbc z80_e
002078  3  B0 05        	bcs  colc1a 				; result is positive.
00207A  3  49 FF        	eor #$ff				; make negative positive.
00207C  3  18           	clc
00207D  3  69 01        	adc #1
00207F  3               colc1a:
00207F  3  C9 10        	cmp #16 				; within x range?
002081  3  B0 BE        	bcs sktyp1				; no - they"ve missed.
002083  3  85 rr        	sta z80_c				; store difference.
002085  3               
002085  3  A0 08        	ldy #8
002087  3  B1 rr        	lda (z80_ix),y				; y coord.
002089  3  38           	sec
00208A  3  E5 rr        	sbc z80_d				; subtract y.
00208C  3  B0 05        	bcs colc1b				; result is positive.
00208E  3  49 FF        	eor #$ff				; make negative positive.
002090  3  18           	clc
002091  3  69 01        	adc #1
002093  3               colc1b:
002093  3  C9 10        	cmp #16					; within y range?
002095  3  B0 AA        	bcs sktyp1 				; no - they've missed.
002097  3  18           	clc					; add x difference.
002098  3  65 rr        	adc z80_c
00209A  3  C9 1A        	cmp #26					; only 5 corner pixels touching?
00209C  3  B0 02        	bcs :+
00209E  3  38           	sec
00209F  3  60           	rts 					; carry set if there's a collision.
0020A0  3               :
0020A0  3  4C 41 20     	jmp sktyp1				; try next sprite in table.
0020A3  3               colty1:
0020A3  3  A5 rr        	lda z80_x  				; compare the two.
0020A5  3  C5 rr        	cmp z80_l
0020A7  3  D0 09        	bne end_col
0020A9  3  A5 rr        	lda z80_i
0020AB  3  C5 rr        	cmp z80_h
0020AD  3  D0 03        	bne end_col
0020AF  3  4C 41 20     	jmp sktyp1 				; addresses are identical.
0020B2  3               end_col:
0020B2  3  4C 66 20     	jmp colty0
0020B5  3               
0020B5  3               ;-----------------------------------------------------------
0020B5  3               ; Display number, left aligned
0020B5  3               ;
0020B5  3               ; Input:
0020B5  3               ;  a		= number
0020B5  3               ;
0020B5  3               ; global:	-
0020B5  3               ; local:	a,y,bc,hl,displ0
0020B5  3               ; calls:	num2ch,dmsg3
0020B5  3               ;-----------------------------------------------------------
0020B5  3               
0020B5  3               disply:
0020B5  3  85 rr        	sta z80_a
0020B7  3  A9 DD        	lda #<displ0				; display workspace.
0020B9  3  85 rr        	sta z80_c
0020BB  3  A9 20        	lda #>displ0
0020BD  3  85 rr        	sta z80_b
0020BF  3  A5 rr        	lda z80_a
0020C1  3  20 33 14     	jsr num2ch				; convert accumulator to string.
0020C4  3               displ1:
0020C4  3  C6 rr        	dec z80_c				; back one character.
0020C6  3  D0 02        	bne :+
0020C8  3  C6 rr        	dec z80_b
0020CA  3               :
0020CA  3  A0 00        	ldy #0
0020CC  3  B1 rr        	lda (z80_bc),y				; fetch digit.
0020CE  3  09 80        	ora #128				; insert end marker.
0020D0  3  91 rr        	sta (z80_bc),y				; new value.
0020D2  3               
0020D2  3  A9 DD        	lda #<displ0				; display space.
0020D4  3  85 rr        	sta z80_l
0020D6  3  A9 20        	lda #>displ0
0020D8  3  85 rr        	sta z80_h
0020DA  3  4C 7A 1C     	jmp dmsg3				; display the string.
0020DD  3               
0020DD  3  00 00 00 8D  displ0:	.byte 0,0,0,13+128
0020E1  3               
0020E1  3               ;----------------------------------------------------------------
0020E1  3               ; Initialise screen.
0020E1  3               ;
0020E1  3               ; global:	roomtb,scno
0020E1  3               ; local:	-
0020E1  3               ; calls:	tstcs
0020E1  3               ;----------------------------------------------------------------
0020E1  3               
0020E1  3               initsc:
0020E1  3  AD 23 24     	lda roomtb 			; whereabouts in the map are we?
0020E4  3  20 EE 20     	jsr tstsc 			; find displacement.
0020E7  3  C9 FF        	cmp #255 			; is it valid?
0020E9  3  F0 02        	beq init_end 			; no, it's rubbish.
0020EB  3  85 rr        	sta scno			; store new room number.
0020ED  3               init_end:
0020ED  3  60           	rts
0020EE  3               
0020EE  3               ;----------------------------------------------------------------
0020EE  3               ; Test screen.
0020EE  3               ;
0020EE  3               ; global:	-
0020EE  3               ; local:	x
0020EE  3               ; calls:	-
0020EE  3               ;----------------------------------------------------------------
0020EE  3               
0020EE  3               tstsc:
0020EE  3  85 rr        	sta tmproom
0020F0  3  18           	clc
0020F1  3  69 0D        	adc #MAPWID 			; add width in case we"re negative.
0020F3  3  AA           	tax 				; add displacement to map data.
0020F4  3  BD 25 24     	lda mapdat-MAPWID,x 		; find room number there.
0020F7  3  60           	rts
0020F8  3               
0020F8  3               ;--------------------------
0020F8  3               ; Screen left.
0020F8  3               ;--------------------------
0020F8  3               
0020F8  3               scrl:
0020F8  3  AD 23 24     	lda roomtb 			; present room table pointer.
0020FB  3  38           	sec
0020FC  3  E9 01        	sbc #1				; room left.
0020FE  3               scrl0:
0020FE  3  20 EE 20     	jsr tstsc			; test screen.
002101  3  C9 FF        	cmp #255			; is there a screen this way?
002103  3  D0 01        	bne :+
002105  3  60           	rts				; no, return to loop.
002106  3               :
002106  3  A5 rr        	lda tmproom			; restore room displacement.
002108  3  8D 23 24     	sta roomtb			; new room table position.
00210B  3               scrl1:
00210B  3  20 E1 20     	jsr initsc 			; set new screen.
00210E  3  A9 02        	lda #2
002110  3  85 rr        	sta restfl 			; set it.
002112  3  60           	rts
002113  3               scrr:
002113  3  AD 23 24     	lda roomtb 			; room table pointer.
002116  3  18           	clc
002117  3  69 01        	adc #1				; room right.
002119  3  4C FE 20     	jmp scrl0
00211C  3               scru:
00211C  3  AD 23 24     	lda roomtb 			; room table pointer.
00211F  3  38           	sec
002120  3  E9 0D        	sbc #MAPWID 			; room up.
002122  3  4C FE 20     	jmp scrl0
002125  3               scrd:
002125  3  AD 23 24     	lda roomtb 			; room table pointer.
002128  3  18           	clc
002129  3  69 0D        	adc #MAPWID 			; room down.
00212B  3  4C FE 20     	jmp scrl0
00212E  3               
00212E  3               ;-----------------------------------------
00212E  3               ; Jump to new screen.
00212E  3               ;-----------------------------------------
00212E  3               
00212E  3               nwscr:
00212E  3  A2 00        	ldx #0				; start of map data.
002130  3               nwscr0:
002130  3  DD 32 24     	cmp mapdat,x
002133  3  F0 06        	beq nwscr1			; have we found a match for screen?
002135  3  E8           	inx 				; next room.
002136  3  E0 50        	cpx #80				; zero room count, 80 to search.
002138  3  D0 F6        	bne nwscr0			; keep looking.
00213A  3  60           	rts
00213B  3               nwscr1:
00213B  3  8E 23 24     	stx roomtb			; set the map position.
00213E  3  4C 0B 21     	jmp scrl1			; draw new room.
002141  3               
002141  3               
002141  3               ;----------------------------------------------------------
002141  3               ; Gravity processing.
002141  3               ;----------------------------------------------------------
002141  3               
002141  3               grav:
002141  3  A0 0D        	ldy #var_jumpLo
002143  3  B1 rr        	lda (z80_ix),y			; jump pointer low.
002145  3  85 rr        	sta z80_l
002147  3  A0 0E        	ldy #var_jumpHi
002149  3  B1 rr        	lda (z80_ix),y			; jump pointer high.
00214B  3  85 rr        	sta z80_h
00214D  3  05 rr        	ora z80_l			; merge in low byte.
00214F  3  D0 01        	bne :+
002151  3  60           	rts				; if neither is set, we're not in the air.
002152  3               :
002152  3  A0 00        	ldy #0
002154  3  B1 rr        	lda (z80_hl),y			; pixels to move.
002156  3  85 rr        	sta z80_a
002158  3  C9 63        	cmp #99				; reached the end?
00215A  3  D0 06        	bne grav0			; no, continue.
00215C  3               grav2:
00215C  3  C6 rr        	dec z80_l			; go back to previous value.
00215E  3               	; 6502 WARNING - not updating 16-bit pointer properly!
00215E  3  B1 rr        	lda (z80_hl),y			; fetch that from table.
002160  3  85 rr        	sta z80_a
002162  3               grav0:
002162  3  E6 rr        	inc z80_l			; point to next table entry.
002164  3               	; 6502 WARNING - not updating 16-bit pointer properly!
002164  3  A5 rr        	lda z80_l
002166  3  A0 0D        	ldy #var_jumpLo
002168  3  91 rr        	sta (z80_ix),y			; store new pointer low.
00216A  3  A5 rr        	lda z80_h
00216C  3  A0 0E        	ldy #var_jumpHi
00216E  3  91 rr        	sta (z80_ix),y			; store new pointer high.
002170  3               grav1:
002170  3  A5 rr        	lda z80_a
002172  3  D0 01        	bne :+				; any movement required?
002174  3  60           	rts				; no, not this time.
002175  3               :
002175  3  A5 rr        	lda z80_a
002177  3  C9 80        	cmp #128			; is it up or down?
002179  3  B0 15        	bcs gravu			; it's up.
00217B  3               gravd:
00217B  3  85 rr        	sta z80_b			; set pixels to move.
00217D  3               gravd0:
00217D  3  20 CE 19     	jsr cangd			; can we go down?
002180  3  D0 28        	bne gravst			; can't move down, so stop.
002182  3  A0 08        	ldy #8
002184  3  B1 rr        	lda (z80_ix),y			; adjust new x coord.
002186  3  18           	clc
002187  3  69 01        	adc #1
002189  3  91 rr        	sta (z80_ix),y
00218B  3  C6 rr        	dec z80_b
00218D  3  D0 EE        	bne gravd0
00218F  3  60           	rts
002190  3               gravu:
002190  3  49 FF        	eor #$ff			; flip the sign so it's positive.
002192  3  18           	clc
002193  3  69 01        	adc #1
002195  3  85 rr        	sta z80_b			; set pixels to move.
002197  3               gravu0:
002197  3  20 99 19     	jsr cangu			; can we go up?
00219A  3  D0 6E        	bne ifalls			; can't move up, go down next.
00219C  3  A0 08        	ldy #8
00219E  3  B1 rr        	lda (z80_ix),y
0021A0  3  38           	sec
0021A1  3  E9 01        	sbc #1
0021A3  3  91 rr        	sta (z80_ix),y			; adjust new x coord.
0021A5  3  C6 rr        	dec z80_b
0021A7  3  D0 EE        	bne gravu0
0021A9  3  60           	rts
0021AA  3               gravst:
0021AA  3  A0 0D        	ldy #var_jumpLo
0021AC  3  B1 rr        	lda (z80_ix),y			; jump pointer low.
0021AE  3  85 rr        	sta z80_l
0021B0  3  A0 0E        	ldy #var_jumpHi
0021B2  3  B1 rr        	lda (z80_ix),y			; jump pointer high.
0021B4  3  85 rr        	sta z80_h
0021B6  3               
0021B6  3  A9 00        	lda #0				; null value in pointer.
0021B8  3  A0 0D        	ldy #var_jumpLo
0021BA  3  91 rr        	sta (z80_ix),y			; store new pointer low.
0021BC  3  C8           	iny
0021BD  3  91 rr        	sta (z80_ix),y			; store new pointer high.
0021BF  3               
0021BF  3  A0 00        	ldy #0
0021C1  3  B1 rr        	lda (z80_hl),y			; fetch byte from table.
0021C3  3  C9 63        	cmp #99				; is it the end marker?
0021C5  3               evftf:
0021C5  3  F0 01        	beq :+				; yes, fallen too far.
0021C7  3  60           	rts
0021C8  3               :
0021C8  3  4C 22 2A     	jmp evnt15			; EVENT FELLTOOFAR
0021CB  3               
0021CB  3               ;------------------------------------------------
0021CB  3               ; Initiate fall check.
0021CB  3               ;------------------------------------------------
0021CB  3               
0021CB  3               ifall:
0021CB  3  A0 0D        	ldy #var_jumpLo
0021CD  3  B1 rr        	lda (z80_ix),y 			; jump pointer low.
0021CF  3  85 rr        	sta z80_l
0021D1  3  A0 0E        	ldy #var_jumpHi
0021D3  3  B1 rr        	lda (z80_ix),y 			; jump pointer high.
0021D5  3  85 rr        	sta z80_h			; high byte in accumulator.
0021D7  3  05 rr        	ora z80_l			; merge in low byte.
0021D9  3  F0 01        	beq :+
0021DB  3  60           	rts				; if either is set, we're already in the air.
0021DC  3               :
0021DC  3  A0 09        	ldy #9
0021DE  3  B1 rr        	lda (z80_ix),y			; y coordinate.
0021E0  3  85 rr        	sta dispx
0021E2  3               numsp7:
0021E2  3  A0 08        	ldy #8
0021E4  3  B1 rr        	lda (z80_ix),y			; look x coordinate.
0021E6  3  18           	clc
0021E7  3  69 10        	adc #16				; add 16 pixels.
0021E9  3  85 rr        	sta dispy			; set up test coordinates.
0021EB  3  20 C1 1B     	jsr tstbl			; get map address.
0021EE  3  20 60 1A     	jsr plchk			; block, platform check.
0021F1  3  F0 01        	beq :+
0021F3  3  60           	rts				; it's solid, don't fall.
0021F4  3               :
0021F4  3  E6 rr        	inc bufaddr			; look right one cell.
0021F6  3  20 60 1A     	jsr plchk			; block, platform check.
0021F9  3  F0 01        	beq :+
0021FB  3  60           	rts				; it's solid, don't fall.
0021FC  3               :
0021FC  3  A5 rr        	lda dispx			; y coordinate.
0021FE  3  29 07        	and #7				; position straddling block cells.
002200  3  F0 08        	beq ifalls			; no more checks needed.
002202  3  E6 rr        	inc bufaddr			; look to third cell.
002204  3  20 60 1A     	jsr plchk			; block, platform check.
002207  3  F0 01        	beq :+
002209  3  60           	rts				; it's solid, don't fall.
00220A  3               :
00220A  3               ifalls:
00220A  3  A9 0F        	lda #<jtab			; jump table start.
00220C  3  85 rr        	sta z80_l
00220E  3  A9 1C        	lda #>jtab
002210  3  85 rr        	sta z80_h
002212  3               ifal0:
002212  3  E6 rr        	inc z80_l			; point to next value.
002214  3  D0 02        	bne :+
002216  3  E6 rr        	inc z80_h
002218  3               :
002218  3  A0 00        	ldy #0
00221A  3  B1 rr        	lda (z80_hl),y			; fetch value.
00221C  3  F0 F4        	beq ifal0			; no, get next value.
00221E  3  C9 63        	cmp #99				; reached end of table?
002220  3  D0 01        	bne :+
002222  3  60           	rts				; yes, don't fall.
002223  3               :
002223  3  C9 80        	cmp #128			; is it going up?
002225  3  B0 EB        	bcs ifal0			; yes, looking for first movement down.
002227  3               
002227  3  A0 0D        	ldy #var_jumpLo
002229  3  A5 rr        	lda z80_l
00222B  3  91 rr        	sta (z80_ix),y 			; set jump low.
00222D  3  A0 0E        	ldy #var_jumpHi
00222F  3  A5 rr        	lda z80_h
002231  3  91 rr        	sta (z80_ix),y 			; set jump high.
002233  3  60           	rts
002234  3               
002234  3               
002234  3               ;----------------------------------------------------
002234  3               ; Get frame data for a particular sprite.
002234  3               ; Input:
002234  3               ;  a		= framenumer
002234  3               ; Output:
002234  3               ;  hl		= frame address
002234  3               ;
002234  3               ; global:	hl,frmptr
002234  3               ; local:	-
002234  3               ; calls:	-
002234  3               ;----------------------------------------------------
002234  3               
002234  3               gfrm:
002234  3  0A           	asl a	 		 	; multiple of 2.
002235  3  18           	clc
002236  3  6D C8 10     	adc frmptr 			; frames used by game.
002239  3  85 rr        	sta z80_l
00223B  3  AD C9 10     	lda frmptr+1
00223E  3  69 00        	adc #0
002240  3  85 rr        	sta z80_h 			; point to frame start.
002242  3  60           	rts
002243  3               
002243  3               ;----------------------------------------------------
002243  3               ; Find sprite list for current room.
002243  3               ;
002243  3               ; global:	hl
002243  3               ; local:	x,y
002243  3               ; calls:	-
002243  3               ;----------------------------------------------------
002243  3               
002243  3               sprlst:
002243  3  A9 9E        	lda #<nmedat 			; list of enemy sprites.
002245  3  85 rr        	sta z80_l
002247  3  A9 55        	lda #>nmedat
002249  3  85 rr        	sta z80_h
00224B  3  A6 rr        	ldx scno 			; screen number.
00224D  3  D0 01        	bne sprls2 			; is it the first screen?
00224F  3  60           	rts 				; yes, don't need to search data.
002250  3               sprls2:
002250  3  A0 00        	ldy #0
002252  3               sprls1:
002252  3  B1 rr        	lda (z80_hl),y 			; fetch type of sprite.
002254  3  C9 FF        	cmp #255			; is it an end marker?
002256  3  F0 0E        	beq sprls0 			; yes, end of this room.
002258  3               
002258  3  18           	clc 				; point to next sprite in list.
002259  3  A5 rr        	lda z80_l
00225B  3  69 04        	adc #NMESIZ
00225D  3  85 rr        	sta z80_l
00225F  3  90 02        	bcc :+
002261  3  E6 rr        	inc z80_h
002263  3               :
002263  3  4C 52 22     	jmp sprls1 			; continue until end of room.
002266  3               sprls0:
002266  3  E6 rr        	inc z80_l 			; point to start of next screen.s
002268  3  D0 02        	bne :+
00226A  3  E6 rr        	inc z80_h
00226C  3               :
00226C  3  CA           	dex
00226D  3  D0 E3        	bne sprls1 			; continue until room found.
00226F  3  60           	rts
002270  3               
002270  3               
002270  3               ;----------------------------------------------------
002270  3               ; Clear all but a single player sprite.
002270  3               ;
002270  3               ; global:	-
002270  3               ; local:	x,y,ix
002270  3               ; calls:	-
002270  3               ;----------------------------------------------------
002270  3               
002270  3               nspr:
002270  3  A9 0C        	lda #NUMSPR			; sprite slots in table.
002272  3  85 rr        	sta sprcnt
002274  3  A9 00        	lda #<sprtab 			; sprite table.
002276  3  85 rr        	sta z80_x
002278  3  A9 0B        	lda #>sprtab
00227A  3  85 rr        	sta z80_i
00227C  3               nspr0:
00227C  3  A0 00        	ldy #0 				; fetch sprite type.
00227E  3  B1 rr        	lda (z80_ix),y 			; is it a player?
002280  3  F0 1A        	beq nspr1 			; yes, keep this one.
002282  3               
002282  3  A9 FF        	lda #255
002284  3  A0 00        	ldy #0 				; fetch sprite type.
002286  3  91 rr        	sta (z80_ix),y 			; delete sprite.
002288  3  A0 05        	ldy #5
00228A  3  91 rr        	sta (z80_ix),y 			; remove next type.
00228C  3               
00228C  3  18           	clc	 			; next sprite.
00228D  3  A5 rr        	lda z80_x
00228F  3  69 11        	adc #TABSIZ 			; distance to next odd/even entry.
002291  3  85 rr        	sta z80_x
002293  3  90 02        	bcc :+
002295  3  E6 rr        	inc z80_i
002297  3               :
002297  3  C6 rr        	dec sprcnt	 			; one less space in the table.
002299  3  D0 E1        	bne nspr0
00229B  3  60           	rts
00229C  3               nspr1:
00229C  3  A9 FF        	lda #255
00229E  3  A0 00        	ldy #0
0022A0  3  91 rr        	sta (z80_ix),y 			; delete sprite.
0022A2  3               
0022A2  3  18           	clc	 			; point to next sprite.
0022A3  3  A5 rr        	lda z80_x
0022A5  3  69 11        	adc #TABSIZ 			; distance to next odd/even entry.
0022A7  3  85 rr        	sta z80_x
0022A9  3  90 02        	bcc :+
0022AB  3  E6 rr        	inc z80_i
0022AD  3               :
0022AD  3  C6 rr        	dec sprcnt	 			; one less to do.
0022AF  3  D0 01        	bne nspr2
0022B1  3  60           	rts
0022B2  3               nspr2:
0022B2  3  A9 FF        	lda #255
0022B4  3  A0 00        	ldy #0
0022B6  3  91 rr        	sta (z80_ix),y 			; delete sprite.
0022B8  3  A0 05        	ldy #5
0022BA  3  91 rr        	sta (z80_ix),y 			; remove next type.
0022BC  3               
0022BC  3  18           	clc	 			; next sprite.
0022BD  3  A5 rr        	lda z80_x
0022BF  3  69 11        	adc #TABSIZ 			; distance to next odd/even entry.
0022C1  3  85 rr        	sta z80_x
0022C3  3  90 02        	bcc :+
0022C5  3  E6 rr        	inc z80_i
0022C7  3               :
0022C7  3  C6 rr        	dec sprcnt	 			; one less space in table.
0022C9  3  D0 E7        	bne nspr2
0022CB  3  60           	rts
0022CC  3               
0022CC  3               ;----------------------------------------------------------
0022CC  3               ; Two initialisation routines.
0022CC  3               ; Initialise sprites - copy everything from list to table.
0022CC  3               ;
0022CC  3               ; global:	-
0022CC  3               ; local:	x,y,ix
0022CC  3               ; calls:	cpsp
0022CC  3               ;----------------------------------------------------------
0022CC  3               
0022CC  3               ispr:
0022CC  3  A9 0C        	lda #NUMSPR			; sprite slots in table.
0022CE  3  85 rr        	sta sprcnt
0022D0  3  A9 00        	lda #<sprtab			; sprite table.
0022D2  3  85 rr        	sta z80_x
0022D4  3  A9 0B        	lda #>sprtab
0022D6  3  85 rr        	sta z80_i
0022D8  3               ispr2:
0022D8  3  A0 00        	ldy #0
0022DA  3  B1 rr        	lda (z80_hl),y 			; fetch byte.
0022DC  3  C9 FF        	cmp #255 			; is it an end marker?
0022DE  3  D0 01        	bne :+
0022E0  3  60           	rts 				; yes, no more to do.
0022E1  3               :
0022E1  3               ispr1:
0022E1  3  A0 00        	ldy #0
0022E3  3  B1 rr        	lda (z80_ix),y 			; fetch sprite type.
0022E5  3  C9 FF        	cmp #255 			; is it enabled yet?
0022E7  3  D0 08        	bne ispr4			; yes, try another slot.
0022E9  3               
0022E9  3  A0 05        	ldy #5
0022EB  3  B1 rr        	lda (z80_ix),y		 	; next type.
0022ED  3  C9 FF        	cmp #255 			; is it enabled yet?
0022EF  3  F0 10        	beq ispr3 			; no, process this one.
0022F1  3               ispr4:
0022F1  3  18           	clc 				; next sprite.
0022F2  3  A5 rr        	lda z80_x
0022F4  3  69 11        	adc #TABSIZ		 	; distance to next odd/even entry.
0022F6  3  85 rr        	sta z80_x
0022F8  3  90 02        	bcc :+
0022FA  3  E6 rr        	inc z80_i
0022FC  3               :
0022FC  3  C6 rr        	dec sprcnt
0022FE  3  D0 E1        	bne ispr1 			; repeat for remaining sprites.
002300  3  60           	rts  				; no more room in table.
002301  3               ispr3:
002301  3  20 54 23     	jsr cpsp			; initialise a sprite.
002304  3  C6 rr        	dec sprcnt			; one less space in the table.
002306  3  D0 D0        	bne ispr2
002308  3  60           	rts
002309  3               
002309  3               
002309  3               ;-----------------------------------------------------------------------
002309  3               ; Initialise sprites - but not player, we're keeping the old one.
002309  3               ;
002309  3               ; global:	-
002309  3               ; local:	x,y,ix
002309  3               ; calls:	cpsp
002309  3               ;-----------------------------------------------------------------------
002309  3               
002309  3               kspr:
002309  3  A2 0C        	ldx #NUMSPR			; sprite slots in table.
00230B  3  A9 00        	lda #<sprtab 			; sprite table.
00230D  3  85 rr        	sta z80_x
00230F  3  A9 0B        	lda #>sprtab
002311  3  85 rr        	sta z80_i
002313  3               kspr2:
002313  3  A0 00        	ldy #0
002315  3  B1 rr        	lda (z80_hl),y 			; fetch byte.
002317  3  C9 FF        	cmp #255 			; is it an end marker?
002319  3  D0 01        	bne :+
00231B  3  60           	rts 				; yes, no more to do.
00231C  3               :
00231C  3  C9 00        	cmp #0
00231E  3  D0 0E        	bne kspr1 			; no, add to table as normal.
002320  3               
002320  3  18           	clc 				; next sprite.
002321  3  A5 rr        	lda z80_l
002323  3  69 04        	adc #NMESIZ		 	; distance to next odd/even entry.
002325  3  85 rr        	sta z80_l
002327  3  90 02        	bcc :+
002329  3  E6 rr        	inc z80_h
00232B  3               :
00232B  3  4C 13 23     	jmp kspr2
00232E  3               kspr1:
00232E  3  A0 00        	ldy #0 				; fetch sprite type.
002330  3  B1 rr        	lda (z80_ix),y
002332  3  C9 FF        	cmp #255 			; is it enabled yet?
002334  3  D0 08        	bne kspr4 			; yes, try another slot.
002336  3               
002336  3  A0 05        	ldy #5 				; next type.
002338  3  B1 rr        	lda (z80_ix),y
00233A  3  C9 FF        	cmp #255 			; is it enabled yet?
00233C  3  F0 0F        	beq kspr3 			; no, process this one.
00233E  3               kspr4:
00233E  3  18           	clc 				; next sprite.
00233F  3  A5 rr        	lda z80_x
002341  3  69 11        	adc #TABSIZ		 	; distance to next odd/even entry.
002343  3  85 rr        	sta z80_x
002345  3  90 02        	bcc :+
002347  3  E6 rr        	inc z80_i
002349  3               :
002349  3  CA           	dex	 			; repeat for remaining sprites.
00234A  3  D0 E2        	bne kspr1
00234C  3  60           	rts  				; no more room in table.
00234D  3               kspr3:
00234D  3  20 54 23     	jsr cpsp 			; copy sprite to table.
002350  3  CA           	dex	 			; one less space in the table.
002351  3  D0 C0        	bne kspr2
002353  3  60           	rts
002354  3               
002354  3               ;----------------------------------------------
002354  3               ; Copy sprite from list to table.
002354  3               ;
002354  3               ; global:	hl,ix
002354  3               ; local:	y
002354  3               ; calls:	evnt09
002354  3               ;----------------------------------------------
002354  3               
002354  3               cpsp:
002354  3  A0 00        	ldy #0					; fetch byte from table.
002356  3  B1 rr        	lda (z80_hl),y
002358  3               	; y=var_Type
002358  3  91 rr        	sta (z80_ix),y			; set up type.
00235A  3  A0 05        	ldy #var_newType
00235C  3  91 rr        	sta (z80_ix),y 			; set up type.
00235E  3               
00235E  3  E6 rr        	inc z80_l 				; move to next byte.
002360  3  D0 02        	bne :+
002362  3  E6 rr        	inc z80_h
002364  3               :
002364  3  A0 00        	ldy #0 					; fetch byte from table.
002366  3  B1 rr        	lda (z80_hl),y
002368  3  A0 06        	ldy #var_newImage
00236A  3  91 rr        	sta (z80_ix),y			; set up image.
00236C  3               
00236C  3  E6 rr        	inc z80_l 				; move to next byte.
00236E  3  D0 02        	bne :+
002370  3  E6 rr        	inc z80_h
002372  3               :
002372  3  A0 00        	ldy #0
002374  3  B1 rr        	lda (z80_hl),y 			; fetch byte from table.
002376  3  A0 08        	ldy #var_newY
002378  3  91 rr        	sta (z80_ix),y 			; set up coordinate.
00237A  3               
00237A  3  A9 C8        	lda #200 				; set initial coordinate off screen.
00237C  3  A0 03        	ldy #var_Y
00237E  3  91 rr        	sta (z80_ix),y
002380  3               
002380  3  E6 rr        	inc z80_l 				; move to next byte.
002382  3  D0 02        	bne :+
002384  3  E6 rr        	inc z80_h
002386  3               :
002386  3  A0 00        	ldy #0 					; fetch byte from table.
002388  3  B1 rr        	lda (z80_hl),y
00238A  3  A0 09        	ldy #var_newX
00238C  3  91 rr        	sta (z80_ix),y 			; set up coordinate.
00238E  3               
00238E  3  E6 rr        	inc z80_l 				; move to next byte.
002390  3  D0 02        	bne :+
002392  3  E6 rr        	inc z80_h
002394  3               :
002394  3  A9 00        	lda #0					; zeroes in accumulator.
002396  3  A0 07        	ldy #var_newFrame 		; reset frame number.
002398  3  91 rr        	sta (z80_ix),y
00239A  3  A0 0A        	ldy #var_Direction 		; reset direction.
00239C  3  91 rr        	sta (z80_ix),y
00239E  3  A0 0D        	ldy #var_jumpLo			; reset jump pointer low.
0023A0  3  91 rr        	sta (z80_ix),y
0023A2  3  A0 0E        	ldy #var_jumpHi	 		; reset jump pointer high.
0023A4  3  91 rr        	sta (z80_ix),y
0023A6  3               
0023A6  3  A9 FF        	lda #255 				; reset data pointer to auto-restore.
0023A8  3  A0 10        	ldy #var_dataHi
0023AA  3  91 rr        	sta (z80_ix),y
0023AC  3               evis0:
0023AC  3  A5 rr        	lda z80_i
0023AE  3  48           	pha
0023AF  3  A5 rr        	lda z80_x
0023B1  3  48           	pha
0023B2  3  A5 rr        	lda z80_h
0023B4  3  48           	pha
0023B5  3  A5 rr        	lda z80_l
0023B7  3  48           	pha
0023B8  3               
0023B8  3  20 69 29     	jsr evnt09 				; perform event.
0023BB  3               
0023BB  3  68           	pla
0023BC  3  85 rr        	sta z80_l
0023BE  3  68           	pla
0023BF  3  85 rr        	sta z80_h
0023C1  3  68           	pla
0023C2  3  85 rr        	sta z80_x
0023C4  3  68           	pla
0023C5  3  85 rr        	sta z80_i
0023C7  3               
0023C7  3  18           	clc
0023C8  3  A5 rr        	lda z80_x 			; distance to next odd/even entry.
0023CA  3  69 11        	adc #TABSIZ		 	; next sprite.
0023CC  3  85 rr        	sta z80_x
0023CE  3  90 02        	bcc :+
0023D0  3  E6 rr        	inc z80_i
0023D2  3               :
0023D2  3  60           	rts
0023D3  3               
0023D3  3               
0023D3  3               ;-------------------------------------
0023D3  3               ; Clear the play area window.
0023D3  3               ;-------------------------------------
0023D3  3               
0023D3  3               clw:
0023D3  3  AD BF 10     	lda wintop			; get coordinates of window.
0023D6  3  85 rr        	sta dispy			; put into dispx for calculation.
0023D8  3  AD C0 10     	lda winlft
0023DB  3  85 rr        	sta dispx
0023DD  3               
0023DD  3  AD C1 10     	lda winhgt			; height of window.
0023E0  3  85 rr        	sta rrow			; copy to b register.
0023E2  3               clw3:
0023E2  3  AD C2 10     	lda winwid 			; width of window.
0023E5  3  85 rr        	sta rcol
0023E7  3               clw2:
0023E7  3  20 F4 17     	jsr gprad 			; get print address.
0023EA  3  A9 00        	lda #0				; zero byte to write.
0023EC  3  A2 07        	ldx #7				; pixel height of each cell.
0023EE  3               clw1:
0023EE  3  BC AB 10     	ldy scrtab,x
0023F1  3  91 rr        	sta (scraddr),y 			; copy to screen.
0023F3  3  CA           	dex				; next screen row down.
0023F4  3  10 F8        	bpl clw1
0023F6  3               
0023F6  3  E6 rr        	inc dispx			; next column.
0023F8  3  C6 rr        	dec rcol			; one less to do.
0023FA  3  D0 EB        	bne clw2			; repeat for remaining columns.
0023FC  3               
0023FC  3  AD C0 10     	lda winlft			; get left edge.
0023FF  3  85 rr        	sta dispx 			; reset x.
002401  3  E6 rr        	inc dispy 			; next line down.
002403  3               
002403  3  C6 rr        	dec rrow
002405  3  D0 DB        	bne clw3			; repeat down the screen.
002407  3               
002407  3  AD BF 10     	lda wintop			; get coordinates of window.
00240A  3  85 rr        	sta chary			; put into display position.
00240C  3  AD C0 10     	lda winlft
00240F  3  85 rr        	sta charx
002411  3  60           	rts
002412  3               
002412  3               
002412  3               ;----------------------------------------------------------
002412  3               ; Effects code.
002412  3               ; Ticker routine is called 25 times per second.
002412  3               ;
002412  3               ; HL = txtscr = left text screen address
002412  3               ; DE = txtscr+txtwid-1 = right text screen address
002412  3               ; BC = txtpos = text scroller position
002412  3               ;
002412  3               ;----------------------------------------------------------
002412  3               
002412  3               .if sflag
002412  3               scrly:
002412  3               	rts
002412  3               	.word txtscr         	; get left screen address.
002412  3               	sta scr_l
002412  3               	lda txtscr+1
002412  3               	sta scr_l+1
002412  3               	sta scr_r+1
002412  3               
002412  3               	stx xtmp
002412  3               
002412  3               	clc         		; get right screen address.
002412  3               	lda scr_l
002412  3               	adc txtwid
002412  3               	sta scr_r
002412  3               	dec scr_r
002412  3               scrly1:
002412  3               	ldy txtwid		; set txtwide
002412  3               	dey
002412  3               	clc
002412  3               scrly0:
002412  3               	lda (scr_l),y		; scroll 1 line
002412  3               	rol a
002412  3               	sta (scr_l),y
002412  3               	dey
002412  3               	bpl scrly0
002412  3               
002412  3               	clc			; point to next line
002412  3               	lda scr_l
002412  3               	adc #32
002412  3               	sta scr_l
002412  3               	bcc scrly1		; repeat 8 times
002412  3               
002412  3               	lda txtpos 		; get text pointer.
002412  3               	sta scr_txt
002412  3               	lda txtpos+1
002412  3               	sta scr_txt+1
002412  3               
002412  3               	ldy #0
002412  3               	lda (scr_txt),y 		; find character we're displaying.
002412  3               	and #127 		; remove end marker bit if applicable.
002412  3               	cmp #ASCII_NEWLINE			; is it newline?
002412  3               	bne scrly5 		; no, it's okay.
002412  3               	lda #32			; convert to a space instead.
002412  3               scrly5:
002412  3               	sta fntaddr		; calculate char address
002412  3               	lda #0
002412  3               	sta fntaddr+1
002412  3               	asl fntaddr  		; multiply char by 8.
002412  3               	rol fntaddr+1
002412  3               	asl fntaddr
002412  3               	rol fntaddr+1
002412  3               	asl fntaddr
002412  3               	rol fntaddr+1
002412  3               	lda fntaddr
002412  3               	clc
002412  3               	adc FontPtr
002412  3               	sta scrly3+1		; that's the low byte.
002412  3               	lda fntaddr+1
002412  3               	adc FontPtr+1
002412  3               	sta scrly3+2		; add displacement.
002412  3               
002412  3               	ldx #0
002412  3               scrly3:
002412  3               	lda $3333,x		; get image of char line.
002412  3               	and txtbit
002412  3               	beq scrly2		; don't plot pixel
002412  3               	ldy scrline,x
002412  3               	lda (scr_r),y
002412  3               	clc
002412  3               	ora #1
002412  3               	sta (scr_r),y		; plot pixel
002412  3               scrly2:
002412  3               	inx			; next line of char.
002412  3               	cpx #8
002412  3               	bne scrly3
002412  3               
002412  3               	lsr txtbit		; bit of text to display.
002412  3               	bcs :+
002412  3               	rts
002412  3               :
002412  3               	ldy #0
002412  3               	lda (scr_txt),y 	; what was the character?
002412  3               	asl a	  		; end of message?
002412  3               	bcs scrly4
002412  3               	inc txtpos
002412  3               	bne :+
002412  3               	inc txtpos+1
002412  3               :
002412  3               	jmp scrly6 		; not yet - continue.
002412  3               scrly4:
002412  3               	lda txtini 		; start of scrolling message.
002412  3               	sta txtpos
002412  3               	lda txtini+1
002412  3               	sta txtpos+1
002412  3               scrly6:
002412  3               	lda #128
002412  3               	sta txtbit
002412  3               	ldx xtmp
002412  3               	rts
002412  3               
002412  3               scrline:	.byte $00,$20,$40,$60,$80,$a0,$c0,$e0
002412  3               
002412  3               ;-------------------------------------------------------
002412  3               ; Entry TICKER command
002412  3               ;
002412  3               ; Entry:
002412  3               ;  z80_b = message nr
002412  3               ;  z80_c = width
002412  3               ;-------------------------------------------------------
002412  3               
002412  3               iscrly:
002412  3               	jsr prescr 		; set up display position.
002412  3               
002412  3               	lda #<msgdat 		; text messages.
002412  3               	sta z80_l
002412  3               	lda #>msgdat
002412  3               	sta z80_h
002412  3               
002412  3               	lda z80_c 		; width.
002412  3               	sec
002412  3               	sbc #1			; subtract one.
002412  3               	cmp #32 		; is it between 1 and 32?
002412  3               	bcc :+
002412  3               	lda #$60
002412  3               	jmp iscrl0		; no, disable messages.
002412  3               :
002412  3               	ldx z80_b		; message number.
002412  3               	jsr getwrd 		; find message start.
002412  3               
002412  3               	lda z80_l		; set initial text position.
002412  3               	sta txtini
002412  3               	lda z80_h
002412  3               	sta txtini+1
002412  3               
002412  3               	lda #$ad		; code for lda adrr
002412  3               iscrl0:
002412  3               	sta scrly		; enable/disable scrolling routine.
002412  3               
002412  3               	jsr prescr 		; set up display position.
002412  3               	jsr gprad 		; get print address.
002412  3               
002412  3               	lda scraddr 		; set text screen address.
002412  3               	sta txtscr
002412  3               	lda scraddr+1
002412  3               	sta txtscr+1
002412  3               
002412  3               	lda z80_c		; width.
002412  3               	sta txtwid		; set width in working storage.
002412  3               
002412  3               	lda #128 		; start with leftmost bit.
002412  3               	sta txtbit
002412  3               
002412  3               	jmp scrly4
002412  3               .endif
002412  3               
002412  3               ;------------------------------------------------------------------
002412  3               ; Sprite table
002412  3               ;------------------------------------------------------------------
002412  3               
002412  3               
002412  3               ; ix+0  = type.
002412  3               ; ix+1  = sprite image number.
002412  3               ; ix+2  = frame.
002412  3               ; ix+3  = y coord.
002412  3               ; ix+4  = x coord.
002412  3               
002412  3               ; ix+5  = new type.
002412  3               ; ix+6  = new image number.
002412  3               ; ix+7  = new frame.
002412  3               ; ix+8  = new y coord.
002412  3               ; ix+9  = new x coord.
002412  3               
002412  3               ; ix+10 = direction.
002412  3               ; ix+11 = parameter 1.
002412  3               ; ix+12 = parameter 2.
002412  3               ; ix+13 = jump pointer low.
002412  3               ; ix+14 = jump pointer high.
002412  3               ; ix+15 = data pointer low.
002412  3               ; ix+16 = data pointer high.
002412  3               
002412  3               ; block NUMSPR * TABSIZ,255
002412  3               ; sprtab NUMSPR*TABSIZ,255
002412  3               
002412  3  FF FF FF FF  ssprit:	.byte 255,255,255,255,255,255,255,0,192,120,0,0,0,255,255,255,255
002416  3  FF FF FF 00  
00241A  3  C0 78 00 00  
002423  3  07           roomtb:	.byte 7                      ; start room map offset.
002424  3               
002424  3               ; User routine.  Put your own code in here to be called with USER instruction.
002424  3               ; if USER has an argument it will be passed in the accumulator.
002424  3               
002424  3               user:
002424  3  60           	rts
002425  3               
002425  3               ; Everything below here will be generated by the editors.
002425  3               
002425  3               script_start:
002425  3               
002425  3               WINDOWTOP = 1
002425  3               WINDOWLFT = 1
002425  3               WINDOWHGT = 22
002425  3               WINDOWWID = 30 ;
002425  3               MAPWID = 13
002425  3  FF FF FF FF          .byte 255,255,255,255,255,255,255,255,255,255,255,255,255
002429  3  FF FF FF FF  
00242D  3  FF FF FF FF  
002432  3               mapdat:
002432  3  FF 00 08 10          .byte 255,0,8,16,24,255,255,255,255,255,255,46,255,255,1,9,17,25,255,255,255,255,255,255,255,255,255,2,10,18,26,255,255,255,255,255,255,255,255,255,3,11,19,27,255,255,255,255,255,255,255,255,255,4,12,20,28,255,255,255,255,255,255,255,255,255,5,13,21,29,255,255,255,255,255,255,255,255,255,6,14,22,30,255,255,255,255,255,255,255,255,255,7,15,23,39,40,41,42,43,44,45,255,255
002436  3  18 FF FF FF  
00243A  3  FF FF FF 2E  
00249A  3  FF FF FF FF          .byte 255,255,255,255,255,255,255,255,255,255,255,255,255
00249E  3  FF FF FF FF  
0024A2  3  FF FF FF FF  
0024A7  3  01           stmap:  .byte 1
0024A8  3               
0024A8  3               evnt00:
0024A8  3  A9 00                lda #0
0024AA  3  C5 rr                cmp scno
0024AC  3  F0 03                beq *+5
0024AE  3  4C B9 24             jmp a00031
0024B1  3  A9 96                lda #150
0024B3  3  20 A5 0E             jsr delay
0024B6  3  20 25 21             jsr scrd
0024B9  3  20 A6 15     a00031: jsr skobj
0024BC  3  85 rr                sta varobj
0024BE  3  A9 FF                lda #255
0024C0  3  C5 rr                cmp varobj
0024C2  3  F0 03                beq *+5
0024C4  3  4C CA 24             jmp a00063
0024C7  3  4C E5 24             jmp a00116
0024CA  3  A5 rr        a00063: lda varobj
0024CC  3  20 25 15             jsr getob
0024CF  3  A9 64                lda #<100
0024D1  3  85 rr                sta z80_l
0024D3  3  A9 00                lda #>100
0024D5  3  85 rr                sta z80_h
0024D7  3  20 1B 17             jsr addsc
0024DA  3  A9 17                lda #23
0024DC  3  85 rr                sta chary
0024DE  3  A9 18                lda #24
0024E0  3  85 rr                sta charx
0024E2  3  20 CF 16             jsr dscor
0024E5  3  A5 rr        a00116: lda joyval
0024E7  3  29 01                and #1
0024E9  3  F0 03                beq :+
0024EB  3  4C 23 25             jmp a00249
0024EE  3               :
0024EE  3  20 15 1A             jsr cangr
0024F1  3  F0 03                beq :+
0024F3  3  4C 23 25             jmp a00249
0024F6  3               :
0024F6  3  A9 01                lda #1
0024F8  3  A0 06                ldy #6
0024FA  3  91 rr                sta (z80_ix),y
0024FC  3  A9 00                lda #0
0024FE  3  C5 rr                cmp vara
002500  3  F0 03                beq *+5
002502  3  4C 08 25             jmp a00186
002505  3                       ; lda #0
002505  3  20 DA 1F             jsr animsp
002508  3  A0 09        a00186: ldy #9
00250A  3  B1 rr                lda (z80_ix),y
00250C  3  18                   clc
00250D  3  69 02                adc #2
00250F  3  91 rr                sta (z80_ix),y
002511  3  A9 E6                lda #230
002513  3                       ; ldy #9
002513  3  D1 rr                cmp (z80_ix),y
002515  3  90 03                bcc *+5
002517  3  4C 23 25             jmp a00249
00251A  3  20 13 21             jsr scrr
00251D  3  A9 14                lda #20
00251F  3  A0 09                ldy #9
002521  3  91 rr                sta (z80_ix),y
002523  3  A5 rr        a00249: lda joyval
002525  3  29 02                and #2
002527  3  F0 03                beq :+
002529  3  4C 5F 25             jmp a00382
00252C  3               :
00252C  3  20 03 1A             jsr cangl
00252F  3  F0 03                beq :+
002531  3  4C 5F 25             jmp a00382
002534  3               :
002534  3  A9 00                lda #0
002536  3  A0 06                ldy #6
002538  3  91 rr                sta (z80_ix),y
00253A  3                       ; lda #0
00253A  3  C5 rr                cmp vara
00253C  3  F0 03                beq *+5
00253E  3  4C 44 25             jmp a00320
002541  3                       ; lda #0
002541  3  20 DA 1F             jsr animsp
002544  3  A0 09        a00320: ldy #9
002546  3  B1 rr                lda (z80_ix),y
002548  3  38                   sec
002549  3  E9 02                sbc #2
00254B  3  91 rr                sta (z80_ix),y
00254D  3  A9 0A                lda #10
00254F  3                       ; ldy #9
00254F  3  D1 rr                cmp (z80_ix),y
002551  3  B0 03                bcs *+5
002553  3  4C 5F 25             jmp a00382
002556  3  20 F8 20             jsr scrl
002559  3  A9 DC                lda #220
00255B  3  A0 09                ldy #9
00255D  3  91 rr                sta (z80_ix),y
00255F  3  A9 07        a00382: lda #7
002561  3  C5 rr                cmp scno
002563  3  F0 03                beq *+5
002565  3  4C A2 25             jmp a00506
002568  3  A5 rr                lda joyval
00256A  3  29 10                and #16
00256C  3  F0 03                beq :+
00256E  3  4C 74 25             jmp a00421
002571  3               :
002571  3  20 F7 1B             jsr jump
002574  3  20 CE 19     a00421: jsr cangd
002577  3  F0 03                beq :+
002579  3  4C 9F 25             jmp a00501
00257C  3               :
00257C  3  20 CB 21             jsr ifall
00257F  3  A9 97                lda #151
002581  3  A0 08                ldy #8
002583  3  D1 rr                cmp (z80_ix),y
002585  3  90 03                bcc *+5
002587  3  4C 9F 25             jmp a00501
00258A  3  20 CE 19             jsr cangd
00258D  3  F0 03                beq :+
00258F  3  4C 9F 25             jmp a00501
002592  3               :
002592  3  A9 08                lda #8
002594  3  85 rr                sta scno
002596  3  20 2E 21             jsr nwscr
002599  3  A9 14                lda #20
00259B  3  A0 08                ldy #8
00259D  3  91 rr                sta (z80_ix),y
00259F  3  4C 94 26     a00501: jmp a00963
0025A2  3  A9 0F        a00506: lda #15
0025A4  3  C5 rr                cmp scno
0025A6  3  F0 03                beq *+5
0025A8  3  4C E5 25             jmp a00630
0025AB  3  A5 rr                lda joyval
0025AD  3  29 10                and #16
0025AF  3  F0 03                beq :+
0025B1  3  4C B7 25             jmp a00545
0025B4  3               :
0025B4  3  20 F7 1B             jsr jump
0025B7  3  20 CE 19     a00545: jsr cangd
0025BA  3  F0 03                beq :+
0025BC  3  4C E2 25             jmp a00625
0025BF  3               :
0025BF  3  20 CB 21             jsr ifall
0025C2  3  A9 97                lda #151
0025C4  3  A0 08                ldy #8
0025C6  3  D1 rr                cmp (z80_ix),y
0025C8  3  90 03                bcc *+5
0025CA  3  4C E2 25             jmp a00625
0025CD  3  20 CE 19             jsr cangd
0025D0  3  F0 03                beq :+
0025D2  3  4C E2 25             jmp a00625
0025D5  3               :
0025D5  3  A9 10                lda #16
0025D7  3  85 rr                sta scno
0025D9  3  20 2E 21             jsr nwscr
0025DC  3  A9 14                lda #20
0025DE  3  A0 08                ldy #8
0025E0  3  91 rr                sta (z80_ix),y
0025E2  3  4C 94 26     a00625: jmp a00963
0025E5  3  A9 17        a00630: lda #23
0025E7  3  C5 rr                cmp scno
0025E9  3  F0 03                beq *+5
0025EB  3  4C 28 26             jmp a00754
0025EE  3  A5 rr                lda joyval
0025F0  3  29 10                and #16
0025F2  3  F0 03                beq :+
0025F4  3  4C FA 25             jmp a00669
0025F7  3               :
0025F7  3  20 F7 1B             jsr jump
0025FA  3  20 CE 19     a00669: jsr cangd
0025FD  3  F0 03                beq :+
0025FF  3  4C 25 26             jmp a00749
002602  3               :
002602  3  20 CB 21             jsr ifall
002605  3  A9 97                lda #151
002607  3  A0 08                ldy #8
002609  3  D1 rr                cmp (z80_ix),y
00260B  3  90 03                bcc *+5
00260D  3  4C 25 26             jmp a00749
002610  3  20 CE 19             jsr cangd
002613  3  F0 03                beq :+
002615  3  4C 25 26             jmp a00749
002618  3               :
002618  3  A9 18                lda #24
00261A  3  85 rr                sta scno
00261C  3  20 2E 21             jsr nwscr
00261F  3  A9 14                lda #20
002621  3  A0 08                ldy #8
002623  3  91 rr                sta (z80_ix),y
002625  3  4C 94 26     a00749: jmp a00963
002628  3  A9 9D        a00754: lda #157
00262A  3  A0 08                ldy #8
00262C  3  D1 rr                cmp (z80_ix),y
00262E  3  90 03                bcc *+5
002630  3  4C 44 26             jmp a00808
002633  3  20 CE 19             jsr cangd
002636  3  F0 03                beq :+
002638  3  4C 44 26             jmp a00808
00263B  3               :
00263B  3  20 25 21             jsr scrd
00263E  3  A9 14                lda #20
002640  3  A0 08                ldy #8
002642  3  91 rr                sta (z80_ix),y
002644  3  A5 rr        a00808: lda joyval
002646  3  29 10                and #16
002648  3  F0 03                beq :+
00264A  3  4C 50 26             jmp a00830
00264D  3               :
00264D  3  20 F7 1B             jsr jump
002650  3  20 CE 19     a00830: jsr cangd
002653  3  F0 03                beq :+
002655  3  4C 5B 26             jmp a00848
002658  3               :
002658  3  20 CB 21             jsr ifall
00265B  3  A9 05        a00848: lda #DEADLY
00265D  3  85 rr                sta z80_b
00265F  3  20 06 1B             jsr tded
002662  3  C5 rr                cmp z80_b
002664  3  F0 03                beq :+
002666  3  4C 6D 26             jmp a00883
002669  3               :
002669  3  A9 01                lda #1
00266B  3  85 rr                sta deadf
00266D  3  A9 2D        a00883: lda #45
00266F  3  C5 rr                cmp scno
002671  3  F0 03                beq *+5
002673  3  4C 94 26             jmp a00963
002676  3  A9 1E                lda #30
002678  3  A0 08                ldy #8
00267A  3  D1 rr                cmp (z80_ix),y
00267C  3  90 03                bcc *+5
00267E  3  4C 94 26             jmp a00963
002681  3  A9 BF                lda #191
002683  3  C8                   iny; ldy #9
002684  3  D1 rr                cmp (z80_ix),y
002686  3  90 03                bcc *+5
002688  3  4C 94 26             jmp a00963
00268B  3  A9 64                lda #100
00268D  3  20 A5 0E             jsr delay
002690  3  A9 01                lda #1
002692  3  85 rr                sta gamwon
002694  3  4C 41 21     a00963: jmp grav
002697  3               .out .sprintf("EVENT 0 SIZE = %d", (* - evnt00))
002697  3               
002697  3               evnt01:
002697  3  20 CE 19             jsr cangd
00269A  3  F0 03                beq :+
00269C  3  4C B7 26             jmp b00077
00269F  3               :
00269F  3  A9 00                lda #0
0026A1  3  20 DA 1F             jsr animsp
0026A4  3  A0 08                ldy #8
0026A6  3  B1 rr                lda (z80_ix),y
0026A8  3  18                   clc
0026A9  3  69 02                adc #2
0026AB  3  91 rr                sta (z80_ix),y
0026AD  3                       ; ldy #8
0026AD  3  B1 rr                lda (z80_ix),y
0026AF  3  18                   clc
0026B0  3  69 01                adc #1
0026B2  3                       ; ldy #8
0026B2  3  91 rr                sta (z80_ix),y
0026B4  3  4C ED 26             jmp b00210
0026B7  3  A9 FF        b00077: lda #255
0026B9  3  A0 05                ldy #5
0026BB  3  91 rr                sta (z80_ix),y
0026BD  3  A9 DC                lda #220
0026BF  3  85 rr                sta z80_d
0026C1  3  20 25 1C             jsr random
0026C4  3  85 rr                sta z80_h
0026C6  3  20 93 14             jsr imul
0026C9  3  A5 rr                lda z80_h
0026CB  3  85 rr                sta varrnd
0026CD  3  A5 rr                lda varrnd
0026CF  3  A0 09                ldy #9
0026D1  3  91 rr                sta (z80_ix),y
0026D3  3  A9 0A                lda #10
0026D5  3  88                   dey; ldy #8
0026D6  3  91 rr                sta (z80_ix),y
0026D8  3                       ; lda #10
0026D8  3  85 rr                sta z80_c
0026DA  3  C8                   iny; ldy #9
0026DB  3  B1 rr                lda (z80_ix),y
0026DD  3  18                   clc
0026DE  3  65 rr                adc z80_c
0026E0  3                       ; ldy #9
0026E0  3  91 rr                sta (z80_ix),y
0026E2  3  A9 01                lda #1
0026E4  3  85 rr                sta z80_c
0026E6  3  A9 04                lda #4
0026E8  3  85 rr                sta z80_b
0026EA  3  20 FF 15             jsr spawn
0026ED  3  A9 00        b00210: lda #0
0026EF  3  85 rr                sta z80_b
0026F1  3  20 25 20             jsr sktyp
0026F4  3  B0 03                bcs :+
0026F6  3  4C FD 26             jmp b00240
0026F9  3               :
0026F9  3  A9 01                lda #1
0026FB  3  85 rr                sta deadf
0026FD  3  60           b00240: rts
0026FE  3               .out .sprintf("EVENT 1 SIZE = %d", (* - evnt01))
0026FE  3               
0026FE  3               evnt02:
0026FE  3  A9 00                lda #0
002700  3  A0 0B                ldy #11
002702  3  D1 rr                cmp (z80_ix),y
002704  3  F0 03                beq *+5
002706  3  4C 4C 27             jmp c00181
002709  3  20 03 1A             jsr cangl
00270C  3  F0 03                beq :+
00270E  3  4C 43 27             jmp c00163
002711  3               :
002711  3  A0 09                ldy #9
002713  3  B1 rr                lda (z80_ix),y
002715  3  38                   sec
002716  3  E9 02                sbc #2
002718  3  91 rr                sta (z80_ix),y
00271A  3  A9 10                lda #16
00271C  3  85 rr                sta z80_c
00271E  3                       ; ldy #9
00271E  3  B1 rr                lda (z80_ix),y
002720  3  38                   sec
002721  3  E5 rr                sbc z80_c
002723  3                       ; ldy #9
002723  3  91 rr                sta (z80_ix),y
002725  3  20 CE 19             jsr cangd
002728  3  F0 03                beq :+
00272A  3  4C 33 27             jmp c00122
00272D  3               :
00272D  3  A9 01                lda #1
00272F  3  A0 0B                ldy #11
002731  3  91 rr                sta (z80_ix),y
002733  3  A9 10        c00122: lda #16
002735  3  85 rr                sta z80_c
002737  3  A0 09                ldy #9
002739  3  B1 rr                lda (z80_ix),y
00273B  3  18                   clc
00273C  3  65 rr                adc z80_c
00273E  3                       ; ldy #9
00273E  3  91 rr                sta (z80_ix),y
002740  3  4C 49 27             jmp c00176
002743  3  A9 01        c00163: lda #1
002745  3  A0 0B                ldy #11
002747  3  91 rr                sta (z80_ix),y
002749  3  4C 8C 27     c00176: jmp c00333
00274C  3  20 15 1A     c00181: jsr cangr
00274F  3  F0 03                beq :+
002751  3  4C 86 27             jmp c00320
002754  3               :
002754  3  A0 09                ldy #9
002756  3  B1 rr                lda (z80_ix),y
002758  3  18                   clc
002759  3  69 02                adc #2
00275B  3  91 rr                sta (z80_ix),y
00275D  3  A9 10                lda #16
00275F  3  85 rr                sta z80_c
002761  3                       ; ldy #9
002761  3  B1 rr                lda (z80_ix),y
002763  3  18                   clc
002764  3  65 rr                adc z80_c
002766  3                       ; ldy #9
002766  3  91 rr                sta (z80_ix),y
002768  3  20 CE 19             jsr cangd
00276B  3  F0 03                beq :+
00276D  3  4C 76 27             jmp c00279
002770  3               :
002770  3  A9 00                lda #0
002772  3  A0 0B                ldy #11
002774  3  91 rr                sta (z80_ix),y
002776  3  A9 10        c00279: lda #16
002778  3  85 rr                sta z80_c
00277A  3  A0 09                ldy #9
00277C  3  B1 rr                lda (z80_ix),y
00277E  3  38                   sec
00277F  3  E5 rr                sbc z80_c
002781  3                       ; ldy #9
002781  3  91 rr                sta (z80_ix),y
002783  3  4C 8C 27             jmp c00333
002786  3  A9 00        c00320: lda #0
002788  3  A0 0B                ldy #11
00278A  3  91 rr                sta (z80_ix),y
00278C  3  A9 01        c00333: lda #1
00278E  3  A0 0B                ldy #11
002790  3  D1 rr                cmp (z80_ix),y
002792  3  F0 03                beq *+5
002794  3  4C A6 27             jmp c00386
002797  3  A9 00                lda #0
002799  3  C5 rr                cmp vara
00279B  3  F0 03                beq *+5
00279D  3  4C A3 27             jmp c00381
0027A0  3                       ; lda #0
0027A0  3  20 DA 1F             jsr animsp
0027A3  3  4C B2 27     c00381: jmp c00412
0027A6  3  A9 00        c00386: lda #0
0027A8  3  C5 rr                cmp vara
0027AA  3  F0 03                beq *+5
0027AC  3  4C B2 27             jmp c00412
0027AF  3                       ; lda #0
0027AF  3  20 00 20             jsr animbk
0027B2  3  A9 00        c00412: lda #0
0027B4  3  85 rr                sta z80_b
0027B6  3  20 25 20             jsr sktyp
0027B9  3  B0 03                bcs :+
0027BB  3  4C C2 27             jmp c00442
0027BE  3               :
0027BE  3  A9 01                lda #1
0027C0  3  85 rr                sta deadf
0027C2  3  60           c00442: rts
0027C3  3               .out .sprintf("EVENT 2 SIZE = %d", (* - evnt02))
0027C3  3               
0027C3  3               evnt03:
0027C3  3  A9 2D                lda #45
0027C5  3  C5 rr                cmp scno
0027C7  3  F0 03                beq *+5
0027C9  3  4C 30 28             jmp d00247
0027CC  3  20 03 1A             jsr cangl
0027CF  3  F0 03                beq :+
0027D1  3  4C EC 27             jmp d00094
0027D4  3               :
0027D4  3  A9 00                lda #0
0027D6  3  20 DA 1F             jsr animsp
0027D9  3  A0 09                ldy #9
0027DB  3  B1 rr                lda (z80_ix),y
0027DD  3  38                   sec
0027DE  3  E9 02                sbc #2
0027E0  3  91 rr                sta (z80_ix),y
0027E2  3                       ; ldy #9
0027E2  3  B1 rr                lda (z80_ix),y
0027E4  3  38                   sec
0027E5  3  E9 01                sbc #1
0027E7  3                       ; ldy #9
0027E7  3  91 rr                sta (z80_ix),y
0027E9  3  4C 20 28             jmp d00217
0027EC  3  A9 FF        d00094: lda #255
0027EE  3  A0 05                ldy #5
0027F0  3  91 rr                sta (z80_ix),y
0027F2  3  A9 87                lda #135
0027F4  3  85 rr                sta z80_d
0027F6  3  20 25 1C             jsr random
0027F9  3  85 rr                sta z80_h
0027FB  3  20 93 14             jsr imul
0027FE  3  A5 rr                lda z80_h
002800  3  85 rr                sta varrnd
002802  3  A9 8C                lda #140
002804  3  A0 09                ldy #9
002806  3  91 rr                sta (z80_ix),y
002808  3  A5 rr                lda varrnd
00280A  3  88                   dey; ldy #8
00280B  3  91 rr                sta (z80_ix),y
00280D  3  C8                   iny; ldy #9
00280E  3  B1 rr                lda (z80_ix),y
002810  3  38                   sec
002811  3  E9 01                sbc #1
002813  3                       ; ldy #9
002813  3  91 rr                sta (z80_ix),y
002815  3  A9 03                lda #3
002817  3  85 rr                sta z80_c
002819  3  A9 06                lda #6
00281B  3  85 rr                sta z80_b
00281D  3  20 FF 15             jsr spawn
002820  3  A9 00        d00217: lda #0
002822  3  85 rr                sta z80_b
002824  3  20 25 20             jsr sktyp
002827  3  B0 03                bcs :+
002829  3  4C 30 28             jmp d00247
00282C  3               :
00282C  3  A9 01                lda #1
00282E  3  85 rr                sta deadf
002830  3  60           d00247: rts
002831  3               .out .sprintf("EVENT 3 SIZE = %d", (* - evnt03))
002831  3               
002831  3               evnt04:
002831  3  60                   rts
002832  3               .out .sprintf("EVENT 4 SIZE = %d", (* - evnt04))
002832  3               
002832  3               evnt05:
002832  3  20 03 1A             jsr cangl
002835  3  F0 03                beq :+
002837  3  4C 5A 28             jmp f00105
00283A  3               :
00283A  3  A9 00                lda #0
00283C  3  20 DA 1F             jsr animsp
00283F  3  A0 09                ldy #9
002841  3  B1 rr                lda (z80_ix),y
002843  3  38                   sec
002844  3  E9 02                sbc #2
002846  3  91 rr                sta (z80_ix),y
002848  3                       ; ldy #9
002848  3  B1 rr                lda (z80_ix),y
00284A  3  38                   sec
00284B  3  E9 01                sbc #1
00284D  3                       ; ldy #9
00284D  3  91 rr                sta (z80_ix),y
00284F  3  88                   dey; ldy #8
002850  3  B1 rr                lda (z80_ix),y
002852  3  18                   clc
002853  3  69 01                adc #1
002855  3                       ; ldy #8
002855  3  91 rr                sta (z80_ix),y
002857  3  4C 96 28             jmp f00255
00285A  3  A9 FF        f00105: lda #255
00285C  3  A0 05                ldy #5
00285E  3  91 rr                sta (z80_ix),y
002860  3  A9 87                lda #135
002862  3  85 rr                sta z80_d
002864  3  20 25 1C             jsr random
002867  3  85 rr                sta z80_h
002869  3  20 93 14             jsr imul
00286C  3  A5 rr                lda z80_h
00286E  3  85 rr                sta varrnd
002870  3  A9 DC                lda #220
002872  3  A0 09                ldy #9
002874  3  91 rr                sta (z80_ix),y
002876  3  A5 rr                lda varrnd
002878  3  88                   dey; ldy #8
002879  3  91 rr                sta (z80_ix),y
00287B  3  C8                   iny; ldy #9
00287C  3  B1 rr                lda (z80_ix),y
00287E  3  38                   sec
00287F  3  E9 01                sbc #1
002881  3                       ; ldy #9
002881  3  91 rr                sta (z80_ix),y
002883  3  88                   dey; ldy #8
002884  3  B1 rr                lda (z80_ix),y
002886  3  18                   clc
002887  3  69 01                adc #1
002889  3                       ; ldy #8
002889  3  91 rr                sta (z80_ix),y
00288B  3  A9 05                lda #5
00288D  3  85 rr                sta z80_c
00288F  3  A9 06                lda #6
002891  3  85 rr                sta z80_b
002893  3  20 FF 15             jsr spawn
002896  3  A9 00        f00255: lda #0
002898  3  85 rr                sta z80_b
00289A  3  20 25 20             jsr sktyp
00289D  3  B0 03                bcs :+
00289F  3  4C A6 28             jmp f00285
0028A2  3               :
0028A2  3  A9 01                lda #1
0028A4  3  85 rr                sta deadf
0028A6  3  60           f00285: rts
0028A7  3               .out .sprintf("EVENT 5 SIZE = %d", (* - evnt05))
0028A7  3               
0028A7  3               evnt06:
0028A7  3  60                   rts
0028A8  3               .out .sprintf("EVENT 6 SIZE = %d", (* - evnt06))
0028A8  3               
0028A8  3               evnt07:
0028A8  3  A9 00                lda #0
0028AA  3  A0 0B                ldy #11
0028AC  3  D1 rr                cmp (z80_ix),y
0028AE  3  F0 03                beq *+5
0028B0  3  4C D0 28             jmp h00082
0028B3  3  20 03 1A             jsr cangl
0028B6  3  F0 03                beq :+
0028B8  3  4C C7 28             jmp h00064
0028BB  3               :
0028BB  3  A0 09                ldy #9
0028BD  3  B1 rr                lda (z80_ix),y
0028BF  3  38                   sec
0028C0  3  E9 02                sbc #2
0028C2  3  91 rr                sta (z80_ix),y
0028C4  3  4C CD 28             jmp h00078
0028C7  3  A9 01        h00064: lda #1
0028C9  3  A0 0B                ldy #11
0028CB  3  91 rr                sta (z80_ix),y
0028CD  3  4C EA 28     h00078: jmp h00136
0028D0  3  20 15 1A     h00082: jsr cangr
0028D3  3  F0 03                beq :+
0028D5  3  4C E4 28             jmp h00123
0028D8  3               :
0028D8  3  A0 09                ldy #9
0028DA  3  B1 rr                lda (z80_ix),y
0028DC  3  18                   clc
0028DD  3  69 02                adc #2
0028DF  3  91 rr                sta (z80_ix),y
0028E1  3  4C EA 28             jmp h00136
0028E4  3  A9 00        h00123: lda #0
0028E6  3  A0 0B                ldy #11
0028E8  3  91 rr                sta (z80_ix),y
0028EA  3  A9 00        h00136: lda #0
0028EC  3  A0 0A                ldy #10
0028EE  3  D1 rr                cmp (z80_ix),y
0028F0  3  F0 03                beq *+5
0028F2  3  4C 12 29             jmp h00217
0028F5  3  20 99 19             jsr cangu
0028F8  3  F0 03                beq :+
0028FA  3  4C 09 29             jmp h00199
0028FD  3               :
0028FD  3  A0 08                ldy #8
0028FF  3  B1 rr                lda (z80_ix),y
002901  3  38                   sec
002902  3  E9 02                sbc #2
002904  3  91 rr                sta (z80_ix),y
002906  3  4C 0F 29             jmp h00212
002909  3  A9 01        h00199: lda #1
00290B  3  A0 0A                ldy #10
00290D  3  91 rr                sta (z80_ix),y
00290F  3  4C 31 29     h00212: jmp h00279
002912  3  20 CE 19     h00217: jsr cangd
002915  3  F0 03                beq :+
002917  3  4C 2B 29             jmp h00266
00291A  3               :
00291A  3  A0 08                ldy #8
00291C  3  B1 rr                lda (z80_ix),y
00291E  3  18                   clc
00291F  3  69 02                adc #2
002921  3  91 rr                sta (z80_ix),y
002923  3  A9 00                lda #0
002925  3  20 DA 1F             jsr animsp
002928  3  4C 31 29             jmp h00279
00292B  3  A9 00        h00266: lda #0
00292D  3  A0 0A                ldy #10
00292F  3  91 rr                sta (z80_ix),y
002931  3  A9 00        h00279: lda #0
002933  3  85 rr                sta z80_b
002935  3  20 25 20             jsr sktyp
002938  3  B0 03                bcs :+
00293A  3  4C 41 29             jmp h00309
00293D  3               :
00293D  3  A9 01                lda #1
00293F  3  85 rr                sta deadf
002941  3  60           h00309: rts
002942  3               .out .sprintf("EVENT 7 SIZE = %d", (* - evnt07))
002942  3               
002942  3               evnt08:
002942  3  A9 00                lda #0
002944  3  85 rr                sta z80_b
002946  3  20 25 20             jsr sktyp
002949  3  B0 03                bcs :+
00294B  3  4C 68 29             jmp i00080
00294E  3               :
00294E  3  A5 rr                lda numlif
002950  3  18                   clc
002951  3  69 01                adc #1
002953  3  85 rr                sta numlif
002955  3  A9 17                lda #23
002957  3  85 rr                sta chary
002959  3  A9 08                lda #8
00295B  3  85 rr                sta charx
00295D  3  A5 rr                lda numlif
00295F  3  20 B5 20             jsr disply
002962  3  A9 FF                lda #255
002964  3  A0 05                ldy #5
002966  3  91 rr                sta (z80_ix),y
002968  3  60           i00080: rts
002969  3               .out .sprintf("EVENT 8 SIZE = %d", (* - evnt08))
002969  3               
002969  3               evnt09:
002969  3  60                   rts
00296A  3               .out .sprintf("EVENT 9 SIZE = %d", (* - evnt09))
00296A  3               
00296A  3               evnt10:
00296A  3  A9 01                lda #1
00296C  3  C5 rr                cmp vara
00296E  3  F0 03                beq *+5
002970  3  4C 7A 29             jmp k00031
002973  3  A9 00                lda #0
002975  3  85 rr                sta vara
002977  3  4C 81 29             jmp k00046
00297A  3  A5 rr        k00031: lda vara
00297C  3  18                   clc
00297D  3  69 01                adc #1
00297F  3  85 rr                sta vara
002981  3  60           k00046: rts
002982  3               .out .sprintf("EVENT 10 SIZE = %d", (* - evnt10))
002982  3               
002982  3               evnt11:
002982  3  A5 rr                lda vare
002984  3  38                   sec
002985  3  E9 01                sbc #1
002987  3  85 rr                sta vare
002989  3  60                   rts
00298A  3               .out .sprintf("EVENT 11 SIZE = %d", (* - evnt11))
00298A  3               
00298A  3               evnt12:
00298A  3  20 4A 11             jsr cls
00298D  3  A9 03                lda #3
00298F  3  85 rr                sta chary
002991  3  A9 0C                lda #12
002993  3  85 rr                sta charx
002995  3  A9 05                lda #5
002997  3  20 6E 1C             jsr dmsg
00299A  3  A9 06                lda #6
00299C  3  85 rr                sta chary
00299E  3  A9 03                lda #3
0029A0  3  85 rr                sta charx
0029A2  3  A9 06                lda #6
0029A4  3  20 6E 1C             jsr dmsg
0029A7  3  A9 08                lda #8
0029A9  3  85 rr                sta chary
0029AB  3  A9 0A                lda #10
0029AD  3  85 rr                sta charx
0029AF  3  A9 07                lda #7
0029B1  3  20 6E 1C             jsr dmsg
0029B4  3  A9 0A                lda #10
0029B6  3  85 rr                sta chary
0029B8  3                       ; lda #10
0029B8  3  85 rr                sta charx
0029BA  3  A9 08                lda #8
0029BC  3  20 6E 1C             jsr dmsg
0029BF  3  A9 0F                lda #15
0029C1  3  85 rr                sta chary
0029C3  3  A9 00                lda #0
0029C5  3  85 rr                sta charx
0029C7  3  A9 03                lda #3
0029C9  3  20 6E 1C             jsr dmsg
0029CC  3  A9 03                lda #3
0029CE  3  C5 rr                cmp vare
0029D0  3  F0 03                beq *+5
0029D2  3  4C DB 29             jmp m00156
0029D5  3  20 67 0E             jsr prskey
0029D8  3  4C E2 29             jmp m00169
0029DB  3  20 67 0E     m00156: jsr prskey
0029DE  3  A9 03                lda #3
0029E0  3  85 rr                sta vare
0029E2  3  60           m00169: rts
0029E3  3               .out .sprintf("EVENT 12 SIZE = %d", (* - evnt12))
0029E3  3               
0029E3  3               evnt13:
0029E3  3  A9 0A                lda #10
0029E5  3  85 rr                sta numlif
0029E7  3  20 4A 11             jsr cls
0029EA  3  A9 00                lda #0
0029EC  3  85 rr                sta vara
0029EE  3  A9 17                lda #23
0029F0  3  85 rr                sta chary
0029F2  3  A9 02                lda #2
0029F4  3  85 rr                sta charx
0029F6  3  A9 01                lda #1
0029F8  3  20 6E 1C             jsr dmsg
0029FB  3  A9 17                lda #23
0029FD  3  85 rr                sta chary
0029FF  3  A9 08                lda #8
002A01  3  85 rr                sta charx
002A03  3  A5 rr                lda numlif
002A05  3  20 B5 20             jsr disply
002A08  3  A9 17                lda #23
002A0A  3  85 rr                sta chary
002A0C  3  A9 12                lda #18
002A0E  3  85 rr                sta charx
002A10  3  A9 02                lda #2
002A12  3  20 6E 1C             jsr dmsg
002A15  3  A9 17                lda #23
002A17  3  85 rr                sta chary
002A19  3  A9 18                lda #24
002A1B  3  85 rr                sta charx
002A1D  3  20 CF 16             jsr dscor
002A20  3  60                   rts
002A21  3               .out .sprintf("EVENT 13 SIZE = %d", (* - evnt13))
002A21  3               
002A21  3               evnt14:
002A21  3  60                   rts
002A22  3               .out .sprintf("EVENT 14 SIZE = %d", (* - evnt14))
002A22  3               
002A22  3               evnt15:
002A22  3  60                   rts
002A23  3               .out .sprintf("EVENT 15 SIZE = %d", (* - evnt15))
002A23  3               
002A23  3               evnt16:
002A23  3  A9 17                lda #23
002A25  3  85 rr                sta chary
002A27  3  A9 08                lda #8
002A29  3  85 rr                sta charx
002A2B  3  20 4A 11             jsr cls
002A2E  3  A9 17                lda #23
002A30  3  85 rr                sta chary
002A32  3  A9 02                lda #2
002A34  3  85 rr                sta charx
002A36  3  A9 01                lda #1
002A38  3  20 6E 1C             jsr dmsg
002A3B  3  A5 rr                lda numlif
002A3D  3  38                   sec
002A3E  3  E9 01                sbc #1
002A40  3  85 rr                sta numlif
002A42  3  A9 17                lda #23
002A44  3  85 rr                sta chary
002A46  3  A9 08                lda #8
002A48  3  85 rr                sta charx
002A4A  3  A5 rr                lda numlif
002A4C  3  20 B5 20             jsr disply
002A4F  3  A9 17                lda #23
002A51  3  85 rr                sta chary
002A53  3  A9 12                lda #18
002A55  3  85 rr                sta charx
002A57  3  A9 02                lda #2
002A59  3  20 6E 1C             jsr dmsg
002A5C  3  A9 17                lda #23
002A5E  3  85 rr                sta chary
002A60  3  A9 18                lda #24
002A62  3  85 rr                sta charx
002A64  3  20 CF 16             jsr dscor
002A67  3  60                   rts
002A68  3               .out .sprintf("EVENT 16 SIZE = %d", (* - evnt16))
002A68  3               
002A68  3               evnt17:
002A68  3  20 4A 11             jsr cls
002A6B  3  A9 00                lda #0
002A6D  3  85 rr                sta chary
002A6F  3                       ; lda #0
002A6F  3  85 rr                sta charx
002A71  3  A9 0C                lda #12
002A73  3  20 6E 1C             jsr dmsg
002A76  3  A9 12                lda #18
002A78  3  85 rr                sta chary
002A7A  3  A9 0A                lda #10
002A7C  3  85 rr                sta charx
002A7E  3  A9 02                lda #2
002A80  3  20 6E 1C             jsr dmsg
002A83  3  A9 12                lda #18
002A85  3  85 rr                sta chary
002A87  3  A9 10                lda #16
002A89  3  85 rr                sta charx
002A8B  3  20 CF 16             jsr dscor
002A8E  3  20 67 0E             jsr prskey
002A91  3  60                   rts
002A92  3               .out .sprintf("EVENT 17 SIZE = %d", (* - evnt17))
002A92  3               
002A92  3               evnt18:
002A92  3  20 4A 11             jsr cls
002A95  3  A9 01                lda #1
002A97  3  85 rr                sta chary
002A99  3  A9 00                lda #0
002A9B  3  85 rr                sta charx
002A9D  3  A9 0A                lda #10
002A9F  3  20 6E 1C             jsr dmsg
002AA2  3  A9 13                lda #19
002AA4  3  85 rr                sta chary
002AA6  3  A9 09                lda #9
002AA8  3  85 rr                sta charx
002AAA  3  A9 02                lda #2
002AAC  3  20 6E 1C             jsr dmsg
002AAF  3  A9 13                lda #19
002AB1  3  85 rr                sta chary
002AB3  3  A9 10                lda #16
002AB5  3  85 rr                sta charx
002AB7  3  20 CF 16             jsr dscor
002ABA  3  20 67 0E             jsr prskey
002ABD  3  60                   rts
002ABE  3               .out .sprintf("EVENT 18 SIZE = %d", (* - evnt18))
002ABE  3               
002ABE  3               evnt19:
002ABE  3  60                   rts
002ABF  3               .out .sprintf("EVENT 19 SIZE = %d", (* - evnt19))
002ABF  3               
002ABF  3               evnt20:
002ABF  3  60                   rts
002AC0  3               .out .sprintf("EVENT 20 SIZE = %d", (* - evnt20))
002AC0  3               
002AC0  3  60           ptcusr: rts
002AC1  3               script_end:
002AC1  3               
002AC1  3               .out .sprintf("TOTAL SCRIPT SIZE = %d", (* - script_start))
002AC1  3               
002AC1  3               data_start:
002AC1  3               msgdat:
002AC1  3  47 41 4D 45          .byte "GAME OVER",141
002AC5  3  20 4F 56 45  
002AC9  3  52 8D        
002ACB  3  4C 49 56 45          .byte "LIVES",141
002ACF  3  53 8D        
002AD1  3  53 43 4F 52          .byte "SCORE",141
002AD5  3  45 8D        
002AD7  3  20 20 20 20          .byte "           BY DAZMAN",13
002ADB  3  20 20 20 20  
002ADF  3  20 20 20 42  
002AEC  3  20 20 20 20          .byte "       ",13
002AF0  3  20 20 20 0D  
002AF4  3  20 20 20 20          .byte "        HAPPY HALLOWEEN",13
002AF8  3  20 20 20 20  
002AFC  3  48 41 50 50  
002B0C  3  8D                   .byte 141
002B0D  3  53 50 41 52          .byte "SPARE",141
002B11  3  45 8D        
002B13  3  4F 50 54 49          .byte "OPTIONS",141
002B17  3  4F 4E 53 8D  
002B1B  3  31 3A 20 4B          .byte "1: KEYBOARD Q,A,O,P,SPACE",141
002B1F  3  45 59 42 4F  
002B23  3  41 52 44 20  
002B35  3  32 3A 20 4B          .byte "2: KEMPSTON",141
002B39  3  45 4D 50 53  
002B3D  3  54 4F 4E 8D  
002B41  3  33 3A 20 53          .byte "3: SINCLAIR",141
002B45  3  49 4E 43 4C  
002B49  3  41 49 52 8D  
002B4D  3  30 20 50 4C          .byte "0 PLAY GAME",141
002B51  3  41 59 20 47  
002B55  3  41 4D 45 8D  
002B59  3  0D                   .byte 13
002B5A  3  20 20 20 20          .byte "           WELL DONE",13
002B5E  3  20 20 20 20  
002B62  3  20 20 20 57  
002B6F  3  0D                   .byte 13
002B70  3  20 20 20 20          .byte "        HELPING BRITTLE",13
002B74  3  20 20 20 20  
002B78  3  48 45 4C 50  
002B88  3  0D                   .byte 13
002B89  3  20 20 20 20          .byte "       COMPLETE THE TASK",13
002B8D  3  20 20 20 43  
002B91  3  4F 4D 50 4C  
002BA2  3  0D                   .byte 13
002BA3  3  20 20 20 20          .byte "     PUMPKIN MASTER IS DEAD",13
002BA7  3  20 50 55 4D  
002BAB  3  50 4B 49 4E  
002BBF  3  0D                   .byte 13
002BC0  3  20 20 20 20          .byte "              AND",13
002BC4  3  20 20 20 20  
002BC8  3  20 20 20 20  
002BD2  3  0D                   .byte 13
002BD3  3  20 20 48 41          .byte "  HALLOWEEN IS SAFE ONCE AGAIN",13
002BD7  3  4C 4C 4F 57  
002BDB  3  45 45 4E 20  
002BF2  3  0D                   .byte 13
002BF3  3  0D                   .byte 13
002BF4  3  20 20 20 20          .byte "        HAPPY HALLOWEEN",141
002BF8  3  20 20 20 20  
002BFC  3  48 41 50 50  
002C0C  3  54 49 4D 45          .byte "TIME",141
002C10  3  8D           
002C11  3  0D                   .byte 13
002C12  3  0D                   .byte 13
002C13  3  0D                   .byte 13
002C14  3  0D                   .byte 13
002C15  3  0D                   .byte 13
002C16  3  20 20 20 20          .byte "            BAD LUCK",13
002C1A  3  20 20 20 20  
002C1E  3  20 20 20 20  
002C2B  3  0D                   .byte 13
002C2C  3  20 20 20 20          .byte "         BRITTLE FAILED",13
002C30  3  20 20 20 20  
002C34  3  20 42 52 49  
002C44  3  0D                   .byte 13
002C45  3  20 20 20 20          .byte "    THE PUMPKIN MASTER WINS",13
002C49  3  54 48 45 20  
002C4D  3  50 55 4D 50  
002C61  3  0D                   .byte 13
002C62  3  20 20 20 20          .byte "           THIS TIME",13
002C66  3  20 20 20 20  
002C6A  3  20 20 20 54  
002C77  3  0D                   .byte 13
002C78  3  0D                   .byte 13
002C79  3  20 20 20 20          .byte "             HA HA",13
002C7D  3  20 20 20 20  
002C81  3  20 20 20 20  
002C8C  3  8D                   .byte 141
002C8D  3               nummsg:
002C8D  3  0D                   .byte 13
002C8E  3               .out .sprintf("MESSAGE SIZE = %d", (* - msgdat))
002C8E  3               
002C8E  3               chgfx:
002C8E  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0
002C92  3  00 00 00 00  
002C96  3  B5 AA FA 76          .byte 181,170,250,118,150,250,95,77
002C9A  3  96 FA 5F 4D  
002C9E  3  00 FF D5 FF          .byte 0,255,213,255,155,147,1,17
002CA2  3  9B 93 01 11  
002CA6  3  FF 49 02 A5          .byte 255,73,2,165,16,66,137,36
002CAA  3  10 42 89 24  
002CAE  3  FC 4A 02 A1          .byte 252,74,2,161,21,66,138,37
002CB2  3  15 42 8A 25  
002CB6  3  3F 66 49 95          .byte 63,102,73,149,68,82,137,84
002CBA  3  44 52 89 54  
002CBE  3  B5 6B 5A 6D          .byte 181,107,90,109,106,91,236,169
002CC2  3  6A 5B EC A9  
002CC6  3  00 00 18 3C          .byte 0,0,24,60,60,24,0,0
002CCA  3  3C 18 00 00  
002CCE  3  00 FF D5 FF          .byte 0,255,213,255,187,147,129,255
002CD2  3  BB 93 81 FF  
002CD6  3  20 44 08 81          .byte 32,68,8,129,4,64,145,8
002CDA  3  04 40 91 08  
002CDE  3  55 AA 55 AA          .byte 85,170,85,170,85,170,85,170
002CE2  3  55 AA 55 AA  
002CE6  3  18 0C 06 FF          .byte 24,12,6,255,255,6,12,24
002CEA  3  FF 06 0C 18  
002CEE  3  76 6D EB A7          .byte 118,109,235,167,205,161,24,118
002CF2  3  CD A1 18 76  
002CF6  3  DA DA AA AB          .byte 218,218,170,171,173,85,85,85
002CFA  3  AD 55 55 55  
002CFE  3  00 04 84 94          .byte 0,4,132,148,134,87,95,222
002D02  3  86 57 5F DE  
002D06  3  DE DE 6F 6B          .byte 222,222,111,107,105,57,57,57
002D0A  3  69 39 39 39  
002D0E  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0
002D12  3  00 00 00 00  
002D16  3  00 00 00 AA          .byte 0,0,0,170,170,0,0,0
002D1A  3  AA 00 00 00  
002D1E  3  00 00 00 AA          .byte 0,0,0,170,170,0,0,0
002D22  3  AA 00 00 00  
002D26  3  00 00 00 AA          .byte 0,0,0,170,170,0,0,0
002D2A  3  AA 00 00 00  
002D2E  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0
002D32  3  00 00 00 00  
002D36  3  FF FF FF FF          .byte 255,255,255,255,255,255,255,255
002D3A  3  FF FF FF FF  
002D3E  3  7F 7F 3F 3F          .byte 127,127,63,63,31,15,7,1
002D42  3  1F 0F 07 01  
002D46  3  01 07 0F 1F          .byte 1,7,15,31,63,63,127,127
002D4A  3  3F 3F 7F 7F  
002D4E  3  00 00 10 00          .byte 0,0,16,0,0,0,0,0
002D52  3  00 00 00 00  
002D56  3  00 00 00 00          .byte 0,0,0,0,8,0,0,0
002D5A  3  08 00 00 00  
002D5E  3  36 0D 01 05          .byte 54,13,1,5,0,3,1,0
002D62  3  00 03 01 00  
002D66  3  6C A0 80 A0          .byte 108,160,128,160,0,192,128,0
002D6A  3  00 C0 80 00  
002D6E  3               bprop:
002D6E  3  00                   .byte 0
002D6F  3  02                   .byte 2
002D70  3  02                   .byte 2
002D71  3  01                   .byte 1
002D72  3  01                   .byte 1
002D73  3  01                   .byte 1
002D74  3  02                   .byte 2
002D75  3  02                   .byte 2
002D76  3  02                   .byte 2
002D77  3  02                   .byte 2
002D78  3  02                   .byte 2
002D79  3  02                   .byte 2
002D7A  3  02                   .byte 2
002D7B  3  02                   .byte 2
002D7C  3  05                   .byte 5
002D7D  3  00                   .byte 0
002D7E  3  00                   .byte 0
002D7F  3  00                   .byte 0
002D80  3  00                   .byte 0
002D81  3  00                   .byte 0
002D82  3  05                   .byte 5
002D83  3  00                   .byte 0
002D84  3  00                   .byte 0
002D85  3  00                   .byte 0
002D86  3  00                   .byte 0
002D87  3  00                   .byte 0
002D88  3  02                   .byte 2
002D89  3  02                   .byte 2
002D8A  3               .out .sprintf("BLOCKS SIZE = %d", (* - chgfx))
002D8A  3               
002D8A  3               sprgfx:
002D8A  3  1F 80 29 C0          .byte 31,128,41,192,8,192,8,192,63,128,20,0,1,32,14,16,0,80,7,144,10,96,8,96,0,128,2,128,0,64,5,192
002D8E  3  08 C0 08 C0  
002D92  3  3F 80 14 00  
002DAA  3  07 E0 0A 70          .byte 7,224,10,112,2,48,2,48,15,224,5,0,0,72,3,132,0,20,1,228,2,152,2,24,0,32,0,160,0,16,1,112
002DAE  3  02 30 02 30  
002DB2  3  0F E0 05 00  
002DCA  3  01 F8 02 9C          .byte 1,248,2,156,0,140,0,140,3,248,1,64,0,18,0,225,0,5,0,121,0,166,0,134,0,8,0,40,0,4,0,92
002DCE  3  00 8C 00 8C  
002DD2  3  03 F8 01 40  
002DEA  3  00 7E 00 A7          .byte 0,126,0,167,0,35,0,35,0,254,0,80,128,4,64,56,64,1,64,30,128,41,128,33,0,2,0,10,0,1,0,23
002DEE  3  00 23 00 23  
002DF2  3  00 FE 00 50  
002E0A  3  1F 80 29 C0          .byte 31,128,41,192,8,192,8,192,63,128,20,0,1,32,14,16,0,72,55,136,50,56,3,48,4,0,36,32,24,16,8,96
002E0E  3  08 C0 08 C0  
002E12  3  3F 80 14 00  
002E2A  3  07 E0 0A 70          .byte 7,224,10,112,2,48,2,48,15,224,5,0,0,72,3,132,0,18,13,226,12,142,0,204,1,0,9,8,6,4,2,24
002E2E  3  02 30 02 30  
002E32  3  0F E0 05 00  
002E4A  3  01 F8 02 9C          .byte 1,248,2,156,0,140,0,140,3,248,1,64,0,18,0,225,128,4,131,120,131,35,0,51,0,64,2,66,1,129,0,134
002E4E  3  00 8C 00 8C  
002E52  3  03 F8 01 40  
002E6A  3  00 7E 00 A7          .byte 0,126,0,167,0,35,0,35,0,254,0,80,128,4,64,56,32,1,32,222,224,200,192,12,0,16,128,144,64,96,128,33
002E6E  3  00 23 00 23  
002E72  3  00 FE 00 50  
002E8A  3  1F 80 29 C0          .byte 31,128,41,192,8,192,8,192,63,128,20,0,1,64,14,32,0,160,15,32,20,192,16,192,1,0,5,0,0,128,11,128
002E8E  3  08 C0 08 C0  
002E92  3  3F 80 14 00  
002EAA  3  07 E0 0A 70          .byte 7,224,10,112,2,48,2,48,15,224,5,0,0,80,3,136,0,40,3,200,5,48,4,48,0,64,1,64,0,32,2,224
002EAE  3  02 30 02 30  
002EB2  3  0F E0 05 00  
002ECA  3  01 F8 02 9C          .byte 1,248,2,156,0,140,0,140,3,248,1,64,0,20,0,226,0,10,0,242,1,76,1,12,0,16,0,80,0,8,0,184
002ECE  3  00 8C 00 8C  
002ED2  3  03 F8 01 40  
002EEA  3  00 7E 00 A7          .byte 0,126,0,167,0,35,0,35,0,254,0,80,0,5,128,56,128,2,128,60,0,83,0,67,0,4,0,20,0,2,0,46
002EEE  3  00 23 00 23  
002EF2  3  00 FE 00 50  
002F0A  3  1F 80 29 C0          .byte 31,128,41,192,8,192,8,192,63,128,20,0,1,64,14,32,0,160,11,192,3,0,0,0,8,128,72,96,48,16,16,96
002F0E  3  08 C0 08 C0  
002F12  3  3F 80 14 00  
002F2A  3  07 E0 0A 70          .byte 7,224,10,112,2,48,2,48,15,224,5,0,0,80,3,136,0,40,2,240,0,192,0,0,2,32,18,24,12,4,4,24
002F2E  3  02 30 02 30  
002F32  3  0F E0 05 00  
002F4A  3  01 F8 02 9C          .byte 1,248,2,156,0,140,0,140,3,248,1,64,0,20,0,226,0,10,0,188,0,48,0,0,0,136,4,134,3,1,1,6
002F4E  3  00 8C 00 8C  
002F52  3  03 F8 01 40  
002F6A  3  00 7E 00 A7          .byte 0,126,0,167,0,35,0,35,0,254,0,80,0,5,128,56,128,2,0,47,0,12,0,0,0,34,129,33,64,192,128,65
002F6E  3  00 23 00 23  
002F72  3  00 FE 00 50  
002F8A  3  01 F8 03 94          .byte 1,248,3,148,3,16,3,16,1,252,0,40,4,128,8,112,10,0,9,224,6,80,6,16,1,0,1,64,2,0,3,160
002F8E  3  03 10 03 10  
002F92  3  01 FC 00 28  
002FAA  3  00 7E 00 E5          .byte 0,126,0,229,0,196,0,196,0,127,0,10,1,32,2,28,2,128,2,120,1,148,1,132,0,64,0,80,0,128,0,232
002FAE  3  00 C4 00 C4  
002FB2  3  00 7F 00 0A  
002FCA  3  80 1F 40 39          .byte 128,31,64,57,0,49,0,49,192,31,128,2,0,72,0,135,0,160,0,158,0,101,0,97,0,16,0,20,0,32,0,58
002FCE  3  00 31 00 31  
002FD2  3  C0 1F 80 02  
002FEA  3  E0 07 50 0E          .byte 224,7,80,14,64,12,64,12,240,7,160,0,0,18,192,33,0,40,128,39,64,25,64,24,0,4,0,5,0,8,128,14
002FEE  3  40 0C 40 0C  
002FF2  3  F0 07 A0 00  
00300A  3  01 F8 03 94          .byte 1,248,3,148,3,16,3,16,1,252,0,40,4,128,8,112,18,0,17,236,28,76,12,192,0,32,4,36,8,24,6,16
00300E  3  03 10 03 10  
003012  3  01 FC 00 28  
00302A  3  00 7E 00 E5          .byte 0,126,0,229,0,196,0,196,0,127,0,10,1,32,2,28,4,128,4,123,7,19,3,48,0,8,1,9,2,6,1,132
00302E  3  00 C4 00 C4  
003032  3  00 7F 00 0A  
00304A  3  80 1F 40 39          .byte 128,31,64,57,0,49,0,49,192,31,128,2,0,72,0,135,1,32,193,30,193,196,0,204,0,2,64,66,128,129,0,97
00304E  3  00 31 00 31  
003052  3  C0 1F 80 02  
00306A  3  E0 07 50 0E          .byte 224,7,80,14,64,12,64,12,240,7,160,0,0,18,192,33,0,72,176,71,48,113,0,51,128,0,144,16,96,32,64,24
00306E  3  40 0C 40 0C  
003072  3  F0 07 A0 00  
00308A  3  01 F8 03 94          .byte 1,248,3,148,3,16,3,16,1,252,0,40,2,128,4,112,5,0,4,240,3,40,3,8,0,128,0,160,1,0,1,208
00308E  3  03 10 03 10  
003092  3  01 FC 00 28  
0030AA  3  00 7E 00 E5          .byte 0,126,0,229,0,196,0,196,0,127,0,10,0,160,1,28,1,64,1,60,0,202,0,194,0,32,0,40,0,64,0,116
0030AE  3  00 C4 00 C4  
0030B2  3  00 7F 00 0A  
0030CA  3  80 1F 40 39          .byte 128,31,64,57,0,49,0,49,192,31,128,2,0,40,0,71,0,80,0,79,128,50,128,48,0,8,0,10,0,16,0,29
0030CE  3  00 31 00 31  
0030D2  3  C0 1F 80 02  
0030EA  3  E0 07 50 0E          .byte 224,7,80,14,64,12,64,12,240,7,160,0,0,10,192,17,0,20,192,19,160,12,32,12,0,2,128,2,0,4,64,7
0030EE  3  40 0C 40 0C  
0030F2  3  F0 07 A0 00  
00310A  3  01 F8 03 94          .byte 1,248,3,148,3,16,3,16,1,252,0,40,2,128,4,112,5,0,3,208,0,192,0,0,1,16,6,18,8,12,6,8
00310E  3  03 10 03 10  
003112  3  01 FC 00 28  
00312A  3  00 7E 00 E5          .byte 0,126,0,229,0,196,0,196,0,127,0,10,0,160,1,28,1,64,0,244,0,48,0,0,0,68,129,132,2,3,1,130
00312E  3  00 C4 00 C4  
003132  3  00 7F 00 0A  
00314A  3  80 1F 40 39          .byte 128,31,64,57,0,49,0,49,192,31,128,2,0,40,0,71,0,80,0,61,0,12,0,0,0,17,32,97,192,128,128,96
00314E  3  00 31 00 31  
003152  3  C0 1F 80 02  
00316A  3  E0 07 50 0E          .byte 224,7,80,14,64,12,64,12,240,7,160,0,0,10,192,17,0,20,64,15,0,3,0,0,64,4,72,24,48,32,32,24
00316E  3  40 0C 40 0C  
003172  3  F0 07 A0 00  
00318A  3  00 00 00 00          .byte 0,0,0,0,0,112,3,232,249,192,62,128,7,224,9,240,0,28,3,128,1,240,12,240,13,240,1,240,9,232,11,244
00318E  3  00 70 03 E8  
003192  3  F9 C0 3E 80  
0031AA  3  00 00 00 00          .byte 0,0,0,0,0,28,0,250,62,112,15,160,1,248,2,124,0,7,0,224,0,124,3,60,3,124,0,124,2,122,2,253
0031AE  3  00 1C 00 FA  
0031B2  3  3E 70 0F A0  
0031CA  3  00 00 00 00          .byte 0,0,0,0,0,7,128,62,15,156,3,232,0,126,0,159,192,1,0,56,0,31,0,207,0,223,0,31,128,158,64,191
0031CE  3  00 07 80 3E  
0031D2  3  0F 9C 03 E8  
0031EA  3  00 00 00 00          .byte 0,0,0,0,192,1,160,15,3,231,0,250,128,31,192,39,112,0,0,14,192,7,192,51,192,55,192,7,160,39,208,47
0031EE  3  C0 01 A0 0F  
0031F2  3  03 E7 00 FA  
00320A  3  00 00 00 00          .byte 0,0,0,0,0,112,3,232,249,192,62,128,7,224,9,240,0,28,3,128,1,240,12,240,13,240,1,240,9,232,11,244
00320E  3  00 70 03 E8  
003212  3  F9 C0 3E 80  
00322A  3  00 00 00 00          .byte 0,0,0,0,0,28,0,250,62,112,15,160,1,248,2,124,0,7,0,224,0,124,3,60,3,124,0,124,2,122,2,253
00322E  3  00 1C 00 FA  
003232  3  3E 70 0F A0  
00324A  3  00 00 00 00          .byte 0,0,0,0,0,7,128,62,15,156,3,232,0,126,0,159,192,1,0,56,0,31,0,207,0,223,0,31,128,158,64,191
00324E  3  00 07 80 3E  
003252  3  0F 9C 03 E8  
00326A  3  00 00 00 00          .byte 0,0,0,0,192,1,160,15,3,231,0,250,128,31,192,39,112,0,0,14,192,7,192,51,192,55,192,7,160,39,208,47
00326E  3  C0 01 A0 0F  
003272  3  03 E7 00 FA  
00328A  3  00 00 00 00          .byte 0,0,0,0,0,112,3,232,249,192,62,128,7,224,9,240,0,28,3,128,1,240,12,240,13,240,1,240,9,232,11,244
00328E  3  00 70 03 E8  
003292  3  F9 C0 3E 80  
0032AA  3  00 00 00 00          .byte 0,0,0,0,0,28,0,250,62,112,15,160,1,248,2,124,0,7,0,224,0,124,3,60,3,124,0,124,2,122,2,253
0032AE  3  00 1C 00 FA  
0032B2  3  3E 70 0F A0  
0032CA  3  00 00 00 00          .byte 0,0,0,0,0,7,128,62,15,156,3,232,0,126,0,159,192,1,0,56,0,31,0,207,0,223,0,31,128,158,64,191
0032CE  3  00 07 80 3E  
0032D2  3  0F 9C 03 E8  
0032EA  3  00 00 00 00          .byte 0,0,0,0,192,1,160,15,3,231,0,250,128,31,192,39,112,0,0,14,192,7,192,51,192,55,192,7,160,39,208,47
0032EE  3  C0 01 A0 0F  
0032F2  3  03 E7 00 FA  
00330A  3  00 00 00 00          .byte 0,0,0,0,0,112,3,232,249,192,62,128,7,224,9,240,0,28,3,128,1,240,12,240,13,240,1,240,9,232,11,244
00330E  3  00 70 03 E8  
003312  3  F9 C0 3E 80  
00332A  3  00 00 00 00          .byte 0,0,0,0,0,28,0,250,62,112,15,160,1,248,2,124,0,7,0,224,0,124,3,60,3,124,0,124,2,122,2,253
00332E  3  00 1C 00 FA  
003332  3  3E 70 0F A0  
00334A  3  00 00 00 00          .byte 0,0,0,0,0,7,128,62,15,156,3,232,0,126,0,159,192,1,0,56,0,31,0,207,0,223,0,31,128,158,64,191
00334E  3  00 07 80 3E  
003352  3  0F 9C 03 E8  
00336A  3  00 00 00 00          .byte 0,0,0,0,192,1,160,15,3,231,0,250,128,31,192,39,112,0,0,14,192,7,192,51,192,55,192,7,160,39,208,47
00336E  3  C0 01 A0 0F  
003372  3  03 E7 00 FA  
00338A  3  00 00 80 01          .byte 0,0,128,1,127,254,107,214,92,58,107,214,72,18,72,18,127,254,71,226,27,216,53,180,86,86,106,106,44,44,24,24
00338E  3  7F FE 6B D6  
003392  3  5C 3A 6B D6  
0033AA  3  00 00 60 00          .byte 0,0,96,0,159,255,154,245,151,14,154,245,146,4,146,4,159,255,145,248,6,246,13,109,149,149,154,154,11,11,6,6
0033AE  3  9F FF 9A F5  
0033B2  3  97 0E 9A F5  
0033CA  3  00 00 18 00          .byte 0,0,24,0,231,255,102,189,165,195,102,189,36,129,36,129,231,255,36,126,129,189,67,91,101,101,166,166,194,194,129,129
0033CE  3  E7 FF 66 BD  
0033D2  3  A5 C3 66 BD  
0033EA  3  00 00 06 00          .byte 0,0,6,0,249,255,89,175,233,112,89,175,73,32,73,32,249,255,137,31,96,111,208,214,89,89,169,169,176,176,96,96
0033EE  3  F9 FF 59 AF  
0033F2  3  E9 70 59 AF  
00340A  3  00 00 80 01          .byte 0,0,128,1,127,254,107,214,92,58,107,214,72,18,72,18,127,254,71,226,27,216,45,172,114,114,78,78,52,52,24,24
00340E  3  7F FE 6B D6  
003412  3  5C 3A 6B D6  
00342A  3  00 00 60 00          .byte 0,0,96,0,159,255,154,245,151,14,154,245,146,4,146,4,159,255,145,248,6,246,11,107,156,156,147,147,13,13,6,6
00342E  3  9F FF 9A F5  
003432  3  97 0E 9A F5  
00344A  3  00 00 18 00          .byte 0,0,24,0,231,255,102,189,165,195,102,189,36,129,36,129,231,255,36,126,129,189,194,218,39,39,228,228,67,67,129,129
00344E  3  E7 FF 66 BD  
003452  3  A5 C3 66 BD  
00346A  3  00 00 06 00          .byte 0,0,6,0,249,255,89,175,233,112,89,175,73,32,73,32,249,255,137,31,96,111,176,182,201,201,57,57,208,208,96,96
00346E  3  F9 FF 59 AF  
003472  3  E9 70 59 AF  
00348A  3  00 00 80 01          .byte 0,0,128,1,127,254,107,214,92,58,107,214,72,18,72,18,127,254,71,226,27,216,53,180,86,86,106,106,44,44,24,24
00348E  3  7F FE 6B D6  
003492  3  5C 3A 6B D6  
0034AA  3  00 00 60 00          .byte 0,0,96,0,159,255,154,245,151,14,154,245,146,4,146,4,159,255,145,248,6,246,13,109,149,149,154,154,11,11,6,6
0034AE  3  9F FF 9A F5  
0034B2  3  97 0E 9A F5  
0034CA  3  00 00 18 00          .byte 0,0,24,0,231,255,102,189,165,195,102,189,36,129,36,129,231,255,36,126,129,189,67,91,101,101,166,166,194,194,129,129
0034CE  3  E7 FF 66 BD  
0034D2  3  A5 C3 66 BD  
0034EA  3  00 00 06 00          .byte 0,0,6,0,249,255,89,175,233,112,89,175,73,32,73,32,249,255,137,31,96,111,208,214,89,89,169,169,176,176,96,96
0034EE  3  F9 FF 59 AF  
0034F2  3  E9 70 59 AF  
00350A  3  00 00 80 01          .byte 0,0,128,1,127,254,107,214,92,58,107,214,72,18,72,18,127,254,71,226,27,216,53,180,86,86,106,106,44,44,24,24
00350E  3  7F FE 6B D6  
003512  3  5C 3A 6B D6  
00352A  3  00 00 60 00          .byte 0,0,96,0,159,255,154,245,151,14,154,245,146,4,146,4,159,255,145,248,6,246,13,109,149,149,154,154,11,11,6,6
00352E  3  9F FF 9A F5  
003532  3  97 0E 9A F5  
00354A  3  00 00 18 00          .byte 0,0,24,0,231,255,102,189,165,195,102,189,36,129,36,129,231,255,36,126,129,189,67,91,101,101,166,166,194,194,129,129
00354E  3  E7 FF 66 BD  
003552  3  A5 C3 66 BD  
00356A  3  00 00 06 00          .byte 0,0,6,0,249,255,89,175,233,112,89,175,73,32,73,32,249,255,137,31,96,111,208,214,89,89,169,169,176,176,96,96
00356E  3  F9 FF 59 AF  
003572  3  E9 70 59 AF  
00358A  3  00 00 01 80          .byte 0,0,1,128,7,224,31,248,49,140,57,156,125,190,111,246,103,230,101,166,48,12,48,12,28,56,15,240,1,128,0,0
00358E  3  07 E0 1F F8  
003592  3  31 8C 39 9C  
0035AA  3  00 00 00 60          .byte 0,0,0,96,1,248,7,254,12,99,14,103,159,111,155,253,153,249,153,105,12,3,12,3,7,14,3,252,0,96,0,0
0035AE  3  01 F8 07 FE  
0035B2  3  0C 63 0E 67  
0035CA  3  00 00 00 18          .byte 0,0,0,24,0,126,129,255,195,24,195,153,231,219,102,255,102,126,102,90,195,0,195,0,129,195,0,255,0,24,0,0
0035CE  3  00 7E 81 FF  
0035D2  3  C3 18 C3 99  
0035EA  3  00 00 00 06          .byte 0,0,0,6,128,31,224,127,48,198,112,230,249,246,217,191,153,159,153,150,48,192,48,192,224,112,192,63,0,6,0,0
0035EE  3  80 1F E0 7F  
0035F2  3  30 C6 70 E6  
00360A  3  00 00 01 80          .byte 0,0,1,128,7,224,31,248,49,140,57,156,125,190,111,246,103,230,117,174,48,12,62,124,31,248,15,240,1,128,0,0
00360E  3  07 E0 1F F8  
003612  3  31 8C 39 9C  
00362A  3  00 00 00 60          .byte 0,0,0,96,1,248,7,254,12,99,14,103,159,111,155,253,153,249,157,107,12,3,15,159,7,254,3,252,0,96,0,0
00362E  3  01 F8 07 FE  
003632  3  0C 63 0E 67  
00364A  3  00 00 00 18          .byte 0,0,0,24,0,126,129,255,195,24,195,153,231,219,102,255,102,126,231,90,195,0,195,231,129,255,0,255,0,24,0,0
00364E  3  00 7E 81 FF  
003652  3  C3 18 C3 99  
00366A  3  00 00 00 06          .byte 0,0,0,6,128,31,224,127,48,198,112,230,249,246,217,191,153,159,185,214,48,192,240,249,224,127,192,63,0,6,0,0
00366E  3  80 1F E0 7F  
003672  3  30 C6 70 E6  
00368A  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
00368E  3  00 00 00 00  
003692  3  00 00 00 00  
0036AA  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0036AE  3  00 00 00 00  
0036B2  3  00 00 00 00  
0036CA  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0036CE  3  00 00 00 00  
0036D2  3  00 00 00 00  
0036EA  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0036EE  3  00 00 00 00  
0036F2  3  00 00 00 00  
00370A  3  00 C6 07 0C          .byte 0,198,7,12,31,219,63,158,56,159,74,140,72,192,127,192,63,240,21,128,0,16,2,176,1,224,0,0,0,0,0,0
00370E  3  1F DB 3F 9E  
003712  3  38 9F 4A 8C  
00372A  3  80 31 01 C3          .byte 128,49,1,195,199,246,143,231,206,39,18,163,18,48,31,240,15,252,5,96,0,4,0,172,0,120,0,0,0,0,0,0
00372E  3  C7 F6 8F E7  
003732  3  CE 27 12 A3  
00374A  3  60 0C C0 70          .byte 96,12,192,112,177,253,227,249,243,137,196,168,4,140,7,252,3,255,1,88,0,1,0,43,0,30,0,0,0,0,0,0
00374E  3  B1 FD E3 F9  
003752  3  F3 89 C4 A8  
00376A  3  18 03 30 1C          .byte 24,3,48,28,108,127,120,254,124,226,49,42,1,35,1,255,192,255,0,86,64,0,192,10,128,7,0,0,0,0,0,0
00376E  3  6C 7F 78 FE  
003772  3  7C E2 31 2A  
00378A  3  00 C0 07 0E          .byte 0,192,7,14,31,220,63,155,56,158,74,159,72,204,127,192,63,240,21,128,0,0,0,0,0,16,2,176,1,224,0,0
00378E  3  1F DC 3F 9B  
003792  3  38 9E 4A 9F  
0037AA  3  00 30 81 C3          .byte 0,48,129,195,7,247,207,230,142,39,210,167,18,51,31,240,15,252,5,96,0,0,0,0,0,4,0,172,0,120,0,0
0037AE  3  07 F7 CF E6  
0037B2  3  8E 27 D2 A7  
0037CA  3  00 0C E0 70          .byte 0,12,224,112,193,253,179,249,227,137,244,169,196,140,7,252,3,255,1,88,0,0,0,0,0,1,0,43,0,30,0,0
0037CE  3  C1 FD B3 F9  
0037D2  3  E3 89 F4 A9  
0037EA  3  00 03 38 1C          .byte 0,3,56,28,112,127,108,254,120,226,125,42,49,35,1,255,192,255,0,86,0,0,0,0,64,0,192,10,128,7,0,0
0037EE  3  70 7F 6C FE  
0037F2  3  78 E2 7D 2A  
00380A  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,56,56,124,124,226,226,226,226,124,124,56,56,0,0,0,0,0,0,0,0,0,0
00380E  3  00 00 00 00  
003812  3  00 00 38 38  
00382A  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,14,14,31,31,184,184,184,184,31,31,14,14,0,0,0,0,0,0,0,0,0,0
00382E  3  00 00 00 00  
003832  3  00 00 0E 0E  
00384A  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,131,131,199,199,46,46,46,46,199,199,131,131,0,0,0,0,0,0,0,0,0,0
00384E  3  00 00 00 00  
003852  3  00 00 83 83  
00386A  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,224,224,241,241,139,139,139,139,241,241,224,224,0,0,0,0,0,0,0,0,0,0
00386E  3  00 00 00 00  
003872  3  00 00 E0 E0  
00388A  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,56,56,124,124,142,142,142,142,124,124,56,56,0,0,0,0,0,0,0,0,0,0
00388E  3  00 00 00 00  
003892  3  00 00 38 38  
0038AA  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,14,14,31,31,163,163,163,163,31,31,14,14,0,0,0,0,0,0,0,0,0,0
0038AE  3  00 00 00 00  
0038B2  3  00 00 0E 0E  
0038CA  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,131,131,199,199,232,232,232,232,199,199,131,131,0,0,0,0,0,0,0,0,0,0
0038CE  3  00 00 00 00  
0038D2  3  00 00 83 83  
0038EA  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,224,224,241,241,58,58,58,58,241,241,224,224,0,0,0,0,0,0,0,0,0,0
0038EE  3  00 00 00 00  
0038F2  3  00 00 E0 E0  
00390A  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,0,129,0,0,0,0,0,0,0,0,0,129,0,255,0
00390E  3  00 00 00 00  
003912  3  00 00 00 00  
00392A  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,63,192,32,64,0,0,0,0,0,0,0,0,32,64,63,192
00392E  3  00 00 00 00  
003932  3  00 00 00 00  
00394A  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15,240,8,16,0,0,0,0,0,0,0,0,8,16,15,240
00394E  3  00 00 00 00  
003952  3  00 00 00 00  
00396A  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,252,2,4,0,0,0,0,0,0,0,0,2,4,3,252
00396E  3  00 00 00 00  
003972  3  00 00 00 00  
00398A  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,224,14,80,12,64,12,64,7,240,48,160,170,12
00398E  3  00 00 00 00  
003992  3  00 00 00 00  
0039AA  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,248,3,148,3,16,3,16,1,252,12,40,42,131
0039AE  3  00 00 00 00  
0039B2  3  00 00 00 00  
0039CA  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,126,0,229,0,196,0,196,0,127,3,10,202,160
0039CE  3  00 00 00 00  
0039D2  3  00 00 00 00  
0039EA  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,31,64,57,0,49,0,49,192,31,128,194,50,168
0039EE  3  00 00 00 00  
0039F2  3  00 00 00 00  
003A0A  3               frmlst:
003A0A  3  00 04                .byte 0,4
003A0C  3  04 04                .byte 4,4
003A0E  3  08 04                .byte 8,4
003A10  3  0C 04                .byte 12,4
003A12  3  10 02                .byte 16,2
003A14  3  12 01                .byte 18,1
003A16  3  13 02                .byte 19,2
003A18  3  15 02                .byte 21,2
003A1A  3  17 01                .byte 23,1
003A1C  3  18 01 19 00          .byte 24,1,25,0
003A20  3               .out .sprintf("SPRITES SIZE = %d", (* - sprgfx))
003A20  3               
003A20  3               scdat:
003A20  3  D8 01 12 01          .word 472,274,116,179,149,158,131,160,217,239,261,142,181,179,140,149,138,168,178,210,122,157,275,144,139,122
003A24  3  74 00 B3 00  
003A28  3  95 00 9E 00  
003A54  3  7A 00 84 00          .word 122,132,125,120,122,113,111,110,110,110,110,110,110,107,61,63,63,58,46,204,36
003A58  3  7D 00 78 00  
003A5C  3  7A 00 71 00  
003A7E  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,4,7,7,7,0,0,0,7,7,0,0,7,7,7,0,0,7,0,0,7
003A82  3  06 01 FF 00  
003A86  3  1C 06 01 FF  
003A9F  3  FF 00 05 06          .byte 255,0,5,6,1,255,0,4,7,0,0,7,0,7,0,0,7,0,7,0,0,7,0,7,0,0,7,255,0,5,6,1,255,0,4
003AA3  3  01 FF 00 04  
003AA7  3  07 00 00 07  
003AC2  3  07 00 00 07          .byte 7,0,0,7,0,7,0,0,7,0,7,0,0,7,0,7,0,7,255,0,6,6,1,255,0,4,7,0,0,7,0,255,7,4
003AC6  3  00 07 00 00  
003ACA  3  07 00 07 00  
003AE4  3  00 07 07 07          .byte 0,7,7,7,0,0,7,7,255,0,7,6,1,255,0,4,7,0,0,7,0,7,0,0,7,0,7,0,0,7,0,7,0
003AE8  3  00 00 07 07  
003AEC  3  FF 00 07 06  
003B05  3  07 FF 00 06          .byte 7,255,0,6,6,1,255,0,4,7,0,0,7,0,7,0,0,7,0,7,0,0,7,0,7,0,0,7,255,0,5,6,1
003B09  3  06 01 FF 00  
003B0D  3  04 07 00 00  
003B26  3  FF 00 04 07          .byte 255,0,4,7,0,0,7,0,7,0,0,7,0,7,0,0,7,0,7,0,0,7,255,0,5,6,1,255,0,4,7,7,7
003B2A  3  00 00 07 00  
003B2E  3  07 00 00 07  
003B47  3  00 00 07 00          .byte 0,0,7,0,0,7,0,7,0,0,7,0,7,0,0,7,255,0,5,6,1,255,0,28,6,1,0,255,7,5,0,7,7,7
003B4B  3  00 07 00 07  
003B4F  3  00 00 07 00  
003B69  3  00 00 07 00          .byte 0,0,7,0,0,7,7,7,0,7,0,0,7,0,7,7,7,0,6,1,0,0,0,7,0,0,0,7,0,0,7,0,0,0
003B6D  3  00 07 07 07  
003B71  3  00 07 00 00  
003B8B  3  07 FF 00 04          .byte 7,255,0,4,7,0,0,7,0,7,0,0,0,6,1,0,0,0,7,0,0,0,7,0,0,7,0,7,0,7,255,0,4
003B8F  3  07 00 00 07  
003B93  3  00 07 00 00  
003BAC  3  07 00 07 00          .byte 7,0,7,0,0,7,0,0,0,6,1,0,0,0,7,0,0,0,7,7,7,0,0,7,0,7,255,0,4,7,7,0,0,0
003BB0  3  00 07 00 00  
003BB4  3  00 06 01 00  
003BCE  3  07 07 07 00          .byte 7,7,7,0,6,1,0,0,0,7,0,0,0,7,0,0,7,0,7,0,7,255,0,4,7,0,7,255,0,4,7,0,6
003BD2  3  06 01 00 00  
003BD6  3  00 07 00 00  
003BEF  3  01 00 00 00          .byte 1,0,0,0,7,0,0,0,7,0,0,7,0,7,0,7,255,0,4,7,0,0,7,0,0,0,7,0,6,1,0,0,0
003BF3  3  07 00 00 00  
003BF7  3  07 00 00 07  
003C10  3  07 00 00 00          .byte 7,0,0,0,7,0,0,7,0,7,0,7,255,0,4,7,0,0,7,0,0,0,7,0,6,1,0,0,0,7,0,0,0
003C14  3  07 00 00 07  
003C18  3  00 07 00 07  
003C31  3  07 00 00 07          .byte 7,0,0,7,0,7,0,0,7,7,7,0,7,0,0,7,0,7,7,7,0,6,1,255,0,28,6,1,255,0,28,6,1
003C35  3  00 07 00 00  
003C39  3  07 07 07 00  
003C52  3  FF 00 1C 06          .byte 255,0,28,6
003C56  3  FF 00 3B 17          .byte 255,0,59,23,255,0,7,25,255,0,5,25,255,0,4,25,255,0,8,20,0,22,0,0,25,255,0,14,25,255,0,7,25
003C5A  3  FF 00 07 19  
003C5E  3  FF 00 05 19  
003C77  3  FF 00 48 09          .byte 255,0,72,9,255,0,7,25,255,0,4,9,255,0,10,25,255,0,4,9,9,9,255,0,11,9,255,0,4,25,255,0,11
003C7B  3  FF 00 07 19  
003C7F  3  FF 00 04 09  
003C98  3  09 FF 00 0B          .byte 9,255,0,11,9,9,255,0,13,25,0,0,9,9,255,0,10,9,10,9,255,0,5,25,255,0,8,9,9,9,255,0,9
003C9C  3  09 09 FF 00  
003CA0  3  0D 19 00 00  
003CB9  3  FF 09 04 FF          .byte 255,9,4,255,0,13,255,9,4,0,0,0,25,255,0,5,255,9,5,255,0,5,9,9,255,0,4,255,9,6,255,0,7
003CBD  3  00 0D FF 09  
003CC1  3  04 00 00 00  
003CDA  3  09 09 09 0A          .byte 9,9,9,10,9,9,9,0,0,0,255,9,4,0,255,9,8,255,0,5,255,9,4,10,10,10,255,9,16,10,9,9,255,0,4
003CDE  3  09 09 09 00  
003CE2  3  00 00 FF 09  
003CFD  3  FF 09 16 0A          .byte 255,9,22,10,10,10,9,255,0,4,9,9,0,255,9,5,10,9,9,9,10,255,9,9,10,10,10,9,9,255,0,7,255,9,5
003D01  3  0A 0A 09 FF  
003D05  3  00 04 09 09  
003D20  3  0A 09 0A 0A          .byte 10,9,10,10,255,9,14,255,0,8,9,10,255,9,4,10,255,9,4,10,10,255,9,4,10,10,9,9,255,0,9,9,10
003D24  3  FF 09 0E FF  
003D28  3  00 08 09 0A  
003D41  3  FF 09 0A 0A          .byte 255,9,10,10,10,9,9,10,10,255,0,12,9,9,10,255,9,13,10,10,255,0,13,9,10,255,9,6,255,3,13,4,255,0,6
003D45  3  0A 09 09 0A  
003D49  3  0A FF 00 0C  
003D64  3  05 FF 03 09          .byte 5,255,3,9
003D68  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
003D6C  3  06 01 FF 00  
003D70  3  1C 06 01 FF  
003D8A  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
003D8E  3  1C 06 01 FF  
003D92  3  00 1C 06 01  
003DAD  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,10,255,2,8,255,0,10,6,1,255,0,28,6,1,255,0,28,6,1
003DB1  3  1C 06 01 FF  
003DB5  3  00 1C 06 01  
003DCE  3  FF 00 1C 06          .byte 255,0,28,6,1,255,0,28,6,1,255,0,28,6
003DD2  3  01 FF 00 1C  
003DD6  3  06 01 FF 00  
003DDC  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
003DE0  3  06 01 FF 00  
003DE4  3  1C 06 01 FF  
003DFE  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,26,8,2,6,1,255,0,4,255,2,4,255,0,17,8,2,0,6,1,255,0,24,8,2
003E02  3  1C 06 01 FF  
003E06  3  00 1A 08 02  
003E1F  3  00 00 06 01          .byte 0,0,6,1,255,0,23,8,2,0,0,0,6,1,255,0,22,8,2,255,0,4,6,1,255,0,7,2,2,255,0,12,8
003E23  3  FF 00 17 08  
003E27  3  02 00 00 00  
003E40  3  02 FF 00 05          .byte 2,255,0,5,6,1,255,0,9,2,2,255,0,9,8,2,255,0,6,6,1,255,0,11,2,2,255,0,6,2,2,255,0,7
003E44  3  06 01 FF 00  
003E48  3  09 02 02 FF  
003E62  3  06 01 FF 00          .byte 6,1,255,0,13,2,2,255,0,13,6,1,255,2,6,255,0,22,6,1,255,0,28,6,1,255,0,16,255,2,9,0,0,0
003E66  3  0D 02 02 FF  
003E6A  3  00 0D 06 01  
003E84  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6
003E88  3  1C 06 01 FF  
003E8C  3  00 1C 06     
003E8F  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
003E93  3  06 01 FF 00  
003E97  3  1C 06 01 FF  
003EB1  3  06 01 FF 00          .byte 6,1,255,0,21,2,2,255,0,5,6,1,255,0,18,2,2,2,255,0,7,6,1,255,0,10,255,2,5,255,0,13,6
003EB5  3  15 02 02 FF  
003EB9  3  00 05 06 01  
003ED2  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,6,2,2,255,0,20,6,1,255,0,28,6,1,2,2,2,255,0,25,6,1,255,0,28,6
003ED6  3  06 01 FF 00  
003EDA  3  06 02 02 FF  
003EF3  3  01 FF 00 04          .byte 1,255,0,4,255,2,9,255,0,15,6,1,255,0,13,2,2,255,0,13,6,1,255,0,28,6,1,255,0,28,6,1,255,0,9
003EF7  3  FF 02 09 FF  
003EFB  3  00 0F 06 01  
003F16  3  FF 02 13 06          .byte 255,2,19,6,1,255,0,28,6,1,255,0,28,6
003F1A  3  01 FF 00 1C  
003F1E  3  06 01 FF 00  
003F24  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
003F28  3  06 01 FF 00  
003F2C  3  1C 06 01 FF  
003F46  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,26,2,2,6,1,255,0,24,2,2,0,0,6,1,255,0,22,2,2
003F4A  3  1C 06 01 FF  
003F4E  3  00 1C 06 01  
003F67  3  FF 00 04 06          .byte 255,0,4,6,1,255,0,28,6,1,255,0,16,255,2,4,255,0,8,6,1,255,0,28,6,1,255,0,10,2,2,255,0,16
003F6B  3  01 FF 00 1C  
003F6F  3  06 01 FF 00  
003F89  3  06 01 FF 00          .byte 6,1,255,0,12,2,2,255,0,14,6,1,255,2,6,255,0,8,2,2,2,255,0,11,6,1,255,0,28,6,1,255,0,19
003F8D  3  0C 02 02 FF  
003F91  3  00 0E 06 01  
003FAB  3  FF 02 06 00          .byte 255,2,6,0,0,0,6,1,255,0,6,255,2,5,255,0,17,6,1,255,0,28,6
003FAF  3  00 00 06 01  
003FB3  3  FF 00 06 FF  
003FC2  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
003FC6  3  06 01 FF 00  
003FCA  3  1C 06 01 FF  
003FE4  3  06 01 FF 00          .byte 6,1,255,0,5,255,2,6,255,0,17,6,1,255,0,19,255,2,9,6,1,255,0,28,6,1,255,0,13,2,2,2,255,0,12
003FE8  3  05 FF 02 06  
003FEC  3  FF 00 11 06  
004007  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,18,255,2,4,255,0,6,6,1,255,0,28,6,1,255,0,28,6,1
00400B  3  1C 06 01 FF  
00400F  3  00 1C 06 01  
004028  3  FF 00 1C 06          .byte 255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6
00402C  3  01 FF 00 1C  
004030  3  06 01 FF 00  
004045  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
004049  3  06 01 FF 00  
00404D  3  1C 06 01 FF  
004067  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
00406B  3  1C 06 01 FF  
00406F  3  00 1C 06 01  
00408A  3  06 01 00 02          .byte 6,1,0,2,2,0,0,2,2,0,0,2,2,0,0,2,2,0,0,2,2,0,0,2,2,0,0,2,2,0,6,1,255,0,28
00408E  3  02 00 00 02  
004092  3  02 00 00 02  
0040AD  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,0,0,0,2,2,0,0,2,2,0,0,2,2,0,0,2,2,0,0,2,2,0,0,2,2,0,0,0
0040B1  3  1C 06 01 00  
0040B5  3  00 00 02 02  
0040D0  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6
0040D4  3  1C 06 01 FF  
0040D8  3  00 1C 06 01  
0040E5  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
0040E9  3  06 01 FF 00  
0040ED  3  1C 06 01 FF  
004107  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,2,8,255,0,24,8,2,6,1,0,2,8,255,0,22,8
00410B  3  1C 06 01 FF  
00410F  3  00 1C 06 01  
004128  3  02 00 06 01          .byte 2,0,6,1,0,0,2,8,255,0,20,8,2,0,0,6,1,0,0,0,2,8,255,0,18,8,2,0,0,0,6,1,255,0,4
00412C  3  00 00 02 08  
004130  3  FF 00 14 08  
00414B  3  02 08 FF 00          .byte 2,8,255,0,16,8,2,255,0,4,6,1,255,0,5,2,8,255,0,14,8,2,255,0,5,6,1,255,0,6,2,8,255,0,12
00414F  3  10 08 02 FF  
004153  3  00 04 06 01  
00416E  3  08 02 FF 00          .byte 8,2,255,0,6,6,1,255,0,7,2,8,255,0,10,8,2,255,0,7,6,1,255,0,8,2,8,255,0,8,8,2,255,0,8
004172  3  06 06 01 FF  
004176  3  00 07 02 08  
004191  3  06 01 FF 00          .byte 6,1,255,0,9,2,8,255,0,6,8,2,255,0,9,6,1,255,0,10,2,8,255,0,4,8,2,255,0,10,6,1,255,0,11
004195  3  09 02 08 FF  
004199  3  00 06 08 02  
0041B4  3  02 02 00 00          .byte 2,2,0,0,2,2,255,0,11,6
0041B8  3  02 02 FF 00  
0041BC  3  0B 06        
0041BE  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
0041C2  3  06 01 FF 00  
0041C6  3  1C 06 01 FF  
0041E0  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
0041E4  3  1C 06 01 FF  
0041E8  3  00 1C 06 01  
004203  3  06 01 08 FF          .byte 6,1,8,255,0,5,8,255,0,5,8,255,0,5,8,255,0,5,8,0,0,0,6,1,8,255,0,5,8,255,0,5,8
004207  3  00 05 08 FF  
00420B  3  00 05 08 FF  
004224  3  FF 00 05 08          .byte 255,0,5,8,255,0,5,8,0,0,0,6,1,8,255,0,5,8,255,0,5,8,255,0,5,8,255,0,5,8,0,0,0
004228  3  FF 00 05 08  
00422C  3  00 00 00 06  
004245  3  06 01 08 00          .byte 6,1,8,0,0,8,0,0,8,0,0,8,0,0,8,0,0,8,0,0,8,0,0,8,0,0,8,0,0,0,6,1,8
004249  3  00 08 00 00  
00424D  3  08 00 00 08  
004266  3  00 00 08 00          .byte 0,0,8,0,0,8,0,0,8,0,0,8,0,0,8,0,0,8,0,0,8,0,0,8,0,0,0,6,1,8,0,0,8
00426A  3  00 08 00 00  
00426E  3  08 00 00 08  
004287  3  00 00 08 00          .byte 0,0,8,0,0,8,0,0,8,0,0,8,0,0,8,0,0,8,0,0,8,0,0,0,6,1,255,2,25,0,0,0,6
00428B  3  00 08 00 00  
00428F  3  08 00 00 08  
0042A8  3  01 FF 00 1C          .byte 1,255,0,28,6
0042AC  3  06           
0042AD  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
0042B1  3  06 01 FF 00  
0042B5  3  1C 06 01 FF  
0042CF  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,5,8,2,2
0042D3  3  1C 06 01 FF  
0042D7  3  00 1C 06 01  
0042F0  3  08 00 00 00          .byte 8,0,0,0,8,2,2,8,0,0,8,8,2,2,8,255,0,5,6,1,255,0,4,8,8,0,0,8,8,0,8,8,0,0
0042F4  3  08 02 02 08  
0042F8  3  00 00 08 08  
004312  3  02 02 00 08          .byte 2,2,0,8,8,0,0,8,8,255,0,4,6,1,255,0,4,8,8,0,0,8,8,0,8,8,255,0,5,8,8,0,0
004316  3  08 00 00 08  
00431A  3  08 FF 00 04  
004333  3  08 08 FF 00          .byte 8,8,255,0,4,6,1,255,0,4,8,8,2,2,8,8,0,8,8,255,0,5,8,8,0,0,8,8,255,0,4,6,1
004337  3  04 06 01 FF  
00433B  3  00 04 08 08  
004354  3  FF 00 04 08          .byte 255,0,4,8,8,0,0,8,8,0,8,8,0,2,8,8,0,8,8,0,0,8,8,255,0,4,6,1,255,0,4,8,8
004358  3  08 00 00 08  
00435C  3  08 00 08 08  
004375  3  00 00 08 08          .byte 0,0,8,8,0,8,8,0,0,8,2,0,8,8,0,0,8,2,255,0,4,6,1,255,0,4,2,2,0,0,2,2,0,0
004379  3  00 08 08 00  
00437D  3  00 08 02 00  
004397  3  FF 02 04 00          .byte 255,2,4,0,0,255,2,5,255,0,5,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6
00439B  3  00 FF 02 05  
00439F  3  FF 00 05 06  
0043B2  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
0043B6  3  06 01 FF 00  
0043BA  3  1C 06 01 FF  
0043D4  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,2,2,255,0,7,2,2,255,0,17,6,1,255,0,16,2,2,255,0,10,6
0043D8  3  1C 06 01 FF  
0043DC  3  00 1C 06 01  
0043F5  3  01 FF 00 04          .byte 1,255,0,4,2,2,255,0,22,6,1,255,0,12,2,2,2,255,0,5,2,2,255,0,6,6,1,255,0,28,6,1,255,0,24
0043F9  3  02 02 FF 00  
0043FD  3  16 06 01 FF  
004418  3  02 02 00 00          .byte 2,2,0,0,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
00441C  3  06 01 FF 00  
004420  3  1C 06 01 FF  
00443A  3  06 01 FF 00          .byte 6,1,255,0,28,6
00443E  3  1C 06        
004440  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,0,255,2,5
004444  3  06 01 FF 00  
004448  3  1C 06 01 FF  
004463  3  FF 00 16 06          .byte 255,0,22,6,1,255,0,28,6,1,255,0,6,2,2,255,0,15,2,2,2,0,0,6,1,255,0,19,2,2,255,0,7
004467  3  01 FF 00 1C  
00446B  3  06 01 FF 00  
004484  3  06 01 FF 00          .byte 6,1,255,0,8,2,255,0,7,2,255,0,11,6,1,255,0,28,6,1,255,0,9,2,255,0,4,8,2,255,0,12,6
004488  3  08 02 FF 00  
00448C  3  07 02 FF 00  
0044A5  3  01 FF 00 0D          .byte 1,255,0,13,8,2,255,0,13,6,1,255,0,12,2,2,255,0,14,6,1,255,0,28,6,1,255,0,10,255,2,7,0,0
0044A9  3  08 02 FF 00  
0044AD  3  0D 06 01 FF  
0044C7  3  FF 02 07 00          .byte 255,2,7,0,0,6,1,255,0,6,2,2,255,0,20,6,1,255,0,28,6,1,2,2,0,0,2,2,255,0,22,6,1
0044CB  3  00 06 01 FF  
0044CF  3  00 06 02 02  
0044E8  3  00 00 02 02          .byte 0,0,2,2,255,0,24,6,1,255,0,28,6
0044EC  3  FF 00 18 06  
0044F0  3  01 FF 00 1C  
0044F5  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
0044F9  3  06 01 FF 00  
0044FD  3  1C 06 01 FF  
004517  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,13,8,8,255,0,13,6,1,255,0,12,255,8,4
00451B  3  1C 06 01 FF  
00451F  3  00 1C 06 01  
004538  3  FF 00 0C 06          .byte 255,0,12,6,1,255,0,11,255,8,6,255,0,11,6,1,255,0,10,255,8,8,255,0,10,6,1,255,0,9,255,8,10
00453C  3  01 FF 00 0B  
004540  3  FF 08 06 FF  
004559  3  FF 00 09 06          .byte 255,0,9,6,1,255,0,8,255,8,12,255,0,8,6,1,255,0,7,255,8,14,255,0,7,6,1,255,0,6,255,8,16
00455D  3  01 FF 00 08  
004561  3  FF 08 0C FF  
00457A  3  FF 00 06 06          .byte 255,0,6,6,1,255,0,5,255,8,18,255,0,5,6,1,255,0,4,255,8,20,255,0,4,6,1,0,0,0,255,8,22
00457E  3  01 FF 00 05  
004582  3  FF 08 12 FF  
00459B  3  00 00 00 06          .byte 0,0,0,6,1,0,0,255,8,24,0,0,6
00459F  3  01 00 00 FF  
0045A3  3  08 18 00 00  
0045A8  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,24
0045AC  3  06 01 FF 00  
0045B0  3  1C 06 01 FF  
0045CA  3  FF 02 04 06          .byte 255,2,4,6,1,255,0,28,6,1,255,0,21,2,255,0,6,6,1,255,0,28,6,1,255,0,16,2,2,2,255,0,9
0045CE  3  01 FF 00 1C  
0045D2  3  06 01 FF 00  
0045EB  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,13,2,255,0,14,6,1,255,0,28,6,1,255,0,8,2,2,2,255,0,17,6,1,255,0,28
0045EF  3  1C 06 01 FF  
0045F3  3  00 0D 02 FF  
00460E  3  06 01 FF 00          .byte 6,1,255,0,5,2,255,0,22,6,1,255,0,28,6,1,2,2,2,255,0,25,6,1,255,0,28,6,1,255,0,28,6
004612  3  05 02 FF 00  
004616  3  16 06 01 FF  
00462F  3  01 FF 00 1C          .byte 1,255,0,28,6
004633  3  06           
004634  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,17
004638  3  06 01 FF 00  
00463C  3  1C 06 01 FF  
004656  3  02 FF 00 0A          .byte 2,255,0,10,6,1,255,0,21,2,255,0,6,6,1,255,0,7,2,2,255,0,4,2,2,255,0,13,6,1,255,0,24
00465A  3  06 01 FF 00  
00465E  3  15 02 FF 00  
004677  3  02 02 00 00          .byte 2,2,0,0,6,1,255,0,4,2,255,0,5,2,255,0,17,6,1,255,0,28,6,1,0,2,2,255,0,25,6,1,255,0,28
00467B  3  06 01 FF 00  
00467F  3  04 02 FF 00  
00469A  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,10,255,2,8,255,0,10,6,1,255,0,28,6,1,255,0,28,6,1
00469E  3  1C 06 01 FF  
0046A2  3  00 1C 06 01  
0046BB  3  FF 00 1C 06          .byte 255,0,28,6,1,255,0,28,6,1,255,0,28,6
0046BF  3  01 FF 00 1C  
0046C3  3  06 01 FF 00  
0046C9  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,10,2,2,0,0
0046CD  3  06 01 FF 00  
0046D1  3  1C 06 01 FF  
0046EA  3  FF 02 04 FF          .byte 255,2,4,255,0,8,2,2,6,1,255,0,28,6,1,0,0,255,2,5,255,0,13,2,2,255,0,6,6,1,255,0,28
0046EE  3  00 08 02 02  
0046F2  3  06 01 FF 00  
00470B  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,2,19
00470F  3  1C 06 01 FF  
004713  3  00 1C 06 01  
00472E  3  FF 00 09 06          .byte 255,0,9,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,19,255,2,9,6,1
004732  3  01 FF 00 1C  
004736  3  06 01 FF 00  
00474F  3  FF 00 1C 06          .byte 255,0,28,6
004753  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,0,2,0,0,0,2,255,0,16
004757  3  06 01 FF 00  
00475B  3  1C 06 01 FF  
004776  3  02 00 00 00          .byte 2,0,0,0,2,2,6,1,255,0,28,6,1,255,0,8,2,255,0,9,2,255,0,9,6,1,255,0,28,6,1,255,0,11
00477A  3  02 02 06 01  
00477E  3  FF 00 1C 06  
004798  3  02 00 00 00          .byte 2,0,0,0,2,255,0,12,6,1,255,0,28,6,1,255,0,28,6,1,255,0,12,2,255,0,9,2,255,0,5,6,1
00479C  3  02 FF 00 0C  
0047A0  3  06 01 FF 00  
0047B9  3  FF 00 12 02          .byte 255,0,18,2,255,0,9,6,1,255,0,15,2,255,0,9,2,0,0,6,1,255,0,28,6,1,255,0,28,6,1,0,0
0047BD  3  FF 00 09 06  
0047C1  3  01 FF 00 0F  
0047DA  3  02 FF 00 19          .byte 2,255,0,25,6,1,255,0,28,6,1,255,0,5,2,2,0,0,2,255,0,18,6,1,255,0,28,6,1,255,0,28,6
0047DE  3  06 01 FF 00  
0047E2  3  1C 06 01 FF  
0047FB  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
0047FF  3  06 01 FF 00  
004803  3  1C 06 01 FF  
00481D  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,2,4,255,0,11,2,2,2,255,0,10
004821  3  1C 06 01 FF  
004825  3  00 1C 06 01  
00483F  3  06 01 FF 00          .byte 6,1,255,0,5,2,255,0,7,2,255,0,5,2,255,0,8,6,1,255,0,7,255,2,5,255,0,9,2,255,8,4,0,0
004843  3  05 02 FF 00  
004847  3  07 02 FF 00  
004861  3  06 01 FF 00          .byte 6,1,255,0,22,255,8,4,0,0,6,1,255,0,22,2,8,8,8,0,0,6,1,255,0,23,8,8,8,0,0,6,1
004865  3  16 FF 08 04  
004869  3  00 00 06 01  
004882  3  FF 00 17 02          .byte 255,0,23,2,8,8,0,0,6,1,255,0,24,8,8,0,0,6,1,255,0,24,2,8,0,0,6,1,255,0,25,8,0,0
004886  3  08 08 00 00  
00488A  3  06 01 FF 00  
0048A4  3  06 01 FF 00          .byte 6,1,255,0,25,2,0,0,6
0048A8  3  19 02 00 00  
0048AC  3  06           
0048AD  3  01 FF 00 19          .byte 1,255,0,25,8,0,0,6,1,255,0,25,8,0,0,6,1,255,0,25,8,0,0,6,1,255,0,25,8,0,0,6,1
0048B1  3  08 00 00 06  
0048B5  3  01 FF 00 19  
0048CE  3  FF 00 19 08          .byte 255,0,25,8,0,0,6,1,255,0,25,8,0,0,6,1,255,0,25,8,0,0,6,1,255,0,25,8,0,0,6,1,255,0,25
0048D2  3  00 00 06 01  
0048D6  3  FF 00 19 08  
0048F1  3  08 00 00 06          .byte 8,0,0,6,1,255,0,25,8,0,0,6,1,255,0,25,8,0,0,6,1,255,0,25,8,0,0,6,1,255,0,25,8
0048F5  3  01 FF 00 19  
0048F9  3  08 00 00 06  
004912  3  00 00 06 01          .byte 0,0,6,1,255,0,25,8,0,0,6,1,255,0,6,2,2,2,8,255,0,15,8,0,0,6,1,255,0,9,2,2,8
004916  3  FF 00 19 08  
00491A  3  00 00 06 01  
004933  3  FF 00 0D 08          .byte 255,0,13,8,0,0,6,1,255,0,11,2,2,8,255,0,11,8,0,0,6,1,255,0,13,2,2,8,255,0,9,8,0,0
004937  3  00 00 06 01  
00493B  3  FF 00 0B 02  
004955  3  06 01 FF 00          .byte 6,1,255,0,15,2,2,8,255,0,7,2,0,0,6,1,255,0,17,255,2,4,255,0,7,6,1,255,2,6,255,0,22
004959  3  0F 02 02 08  
00495D  3  FF 00 07 02  
004976  3  06 01 FF 00          .byte 6,1,255,0,22,255,2,6,6
00497A  3  16 FF 02 06  
00497E  3  06           
00497F  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
004983  3  06 01 FF 00  
004987  3  1C 06 01 FF  
0049A1  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,5,255,2,7,255,0,16,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1
0049A5  3  1C 06 01 FF  
0049A9  3  00 05 FF 02  
0049C2  3  FF 00 19 02          .byte 255,0,25,2,2,0,6,1,255,0,28,6,1,255,0,28,6,1,0,0,0,255,2,25,6,1,255,0,28,6,1,255,0,28
0049C6  3  02 00 06 01  
0049CA  3  FF 00 1C 06  
0049E4  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6
0049E8  3  1C 06 01 FF  
0049EC  3  00 1C 06 01  
0049F9  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
0049FD  3  06 01 FF 00  
004A01  3  1C 06 01 FF  
004A1B  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,0,0,255,2,6,8,255,0,19,6,1,255,0,8,2,8
004A1F  3  1C 06 01 FF  
004A23  3  00 1C 06 01  
004A3C  3  FF 00 12 06          .byte 255,0,18,6,1,255,0,9,2,8,255,0,17,6,1,255,0,10,2,8,255,0,16,6,1,255,0,11,2,8,255,0,15
004A40  3  01 FF 00 09  
004A44  3  02 08 FF 00  
004A5D  3  06 01 FF 00          .byte 6,1,255,0,12,2,8,255,0,14,6,1,255,0,13,2,8,255,0,13,6,1,255,0,14,2,8,255,0,12,6,1,255,0,15
004A61  3  0C 02 08 FF  
004A65  3  00 0E 06 01  
004A80  3  FF 02 05 FF          .byte 255,2,5,255,0,8,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6
004A84  3  00 08 06 01  
004A88  3  FF 00 1C 06  
004A96  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,12,2,8,16,255,0,13,6,1,255,0,13,8,8,255,0,13
004A9A  3  06 01 FF 00  
004A9E  3  1C 06 01 FF  
004AB9  3  06 01 FF 00          .byte 6,1,255,0,10,255,8,7,255,0,11,6,1,255,0,9,255,8,9,255,0,10,6,1,255,0,8,8,255,2,4,8,255,2,4
004ABD  3  0A FF 08 07  
004AC1  3  FF 00 0B 06  
004ADC  3  08 FF 00 09          .byte 8,255,0,9,6,1,255,0,7,8,8,255,16,4,8,255,16,4,8,8,255,0,8,6,1,255,0,7,8,8,8,16,16
004AE0  3  06 01 FF 00  
004AE4  3  07 08 08 FF  
004AFD  3  08 02 08 10          .byte 8,2,8,16,16,8,8,8,255,0,8,6,1,255,0,6,8,2,255,8,4,2,16,2,255,8,4,2,8,255,0,7,6
004B01  3  10 08 08 08  
004B05  3  FF 00 08 06  
004B1E  3  01 FF 00 06          .byte 1,255,0,6,8,16,255,8,4,16,16,16,255,8,4,16,8,255,0,7,6,1,255,0,6,8,16,2,255,8,9,2,16
004B22  3  08 10 FF 08  
004B26  3  04 10 10 10  
004B3F  3  08 FF 00 07          .byte 8,255,0,7,6,1,255,0,6,8,16,16,255,2,9,16,16,8,255,0,7,6,1,255,0,6,2,8,255,16,11,8,2
004B43  3  06 01 FF 00  
004B47  3  06 08 10 10  
004B60  3  FF 00 07 06          .byte 255,0,7,6,1,255,0,7,8,255,16,11,8,255,0,8,6,1,255,0,7,2,8,255,16,9,8,2,255,0,8,6,1
004B64  3  01 FF 00 07  
004B68  3  08 FF 10 0B  
004B81  3  FF 00 08 02          .byte 255,0,8,2,2,255,8,7,2,2,255,0,9,6,1,255,0,10,255,2,7,255,0,11,6,1,255,0,28,6,1,255,0,28
004B85  3  02 FF 08 07  
004B89  3  02 02 FF 00  
004BA3  3  06 01 FF 00          .byte 6,1,255,0,28,6
004BA7  3  1C 06        
004BA9  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
004BAD  3  06 01 FF 00  
004BB1  3  1C 06 01 FF  
004BCB  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,25,2,2,0,6,1,255,0,28
004BCF  3  1C 06 01 FF  
004BD3  3  00 1C 06 01  
004BEC  3  06 01 FF 00          .byte 6,1,255,0,20,2,0,0,2,255,0,4,6,1,255,0,28,6,1,255,0,18,2,255,0,9,6,1,255,0,16,2,255,0,11
004BF0  3  14 02 00 00  
004BF4  3  02 FF 00 04  
004C0F  3  06 01 FF 00          .byte 6,1,255,0,7,2,2,2,255,0,18,6,1,0,255,2,4,255,0,7,2,2,2,255,0,13,6,1,255,0,28,6,1
004C13  3  07 02 02 02  
004C17  3  FF 00 12 06  
004C30  3  FF 00 1C 06          .byte 255,0,28,6,1,255,0,28,6
004C34  3  01 FF 00 1C  
004C38  3  06           
004C39  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
004C3D  3  06 01 FF 00  
004C41  3  1C 06 01 FF  
004C5B  3  06 01 FF 00          .byte 6,1,255,0,5,2,2,255,0,4,2,2,2,255,0,14,6,1,2,2,255,0,15,2,2,255,0,9,6,1,255,0,28
004C5F  3  05 02 02 FF  
004C63  3  00 04 02 02  
004C7C  3  06 01 FF 00          .byte 6,1,255,0,22,2,2,255,0,4,6,1,255,0,28,6,1,255,0,28,6,1,255,2,19,255,0,9,6,1,255,0,28
004C80  3  16 02 02 FF  
004C84  3  00 04 06 01  
004C9D  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,14,255,2,14,6,1,255,0,28,6,1,255,0,28
004CA1  3  1C 06 01 FF  
004CA5  3  00 1C 06 01  
004CBE  3  06 01 FF 00          .byte 6,1,255,0,28,6
004CC2  3  1C 06        
004CC4  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,2,19,255,0,9,6
004CC8  3  06 01 FF 00  
004CCC  3  1C 06 01 FF  
004CE5  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,6,255,2,22,6,1,255,0,28,6
004CE9  3  06 01 FF 00  
004CED  3  1C 06 01 FF  
004D06  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,2,23,255,0,5,6,1,255,0,28,6
004D0A  3  06 01 FF 00  
004D0E  3  1C 06 01 FF  
004D27  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,25,2,2,2,6,1,255,0,28,6
004D2B  3  06 01 FF 00  
004D2F  3  1C 06 01 FF  
004D3E  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
004D42  3  06 01 FF 00  
004D46  3  1C 06 01 FF  
004D60  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,5,255,2,5,255,0,18,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1
004D64  3  1C 06 01 FF  
004D68  3  00 05 FF 02  
004D81  3  FF 00 1C 06          .byte 255,0,28,6,1,255,0,28,6,1,255,0,16,255,2,8,255,0,4,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
004D85  3  01 FF 00 1C  
004D89  3  06 01 FF 00  
004DA3  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6
004DA7  3  1C 06 01 FF  
004DAB  3  00 1C 06 01  
004DB8  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
004DBC  3  06 01 FF 00  
004DC0  3  1C 06 01 FF  
004DDA  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,11
004DDE  3  1C 06 01 FF  
004DE2  3  00 1C 06 01  
004DFD  3  FF 02 06 FF          .byte 255,2,6,255,0,11,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,0,0,255,2,6,255,0,12,255,2,6
004E01  3  00 0B 06 01  
004E05  3  FF 00 1C 06  
004E1F  3  00 00 06 01          .byte 0,0,6,1,255,0,28,6,1,255,0,12,255,2,4,255,0,12,6,1,255,0,28,6,1,255,0,28,6
004E23  3  FF 00 1C 06  
004E27  3  01 FF 00 0C  
004E3C  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,4
004E40  3  06 01 FF 00  
004E44  3  1C 06 01 FF  
004E5E  3  02 02 FF 00          .byte 2,2,255,0,22,6,1,255,0,28,6,1,255,0,9,2,2,255,0,17,6,1,255,0,28,6,1,255,0,15,2,2,255,0,11
004E62  3  16 06 01 FF  
004E66  3  00 1C 06 01  
004E81  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
004E85  3  1C 06 01 FF  
004E89  3  00 1C 06 01  
004EA4  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6
004EA8  3  1C 06 01 FF  
004EAC  3  00 1C 06 01  
004EB9  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
004EBD  3  06 01 FF 00  
004EC1  3  1C 06 01 FF  
004EDB  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
004EDF  3  1C 06 01 FF  
004EE3  3  00 1C 06 01  
004EFE  3  06 01 FF 00          .byte 6,1,255,0,13,2,2,255,0,13,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,2,13,0,0,255,2,13
004F02  3  0D 02 02 FF  
004F06  3  00 0D 06 01  
004F21  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6
004F25  3  1C 06 01 FF  
004F29  3  00 1C 06 01  
004F31  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,11
004F35  3  06 01 FF 00  
004F39  3  1C 06 01 FF  
004F53  3  FF 02 04 FF          .byte 255,2,4,255,0,13,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1
004F57  3  00 0D 06 01  
004F5B  3  FF 00 1C 06  
004F74  3  FF 00 1C 06          .byte 255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
004F78  3  01 FF 00 1C  
004F7C  3  06 01 FF 00  
004F95  3  06 01 FF 00          .byte 6,1,255,0,11,255,2,4,255,0,13,6,1,255,0,28,6,1,255,0,28,6
004F99  3  0B FF 02 04  
004F9D  3  FF 00 0D 06  
004FAB  3  01 FF 00 16          .byte 1,255,0,22,255,16,6,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6
004FAF  3  FF 10 06 06  
004FB3  3  01 FF 00 1C  
004FCC  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
004FD0  3  06 01 FF 00  
004FD4  3  1C 06 01 FF  
004FEE  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
004FF2  3  1C 06 01 FF  
004FF6  3  00 1C 06 01  
005011  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6
005015  3  1C 06 01 FF  
005019  3  00 1C 06     
00501C  3  01 FF 00 1B          .byte 1,255,0,27,16,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
005020  3  10 06 01 FF  
005024  3  00 1C 06 01  
00503F  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
005043  3  1C 06 01 FF  
005047  3  00 1C 06 01  
005062  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
005066  3  1C 06 01 FF  
00506A  3  00 1C 06 01  
005085  3  06 01 FF 00          .byte 6,1,255,0,28,6
005089  3  1C 06        
00508B  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
00508F  3  06 01 FF 00  
005093  3  1C 06 01 FF  
0050AD  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
0050B1  3  1C 06 01 FF  
0050B5  3  00 1C 06 01  
0050D0  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
0050D4  3  1C 06 01 FF  
0050D8  3  00 1C 06 01  
0050F3  3  06 01 FF 00          .byte 6,1,255,0,28,6
0050F7  3  1C 06        
0050F9  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
0050FD  3  06 01 FF 00  
005101  3  1C 06 01 FF  
00511B  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
00511F  3  1C 06 01 FF  
005123  3  00 1C 06 01  
00513E  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
005142  3  1C 06 01 FF  
005146  3  00 1C 06 01  
005161  3  06 01 FF 00          .byte 6,1,255,0,28,6
005165  3  1C 06        
005167  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
00516B  3  06 01 FF 00  
00516F  3  1C 06 01 FF  
005189  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
00518D  3  1C 06 01 FF  
005191  3  00 1C 06 01  
0051AC  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
0051B0  3  1C 06 01 FF  
0051B4  3  00 1C 06 01  
0051CF  3  06 01 FF 00          .byte 6,1,255,0,28,6
0051D3  3  1C 06        
0051D5  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
0051D9  3  06 01 FF 00  
0051DD  3  1C 06 01 FF  
0051F7  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
0051FB  3  1C 06 01 FF  
0051FF  3  00 1C 06 01  
00521A  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
00521E  3  1C 06 01 FF  
005222  3  00 1C 06 01  
00523D  3  06 01 FF 00          .byte 6,1,255,0,28,6
005241  3  1C 06        
005243  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
005247  3  06 01 FF 00  
00524B  3  1C 06 01 FF  
005265  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
005269  3  1C 06 01 FF  
00526D  3  00 1C 06 01  
005288  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
00528C  3  1C 06 01 FF  
005290  3  00 1C 06 01  
0052AB  3  06 01 FF 00          .byte 6,1,255,0,28,6
0052AF  3  1C 06        
0052B1  3  01 FF 00 1C          .byte 1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
0052B5  3  06 01 FF 00  
0052B9  3  1C 06 01 FF  
0052D3  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
0052D7  3  1C 06 01 FF  
0052DB  3  00 1C 06 01  
0052F6  3  06 01 FF 00          .byte 6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28,6,1,255,0,28
0052FA  3  1C 06 01 FF  
0052FE  3  00 1C 06 01  
005319  3  06 01 FF 00          .byte 6,1,255,0,28,6
00531D  3  1C 06        
00531F  3  01 FF 00 1C          .byte 1,255,0,28,1,1,255,0,28,1,1,255,0,28,1,1,255,0,28,1,1,255,0,28,1,1,255,0,29,1,255,0,29
005323  3  01 01 FF 00  
005327  3  1C 01 01 FF  
005340  3  01 FF 00 1D          .byte 1,255,0,29,1,255,0,29,1,255,0,29,1,255,0,29,1,255,0,29,1,255,0,29,1,255,0,29,1,255,2,8,255,0,21
005344  3  01 FF 00 1D  
005348  3  01 FF 00 1D  
005363  3  01 FF 00 16          .byte 1,255,0,22,255,2,5,0,0,1,255,0,10,255,2,9,255,0,10,1,255,0,29,1,255,0,29,1,255,14,29,1,255,15,29
005367  3  FF 02 05 00  
00536B  3  00 01 FF 00  
005386  3  01 FF 0F 1D          .byte 1,255,15,29
00538A  3  FF 01 4B 1B          .byte 255,1,75,27,255,0,14,255,1,10,27,255,0,19,255,1,5,27,255,0,252,255,2,4,255,0,22,2,2,255,0,6,2,2
00538E  3  FF 00 0E FF  
005392  3  01 0A 1B FF  
0053AC  3  FF 00 08 FF          .byte 255,0,8,255,2,4,255,0,63,255,2,4,255,0,12,2,2,2,255,0,62,255,14,30,255,15,60
0053B0  3  02 04 FF 00  
0053B4  3  3F FF 02 04  
0053C7  3  FF 01 3C FF          .byte 255,1,60,255,0,7,26,255,1,6,27,255,0,7,26,1,1,1,27,255,0,0,0,0,2,2,2,255,0,48,2,2,255,0,24
0053CB  3  00 07 1A FF  
0053CF  3  01 06 1B FF  
0053EA  3  02 02 02 FF          .byte 2,2,2,255,0,8,2,2,255,0,4,2,2,255,0,63,255,2,4,255,0,62,255,14,30,255,15,60
0053EE  3  00 08 02 02  
0053F2  3  FF 00 04 02  
005406  3  FF 01 3C FF          .byte 255,1,60,255,0,7,26,255,1,7,27,255,0,6,26,255,1,7,255,0,0,255,0,39,255,2,4,255,0,23,2,2,255,0,38
00540A  3  00 07 1A FF  
00540E  3  01 07 1B FF  
005429  3  FF 02 04 FF          .byte 255,2,4,255,0,30,2,2,2,255,0,5,2,2,2,0,0,2,2,255,0,69,255,14,30,255,15,60
00542D  3  00 1E 02 02  
005431  3  02 FF 00 05  
005445  3  FF 01 40 1B          .byte 255,1,64,27,255,0,5,26,255,1,14,27,255,0,221,255,2,5,255,0,49,255,2,4,255,0,10,2,2,255,0,30,2,2
005449  3  FF 00 05 1A  
00544D  3  FF 01 0E 1B  
005467  3  FF 00 1E 02          .byte 255,0,30,2,2,255,0,30,2,2,255,0,63,2,2,255,0,32,255,14,30,255,15,60
00546B  3  02 FF 00 1E  
00546F  3  02 02 FF 00  
00547F  3  FF 01 3C FF          .byte 255,1,60,255,0,5,26,255,1,6,27,255,0,0,255,0,73,255,2,5,255,0,75,2,2,2,0,0,2,2,2,255,0,13
005483  3  00 05 1A FF  
005487  3  01 06 1B FF  
0054A1  3  FF 02 05 FF          .byte 255,2,5,255,0,62,255,14,30,255,15,60
0054A5  3  00 3E FF 0E  
0054A9  3  1E FF 0F 3C  
0054AD  3  FF 01 3C FF          .byte 255,1,60,255,0,5,26,1,1,1,27,255,0,14,26,255,1,5,255,0,27,26,1,1,255,0,25,16,16,0,26,1,255,0,25
0054B1  3  00 05 1A 01  
0054B5  3  01 01 1B FF  
0054D0  3  10 10 00 00          .byte 16,16,0,0,1,255,0,25,12,12,0,0,26,255,0,26,12,12,255,0,20,2,2,0,0,0,255,13,7,255,0,21,255,13,9
0054D4  3  01 FF 00 19  
0054D8  3  0C 0C 00 00  
0054F3  3  FF 00 14 FF          .byte 255,0,20,255,13,10,255,0,14,2,2,0,0,0,13,13,13,0,0,0,255,13,5,255,0,10,2,2,255,0,7,13,13,13
0054F7  3  0D 0A FF 00  
0054FB  3  0E 02 02 00  
005515  3  00 00 00 0D          .byte 0,0,0,13,13,255,0,21,255,13,5,0,0,0,13,255,0,21,255,13,6,0,0,13,13,255,0,9,2,2,255,0,9
005519  3  0D FF 00 15  
00551D  3  FF 0D 05 00  
005536  3  0D 0D 00 FF          .byte 13,13,0,255,13,9,255,0,18,13,13,0,0,255,13,8,0,0,255,2,4,255,0,12,13,13,0,0,0,255,13,7,255,0,19
00553A  3  0D 09 FF 00  
00553E  3  12 0D 0D 00  
005559  3  0D 0D FF 00          .byte 13,13,255,0,4,255,13,5,255,14,19,13,13,13,255,0,8,255,15,20,255,13,4,255,0,6,255,15,22,255,13,8
00555D  3  04 FF 0D 05  
005561  3  FF 0E 13 0D  
005579  3  FF 00 00 FF          .byte 255,0,0,255,0,144,255,20,12,255,0,12,255,20,18,255,0,12,255,20,19,255,0,12,255,20,18,255,0,12,255,20,18
00557D  3  00 90 FF 14  
005581  3  0C FF 00 0C  
00559A  3  FF 00 7F             .byte 255,0,127
00559D  3               numsc:
00559D  3  2F                   .byte 47
00559E  3               .out .sprintf("SCREENS SIZE = %d", (* - scdat))
00559E  3               
00559E  3               nmedat:
00559E  3  00 05 A0 48          .byte 0,5,160,72,6,2,80,208,255
0055A2  3  06 02 50 D0  
0055A6  3  FF           
0055A7  3  00 01 A0 60          .byte 0,1,160,96,255
0055AB  3  FF           
0055AC  3  01 04 10 D8          .byte 1,4,16,216,1,4,32,24,1,4,8,48,1,4,16,88,1,4,40,192,1,4,8,152,0,1,120,120,1,4,8,72,255
0055B0  3  01 04 20 18  
0055B4  3  01 04 08 30  
0055CD  3  01 04 88 18          .byte 1,4,136,24,0,1,112,104,1,4,64,224,1,4,72,48,255
0055D1  3  00 01 70 68  
0055D5  3  01 04 40 E0  
0055DE  3  00 01 70 58          .byte 0,1,112,88,1,4,104,16,1,4,104,208,1,4,56,184,255
0055E2  3  01 04 68 10  
0055E6  3  01 04 68 D0  
0055EF  3  00 00 60 98          .byte 0,0,96,152,1,4,136,24,1,4,72,224,1,4,120,104,1,4,88,192,255
0055F3  3  01 04 88 18  
0055F7  3  01 04 48 E0  
005604  3  00 01 48 78          .byte 0,1,72,120,1,4,56,64,1,4,64,176,1,4,64,208,1,4,104,160,255
005608  3  01 04 38 40  
00560C  3  01 04 40 B0  
005619  3  00 01 68 78          .byte 0,1,104,120,1,4,112,88,1,4,112,152,1,4,112,216,1,4,136,104,8,9,128,40,255
00561D  3  01 04 70 58  
005621  3  01 04 70 98  
005632  3  00 00 78 B0          .byte 0,0,120,176,1,4,72,192,1,4,80,128,1,4,64,208,1,4,128,24,255
005636  3  01 04 48 C0  
00563A  3  01 04 50 80  
005647  3  00 01 68 38          .byte 0,1,104,56,1,4,88,80,1,4,64,32,1,4,64,208,1,4,72,152,255
00564B  3  01 04 58 50  
00564F  3  01 04 40 20  
00565C  3  00 01 58 78          .byte 0,1,88,120,1,4,64,64,1,4,72,192,1,4,24,40,1,4,8,200,255
005660  3  01 04 40 40  
005664  3  01 04 48 C0  
005671  3  00 01 58 70          .byte 0,1,88,112,1,4,136,208,1,4,112,144,1,4,104,88,1,4,128,40,255
005675  3  01 04 88 D0  
005679  3  01 04 70 90  
005686  3  00 01 28 28          .byte 0,1,40,40,1,4,64,184,1,4,72,40,8,9,120,192,255
00568A  3  01 04 40 B8  
00568E  3  01 04 48 28  
005697  3  00 01 48 78          .byte 0,1,72,120,1,4,120,144,1,4,168,152,1,4,160,72,1,4,104,112,255
00569B  3  01 04 78 90  
00569F  3  01 04 A8 98  
0056AC  3  00 00 58 78          .byte 0,0,88,120,1,4,80,48,1,4,104,144,1,4,96,200,255
0056B0  3  01 04 50 30  
0056B4  3  01 04 68 90  
0056BD  3  00 01 38 78          .byte 0,1,56,120,1,4,80,120,1,4,96,208,1,4,112,48,8,9,120,120,255
0056C1  3  01 04 50 78  
0056C5  3  01 04 60 D0  
0056D2  3  00 00 30 B0          .byte 0,0,48,176,1,4,64,40,1,4,48,128,1,4,48,96,2,3,112,56,2,3,152,192,255
0056D6  3  01 04 40 28  
0056DA  3  01 04 30 80  
0056EB  3  00 01 40 60          .byte 0,1,64,96,1,4,88,152,1,4,160,56,255
0056EF  3  01 04 58 98  
0056F3  3  01 04 A0 38  
0056F8  3  00 01 50 10          .byte 0,1,80,16,1,4,48,216,1,4,112,32,1,4,112,144,255
0056FC  3  01 04 30 D8  
005700  3  01 04 70 20  
005709  3  00 00 A0 E0          .byte 0,0,160,224,1,4,48,40,1,4,32,176,1,4,16,88,255
00570D  3  01 04 30 28  
005711  3  01 04 20 B0  
00571A  3  00 01 38 38          .byte 0,1,56,56,2,3,112,192,2,3,112,64,1,4,24,208,1,4,88,112,255
00571E  3  02 03 70 C0  
005722  3  02 03 70 40  
00572F  3  00 01 88 98          .byte 0,1,136,152,1,4,128,200,1,4,104,56,1,4,80,216,255
005733  3  01 04 80 C8  
005737  3  01 04 68 38  
005740  3  00 01 10 70          .byte 0,1,16,112,2,3,128,136,255
005744  3  02 03 80 88  
005748  3  FF           
005749  3  00 01 88 70          .byte 0,1,136,112,1,4,104,96,1,4,72,160,1,4,80,80,8,9,136,24,255
00574D  3  01 04 68 60  
005751  3  01 04 48 A0  
00575E  3  00 01 30 68          .byte 0,1,48,104,1,4,128,24,1,4,80,168,2,3,136,192,255
005762  3  01 04 80 18  
005766  3  01 04 50 A8  
00576F  3  00 01 20 18          .byte 0,1,32,24,2,3,32,56,2,3,72,168,2,3,120,56,255
005773  3  02 03 20 38  
005777  3  02 03 48 A8  
005780  3  07 07 80 30          .byte 7,7,128,48,7,7,72,176,7,7,136,136,0,1,56,64,255
005784  3  07 07 48 B0  
005788  3  07 07 88 88  
005791  3  00 01 60 78          .byte 0,1,96,120,2,3,128,40,2,3,128,208,7,7,40,40,255
005795  3  02 03 80 28  
005799  3  02 03 80 D0  
0057A2  3  00 01 28 30          .byte 0,1,40,48,7,7,32,192,7,7,128,40,8,9,72,136,255
0057A6  3  07 07 20 C0  
0057AA  3  07 07 80 28  
0057B3  3  00 01 68 78          .byte 0,1,104,120,2,3,136,32,2,3,136,80,2,3,136,224,2,3,136,144,255
0057B7  3  02 03 88 20  
0057BB  3  02 03 88 50  
0057C8  3  00 01 28 70          .byte 0,1,40,112,1,4,120,168,1,4,96,208,1,4,152,64,1,4,96,32,255
0057CC  3  01 04 78 A8  
0057D0  3  01 04 60 D0  
0057DD  3  FF FF FF FF          .byte 255,255,255,255,255,255,255,255,0,1,120,120,5,6,32,216,1,4,56,32,1,4,72,208,255
0057E1  3  FF FF FF FF  
0057E5  3  00 01 78 78  
0057F6  3  00 01 68 18          .byte 0,1,104,24,5,6,136,224,8,9,88,160,255
0057FA  3  05 06 88 E0  
0057FE  3  08 09 58 A0  
005803  3  00 01 68 18          .byte 0,1,104,24,5,6,80,208,255
005807  3  05 06 50 D0  
00580B  3  FF           
00580C  3  00 01 70 18          .byte 0,1,112,24,5,6,128,208,255
005810  3  05 06 80 D0  
005814  3  FF           
005815  3  00 01 58 18          .byte 0,1,88,24,5,6,72,232,255
005819  3  05 06 48 E8  
00581D  3  FF           
00581E  3  00 01 78 18          .byte 0,1,120,24,5,6,88,224,8,9,96,112,255
005822  3  05 06 58 E0  
005826  3  08 09 60 70  
00582B  3  00 01 80 18          .byte 0,1,128,24,7,7,56,32,3,6,40,136,255
00582F  3  07 07 38 20  
005833  3  03 06 28 88  
005838  3  00 01 80 78          .byte 0,1,128,120,255
00583C  3  FF           
00583D  3               .out .sprintf("POSITIONS SIZE = %d", (* - nmedat))
00583D  3               
00583D  3               NUMOBJ = 41
00583D  3               objdta:
00583D  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,3,129,16,3,129,16
005841  3  00 00 00 00  
005845  3  00 00 00 00  
005863  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,3,56,224,3,56,224
005867  3  00 00 00 00  
00586B  3  00 00 00 00  
005889  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,4,96,16,4,96,16
00588D  3  00 00 00 00  
005891  3  00 00 00 00  
0058AF  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,4,48,184,4,48,184
0058B3  3  00 00 00 00  
0058B7  3  00 00 00 00  
0058D5  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,5,128,24,5,128,24
0058D9  3  00 00 00 00  
0058DD  3  00 00 00 00  
0058FB  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,5,64,224,5,64,224
0058FF  3  00 00 00 00  
005903  3  00 00 00 00  
005921  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,6,48,72,6,48,72
005925  3  00 00 00 00  
005929  3  00 00 00 00  
005947  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,6,56,216,6,56,216
00594B  3  00 00 00 00  
00594F  3  00 00 00 00  
00596D  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,7,104,56,7,104,56
005971  3  00 00 00 00  
005975  3  00 00 00 00  
005993  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,8,72,16,8,72,16
005997  3  00 00 00 00  
00599B  3  00 00 00 00  
0059B9  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,7,104,184,7,104,184
0059BD  3  00 00 00 00  
0059C1  3  00 00 00 00  
0059DF  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,8,72,224,8,72,224
0059E3  3  00 00 00 00  
0059E7  3  00 00 00 00  
005A05  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,9,152,24,9,152,24
005A09  3  00 00 00 00  
005A0D  3  00 00 00 00  
005A2B  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,9,152,48,9,152,48
005A2F  3  00 00 00 00  
005A33  3  00 00 00 00  
005A51  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,9,152,72,9,152,72
005A55  3  00 00 00 00  
005A59  3  00 00 00 00  
005A77  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,9,152,96,9,152,96
005A7B  3  00 00 00 00  
005A7F  3  00 00 00 00  
005A9D  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,9,152,120,9,152,120
005AA1  3  00 00 00 00  
005AA5  3  00 00 00 00  
005AC3  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,9,152,144,9,152,144
005AC7  3  00 00 00 00  
005ACB  3  00 00 00 00  
005AE9  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,9,152,168,9,152,168
005AED  3  00 00 00 00  
005AF1  3  00 00 00 00  
005B0F  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,9,152,192,9,152,192
005B13  3  00 00 00 00  
005B17  3  00 00 00 00  
005B35  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,11,64,16,11,64,16
005B39  3  00 00 00 00  
005B3D  3  00 00 00 00  
005B5B  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,11,88,176,11,88,176
005B5F  3  00 00 00 00  
005B63  3  00 00 00 00  
005B81  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,12,56,208,12,56,208
005B85  3  00 00 00 00  
005B89  3  00 00 00 00  
005BA7  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,12,152,32,12,152,32
005BAB  3  00 00 00 00  
005BAF  3  00 00 00 00  
005BCD  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,14,136,16,14,136,16
005BD1  3  00 00 00 00  
005BD5  3  00 00 00 00  
005BF3  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,14,40,224,14,40,224
005BF7  3  00 00 00 00  
005BFB  3  00 00 00 00  
005C19  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,15,88,24,15,88,24
005C1D  3  00 00 00 00  
005C21  3  00 00 00 00  
005C3F  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,15,64,208,15,64,208
005C43  3  00 00 00 00  
005C47  3  00 00 00 00  
005C65  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,16,32,224,16,32,224
005C69  3  00 00 00 00  
005C6D  3  00 00 00 00  
005C8B  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,16,112,16,16,112,16
005C8F  3  00 00 00 00  
005C93  3  00 00 00 00  
005CB1  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,17,144,56,17,144,56
005CB5  3  00 00 00 00  
005CB9  3  00 00 00 00  
005CD7  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,17,32,224,17,32,224
005CDB  3  00 00 00 00  
005CDF  3  00 00 00 00  
005CFD  3  00 00 20 00          .byte 0,0,32,0,0,8,1,28,16,8,56,0,17,128,0,193,7,240,37,208,15,120,9,200,4,16,70,48,1,194,0,0,45,40,208,45,40,208
005D01  3  00 08 01 1C  
005D05  3  10 08 38 00  
005D23  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,20,88,216,20,88,216
005D27  3  00 00 00 00  
005D2B  3  00 00 00 00  
005D49  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,21,72,40,21,72,40
005D4D  3  00 00 00 00  
005D51  3  00 00 00 00  
005D6F  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,23,80,216,23,80,216
005D73  3  00 00 00 00  
005D77  3  00 00 00 00  
005D95  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,24,56,16,24,56,16
005D99  3  00 00 00 00  
005D9D  3  00 00 00 00  
005DBB  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,26,104,184,26,104,184
005DBF  3  00 00 00 00  
005DC3  3  00 00 00 00  
005DE1  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,30,144,112,30,144,112
005DE5  3  00 00 00 00  
005DE9  3  00 00 00 00  
005E07  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,28,136,200,28,136,200
005E0B  3  00 00 00 00  
005E0F  3  00 00 00 00  
005E2D  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,192,7,240,5,208,15,120,9,200,4,16,6,48,1,192,0,0,39,104,24,39,104,24
005E31  3  00 00 00 00  
005E35  3  00 00 00 00  
005E53  3               .out .sprintf("OBJECTS SIZE = %d", (* - objdta))
005E53  3               
005E53  3               font:
005E53  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0
005E57  3  00 00 00 00  
005E5B  3  00 30 30 30          .byte 0,48,48,48,48,0,48,0
005E5F  3  30 00 30 00  
005E63  3  00 6C 6C 00          .byte 0,108,108,0,0,0,0,0
005E67  3  00 00 00 00  
005E6B  3  00 6C FE 6C          .byte 0,108,254,108,108,254,108,0
005E6F  3  6C FE 6C 00  
005E73  3  00 18 7E 78          .byte 0,24,126,120,126,30,126,24
005E77  3  7E 1E 7E 18  
005E7B  3  00 E6 EC 18          .byte 0,230,236,24,48,110,206,0
005E7F  3  30 6E CE 00  
005E83  3  00 30 78 30          .byte 0,48,120,48,126,204,126,0
005E87  3  7E CC 7E 00  
005E8B  3  00 18 30 00          .byte 0,24,48,0,0,0,0,0
005E8F  3  00 00 00 00  
005E93  3  00 0C 18 18          .byte 0,12,24,24,24,24,12,0
005E97  3  18 18 0C 00  
005E9B  3  00 60 30 30          .byte 0,96,48,48,48,48,96,0
005E9F  3  30 30 60 00  
005EA3  3  00 00 3C 18          .byte 0,0,60,24,126,24,60,0
005EA7  3  7E 18 3C 00  
005EAB  3  00 00 18 18          .byte 0,0,24,24,126,24,24,0
005EAF  3  7E 18 18 00  
005EB3  3  00 00 00 00          .byte 0,0,0,0,0,24,24,48
005EB7  3  00 18 18 30  
005EBB  3  00 00 00 00          .byte 0,0,0,0,126,0,0,0
005EBF  3  7E 00 00 00  
005EC3  3  00 00 00 00          .byte 0,0,0,0,0,56,56,0
005EC7  3  00 38 38 00  
005ECB  3  00 00 06 0C          .byte 0,0,6,12,24,48,96,0
005ECF  3  18 30 60 00  
005ED3  3  00 7C CE DE          .byte 0,124,206,222,246,230,124,80
005ED7  3  F6 E6 7C 50  
005EDB  3  00 38 78 18          .byte 0,56,120,24,88,24,126,34
005EDF  3  58 18 7E 22  
005EE3  3  00 7C D6 06          .byte 0,124,214,6,124,192,254,70
005EE7  3  7C C0 FE 46  
005EEB  3  00 7C C6 5C          .byte 0,124,198,92,22,198,124,36
005EEF  3  16 C6 7C 24  
005EF3  3  00 18 38 78          .byte 0,24,56,120,216,254,88,72
005EF7  3  D8 FE 58 48  
005EFB  3  00 FE C0 FC          .byte 0,254,192,252,22,198,124,36
005EFF  3  16 C6 7C 24  
005F03  3  00 7C C0 FC          .byte 0,124,192,252,206,198,124,72
005F07  3  CE C6 7C 48  
005F0B  3  00 FE A6 8E          .byte 0,254,166,142,24,50,50,0
005F0F  3  18 32 32 00  
005F13  3  00 7C C6 7C          .byte 0,124,198,124,214,198,124,36
005F17  3  D6 C6 7C 24  
005F1B  3  00 7C D6 C6          .byte 0,124,214,198,126,6,124,80
005F1F  3  7E 06 7C 50  
005F23  3  00 00 00 30          .byte 0,0,0,48,0,0,48,0
005F27  3  00 00 30 00  
005F2B  3  00 00 30 00          .byte 0,0,48,0,0,48,48,96
005F2F  3  00 30 30 60  
005F33  3  00 00 0C 18          .byte 0,0,12,24,48,24,12,0
005F37  3  30 18 0C 00  
005F3B  3  00 00 00 7E          .byte 0,0,0,126,0,126,0,0
005F3F  3  00 7E 00 00  
005F43  3  00 00 30 18          .byte 0,0,48,24,12,24,48,0
005F47  3  0C 18 30 00  
005F4B  3  00 7C C6 0C          .byte 0,124,198,12,24,0,24,0
005F4F  3  18 00 18 00  
005F53  3  00 7C DE FE          .byte 0,124,222,254,254,192,124,0
005F57  3  FE C0 7C 00  
005F5B  3  00 7C E6 C6          .byte 0,124,230,198,254,214,198,66
005F5F  3  FE D6 C6 42  
005F63  3  00 FC C6 FC          .byte 0,252,198,252,214,198,254,132
005F67  3  D6 C6 FE 84  
005F6B  3  00 7C F6 D0          .byte 0,124,246,208,192,198,252,36
005F6F  3  C0 C6 FC 24  
005F73  3  00 F8 EC C6          .byte 0,248,236,198,198,206,248,160
005F77  3  C6 CE F8 A0  
005F7B  3  00 FE C2 FA          .byte 0,254,194,250,200,192,254,144
005F7F  3  C8 C0 FE 90  
005F83  3  00 FE C2 FC          .byte 0,254,194,252,196,192,196,64
005F87  3  C4 C0 C4 40  
005F8B  3  00 7C D6 C0          .byte 0,124,214,192,222,198,126,34
005F8F  3  DE C6 7E 22  
005F93  3  00 C6 C6 FE          .byte 0,198,198,254,214,198,214,82
005F97  3  D6 C6 D6 52  
005F9B  3  00 7E 1A 5A          .byte 0,126,26,90,24,24,126,34
005F9F  3  18 18 7E 22  
005FA3  3  00 06 06 06          .byte 0,6,6,6,198,198,124,36
005FA7  3  C6 C6 7C 24  
005FAB  3  00 CC D8 F0          .byte 0,204,216,240,216,220,198,144
005FAF  3  D8 DC C6 90  
005FB3  3  00 C0 C0 C0          .byte 0,192,192,192,192,192,254,66
005FB7  3  C0 C0 FE 42  
005FBB  3  00 C6 EE FE          .byte 0,198,238,254,214,198,214,18
005FBF  3  D6 C6 D6 12  
005FC3  3  00 C6 E6 F6          .byte 0,198,230,246,222,206,206,136
005FC7  3  DE CE CE 88  
005FCB  3  00 7C D6 C6          .byte 0,124,214,198,214,198,124,36
005FCF  3  D6 C6 7C 24  
005FD3  3  00 FC C6 C6          .byte 0,252,198,198,252,212,192,64
005FD7  3  FC D4 C0 40  
005FDB  3  00 7C D6 C6          .byte 0,124,214,198,246,222,124,4
005FDF  3  F6 DE 7C 04  
005FE3  3  00 FC E6 C6          .byte 0,252,230,198,252,204,198,66
005FE7  3  FC CC C6 42  
005FEB  3  00 7C C0 7C          .byte 0,124,192,124,22,198,124,32
005FEF  3  16 C6 7C 20  
005FF3  3  00 FE B6 32          .byte 0,254,182,50,176,50,48,16
005FF7  3  B0 32 30 10  
005FFB  3  00 C6 C6 C6          .byte 0,198,198,198,198,198,124,64
005FFF  3  C6 C6 7C 40  
006003  3  00 C6 C6 C6          .byte 0,198,198,198,198,236,120,72
006007  3  C6 EC 78 48  
00600B  3  00 C6 C6 C6          .byte 0,198,198,198,198,254,108,64
00600F  3  C6 FE 6C 40  
006013  3  00 C6 6E 3A          .byte 0,198,110,58,56,108,198,128
006017  3  38 6C C6 80  
00601B  3  00 86 CC 7A          .byte 0,134,204,122,48,50,48,18
00601F  3  30 32 30 12  
006023  3  00 FE 8C 98          .byte 0,254,140,152,48,96,254,66
006027  3  30 60 FE 42  
00602B  3  00 1E 18 18          .byte 0,30,24,24,24,24,30,0
00602F  3  18 18 1E 00  
006033  3  00 00 C0 60          .byte 0,0,192,96,48,24,12,0
006037  3  30 18 0C 00  
00603B  3  00 F0 30 30          .byte 0,240,48,48,48,48,240,0
00603F  3  30 30 F0 00  
006043  3  00 30 78 FC          .byte 0,48,120,252,48,48,48,0
006047  3  30 30 30 00  
00604B  3  00 00 00 00          .byte 0,0,0,0,0,0,0,255
00604F  3  00 00 00 FF  
006053  3  00 3C 66 F8          .byte 0,60,102,248,96,96,254,0
006057  3  60 60 FE 00  
00605B  3  00 00 78 0C          .byte 0,0,120,12,124,204,124,0
00605F  3  7C CC 7C 00  
006063  3  00 60 60 7C          .byte 0,96,96,124,102,102,124,0
006067  3  66 66 7C 00  
00606B  3  00 00 3C 60          .byte 0,0,60,96,96,96,60,0
00606F  3  60 60 3C 00  
006073  3  00 0C 0C 7C          .byte 0,12,12,124,204,204,124,0
006077  3  CC CC 7C 00  
00607B  3  00 00 78 CC          .byte 0,0,120,204,248,192,124,0
00607F  3  F8 C0 7C 00  
006083  3  00 1C 30 38          .byte 0,28,48,56,48,48,48,0
006087  3  30 30 30 00  
00608B  3  00 00 7C CC          .byte 0,0,124,204,204,124,12,120
00608F  3  CC 7C 0C 78  
006093  3  00 C0 C0 F8          .byte 0,192,192,248,204,204,204,0
006097  3  CC CC CC 00  
00609B  3  00 30 00 70          .byte 0,48,0,112,48,48,120,0
00609F  3  30 30 78 00  
0060A3  3  00 0C 00 0C          .byte 0,12,0,12,12,12,108,56
0060A7  3  0C 0C 6C 38  
0060AB  3  00 60 78 70          .byte 0,96,120,112,112,120,108,0
0060AF  3  70 78 6C 00  
0060B3  3  00 30 30 30          .byte 0,48,48,48,48,48,28,0
0060B7  3  30 30 1C 00  
0060BB  3  00 00 F8 FC          .byte 0,0,248,252,252,252,252,0
0060BF  3  FC FC FC 00  
0060C3  3  00 00 F8 CC          .byte 0,0,248,204,204,204,204,0
0060C7  3  CC CC CC 00  
0060CB  3  00 00 78 CC          .byte 0,0,120,204,204,204,120,0
0060CF  3  CC CC 78 00  
0060D3  3  00 00 F8 CC          .byte 0,0,248,204,204,248,192,192
0060D7  3  CC F8 C0 C0  
0060DB  3  00 00 7C CC          .byte 0,0,124,204,204,124,12,14
0060DF  3  CC 7C 0C 0E  
0060E3  3  00 00 3C 60          .byte 0,0,60,96,96,96,96,0
0060E7  3  60 60 60 00  
0060EB  3  00 00 78 C0          .byte 0,0,120,192,120,12,248,0
0060EF  3  78 0C F8 00  
0060F3  3  00 30 78 30          .byte 0,48,120,48,48,48,28,0
0060F7  3  30 30 1C 00  
0060FB  3  00 00 CC CC          .byte 0,0,204,204,204,204,120,0
0060FF  3  CC CC 78 00  
006103  3  00 00 CC CC          .byte 0,0,204,204,120,120,48,0
006107  3  78 78 30 00  
00610B  3  00 00 CC FC          .byte 0,0,204,252,252,252,120,0
00610F  3  FC FC 78 00  
006113  3  00 00 CC 78          .byte 0,0,204,120,48,120,204,0
006117  3  30 78 CC 00  
00611B  3  00 00 CC CC          .byte 0,0,204,204,204,124,12,120
00611F  3  CC 7C 0C 78  
006123  3  00 00 FC 18          .byte 0,0,252,24,48,96,252,0
006127  3  30 60 FC 00  
00612B  3  00 1E 18 70          .byte 0,30,24,112,24,24,30,0
00612F  3  18 18 1E 00  
006133  3  00 18 18 18          .byte 0,24,24,24,24,24,24,0
006137  3  18 18 18 00  
00613B  3  00 F0 30 1C          .byte 0,240,48,28,48,48,240,0
00613F  3  30 30 F0 00  
006143  3  00 3C 78 00          .byte 0,60,120,0,0,0,0,0
006147  3  00 00 00 00  
00614B  3  7C C6 BB E3          .byte 124,198,187,227,227,187,198,124
00614F  3  E3 BB C6 7C  
006153  3               .out .sprintf("FONT SIZE = %d", (* - font))
006153  3               
006153  3  42 61 68 48  keys:   .byte 66,97,104,72,98,16,55,48,49,17,18
006157  3  62 10 37 30  
00615B  3  31 11 12     
00615E  3               .out .sprintf("KEYS SIZE = %d", (* - keys))
00615E  3               
00615E  3               data_end:
00615E  3               .out .sprintf("TOTAL DATA SIZE = %d", (* - data_start))
00615E  3               
00615E  2               
00615E  1               
00615E  1               end_asm:
00615E  1               
00615E  1               ;----------------------------------------------------------------------
00615E  1               ; RELOCATION OF BEEB CODE FROM LOAD ADDRESS
00615E  1               ;----------------------------------------------------------------------
00615E  1               
00615E  1               relocate:
00615E  1               ; Issue *TAPE otherwise DFS goes mental that we've overwritten workspace from &E00 - &1100
00615E  1               
00615E  1  A9 8C            lda #$8C
006160  1  A2 0C            ldx #$0C
006162  1  A0 00            ldy #$00
006164  1  20 F4 FF         jsr OSBYTE					; *FX &8C,0,0 - *TAPE 1200
006167  1               
006167  1               ; Other one off initialisation could happen here...
006167  1               
006167  1               ; Relocate all code down to &E00
006167  1  A2 54        	ldx #>(end_asm - start_asm) + 1
006169  1  A0 00        	ldy #0
00616B  1               reloop:
00616B  1  B9 00 12     	lda load_address, y
00616E  1  99 00 0E     	sta asm_code, y
006171  1  C8           	iny
006172  1  D0 F7        	bne reloop
006174  1  EE 6D 65     	inc reloop + 2 + load_address - asm_code
006177  1  EE 70 65     	inc reloop + 5 + load_address - asm_code
00617A  1  CA           	dex
00617B  1  D0 EE        	bne reloop
00617D  1  4C 03 0E     	jmp boot_game
00617D  1               
