ca65 V2.17 - Git cc5c093
Main file   : game.asm
Current file: game.asm

000000r 1               ;----------------------------------------------
000000r 1               ; BBC AGD Engine
000000r 1               ; Z80 conversion by Kees van Oss 2017
000000r 1               ; BBC Micro version by Kieran Connell 2018
000000r 1               ;----------------------------------------------
000000r 1               
000000r 1               .DEFINE asm_code $0e00		; assembly address _BEEB
000000r 1               .DEFINE load_address $1200	; load address _BEEB
000000r 1               
000000r 1               ;----------------------------------------------------------------------
000000r 1               ; BBC MICRO PLATFORM DEFINES
000000r 1               ;----------------------------------------------------------------------
000000r 1               
000000r 1               ; _BEEB MOS calls
000000r 1               
000000r 1               	OSBYTE	 = $fff4
000000r 1               	OSFILE	 = $ffdd
000000r 1               	OSWRCH	 = $ffee
000000r 1               	OSASCI	 = $ffe3
000000r 1               	OSWORD	 = $fff1
000000r 1               	OSFIND	 = $ffce
000000r 1               	OSGBPB	 = $ffd1
000000r 1               	OSARGS	 = $ffda
000000r 1               
000000r 1               	EVENTV	 = $0220
000000r 1               
000000r 1               	PAL_black = 0 ^ 7
000000r 1               	PAL_red = 1 ^ 7
000000r 1               	PAL_green = 2 ^ 7
000000r 1               	PAL_yellow = 3 ^ 7
000000r 1               	PAL_blue = 4 ^ 7
000000r 1               	PAL_magenta = 5 ^ 7
000000r 1               	PAL_cyan = 6 ^ 7
000000r 1               	PAL_white = 7 ^ 7
000000r 1               
000000r 1               ; System constants
000000r 1               
000000r 1               	ScreenSize  = $1800	; Startaddress video RAM _BEEB
000000r 1               	ScreenAddr 	= $8000 - ScreenSize	; Screen size bytes _BEEB
000000r 1               	ScreenRowBytes = 256				; 40 columns
000000r 1               
000000r 1               	SpriteMaxY	= 177	; used for clipping bottom of screen
000000r 1               
000000r 1               ; AGD Engine Workspace
000000r 1               
000000r 1               	MAP 		= $300				; properties map buffer (3x256 bytes)
000000r 1               	SCADTB_lb	= MAP + $300
000000r 1               	SCADTB_hb	= SCADTB_lb + $100
000000r 1               
000000r 1               .if pflag
000000r 1                   SHRAPN 		= $B00 - (NUMSHR * SHRSIZ)	; shrapnel table (55x6 bytes)
000000r 1               .endif
000000r 1               
000000r 1               	sprtab		= $B00				; NUMSPR*TABSIZ
000000r 1               
000000r 1               	.macro DEBUG_PAL pal
000000r 1               	;	SET_PAL pal
000000r 1               	.endmacro
000000r 1               
000000r 1               	.macro SET_PAL pal
000000r 1               		lda #$00+pal
000000r 1               		sta $fe21
000000r 1               		lda #$10+pal
000000r 1               		sta $fe21
000000r 1               		lda #$20+pal
000000r 1               		sta $fe21
000000r 1               		lda #$30+pal
000000r 1               		sta $fe21
000000r 1               		lda #$40+pal
000000r 1               		sta $fe21
000000r 1               		lda #$50+pal
000000r 1               		sta $fe21
000000r 1               		lda #$60+pal
000000r 1               		sta $fe21
000000r 1               		lda #$70+pal
000000r 1               		sta $fe21
000000r 1               	.endmacro
000000r 1               
000000r 1               ;----------------------------------------------------------------------
000000r 1               ; ZERO PAGE SEGMENT
000000r 1               ;----------------------------------------------------------------------
000000r 1               
000000r 1               .segment "ZEROPAGE"
000000r 1               
000000r 1               .include "z80-zp.inc"
000000r 2               ;ws	 = $60
000000r 2               
000000r 2  xx           z80_f: .res 1;	 = ws+$00
000001r 2  xx           z80_a: .res 1;	 = ws+$01
000002r 2               z80_af	 = z80_f
000002r 2               
000002r 2  xx           z80_c: .res 1;	 = ws+$02
000003r 2  xx           z80_b: .res 1;	 = ws+$03
000004r 2               z80_bc	 = z80_c
000004r 2               
000004r 2  xx           z80_e: .res 1;	 = ws+$04
000005r 2  xx           z80_d: .res 1;	 = ws+$05
000006r 2               z80_de	 = z80_e
000006r 2               
000006r 2  xx           z80_l: .res 1;	 = ws+$06
000007r 2  xx           z80_h: .res 1;	 = ws+$07
000008r 2               z80_hl	 = z80_l
000008r 2               
000008r 2  xx           z80_x: .res 1;    = ws+$08
000009r 2  xx           z80_i: .res 1;    = ws+$09
00000Ar 2               z80_ix	 = z80_x
00000Ar 2               
00000Ar 2  xx xx        z80_iy: .res 2;	 = ws+$0a
00000Cr 2               
00000Cr 2  xx           z80_fp: .res 1;	 = ws+$0c
00000Dr 2  xx           z80_ap: .res 1;	 = ws+$0d
00000Er 2               
00000Er 2  xx           z80_cp: .res 1;	 = ws+$0e
00000Fr 2  xx           z80_bp: .res 1;	 = ws+$0f
000010r 2               z80_bcp	 = z80_cp
000010r 2               
000010r 2  xx           z80_ep: .res 1;	 = ws+$10
000011r 2  xx           z80_dp: .res 1;	 = ws+$11
000012r 2               z80_dep	 = z80_ep
000012r 2               
000012r 2  xx           z80_lp: .res 1;	 = ws+$12
000013r 2  xx           z80_hp: .res 1;	 = ws+$13
000014r 2               z80_hlp	 = z80_lp
000014r 2               
000014r 2  xx xx        z80_sp: .res 2;   = ws+$14
000016r 2               
000016r 2  xx           z80_reg0: .res 1; = ws+$16
000017r 2  xx           z80_reg1: .res 1; = ws+$17
000018r 2  xx           z80_reg2: .res 1; = ws+$18
000019r 2  xx           z80_reg3: .res 1; = ws+$19
00001Ar 2               
00001Ar 2               ;z80_r: .res 1;	 = ws+$1a
00001Ar 2               
00001Ar 1               .include "engine-zp.inc"
00001Ar 2               ;----------------------------------------------------------------------
00001Ar 2               ; AGD 6502 Engine Zero Page Variables
00001Ar 2               ;----------------------------------------------------------------------
00001Ar 2               
00001Ar 2               ; Variables start here.
00001Ar 2               
00001Ar 2  xx           scno:	.res 1			; present screen number.
00001Br 2  xx           numlif:	.res 1			; number of lives.
00001Cr 2               
00001Cr 2  xx           vara:	.res 1			; general-purpose variable.
00001Dr 2  xx           varb:	.res 1			; general-purpose variable.
00001Er 2  xx           varc:	.res 1			; general-purpose variable.
00001Fr 2  xx           vard:	.res 1			; general-purpose variable.
000020r 2  xx           vare:	.res 1			; general-purpose variable.
000021r 2  xx           varf:	.res 1			; general-purpose variable.
000022r 2  xx           varg:	.res 1			; general-purpose variable.
000023r 2  xx           varh:	.res 1			; general-purpose variable.
000024r 2  xx           vari:	.res 1			; general-purpose variable.
000025r 2  xx           varj:	.res 1			; general-purpose variable.
000026r 2  xx           vark:	.res 1			; general-purpose variable.
000027r 2  xx           varl:	.res 1			; general-purpose variable.
000028r 2  xx           varm:	.res 1			; general-purpose variable.
000029r 2  xx           varn:	.res 1			; general-purpose variable.
00002Ar 2  xx           varo:	.res 1			; general-purpose variable.
00002Br 2  xx           varp:	.res 1			; general-purpose variable.
00002Cr 2  xx           varq:	.res 1			; general-purpose variable.
00002Dr 2  xx           varr:	.res 1			; general-purpose variable.
00002Er 2  xx           vars:	.res 1			; general-purpose variable.
00002Fr 2  xx           vart:	.res 1			; general-purpose variable.
000030r 2  xx           varu:	.res 1			; general-purpose variable.
000031r 2  xx           varv:	.res 1			; general-purpose variable.
000032r 2  xx           varw:	.res 1			; general-purpose variable.
000033r 2  xx           varz:	.res 1			; general-purpose variable.
000034r 2               
000034r 2  xx           charx:	.res 1			; cursor x position.
000035r 2  xx           chary:	.res 1			; cursor y position.
000036r 2               
000036r 2  xx           clock:	.res 1			; last clock reading.
000037r 2  xx           varrnd:	.res 1	        ; last random number.
000038r 2  xx           varobj:	.res 1  	    ; last object number.
000039r 2  xx           varopt:	.res 1     		; last option chosen from menu.
00003Ar 2  xx           varblk:	.res 1  		; block type.
00003Br 2  xx           nexlev:	.res 1			; next level flag.
00003Cr 2  xx           restfl:	.res 1			; restart screen flag.
00003Dr 2  xx           deadf:	.res 1			; dead flag.
00003Er 2  xx           gamwon:	.res 1			; game won flag.
00003Fr 2  xx           dispx:	.res 1			; cursor x position.
000040r 2  xx           dispy:	.res 1			; cursor y position.
000041r 2               
000041r 2  xx           contrl:	.res 1			; control = keyboard, 1 = Kempston, 2 = Sinclair, 3 = Mouse.
000042r 2  xx           joyval:	.res 1			; joystick reading.
000043r 2  xx           frmno:	.res 1			; selected frame.
000044r 2               
000044r 2               ;----------------------------------------------------
000044r 2               ; Missing vars
000044r 2               ;----------------------------------------------------
000044r 2               
000044r 2  xx           loopa:		.res 1
000045r 2  xx           loopb:		.res 1
000046r 2  xx           loopc:		.res 1
000047r 2  xx xx        FontPtr:    .res 2
000049r 2               
000049r 2               ; Local vars
000049r 2               
000049r 2  xx xx        scraddr:    .res 2
00004Br 2  xx xx        fntaddr:    .res 2
00004Dr 2  xx xx        tileaddr:   .res 2
00004Fr 2  xx xx        bufaddr:    .res 2
000051r 2               
000051r 2  xx xx        tmp:        .res 2
000053r 2  xx xx        scr_l:      .res 2
000055r 2  xx xx        scr_r:      .res 2
000057r 2  xx xx        scr_txt:    .res 2
000059r 2               
000059r 2  xx           xtmp:	    .res 1
00005Ar 2  xx           spcnt:	    .res 1
00005Br 2  xx xx        spptr:	    .res 2		; spawned sprite pointer.
00005Dr 2  xx           seed:	    .res 1		; seed for random numbers.
00005Er 2               
00005Er 2  xx           ccnt:       .res 1
00005Fr 2  xx           flag:	    .res 1
000060r 2  xx           rcol:	    .res 1
000061r 2  xx           rrow:	    .res 1
000062r 2               
000062r 2  xx           combyt:	    .res 1		; byte type compressed.
000063r 2  xx           comcnt:	    .res 1		; compression counter.
000064r 2  xx           prtmod:	    .res 1      ; print mode, 0 = standard, 1 = double-height.
000065r 2  xx           qscnt:	    .res 1
000066r 2               
000066r 2  xx           sprptr:	    .res 1      ; not a ptr
000067r 2  xx           sprcnt:	    .res 1
000068r 2               
000068r 2  xx xx        skptr:	    .res 2		; search pointer.
00006Ar 2  xx           sktptr:	    .res 1      ; not a ptr
00006Br 2  xx           tmproom:	.res 1
00006Cr 2  xx xx        ogptr:	    .res 2		; original sprite pointer.
00006Er 2               
00006Er 2  xx xx xx     spr:	    .res 3      ; static sprite data
000071r 2  xx           vsync_count:.res 1
000072r 2  xx           colpatt:	.res 1
000073r 2  xx           sprtmp:     .res 1
000074r 2  xx           sprtmp2:    .res 1
000075r 2  xx           sprshft:    .res 1
000076r 2               
000076r 2               .if mflag
000076r 2               TmpAddr:	.res 2
000076r 2               bwid:	    .res 1     ; box/menu width.
000076r 2               blen:	    .res 1     ; box/menu height.
000076r 2               btop:	    .res 1     ; box coordinates.
000076r 2               blft:	    .res 1
000076r 2               .endif
000076r 2               
000076r 2               .if pflag
000076r 2               shrctr:	    .res 1
000076r 2               explcnt:	.res 1
000076r 2               seed3:	    .res 1
000076r 2               .endif
000076r 2               
000076r 1               
000076r 1               ;----------------------------------------------------------------------
000076r 1               ; ZCODE SEGMENT
000076r 1               ;----------------------------------------------------------------------
000076r 1               
000076r 1               .segment "CODE"
000000r 1               .org asm_code
000E00  1               
000E00  1               start_asm:
000E00  1               
000E00  1  4C 81 6B     	jmp relocate + load_address - asm_code
000E03  1               
000E03  1               boot_game:
000E03  1               
000E03  1               ; Zero ZP vars
000E03  1               
000E03  1               clear_zp:
000E03  1  A2 00        	ldx #0
000E05  1  8A           	txa
000E06  1               	:
000E06  1  95 00        	sta $00, x
000E08  1  E8           	inx
000E09  1  E0 A0        	cpx #$a0
000E0B  1  D0 F9        	bne :-
000E0D  1               
000E0D  1               	; Init non-zero vars
000E0D  1  A9 03        	lda #3
000E0F  1  85 rr        	sta numlif
000E11  1               
000E11  1  A2 FF        	ldx #255
000E13  1  86 rr        	stx varrnd
000E15  1  86 rr        	stx varopt
000E17  1  86 rr        	stx varblk
000E19  1  CA           	dex
000E1A  1  86 rr        	stx varobj
000E1C  1               
000E1C  1  20 80 0E     	jsr bbcinit
000E1F  1               
000E1F  1               	; Call AGD Engine start game
000E1F  1  20 00 16     	jsr start_game
000E22  1               
000E22  1  20 9F 0E     	jsr bbckill
000E25  1               
000E25  1                   ; Wait for keypress
000E25  1  A2 FF        	ldx #$ff
000E27  1  A0 7F        	ldy #$7f
000E29  1  A9 81        	lda #$81
000E2B  1  20 F4 FF     	jsr OSBYTE
000E2E  1               
000E2E  1               	; Restart or exit
000E2E  1  4C 03 0E     	jmp boot_game
000E31  1               
000E31  1               ;----------------------------------------------------------------------
000E31  1               ; PLATFORM SPECIFIC ENGINE CODE
000E31  1               ;----------------------------------------------------------------------
000E31  1               
000E31  1               	.include "z80.asm"
000E31  2               ;------------------------------------------------------
000E31  2               ; z80.asm
000E31  2               ; spectrum stuff
000E31  2               ; adresses
000E31  2               
000E31  2               ;ws	 = $60
000E31  2               
000E31  2               ;z80_f	 = ws+$00
000E31  2               ;z80_a	 = ws+$01
000E31  2               ;z80_af	 = z80_f
000E31  2               
000E31  2               ;z80_c	 = ws+$02
000E31  2               ;z80_b	 = ws+$03
000E31  2               ;z80_bc	 = z80_c
000E31  2               
000E31  2               ;z80_e	 = ws+$04
000E31  2               ;z80_d	 = ws+$05
000E31  2               ;z80_de	 = z80_e
000E31  2               
000E31  2               ;z80_l	 = ws+$06
000E31  2               ;z80_h	 = ws+$07
000E31  2               ;z80_hl	 = z80_l
000E31  2               
000E31  2               ;z80_x    = ws+$08
000E31  2               ;z80_i    = ws+$09
000E31  2               ;z80_ix	 = z80_x
000E31  2               
000E31  2               ;z80_iy	 = ws+$0a
000E31  2               
000E31  2               ;z80_fp	 = ws+$0c
000E31  2               ;z80_ap	 = ws+$0d
000E31  2               
000E31  2               ;z80_cp	 = ws+$0e
000E31  2               ;z80_bp	 = ws+$0f
000E31  2               ;z80_bcp = z80_cp
000E31  2               
000E31  2               ;z80_ep	 = ws+$10
000E31  2               ;z80_dp	 = ws+$11
000E31  2               ;z80_dep = z80_ep
000E31  2               
000E31  2               ;z80_lp	 = ws+$12
000E31  2               ;z80_hp	 = ws+$13
000E31  2               ;z80_hlp = z80_lp
000E31  2               
000E31  2               ;z80_sp   = ws+$14
000E31  2               
000E31  2               ;z80_reg0 = ws+$16
000E31  2               ;z80_reg1 = ws+$17
000E31  2               ;z80_reg2 = ws+$18
000E31  2               ;z80_reg3 = ws+$19
000E31  2               
000E31  2               ;z80_r	 = ws+$1a
000E31  2               
000E31  2               ; Contains seperatly 1 bit set
000E31  2               ; _BEEB this is not safe memory to use as required by MOS
000E31  2               
000E31  2               _bitmem0	= $f8
000E31  2               _bitmem1	= $f9
000E31  2               _bitmem2	= $fa
000E31  2               _bitmem3	= $fb
000E31  2               _bitmem4	= $fc
000E31  2               _bitmem5	= $fd
000E31  2               _bitmem6	= $fe
000E31  2               _bitmem7	= $ff
000E31  2               
000E31  2               ; constants
000E31  2               _bitvalue0	= $01
000E31  2               _bitvalue1	= $02
000E31  2               _bitvalue2	= $04
000E31  2               _bitvalue3	= $08
000E31  2               _bitvalue4	= $10
000E31  2               _bitvalue5	= $20
000E31  2               _bitvalue6	= $40
000E31  2               _bitvalue7	= $80
000E31  2               
000E31  2               _notbitvalue0	= $fe
000E31  2               _notbitvalue1	= $fd
000E31  2               _notbitvalue2	= $fb
000E31  2               _notbitvalue3	= $f7
000E31  2               _notbitvalue4	= $ef
000E31  2               _notbitvalue5	= $df
000E31  2               _notbitvalue6	= $bf
000E31  2               _notbitvalue7	= $7f
000E31  2               
000E31  2               
000E31  2               ;add_hl_bc:
000E31  2               ;		lda z80_l
000E31  2               ;		clc
000E31  2               ;		adc z80_c
000E31  2               ;		sta z80_l
000E31  2               ;		lda z80_h
000E31  2               ;		adc z80_b
000E31  2               ;		sta z80_h
000E31  2               ;		rts
000E31  2               ;
000E31  2               ;add_ix_de:
000E31  2               ;		lda z80_ix
000E31  2               ;		clc
000E31  2               ;		adc z80_e
000E31  2               ;		sta z80_ix
000E31  2               ;		lda z80_ix+1
000E31  2               ;		adc z80_d
000E31  2               ;		sta z80_ix+1
000E31  2               ;		rts
000E31  2               ;
000E31  2               ;add_iy_de:
000E31  2               ;		lda z80_iy
000E31  2               ;		clc
000E31  2               ;		adc z80_e
000E31  2               ;		sta z80_iy
000E31  2               ;		lda z80_iy+1
000E31  2               ;		adc z80_d
000E31  2               ;		sta z80_iy+1
000E31  2               ;		rts
000E31  2               ;
000E31  2               ;add_hl_de:
000E31  2               ;		lda z80_l
000E31  2               ;		clc
000E31  2               ;		adc z80_e
000E31  2               ;		sta z80_l
000E31  2               ;		lda z80_h
000E31  2               ;		adc z80_d
000E31  2               ;		sta z80_h
000E31  2               ;		rts
000E31  2               ;
000E31  2               ;add_ix_bc:
000E31  2               ;		lda z80_ix
000E31  2               ;		clc
000E31  2               ;		adc z80_c
000E31  2               ;		sta z80_ix
000E31  2               ;		lda z80_ix+1
000E31  2               ;		adc z80_b
000E31  2               ;		sta z80_ix+1
000E31  2               ;		rts
000E31  2               ;
000E31  2               ;add_iy_bc:
000E31  2               ;		lda z80_iy
000E31  2               ;		clc
000E31  2               ;		adc z80_c
000E31  2               ;		sta z80_iy
000E31  2               ;		lda z80_iy+1
000E31  2               ;		adc z80_b
000E31  2               ;		sta z80_iy+1
000E31  2               ;		rts
000E31  2               ;
000E31  2               ;sbc_hl_de:
000E31  2               ;		lda z80_l
000E31  2               ;		sbc z80_e
000E31  2               ;		sta z80_l
000E31  2               ;		lda z80_h
000E31  2               ;		sbc z80_d
000E31  2               ;		sta z80_h
000E31  2               ;		rts
000E31  2               ;
000E31  2               ;sbc_hl_bc:
000E31  2               ;		lda z80_l
000E31  2               ;		sbc z80_c
000E31  2               ;		sta z80_l
000E31  2               ;		lda z80_h
000E31  2               ;		sbc z80_b
000E31  2               ;		sta z80_h
000E31  2               ;		rts
000E31  2               ;
000E31  2               ;cmp_hl_bc:
000E31  2               ;		lda z80_l
000E31  2               ;		cmp z80_c
000E31  2               ;		bne cmp_hl_bc_end
000E31  2               ;		lda z80_h
000E31  2               ;		cmp z80_b
000E31  2               ;cmp_hl_bc_end:
000E31  2               ;		rts
000E31  2               ;
000E31  2               ;cmp_iy_ix:
000E31  2               ;		lda z80_iy
000E31  2               ;		cmp z80_ix
000E31  2               ;		bne cmp_iy_ix_end
000E31  2               ;		lda z80_iy+1
000E31  2               ;		cmp z80_ix+1
000E31  2               ;cmp_iy_ix_end:
000E31  2               ;		rts
000E31  2               ;
000E31  2               ;dec_hl:
000E31  2               ;		lda z80_l
000E31  2               ;		bne dec_hl_no_dec_h
000E31  2               ;		dec z80_h
000E31  2               ;dec_hl_no_dec_h:
000E31  2               ;		dec z80_l
000E31  2               ;		rts
000E31  2               ;
000E31  2               ;dec_ix:
000E31  2               ;		lda z80_ix
000E31  2               ;		bne dec_ix_no_dec_h
000E31  2               ;		dec z80_ix+1
000E31  2               ;dec_ix_no_dec_h:
000E31  2               ;		dec z80_ix
000E31  2               ;		rts
000E31  2               ;
000E31  2               ;dec_bc:
000E31  2               ;		lda z80_c
000E31  2               ;		bne dec_bc_no_dec_b
000E31  2               ;		dec z80_b
000E31  2               ;dec_bc_no_dec_b:
000E31  2               ;		dec z80_c
000E31  2               ;		rts
000E31  2               ;
000E31  2               ;dec_de:
000E31  2               ;		lda z80_e
000E31  2               ;		bne dec_de_no_dec_d
000E31  2               ;		dec z80_d
000E31  2               ;dec_de_no_dec_d:
000E31  2               ;		dec z80_e
000E31  2               ;		rts
000E31  2               ;
000E31  2               ;ex_af_afs:
000E31  2               ;	rts
000E31  2               ;ex_de_hl:
000E31  2               ;		lda z80_e
000E31  2               ;		ldx z80_l
000E31  2               ;		stx z80_e
000E31  2               ;		sta z80_l
000E31  2               ;		lda z80_d
000E31  2               ;		ldx z80_h
000E31  2               ;		stx z80_d
000E31  2               ;		sta z80_h
000E31  2               ;		rts
000E31  2               ;
000E31  2               exx:
000E31  2  A5 rr        		lda z80_c
000E33  2  A4 rr        		ldy z80_cp
000E35  2  84 rr        		sty z80_c
000E37  2  85 rr        		sta z80_cp
000E39  2  A5 rr        		lda z80_b
000E3B  2  A4 rr        		ldy z80_bp
000E3D  2  84 rr        		sty z80_b
000E3F  2  85 rr        		sta z80_bp
000E41  2  A5 rr        		lda z80_e
000E43  2  A4 rr        		ldy z80_ep
000E45  2  84 rr        		sty z80_e
000E47  2  85 rr        		sta z80_ep
000E49  2  A5 rr        		lda z80_d
000E4B  2  A4 rr        		ldy z80_dp
000E4D  2  84 rr        		sty z80_d
000E4F  2  85 rr        		sta z80_dp
000E51  2  A5 rr        		lda scraddr
000E53  2  A4 rr        		ldy z80_lp
000E55  2  84 rr        		sty scraddr
000E57  2  85 rr        		sta z80_lp
000E59  2  A5 rr        		lda scraddr+1
000E5B  2  A4 rr        		ldy z80_hp
000E5D  2  84 rr        		sty scraddr+1
000E5F  2  85 rr        		sta z80_hp
000E61  2  60           		rts
000E62  2               
000E62  2               ;ex_sp_hl:
000E62  2               ;		tsx
000E62  2               ;		lda $0103,x
000E62  2               ;		ldy z80_h
000E62  2               ;		sta z80_h
000E62  2               ;		tya
000E62  2               ;		sta $0103,x
000E62  2               ;		lda $0104,x
000E62  2               ;		ldy z80_l
000E62  2               ;		sta z80_l
000E62  2               ;		tya
000E62  2               ;		sta $104,x
000E62  2               ;		rts
000E62  2               ;
000E62  2               ;ldi:
000E62  2               ;	rts
000E62  2               ;ldir:
000E62  2               ;		ldy #$00
000E62  2               ;		ldx z80_b
000E62  2               ;		beq ldir_last_page
000E62  2               ;ldir_loop:
000E62  2               ;		lda (z80_hl),y
000E62  2               ;		sta (z80_de),y
000E62  2               ;		iny
000E62  2               ;		bne ldir_loop
000E62  2               ;		inc z80_h
000E62  2               ;		inc z80_d
000E62  2               ;		dex
000E62  2               ;		bne ldir_loop
000E62  2               ;ldir_last_page:
000E62  2               ;		lda z80_c
000E62  2               ;		beq ldir_end
000E62  2               ;ldir_last_page_loop:
000E62  2               ;		lda (z80_hl),y
000E62  2               ;		sta (z80_de),y
000E62  2               ;		iny
000E62  2               ;		cpy z80_c
000E62  2               ;		bne ldir_last_page_loop
000E62  2               ;ldir_end:
000E62  2               ;		stx z80_c
000E62  2               ;		stx z80_b
000E62  2               ;		tya
000E62  2               ;		clc
000E62  2               ;		adc z80_l
000E62  2               ;		sta z80_l
000E62  2               ;		bcc *+4
000E62  2               ;		inc z80_h
000E62  2               ;		tya
000E62  2               ;		clc
000E62  2               ;		adc z80_e
000E62  2               ;		sta z80_e
000E62  2               ;		bcc *+4
000E62  2               ;		inc z80_d
000E62  2               ;		rts
000E62  2               ;
000E62  2               ;lddr:		ldy #$00
000E62  2               ;lddr_loop:
000E62  2               ;		lda (z80_hl),y
000E62  2               ;		sta (z80_de),y
000E62  2               ;		jsr dec_hl
000E62  2               ;		jsr dec_de
000E62  2               ;		jsr dec_bc
000E62  2               ;		lda z80_b
000E62  2               ;		ora z80_c
000E62  2               ;		bne lddr_loop
000E62  2               ;		rts
000E62  2               ;ei:
000E62  2               ;		rts
000E62  2               ;di:
000E62  2               ;		rts
000E62  2               
000E62  2               ;-------------------------------------------------------------
000E62  2               ; Set bits in bitmem
000E62  2               ;-------------------------------------------------------------
000E62  2               
000E62  2               .if 0
000E62  2               z80_init:
000E62  2               	ldx #$00
000E62  2               	lda #$01
000E62  2               z80_init_loop:
000E62  2               	sta _bitmem0,x
000E62  2               	inx
000E62  2               	asl a
000E62  2               	bne z80_init_loop
000E62  2               	rts
000E62  2               .endif
000E62  2               
000E62  2               push_af:
000E62  2               push_bc:
000E62  2               push_de:
000E62  2               push_hl:
000E62  2               
000E62  2               pop_af:
000E62  2               pop_bc:
000E62  2               pop_de:
000E62  2               pop_ix:
000E62  2               pop_hl:
000E62  2               
000E62  2               add_hl_hl:
000E62  2               
000E62  2               inc_bc:
000E62  2               inc_de:
000E62  2               inc_hl:
000E62  2               inc_ix:
000E62  2               inc_sp:
000E62  2               
000E62  2               cpir:
000E62  2               
000E62  2               ex_af_af:
000E62  2               ;	rts
000E62  2               
000E62  1               	.include "bbc.inc"
000E62  2               ;----------------------------------------------------------------------
000E62  2               ; BBC Platform Specific functions
000E62  2               ;----------------------------------------------------------------------
000E62  2               
000E62  2               ;--------------------------------------------------------
000E62  2               ; Keys
000E62  2               ;
000E62  2               ; Out: joyval=x65FUDLR (bit cleared if key pressed)
000E62  2               ;             ||||||||
000E62  2               ;             |||||||+> Right    KEY 0  - X
000E62  2               ;             ||||||+-> Left     KEY 1  - Z
000E62  2               ;             |||||+--> Down     KEY 2  - .
000E62  2               ;             ||||+---> Up       KEY 3  - ;
000E62  2               ;             |||+----> Fire1    KEY 4  - SPC
000E62  2               ;             ||+-----> Fire2    KEY 5  - Q
000E62  2               ;             |+------> Fire3    KEY 6  - P
000E62  2               ;             +-------> Not used
000E62  2               ;
000E62  2               ;                       Option1  KEY 7  - 1
000E62  2               ;                       Option2  KEY 8  - 2
000E62  2               ;                       Option3  KEY 9  - 3
000E62  2               ;                       Option4  KEY 10 - 4
000E62  2               ;--------------------------------------------------------
000E62  2               
000E62  2               ;              X   Z   .   ;  SPC  Q   P
000E62  2               ;keys:   .byte $42,$61,$68,$48,$62,$10,$37       ; Keys defined by game designer.
000E62  2               ;        .byte $30,$31,$11,$12                   ; menu options.
000E62  2               
000E62  2  42 61 68 48  jkeys:  .byte $42,$61,$68,$48,$62,$10,$37       ; Keys defined by game designer.
000E66  2  62 10 37     
000E69  2  30 31 11 12          .byte $30,$31,$11,$12                   ; menu options.
000E6D  2               
000E6D  2               ;----------------------------------------------------
000E6D  2               ; Wait for keypress.
000E6D  2               ;----------------------------------------------------
000E6D  2               
000E6D  2               prskey:
000E6D  2  8A           	txa
000E6E  2  48           	pha
000E6F  2               prsloop:
000E6F  2  20 0E 0F     	jsr vsync
000E72  2               
000E72  2  A9 79        	lda #$79
000E74  2  A2 01        	ldx #$01
000E76  2  20 F4 FF     	jsr OSBYTE
000E79  2               
000E79  2  E0 FF        	cpx #$ff
000E7B  2  F0 F2        	beq prsloop		; wait until key pressed
000E7D  2  68           	pla
000E7E  2  AA           	tax
000E7F  2  60           	rts
000E80  2               
000E80  2               bbcinit:
000E80  2  78           	sei
000E81  2  AD 20 02     	lda EVENTV
000E84  2  8D B4 0E     	sta old_eventv
000E87  2  AD 21 02     	lda EVENTV+1
000E8A  2  8D B5 0E     	sta old_eventv+1
000E8D  2               
000E8D  2  A9 B6        	lda #<event_handler
000E8F  2  8D 20 02     	sta EVENTV
000E92  2  A9 0E        	lda #>event_handler
000E94  2  8D 21 02     	sta EVENTV+1
000E97  2  58           	cli
000E98  2               
000E98  2               	; Enable VSYNC event.
000E98  2  A9 0E        	lda #14
000E9A  2  A2 04        	ldx #4
000E9C  2  4C F4 FF     	jmp OSBYTE
000E9F  2               
000E9F  2               bbckill:
000E9F  2  78           	sei
000EA0  2  AD B4 0E     	lda old_eventv
000EA3  2  8D 20 02     	sta EVENTV
000EA6  2  AD B5 0E     	lda old_eventv+1
000EA9  2  8D 21 02     	sta EVENTV+1
000EAC  2  58           	cli
000EAD  2               
000EAD  2               	; Disable VSYNC event.
000EAD  2  A9 0D        	lda #13
000EAF  2  A2 04        	ldx #4
000EB1  2  4C F4 FF     	jmp OSBYTE
000EB4  2               
000EB4  2               
000EB4  2               old_eventv:
000EB4  2  xx xx        	.res 2
000EB6  2               
000EB6  2               event_handler:
000EB6  2  08           	php
000EB7  2  C9 04        	cmp #4
000EB9  2  D0 02        	bne not_vsync
000EBB  2               
000EBB  2  E6 rr        	inc vsync_count
000EBD  2               
000EBD  2               not_vsync:
000EBD  2  28           	plp
000EBE  2  6C B4 0E     	jmp (old_eventv)
000EC1  2               
000EC1  2               bbcsync:
000EC1  2  A5 rr        	lda vsync_count
000EC3  2  C9 02        	cmp #2
000EC5  2  90 FA        	bcc bbcsync
000EC7  2  A9 00        	lda #0
000EC9  2  85 rr        	sta vsync_count
000ECB  2  60           	rts
000ECC  2               
000ECC  2               ;--------------------------------------------------------
000ECC  2               ; Keyboard test routine.
000ECC  2               ;
000ECC  2               ; Input:
000ECC  2               ;  A = key to read, high nibble=row and low nibble=col
000ECC  2               ;
000ECC  2               ; Output:
000ECC  2               ;  carry clr = key pressed
000ECC  2               ;  carry set = key not pressed
000ECC  2               ;--------------------------------------------------------
000ECC  2               
000ECC  2               ktest:
000ECC  2  85 rr        	sta z80_a		; save key
000ECE  2  98           	tya
000ECF  2  48           	pha
000ED0  2               
000ED0  2               ; _BEEB keyboard read
000ED0  2  A5 rr        	lda z80_a
000ED2  2  49 80        	eor #$80		; _BEEB just look for this key
000ED4  2  AA           	tax
000ED5  2               
000ED5  2  A9 79        	lda #$79
000ED7  2  20 F4 FF     	jsr OSBYTE
000EDA  2               
000EDA  2  8A           	txa
000EDB  2  30 04        	bmi pressed 	; _BEEB X is negative if key is pressed
000EDD  2               
000EDD  2  38           	sec			; key not pressed
000EDE  2  68           	pla
000EDF  2  A8           	tay
000EE0  2  60           	rts
000EE1  2               
000EE1  2               pressed:
000EE1  2  18           	clc			; key pressed
000EE2  2  68           	pla
000EE3  2  A8           	tay
000EE4  2  60           	rts
000EE5  2               
000EE5  2               ;---------------------------------------------------------------
000EE5  2               ; Getkey in column,row format
000EE5  2               ;
000EE5  2               ; Output:
000EE5  2               ;  A = high nibble=row and low nibble=column key in matrix
000EE5  2               ;---------------------------------------------------------------
000EE5  2               
000EE5  2               kget:
000EE5  2  86 rr        	stx xtmp
000EE7  2               
000EE7  2               kget1:
000EE7  2  A9 79        	lda #$79			; _BEEB read keyboard with OSBYTE &79
000EE9  2  A2 01        	ldx #$01
000EEB  2  20 F4 FF     	jsr OSBYTE
000EEE  2               
000EEE  2  E0 FF        	cpx #$ff
000EF0  2  F0 F5        	beq kget1
000EF2  2               
000EF2  2  8A           	txa
000EF3  2               
000EF3  2  A6 rr        	ldx xtmp
000EF5  2  60           	rts
000EF6  2               
000EF6  2               ;----------------------------------------------------
000EF6  2               ; AtoMMC joystick controls.
000EF6  2               ; _BEEB TODO
000EF6  2               ;----------------------------------------------------
000EF6  2               
000EF6  2               joyinit:
000EF6  2               joysin:
000EF6  2  60           	rts
000EF7  2               
000EF7  2               
000EF7  2               ;----------------------------------------------------
000EF7  2               ; Delay routine 1/50 sec
000EF7  2               ;
000EF7  2               ; Wait 1/60 sec = 16666 usec
000EF7  2               ; Wait 208 x 16 =  3328 usec
000EF7  2               ;                 19994 usec
000EF7  2               ; rts           =     6 usec
000EF7  2               ; Total         = 20000 usec
000EF7  2               ;----------------------------------------------------
000EF7  2               
000EF7  2               delay:
000EF7  2  85 rr        	sta xtmp
000EF9  2               del_loop:
000EF9  2  A9 13        	lda #19
000EFB  2  20 F4 FF     	jsr OSBYTE		; wait for vsync _BEEB
000EFE  2               
000EFE  2  A0 D0        	ldy #208		; wait 208 x 16 = 3328 usec
000F00  2               delay1:
000F00  2  61 80        	adc ($80,x)		;	 6 usec
000F02  2  61 80        	adc ($80,x)		;	 6 usec
000F04  2  88           	dey			;	 2 usec
000F05  2  D0 F9        	bne delay1		;	 2 usec
000F07  2  EA           	nop			; 2 usec
000F08  2  EA           	nop			; 2 usec
000F09  2               				; tot: 20000 usec
000F09  2  C6 rr        	dec xtmp
000F0B  2  D0 EC        	bne del_loop
000F0D  2  60           	rts
000F0E  2               
000F0E  2               ;-------------------------------------------------------------
000F0E  2               ; Screen synchronisation.
000F0E  2               ;
000F0E  2               ;  - read joystick/keyboard
000F0E  2               ;  - handle sound
000F0E  2               ;  - sync framerate with clock
000F0E  2               ;  - handle shrapnel every even frame
000F0E  2               ;-------------------------------------------------------------
000F0E  2               
000F0E  2               vsync:
000F0E  2  48           	pha
000F0F  2  98           	tya
000F10  2  48           	pha
000F11  2  8A           	txa
000F12  2  48           	pha
000F13  2  20 45 20     	jsr joykey		; read joystick/keyboard.
000F16  2               vsync1:
000F16  2               ; Don't sync to vsync here - we can sync to every other vsync in main loop
000F16  2               ;	lda #19
000F16  2               ;	jsr OSBYTE		; _BEEB vsync
000F16  2               
000F16  2  A5 rr        	lda clock
000F18  2  29 01        	and #1
000F1A  2  D0 03        	bne:+
000F1C  2  20 F5 16     	jsr proshr		; handle shrapnel every even frame
000F1F  2               :
000F1F  2  AD 2A 0F     	lda sndtyp
000F22  2  F0 00        	beq sndskip
000F24  2               
000F24  2               ; _BEEB TODO SOUND
000F24  2               ;sndloop:
000F24  2               ;	lda SpeakerBit		; handle sound
000F24  2               ;	ldy sndtyp
000F24  2               ;sndwait:
000F24  2               ;	dey
000F24  2               ;	bne sndwait
000F24  2               ;	eor #4
000F24  2               ;	sta SpeakerBit
000F24  2               ;	dec sndtyp
000F24  2               ;	bne sndloop
000F24  2               
000F24  2               sndskip:
000F24  2  68           	pla
000F25  2  AA           	tax
000F26  2  68           	pla
000F27  2  A8           	tay
000F28  2  68           	pla
000F29  2  60           	rts
000F2A  2               
000F2A  2  00           sndtyp:	.byte 0
000F2B  2               
000F2B  2               ;----------------------------------------------------------------------
000F2B  2               ; BBC video hardware fns
000F2B  2               ;----------------------------------------------------------------------
000F2B  2               
000F2B  2               screeninit:
000F2B  2  A2 0D        	ldx #13
000F2D  2               crtcloop:
000F2D  2  8E 00 FE     	stx $FE00
000F30  2  BD 4D 0F     	lda crtc_regs_high,x
000F33  2  8D 01 FE     	sta $FE01
000F36  2  CA           	dex
000F37  2  10 F4        	bpl crtcloop
000F39  2               
000F39  2                   ; Set ULA
000F39  2  A9 88            lda #$88            ; MODE 4
000F3B  2  8D 48 02         sta $248            ; Tell the OS or it will mess with ULA settings at vsync
000F3E  2  8D 20 FE         sta $FE20
000F41  2               
000F41  2               ; fall through to palette
000F41  2               
000F41  2               setpal:
000F41  2  A2 0F        	ldx #15
000F43  2               palloop:
000F43  2  BD 5B 0F     	lda ula_pal,x
000F46  2  8D 21 FE     	sta $fe21
000F49  2  CA           	dex
000F4A  2  10 F7        	bpl palloop
000F4C  2  60           	rts
000F4D  2               
000F4D  2               crtc_regs_high:
000F4D  2  3F           	.byte 63				; R0  horizontal total
000F4E  2  20           	.byte 32				; R1  horizontal displayed
000F4F  2  31           	.byte 49				; R2  horizontal position
000F50  2  24           	.byte $24				; R3  sync width 40 = &28
000F51  2  26           	.byte 38				; R4  vertical total
000F52  2  00           	.byte 0					; R5  vertical total adjust
000F53  2  18           	.byte 24				; R6  vertical displayed
000F54  2  23           	.byte 35				; R7  vertical position; 35=top of screen
000F55  2  00           	.byte $00				; R8  interlace
000F56  2  07           	.byte 7					; R9  scanlines per row
000F57  2  20           	.byte 32				; R10 cursor start
000F58  2  08           	.byte 8					; R11 cursor end
000F59  2  0D           	.byte >(ScreenAddr/8)	; R12 screen start address, high
000F5A  2  00           	.byte <(ScreenAddr/8)	; R13 screen start address, low
000F5B  2               
000F5B  2               ula_pal:
000F5B  2  07           	.byte $00 + PAL_black
000F5C  2  17           	.byte $10 + PAL_black
000F5D  2  27           	.byte $20 + PAL_black
000F5E  2  37           	.byte $30 + PAL_black
000F5F  2  47           	.byte $40 + PAL_black
000F60  2  57           	.byte $50 + PAL_black
000F61  2  67           	.byte $60 + PAL_black
000F62  2  77           	.byte $70 + PAL_black
000F63  2  80           	.byte $80 + PAL_white
000F64  2  90           	.byte $90 + PAL_white
000F65  2  A0           	.byte $a0 + PAL_white
000F66  2  B0           	.byte $b0 + PAL_white
000F67  2  C0           	.byte $c0 + PAL_white
000F68  2  D0           	.byte $d0 + PAL_white
000F69  2  E0           	.byte $e0 + PAL_white
000F6A  2  F0           	.byte $f0 + PAL_white
000F6B  2               
000F6B  2               ;----------------------------------------------------
000F6B  2               ; Draw sprite
000F6B  2               ;----------------------------------------------------
000F6B  2               
000F6B  2               sprite:
000F6B  2  86 rr        	stx xtmp		; Save X-reg
000F6D  2  20 BD 0F     	jsr scadd 		; get screen address in scraddr.
000F70  2               
000F70  2  A5 rr        	lda dispx 		; x position.
000F72  2  29 07        	and #7 			; position straddling cells.
000F74  2  85 rr        	sta z80_b		; store in b register.
000F76  2               
000F76  2  A5 rr        	lda z80_l		; store sprite graphic address.
000F78  2  8D 89 0F     	sta sprit1+1
000F7B  2  8D 8F 0F     	sta sprit2+1
000F7E  2  A5 rr        	lda z80_h
000F80  2  8D 8A 0F     	sta sprit1+2
000F83  2  8D 90 0F     	sta sprit2+2
000F86  2               
000F86  2  A2 00        	ldx #0			; pixel height.
000F88  2               sprit1:
000F88  2  BD 20 63     	lda objdta,x		; fetch first byte.
000F8B  2  85 rr        	sta spr
000F8D  2  E8           	inx
000F8E  2               sprit2:
000F8E  2  BD 20 63     	lda objdta,x
000F91  2  85 rr        	sta spr+1
000F93  2               
000F93  2  A9 00        	lda #0
000F95  2  85 rr        	sta spr+2
000F97  2  20 B1 1C     	jsr sprit7		; shift sprite
000F9A  2               
000F9A  2  A5 rr        	lda spr			; fetch graphic.
000F9C  2  A0 00        	ldy #0			; _BEEB
000F9E  2  51 rr        	eor (scraddr),y		; merge with screen image.
000FA0  2  91 rr        	sta (scraddr),y		; write to screen.
000FA2  2               
000FA2  2  A5 rr        	lda spr+1		; fetch graphic.
000FA4  2  A0 08        	ldy #8			; _BEEB
000FA6  2  51 rr        	eor (scraddr),y		; merge with screen image.
000FA8  2  91 rr        	sta (scraddr),y		; write to screen.
000FAA  2               
000FAA  2  A5 rr        	lda spr+2		; fetch graphic.
000FAC  2  A0 10        	ldy #16			; _BEEB
000FAE  2  51 rr        	eor (scraddr),y		; merge with screen image.
000FB0  2  91 rr        	sta (scraddr),y		; write to screen.
000FB2  2               
000FB2  2  20 9F 10     	jsr nline
000FB5  2               
000FB5  2  E8           	inx			; next source byte.
000FB6  2  E0 20        	cpx #32
000FB8  2  D0 CE        	bne sprit1		; repeat
000FBA  2               
000FBA  2  A6 rr        	ldx xtmp		; retreive X-reg
000FBC  2  60           	rts
000FBD  2               
000FBD  2               ;------------------------------------------------------------------
000FBD  2               ; This routine returns a screen address for (dispx, dispy) in scraddr.
000FBD  2               ;------------------------------------------------------------------
000FBD  2               
000FBD  2               scadd:
000FBD  2  A6 rr        	ldx dispy
000FBF  2  A5 rr        	lda dispx
000FC1  2  29 F8        	and #$f8
000FC3  2  18           	clc
000FC4  2  7D 00 06     	adc SCADTB_lb,x
000FC7  2  85 rr        	sta scraddr
000FC9  2  BD 00 07     	lda SCADTB_hb,x
000FCC  2  69 00        	adc #0
000FCE  2  85 rr        	sta scraddr+1
000FD0  2  60           	rts
000FD1  2               
000FD1  2               ;-----------------------------------------------------------------
000FD1  2               ; These are the sprite routines.
000FD1  2               ; sspria = single sprite, old (ix).
000FD1  2               ; ssprib = single sprite, new (ix+5).
000FD1  2               ; sspric = both sprites, old (ix) and new (ix+5).
000FD1  2               ;-----------------------------------------------------------------
000FD1  2               
000FD1  2               sspria:
000FD1  2  20 93 23     	jsr gsprad		; get old sprite address.
000FD4  2               sspri2:
000FD4  2               
000FD4  2  A5 rr        	lda z80_e				; 3c
000FD6  2  8D 6C 10     	sta dline_spraddr1+1	; 4c
000FD9  2  8D 83 10     	sta dline_spraddr2+1	; 4c
000FDC  2               
000FDC  2  A5 rr        	lda z80_d				; 3c
000FDE  2  8D 6D 10     	sta dline_spraddr1+2	; 4c
000FE1  2  8D 84 10     	sta dline_spraddr2+2	; 4c
000FE4  2               
000FE4  2  A6 rr        	ldx sprshft
000FE6  2  BD 63 10     	lda shift_table,x
000FE9  2  8D 6F 10     	sta dline_shift1+1
000FEC  2  8D 86 10     	sta dline_shift2+1
000FEF  2  BD 64 10     	lda shift_table+1,x
000FF2  2  8D 70 10     	sta dline_shift1+2
000FF5  2  8D 87 10     	sta dline_shift2+2
000FF8  2               
000FF8  2  A2 00        	ldx #0			; vertical lines.
000FFA  2               sspri0:
000FFA  2  20 6B 10     	jsr dline		; draw a line.
000FFD  2  E0 20        	cpx #32
000FFF  2  D0 F9        	bne sspri0		; repeat 16 times x 2 bytes
001001  2  60           	rts
001002  2               
001002  2               ;-----------------------------------------------------------------
001002  2               
001002  2               ssprib:
001002  2  20 74 23     	jsr gspran 		; get new sprite address.
001005  2  4C D4 0F     	jmp sspri2
001008  2               
001008  2               ;-----------------------------------------------------------------
001008  2               
001008  2               sspric:
001008  2  20 93 23     	jsr gsprad 		; get old sprite address.
00100B  2               
00100B  2  A5 rr        	lda z80_e				; 3c
00100D  2  8D 06 11     	sta ddline_spraddr3+1	; 4c
001010  2  8D 1D 11     	sta ddline_spraddr4+1	; 4c
001013  2               
001013  2  A5 rr        	lda z80_d				; 3c
001015  2  8D 07 11     	sta ddline_spraddr3+2	; 4c
001018  2  8D 1E 11     	sta ddline_spraddr4+2	; 4c
00101B  2               
00101B  2  A6 rr        	ldx sprshft
00101D  2  BD 63 10     	lda shift_table,x
001020  2  8D 09 11     	sta ddline_shift3+1
001023  2  8D 20 11     	sta ddline_shift4+1
001026  2  BD 64 10     	lda shift_table+1,x
001029  2  8D 0A 11     	sta ddline_shift3+2
00102C  2  8D 21 11     	sta ddline_shift4+2
00102F  2               
00102F  2  20 31 0E     	jsr exx  		; store addresses.
001032  2  20 74 23     	jsr gspran 		; get new sprite addresses.
001035  2               
001035  2  A5 rr        	lda z80_e				; 3c
001037  2  8D B9 10     	sta ddline_spraddr1+1	; 4c
00103A  2  8D D0 10     	sta ddline_spraddr2+1	; 4c
00103D  2               
00103D  2  A5 rr        	lda z80_d				; 3c
00103F  2  8D BA 10     	sta ddline_spraddr1+2	; 4c
001042  2  8D D1 10     	sta ddline_spraddr2+2	; 4c
001045  2               
001045  2  A6 rr        	ldx sprshft
001047  2  BD 63 10     	lda shift_table,x
00104A  2  8D BC 10     	sta ddline_shift1+1
00104D  2  8D D3 10     	sta ddline_shift2+1
001050  2  BD 64 10     	lda shift_table+1,x
001053  2  8D BD 10     	sta ddline_shift1+2
001056  2  8D D4 10     	sta ddline_shift2+2
001059  2               
001059  2  A2 00        	ldx #0
00105B  2               lloop:
00105B  2  20 B8 10     	jsr ddline 		; draw a line.
00105E  2  E0 20        	cpx #32
001060  2  D0 F9        	bne lloop
001062  2  60           	rts
001063  2               
001063  2               shift_table:
001063  2  00 12        .word shift0
001065  2  00 13        .word shift2
001067  2  00 14        .word shift4
001069  2  00 15        .word shift6
00106B  2               
00106B  2               ;-------------------------------------------------------------
00106B  2               ; Drop through.
00106B  2               ; Line drawn, now work out next target address.
00106B  2               ;
00106B  2               ; Input:
00106B  2               ;  B  = right mask
00106B  2               ;  C  = left mask
00106B  2               ;  DE = spriteaddress
00106B  2               ;  scraddr = screen address
00106B  2               ;-------------------------------------------------------------
00106B  2               
00106B  2               dline:
00106B  2               
00106B  2               ; first screen byte
00106B  2               
00106B  2               dline_spraddr1:
00106B  2  BC FF FF     	ldy $ffff,x 		; graphic data.
00106E  2               dline_shift1:
00106E  2  B9 FF FF     	lda $ffff,y
001071  2  85 rr        	sta sprtmp
001073  2  25 rr        	and z80_c 			; mask away what's not needed.
001075  2               
001075  2  A0 00        	ldy #0
001077  2  51 rr        	eor (scraddr),y 	; XOR with what's there.
001079  2  91 rr        	sta (scraddr),y 	; bung it in.
00107B  2               
00107B  2               ; carry to next screen byte
00107B  2               
00107B  2  A5 rr        	lda sprtmp			; fetch data.
00107D  2  25 rr        	and z80_b 			; mask away unwanted
00107F  2  85 rr        	sta sprtmp
001081  2               
001081  2               ; middle screen byte
001081  2               
001081  2  E8           	inx
001082  2               dline_spraddr2:
001082  2  BC FF FF     	ldy $ffff,x 		; second bit of data.
001085  2               dline_shift2:
001085  2  B9 FF FF     	lda $ffff,y
001088  2  85 rr        	sta sprtmp2
00108A  2  25 rr        	and z80_c 			; mask away what's not needed.
00108C  2  05 rr        	ora sprtmp
00108E  2               
00108E  2  A0 08        	ldy #8
001090  2  51 rr        	eor (scraddr),y 	; XOR with what's there.
001092  2  91 rr        	sta (scraddr),y 	; bung it in.
001094  2               
001094  2               ; carry to last screen byte
001094  2               
001094  2  A5 rr        	lda sprtmp2
001096  2  25 rr        	and z80_b 			; mask away unwanted
001098  2               
001098  2  A0 10        	ldy #16
00109A  2  51 rr        	eor (scraddr),y 	; XOR with what's there.
00109C  2  91 rr        	sta (scraddr),y 	; bung it in.
00109E  2               
00109E  2  E8           	inx
00109F  2               
00109F  2               ;----------------------------------------------------------------------
00109F  2               ; Line drawn, now work out next target address.
00109F  2               ;----------------------------------------------------------------------
00109F  2               
00109F  2               ; _BEEB screen arrangement
00109F  2               
00109F  2               nline:
00109F  2  A5 rr        	lda scraddr 		; get low byte of address.
0010A1  2  29 07        	and #7
0010A3  2  C9 07        	cmp #7				; is this last line of row?
0010A5  2  F0 03        	beq beeb_next_row
0010A7  2               
0010A7  2               	; within same row
0010A7  2  E6 rr        	inc scraddr			; new low byte of address.
0010A9  2               ;	bne :+
0010A9  2               ;	inc scraddr+1		; new high byte of address.
0010A9  2               :
0010A9  2  60           	rts
0010AA  2               
0010AA  2               beeb_next_row:
0010AA  2  18           	clc
0010AB  2  A5 rr        	lda scraddr
0010AD  2  69 F9        	adc #<(ScreenRowBytes-7)
0010AF  2  85 rr        	sta scraddr			; new low byte of address.
0010B1  2  A5 rr        	lda scraddr+1
0010B3  2  69 00        	adc #>(ScreenRowBytes-7)
0010B5  2  85 rr        	sta scraddr+1		; new high byte of address.
0010B7  2  60           	rts
0010B8  2               
0010B8  2               ;-------------------------------------------------------------
0010B8  2               ; Drop through.
0010B8  2               ; Line drawn, now work out next target address.
0010B8  2               ;
0010B8  2               ; Input:
0010B8  2               ;  B  = right mask
0010B8  2               ;  C  = left mask
0010B8  2               ;  DE = spriteaddress
0010B8  2               ;  scraddr = screen address
0010B8  2               ;-------------------------------------------------------------
0010B8  2               
0010B8  2               ddline:
0010B8  2               
0010B8  2               ; NEW SPRITE
0010B8  2               
0010B8  2               ; first screen byte
0010B8  2               
0010B8  2               ddline_spraddr1:
0010B8  2  BC FF FF     	ldy $ffff,x 		; graphic data.
0010BB  2               ddline_shift1:
0010BB  2  B9 FF FF     	lda $ffff,y
0010BE  2  85 rr        	sta sprtmp
0010C0  2  25 rr        	and z80_c 			; mask away what's not needed.
0010C2  2               
0010C2  2  A0 00        	ldy #0
0010C4  2  51 rr        	eor (scraddr),y 	; XOR with what's there.
0010C6  2  91 rr        	sta (scraddr),y 	; bung it in.
0010C8  2               
0010C8  2               ; carry to next screen byte
0010C8  2               
0010C8  2  A5 rr        	lda sprtmp			; fetch data.
0010CA  2  25 rr        	and z80_b 			; mask away unwanted
0010CC  2  85 rr        	sta sprtmp
0010CE  2               
0010CE  2               ; middle screen byte
0010CE  2               
0010CE  2  E8           	inx
0010CF  2               ddline_spraddr2:
0010CF  2  BC FF FF     	ldy $ffff,x 		; second bit of data.
0010D2  2               ddline_shift2:
0010D2  2  B9 FF FF     	lda $ffff,y
0010D5  2  85 rr        	sta sprtmp2
0010D7  2  25 rr        	and z80_c 			; mask away what's not needed.
0010D9  2  05 rr        	ora sprtmp
0010DB  2               
0010DB  2  A0 08        	ldy #8
0010DD  2  51 rr        	eor (scraddr),y 	; XOR with what's there.
0010DF  2  91 rr        	sta (scraddr),y 	; bung it in.
0010E1  2               
0010E1  2               ; carry to last screen byte
0010E1  2               
0010E1  2  A5 rr        	lda sprtmp2
0010E3  2  25 rr        	and z80_b 			; mask away unwanted
0010E5  2               
0010E5  2  A0 10        	ldy #16
0010E7  2  51 rr        	eor (scraddr),y 	; XOR with what's there.
0010E9  2  91 rr        	sta (scraddr),y 	; bung it in.
0010EB  2               
0010EB  2               ; _BEEB next row
0010EB  2               
0010EB  2  A5 rr        	lda scraddr 		; get low byte of address.
0010ED  2  29 07        	and #7
0010EF  2  C9 07        	cmp #7				; is this last line of row?
0010F1  2  F0 04        	beq :+
0010F3  2               
0010F3  2               	; within same row can't increment page
0010F3  2  E6 rr        	inc scraddr			; new low byte of address.
0010F5  2  D0 0D        	bne ddline2
0010F7  2               
0010F7  2               :
0010F7  2  18           	clc
0010F8  2  A5 rr        	lda scraddr
0010FA  2  69 F9        	adc #<(ScreenRowBytes-7)
0010FC  2  85 rr        	sta scraddr			; new low byte of address.
0010FE  2  A5 rr        	lda scraddr+1
001100  2  69 00        	adc #>(ScreenRowBytes-7)
001102  2  85 rr        	sta scraddr+1		; new high byte of address.
001104  2               
001104  2               ; OLD SPRITE
001104  2               
001104  2               ddline2:
001104  2               
001104  2               ; still first row but different data!
001104  2               
001104  2  CA           	dex
001105  2               
001105  2               ; first screen byte
001105  2               
001105  2               ddline_spraddr3:
001105  2  BC FF FF     	ldy $ffff,x			; graphic data.
001108  2               ddline_shift3:
001108  2  B9 FF FF     	lda $ffff,y
00110B  2  85 rr        	sta sprtmp
00110D  2  25 rr        	and z80_cp 			; mask away what's not needed.
00110F  2               
00110F  2  A0 00        	ldy #0
001111  2  51 rr        	eor (z80_hlp),y 	; XOR with what's there.
001113  2  91 rr        	sta (z80_hlp),y 	; bung it in.
001115  2               
001115  2               ; carry to next screen byte
001115  2               
001115  2  A5 rr        	lda sprtmp			; fetch data.
001117  2  25 rr        	and z80_bp 			; mask away unwanted
001119  2  85 rr        	sta sprtmp
00111B  2               
00111B  2               ; middle screen byte
00111B  2               
00111B  2  E8           	inx
00111C  2               ddline_spraddr4:
00111C  2  BC FF FF     	ldy $ffff,x 		; second bit of data.
00111F  2               ddline_shift4:
00111F  2  B9 FF FF     	lda $ffff,y
001122  2  85 rr        	sta sprtmp2
001124  2  25 rr        	and z80_cp 			; mask away what's not needed.
001126  2  05 rr        	ora sprtmp
001128  2               
001128  2  A0 08        	ldy #8
00112A  2  51 rr        	eor (z80_hlp),y 	; XOR with what's there.
00112C  2  91 rr        	sta (z80_hlp),y 	; bung it in.
00112E  2               
00112E  2               ; last screen byte
00112E  2               
00112E  2  A5 rr        	lda sprtmp2			; fetch data.
001130  2  25 rr        	and z80_bp 			; mask away unwanted
001132  2               
001132  2  A0 10        	ldy #16
001134  2  51 rr        	eor (z80_hlp),y 	; XOR with what's there.
001136  2  91 rr        	sta (z80_hlp),y 	; bung it in.
001138  2               
001138  2               ; next row of sprite data
001138  2               
001138  2  E8           	inx
001139  2               
001139  2               ; _BEEB screen arrangement
001139  2               
001139  2  A5 rr        	lda z80_lp 			; get low byte of address.
00113B  2  29 07        	and #7
00113D  2  C9 07        	cmp #7				; is this last line of row?
00113F  2  F0 03        	beq :+
001141  2               
001141  2               	; within same row can't increment page
001141  2  E6 rr        	inc z80_lp			; new low byte of address.
001143  2  60           	rts
001144  2               
001144  2               :
001144  2  18           	clc
001145  2  A5 rr        	lda z80_lp
001147  2  69 F9        	adc #<(ScreenRowBytes-7)
001149  2  85 rr        	sta z80_lp			; new low byte of address.
00114B  2  A5 rr        	lda z80_lp+1
00114D  2  69 00        	adc #>(ScreenRowBytes-7)
00114F  2  85 rr        	sta z80_lp+1		; new high byte of address.
001151  2  60           	rts
001152  2               
001152  2               ;----------------------------------------------------
001152  2               ; Display character in A at dispx,dispy.
001152  2               ;
001152  2               ; Input:
001152  2               ;  A 	   = character to print
001152  2               ;----------------------------------------------------
001152  2               
001152  2               pchar:
001152  2  85 rr        	sta fntaddr
001154  2  A9 00        	lda #0
001156  2  85 rr        	sta fntaddr+1
001158  2  06 rr        	asl fntaddr  		; multiply char by 8.
00115A  2  26 rr        	rol fntaddr+1
00115C  2  06 rr        	asl fntaddr
00115E  2  26 rr        	rol fntaddr+1
001160  2  06 rr        	asl fntaddr
001162  2  26 rr        	rol fntaddr+1
001164  2               
001164  2  A5 rr        	lda fntaddr
001166  2  18           	clc
001167  2  65 rr        	adc FontPtr
001169  2  85 rr        	sta fntaddr		; that's the low byte.
00116B  2  A5 rr        	lda fntaddr+1
00116D  2  65 rr        	adc FontPtr+1
00116F  2  85 rr        	sta fntaddr+1		; add displacement.
001171  2               pchark:
001171  2  20 04 1C     	jsr gprad		; get screen address.
001174  2  A0 00        	ldy #0
001176  2               
001176  2               pchar0:
001176  2  B1 rr        	lda (fntaddr),y 	; get image byte.
001178  2  49 00        	eor #TxtInvert		; Invert
00117A  2  91 rr        	sta (scraddr),y 	; copy to screen.
00117C  2  C8           	iny					; next screen row down.
00117D  2  C0 08        	cpy #8				; number lines
00117F  2  90 F5        	bcc pchar0			; repeat.
001181  2  60           	rts
001182  2               
001182  2               ;----------------------------------------------------
001182  2               ; Shift tables
001182  2               ;----------------------------------------------------
001182  2               
001182  2               .if 1
001182  2  xx xx xx xx  .align 256
001186  2  xx xx xx xx  
00118A  2  xx xx xx xx  
001200  2               shift0:
001200  2  00 01 02 03  .repeat 256, i
001204  2  04 05 06 07  
001208  2  08 09 0A 0B  
001300  2               	.byte i
001300  2               .endrep
001300  2               
001300  2               shift2:
001300  2  00 40 80 C0  .repeat 256, i
001304  2  01 41 81 C1  
001308  2  02 42 82 C2  
001400  2               	.byte (i >> 2) | (i << 6) & $c0
001400  2               .endrep
001400  2               
001400  2               shift4:
001400  2  00 10 20 30  .repeat 256, i
001404  2  40 50 60 70  
001408  2  80 90 A0 B0  
001500  2               	.byte (i >> 4) | ((i << 4) & $f0)
001500  2               .endrep
001500  2               
001500  2               shift6:
001500  2  00 04 08 0C  .repeat 256, i
001504  2  10 14 18 1C  
001508  2  20 24 28 2C  
001600  2               	.byte (i >> 6) | ((i << 2) & $fc)
001600  2               .endrep
001600  2               .align 1
001600  2               .endif
001600  2               
001600  1               
001600  1               ;----------------------------------------------------------------------
001600  1               ; AGD 6502 ENGINE CODE + COMPILED GAME SCRIPT
001600  1               ;----------------------------------------------------------------------
001600  1               
001600  1               start_game:
001600  1               
001600  1               	.include "game.inc"
001600  2               .include "terrapins.inc"
001600  3               ; Game engine code --------------------------------------------------------------
001600  3               
001600  3               ; Arcade Game Designer.
001600  3               ; (C) 2008 Jonathan Cauldwell.
001600  3               ; ZX Spectrum Next Engine v0.1.
001600  3               
001600  3               ; Global definitions ------------------------------------------------------------
001600  3               
001600  3               	FONT = font			; Font address
001600  3               
001600  3               ; Block characteristics.
001600  3               
001600  3               	PLATFM = 1			; platform.
001600  3               	WALL = PLATFM + 1	; solid wall.
001600  3               	LADDER = WALL + 1	; ladder.
001600  3               	FODDER = LADDER + 1	; fodder block.
001600  3               	DEADLY = FODDER + 1	; deadly block.
001600  3               	CUSTOM = DEADLY + 1	; custom block.
001600  3               	WATER  = CUSTOM + 1	; water block.
001600  3                   COLECT = WATER + 1      ; collectable block.
001600  3                   NUMTYP = COLECT + 1     ; number of types.
001600  3               
001600  3               ; Sprites.
001600  3               
001600  3               	NUMSPR = 12			; number of sprites.
001600  3               	TABSIZ = 17			; size of each entry.
001600  3               	SPRBUF = NUMSPR * TABSIZ; size of entire table.
001600  3               	NMESIZ = 4			; bytes stored in nmetab for each sprite.
001600  3               
001600  3               ; Sprite table variable offsets.
001600  3               
001600  3               	var_Type = 0		; sprite type
001600  3               	var_Image = 1		; sprite time number
001600  3               	var_Frame = 2		; sprite frame
001600  3               	var_Y = 3			; sprite y coordinate
001600  3               	var_X = 4			; sprite X coordinate
001600  3               
001600  3               	var_newType = 5		; sprite new type
001600  3               	var_newImage = 6	; sprite new image number
001600  3               	var_newFrame = 7	; sprite new frame
001600  3               	var_newY = 8		; sprite new y coordinate
001600  3               	var_newX = 9		; sprite new x coordinate
001600  3               
001600  3               	var_Direction = 10	; sprite direction
001600  3               	var_Param1 = 11		; sprite parameter 1
001600  3               	var_Param2 = 12		; sprite parameter 2
001600  3               
001600  3               	var_jumpLo = 13		; sprite jump ptr low
001600  3               	var_jumpHi = 14		; sprite jump ptr high
001600  3               	var_dataLo = 15		; sprite data ptr low
001600  3               	var_dataHi = 16		; sprite data ptr high
001600  3               
001600  3               ; Particle engine.
001600  3               
001600  3               	NUMSHR = 55			; pieces of shrapnel.
001600  3               	SHRSIZ = 6			; bytes per particle.
001600  3               
001600  3               ; Conditional compilation flags
001600  3               ; Flags are set in commandline assembly
001600  3               
001600  3               ;	mflag = 0 		; MENU + INV
001600  3               ;	pflag = 0		; Particle engine
001600  3               ;	sflag = 0		; scrollytext
001600  3               ;	fflag = 1		; Fontflag
001600  3               
001600  3               .if iflag
001600  3               	TxtInvert   = $ff	; Invert byte for character printing
001600  3               	ScrFillByte = $ff	; Screen fill byte for CLS
001600  3               .else
001600  3               	TxtInvert   = $00	; Invert byte for character printing
001600  3               	ScrFillByte = $00	; Screen fill byte for CLS
001600  3               .endif
001600  3               
001600  3               	ASCII_NEWLINE = 13
001600  3               
001600  3               ;===============================================================
001600  3               ; Game starts here
001600  3               ;===============================================================
001600  3               
001600  3               ;--------------------------------------------------------------
001600  3               ; If a font is required...
001600  3               ;--------------------------------------------------------------
001600  3               
001600  3  A9 76        	lda #<(FONT-256)	; address of font.
001602  3  85 rr        	sta FontPtr
001604  3  A9 63        	lda #>(FONT-256)
001606  3  85 rr        	sta FontPtr+1
001608  3               
001608  3  20 F6 16     	jsr game	 		; start the game.
00160B  3  60           	rts
00160C  3               
00160C  3               ; Don't change the order of these four.
00160C  3               ; Menu routine relies on winlft following wintop.
00160C  3               
00160C  3  00           wintop:	.byte WINDOWTOP		; top of window.
00160D  3  00           winlft:	.byte WINDOWLFT		; left edge.
00160E  3  17           winhgt:	.byte WINDOWHGT		; window height.
00160F  3  1A           winwid:	.byte WINDOWWID		; window width.
001610  3  09           numob:	.byte NUMOBJ		; number of objects in game.
001611  3               
001611  3               ; Pixel versions of wintop, winlft, winhgt, winwid.
001611  3               
001611  3  00           wntopx:	.byte (8 * WINDOWTOP)
001612  3  00           wnlftx:	.byte (8 * WINDOWLFT)
001613  3  A8           wnbotx:	.byte ((WINDOWTOP * 8) + (WINDOWHGT * 8) - 16)
001614  3  BE           wnrgtx:	.byte ((WINDOWLFT * 8) + (WINDOWWID * 8) - 16)-2
001615  3               
001615  3               ; Make sure pointers are arranged in the same order as the data itself.
001615  3               
001615  3  19 5E        frmptr:	.word frmlst         ; sprite frames.
001617  3               
001617  3               ; Assorted game routines which can go in contended memory.
001617  3               
001617  3               ;--------------------------------------------------------------
001617  3               ; Modify for inventory.
001617  3               ; called by the INV command
001617  3               ;
001617  3               ; Input:
001617  3               ;  X   = message nr with objects seperated with ,
001617  3               ;
001617  3               ; Output:
001617  3               ;  OPT = selected line nr of INV menu
001617  3               ;--------------------------------------------------------------
001617  3               
001617  3               .if mflag
001617  3               minve:
001617  3               	lda #<(invdis)		; routine address.
001617  3               	sta mod0+1		; set up menu routine.
001617  3               	sta mod2+1		; set up count routine.
001617  3               	lda #>(invdis)
001617  3               	sta mod0+2
001617  3               	sta mod2+2
001617  3               	lda #<(fopt)		; find option from available objects.
001617  3               	sta mod1+1		; set up routine.
001617  3               	lda #>(fopt)
001617  3               	sta mod1+1+1
001617  3               	jmp dbox		; do menu routine.
001617  3               
001617  3               ;--------------------------------------------------------------
001617  3               ; Modify for menu.
001617  3               ; called by the MENU command
001617  3               ;
001617  3               ; Input:
001617  3               ;  X   = message nr with menu items seperated with ,
001617  3               ;
001617  3               ; Output:
001617  3               ;  OPT = selected line nr of MENU menu
001617  3               ;--------------------------------------------------------------
001617  3               
001617  3               mmenu:
001617  3               	lda #<(always)		; routine address.
001617  3               	sta mod0+1		; set up routine.
001617  3               	sta mod2+1		; set up count routine.
001617  3               	lda #>(always)
001617  3               	sta mod0+2
001617  3               	sta mod2+2
001617  3               
001617  3               	lda #<(fstd)		; standard option selection.
001617  3               	sta mod1+1		; set up routine.
001617  3               	lda #>(fstd)
001617  3               	sta mod1+2
001617  3               
001617  3               ; Drop through into box routine.
001617  3               
001617  3               ;--------------------------------------------------------------
001617  3               ; Work out size of box for message or menu.
001617  3               ;--------------------------------------------------------------
001617  3               
001617  3               dbox:
001617  3               	lda #<(msgdat)		; pointer to messages.
001617  3               	sta z80_l
001617  3               	lda #>(msgdat)
001617  3               	sta z80_h
001617  3               
001617  3               	jsr getwrd		; get message number.
001617  3               
001617  3               	lda z80_h		; store pointer to message.
001617  3               	sta TmpAddr
001617  3               	lda z80_l
001617  3               	sta TmpAddr+1
001617  3               
001617  3               	lda #1			; height.
001617  3               	sta z80_d
001617  3               	lda #0			; start at object zero.
001617  3               	sta combyt		; store number of object in combyt.
001617  3               	sta z80_e		; maximum width.
001617  3               dbox5:
001617  3               	lda #0			; this line"s width.
001617  3               	sta z80_b
001617  3               mod2:
001617  3               	jsr always		; item in player"s possession?
001617  3               	cmp #255
001617  3               	bne dbox6		; not in inventory, skip this line.
001617  3               	inc z80_d		; add to tally.
001617  3               dbox6:
001617  3               	ldy #0			; get character.
001617  3               	lda (z80_hl),y
001617  3               	sta z80_a
001617  3               	inc z80_l		; next character.
001617  3               	bne :+
001617  3               	inc z80_h
001617  3               :
001617  3               	lda z80_a		; reached end of line?
001617  3               	cmp #','
001617  3               	beq dbox3		; yes.
001617  3               	cmp #ASCII_NEWLINE
001617  3               	beq dbox3		; yes.
001617  3               	inc z80_b		; add to this line"s width.
001617  3               	lda z80_a
001617  3               	bmi dbox4		; end of message? yes, end count.
001617  3               	jmp dbox6		; repeat until we find the end.
001617  3               dbox3:
001617  3               	lda z80_e		; maximum line width.
001617  3               	cmp z80_b		; have we exceeded longest so far?
001617  3               	bpl dbox5		; no, carry on looking.
001617  3               	lda z80_b		; make this the widest so far.
001617  3               	sta z80_e
001617  3               	jmp dbox5		; keep looking.
001617  3               dbox4:
001617  3               	lda z80_e		; maximum line width.
001617  3               	cmp z80_b		; have we exceeded longest so far?
001617  3               	bpl dbox8		; no, carry on looking.
001617  3               	lda z80_b		; final line is the longest so far.
001617  3               	sta z80_e
001617  3               dbox8:
001617  3               	dec z80_d		; decrement items found.
001617  3               	bne :+			; total was zero.
001617  3               	jmp dbox15
001617  3               :
001617  3               	lda z80_e		; longest line.
001617  3               	bne :+			; was it zero?
001617  3               	jmp dbox15		; total was zero.
001617  3               :
001617  3               	sta bwid		; set up size.
001617  3               	lda z80_d
001617  3               	sta blen
001617  3               
001617  3               ;--------------------------------------------------------------
001617  3               ; That's set up our box size.
001617  3               ;--------------------------------------------------------------
001617  3               
001617  3               	lda winhgt		; window height in characters.
001617  3               	sec
001617  3               	sbc z80_d		; subtract height of box.
001617  3               	lsr a			; divide by 2.
001617  3               	clc
001617  3               	adc wintop		; add top edge of window.
001617  3               	sta btop		; set up box top.
001617  3               
001617  3               	lda winwid		; window width in characters.
001617  3               	sec
001617  3               	sbc z80_e		; subtract box width.
001617  3               	lsr a			; divide by 2.
001617  3               	clc
001617  3               	adc winlft		; add left edge of window.
001617  3               	sta blft		; box left.
001617  3               
001617  3               	lda FontPtr		; font.
001617  3               	sta grbase		; set up for text display.
001617  3               	lda FontPtr+1
001617  3               	sta grbase+1
001617  3               
001617  3               	lda TmpAddr+1		; restore message pointer.
001617  3               	sta z80_l
001617  3               	lda TmpAddr
001617  3               	sta z80_h
001617  3               
001617  3               	lda btop		; box top.
001617  3               	sta dispy		; set display coordinate.
001617  3               	lda #0			; start at object zero.
001617  3               	sta combyt		; store number of object in combyt.
001617  3               dbox2:
001617  3               	lda combyt		; get object number.
001617  3               	sta z80_a
001617  3               mod0:
001617  3               	jsr always		; check inventory for display.
001617  3               	cmp #255
001617  3               	beq :+
001617  3               	jmp dbox13		; not in inventory, skip this line.
001617  3               :
001617  3               	lda blft		; box left.
001617  3               	sta dispx		; set left display position.
001617  3               	lda bwid		; box width.
001617  3               	sta z80_b		; store width.
001617  3               dbox0:
001617  3               	ldy #0			; get character.
001617  3               	lda (z80_hl),y
001617  3               	cmp #','		; end of line?
001617  3               	beq dbox1		; yes, next one.
001617  3               	cmp #ASCII_NEWLINE			; end of line?
001617  3               	beq dbox1		; yes, next one.
001617  3               
001617  3               	dec z80_b		; one less to display.
001617  3               	and #127		; remove terminator.
001617  3               
001617  3               	jsr pchr		; display on screen.
001617  3               
001617  3               	ldy #0
001617  3               	lda (z80_hl),y		; get character.
001617  3               	sta z80_a
001617  3               	inc z80_l		; next character.
001617  3               	bne :+
001617  3               	inc z80_h
001617  3               :
001617  3               	lda z80_a
001617  3               	cmp #128		; end of message?
001617  3               	bmi :+
001617  3               	jmp dbox7		; yes, job done.
001617  3               :
001617  3               	lda z80_b		; chars remaining.
001617  3               	beq :+			; are any left?
001617  3               	jmp dbox0		; yes, continue.
001617  3               :
001617  3               ;---------------------------------------------------
001617  3               ; Reached limit of characters per line.
001617  3               ;---------------------------------------------------
001617  3               
001617  3               dbox9:
001617  3               	ldy #0
001617  3               	lda (z80_hl),y		; get character.
001617  3               	inc z80_l		; next one.
001617  3               	bne :+
001617  3               	inc z80_h
001617  3               :
001617  3               	cmp #','		; another line?
001617  3               	beq dbox10		; yes, do next line.
001617  3               	cmp #ASCII_NEWLINE			; another line?
001617  3               	beq dbox10		; yes, do next line.
001617  3               	cmp #128		; end of message?
001617  3               	bcs :+
001617  3               	jmp dbox11		; yes, finish message.
001617  3               :
001617  3               	jmp dbox9
001617  3               
001617  3               ;---------------------------------------------------
001617  3               ; Fill box to end of line.
001617  3               ;---------------------------------------------------
001617  3               
001617  3               dboxf:
001617  3               	lda #32			; space character.
001617  3               	jsr pchr		; display character.
001617  3               	dec z80_b
001617  3               	beq :+
001617  3               	jmp dboxf		; repeat for remaining chars on line.
001617  3               :
001617  3               	rts
001617  3               dbox1:
001617  3               	inc z80_l		; skip character.
001617  3               	bne :+
001617  3               	inc z80_h
001617  3               :
001617  3               	jsr dboxf		; fill box out to right side.
001617  3               dbox10:
001617  3               	inc dispy		; y coordinate down a line next position.
001617  3               	jmp dbox2		; next line.
001617  3               dbox7:
001617  3               	lda z80_b		; chars remaining.
001617  3               	bne :+			; are any left?
001617  3               	jmp dbox11		; no, nothing to draw.
001617  3               :
001617  3               	jsr dboxf		; fill message to line.
001617  3               
001617  3               ;------------------------------------------------------
001617  3               ; Drawn the box menu, now select option.
001617  3               ;------------------------------------------------------
001617  3               
001617  3               dbox11:
001617  3               	lda btop		; box top.
001617  3               	sta dispy		; set bar position.
001617  3               dbox14:
001617  3               	jsr joykey		; get controls.
001617  3               	cmp #$7f		; anything pressed?
001617  3               	bne dbox14		; yes, debounce it.
001617  3               	jsr dbar		; draw bar.
001617  3               dbox12:
001617  3               	jsr joykey		; get controls.
001617  3               	cmp #$7f		; anything pressed?
001617  3               	beq dbox12		; no, nothing.
001617  3               	and #16			; fire button pressed?
001617  3               	bne :+
001617  3               mod1:
001617  3               	jmp fstd		; yes, job done.
001617  3               :
001617  3               	jsr dbar		; delete bar.
001617  3               
001617  3               	lda joyval		; joystick reading.
001617  3               	and #8			; going up?
001617  3               	beq dboxu		; yes, go up.
001617  3               
001617  3               	ldx dispy		; vertical position of bar.
001617  3               	inx			; look down.
001617  3               	txa
001617  3               	sec
001617  3               	sbc btop		; find distance from top.
001617  3               	cmp blen		; top of box.
001617  3               	bne :+
001617  3               	jmp dbox14		; yes, go no further.
001617  3               :
001617  3               	inc dispy		; move bar.
001617  3               	jmp dbox14		; continue.
001617  3               dboxu:
001617  3               	lda dispy		; vertical position of bar.
001617  3               	cmp btop		; are we at the top?
001617  3               	bne :+
001617  3               	jmp dbox14		; yes, go no further.
001617  3               :
001617  3               	dec dispy		; move bar.
001617  3               	jmp dbox14		; continue.
001617  3               fstd:
001617  3               	lda dispy		; bar position.
001617  3               	sec
001617  3               	sbc btop		; find selected option.
001617  3               	sta varopt		; store the option.
001617  3               	jmp redraw		; redraw the screen.
001617  3               
001617  3               ;------------------------------------------------------
001617  3               ; Option not available.  Skip this line.
001617  3               ;------------------------------------------------------
001617  3               
001617  3               dbox13:
001617  3               	ldy #0
001617  3               	lda (z80_hl),y		; get character.
001617  3               	inc z80_l		; next one.
001617  3               	bne :+
001617  3               	inc z80_h
001617  3               :
001617  3               	cmp #','		; another line?
001617  3               	bne :+
001617  3               	jmp dbox2		; yes, do next line.
001617  3               :
001617  3               	cmp #ASCII_NEWLINE			; another line?
001617  3               	bne :+
001617  3               	jmp dbox2		; yes, do next line.
001617  3               :
001617  3               
001617  3               	bpl :+			; end of message?
001617  3               	jmp dbox11		; yes, finish message.
001617  3               :
001617  3               	jmp dbox13
001617  3               dbox15:
001617  3               	lda TmpAddr		; pop message pointer from the stack.
001617  3               	sta z80_h
001617  3               	lda TmpAddr+1
001617  3               	sta z80_l
001617  3               	rts
001617  3               
001617  3               ;------------------------------------------------------
001617  3               ; Invert bar
001617  3               ;------------------------------------------------------
001617  3               
001617  3               dbar:
001617  3               	lda blft		; box left.
001617  3               	sta dispx		; set display coordinate.
001617  3               	jsr gprad		; get printing address.
001617  3               
001617  3               	lda bwid		; box width.
001617  3               	sta z80_c		; loop counter in c.
001617  3               	lda z80_h
001617  3               	sta z80_d		; store screen address high byte.
001617  3               dbar1:
001617  3               	ldy #7			; pixel height in b.
001617  3               dbar0:
001617  3               	lda (scraddr),y		; get screen byte.
001617  3               	eor #255		; reverse all bits.
001617  3               	sta (scraddr),y		; write back to screen.
001617  3               	dey			; next line down.
001617  3               	bpl dbar0		; draw rest of character.
001617  3               
001617  3               	clc
001617  3               	lda scraddr		; one char right.
001617  3               	adc #8
001617  3               	sta scraddr
001617  3               	bcc :+
001617  3               	inc scraddr+1
001617  3               :
001617  3               
001617  3               	dec z80_c		; decrement character counter.
001617  3               	beq :+
001617  3               	jmp dbar1		; repeat for whole line.
001617  3               :
001617  3               	rts
001617  3               
001617  3               ;------------------------------------------------------
001617  3               ; Point to object
001617  3               ;
001617  3               ; Input:
001617  3               ;  -
001617  3               ;
001617  3               ; Output:
001617  3               ;  A = object number, A=255 if already in possession
001617  3               ;------------------------------------------------------
001617  3               
001617  3               invdis:
001617  3               	lda z80_l		; store message text pointer.
001617  3               	pha
001617  3               	lda z80_h
001617  3               	pha
001617  3               	lda combyt		; object number.
001617  3               	inc combyt		; ready for next one.
001617  3               	jsr gotob		; check if we have object.
001617  3               	tay
001617  3               	pla
001617  3               	sta z80_h
001617  3               	pla
001617  3               	sta z80_l
001617  3               	tya
001617  3               	rts
001617  3               
001617  3               ;------------------------------------------------------
001617  3               ; Find option selected.
001617  3               ;
001617  3               ; Input:
001617  3               ;  -
001617  3               ;
001617  3               ; Output:
001617  3               ;  OPT = selected object
001617  3               ;------------------------------------------------------
001617  3               
001617  3               fopt:
001617  3               	lda dispy
001617  3               	sec
001617  3               	sbc btop		; find selected option.
001617  3               	sta tmp+2		; option selected in b register.
001617  3               	inc tmp+2
001617  3               
001617  3               	lda #0			; set to first item.
001617  3               	sta combyt		; object number.
001617  3               fopt0:
001617  3               	jsr fobj		; find next object in inventory.
001617  3               	dec tmp+2
001617  3               	bne fopt0		; repeat for relevant steps down the list.
001617  3               
001617  3               	lda combyt		; get option.
001617  3               	sta varopt		; store the option.
001617  3               	dec varopt		; one less, due to where we increment combyt.
001617  3               	jmp redraw		; redraw the screen.
001617  3               fobj:
001617  3               	ldy combyt		; object number.
001617  3               	inc combyt		; ready for next item.
001617  3               	tya
001617  3               	jsr gotob		; do we have this item?
001617  3               	cmp #255
001617  3               	bne :+
001617  3               	rts
001617  3               :
001617  3               	jmp fobj		; yes, it's on the list.
001617  3               .endif
001617  3               
001617  3               ;----------------------------------------------------
001617  3               ; Clear sprite table.
001617  3               ;
001617  3               ; sprtab[0] - sprtab[SPRBUF-1] = 255
001617  3               ;----------------------------------------------------
001617  3               
001617  3               xspr:
001617  3  A9 FF        	lda #255		; clear byte.
001619  3  A2 00        	ldx #0			; length of table.
00161B  3               xspr0:
00161B  3  9D 00 0B     	sta sprtab,x		; sprite table.
00161E  3  E8           	inx			; move to next byte.
00161F  3  E0 CC        	cpx #SPRBUF
001621  3  D0 F8        	bne xspr0		; repeat for rest of table.
001623  3  60           	rts
001624  3               
001624  3               ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
001624  3               ; Sound, NOT IMPLEMENTED!!!
001624  3               ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
001624  3               ;
001624  3               ;silenc:
001624  3               ;	jsr silen1 		; silence channel 1.
001624  3               ;	jsr silen2 		; silence channel 2.
001624  3               ;	jsr silen3 		; silence channel 3.
001624  3               ;	jmp plsnd 		; play all channels to switch them off.
001624  3               ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
001624  3               
001624  3               ;-------------------------------------------------------------
001624  3               ; Initialise all objects.
001624  3               ;
001624  3               ; Reset current room,y,x to start room,y,x for all objects
001624  3               ;-------------------------------------------------------------
001624  3               
001624  3               iniob:
001624  3  A9 20        	lda #<objdta 		; objects table.
001626  3  85 rr        	sta z80_x
001628  3  A9 63        	lda #>objdta
00162A  3  85 rr        	sta z80_i
00162C  3               
00162C  3  AE 10 16     	ldx numob 		; number of objects in the game.
00162F  3               iniob0:
00162F  3  A0 23        	ldy #35
001631  3  B1 rr        	lda (z80_ix),y 		; start screen.
001633  3  A0 20        	ldy #32
001635  3  91 rr        	sta (z80_ix),y 		; set start screen.
001637  3               
001637  3  A0 24        	ldy #36
001639  3  B1 rr        	lda (z80_ix),y 		; find start y.
00163B  3  A0 21        	ldy #33
00163D  3  91 rr        	sta (z80_ix),y 		; set start y.
00163F  3               
00163F  3  A0 25        	ldy #37
001641  3  B1 rr        	lda (z80_ix),y 		; get initial x.
001643  3  A0 22        	ldy #34
001645  3  91 rr        	sta (z80_ix),y 		; set x coord.
001647  3               
001647  3  18           	clc 			; point to next object.
001648  3  A5 rr        	lda z80_x
00164A  3  69 26        	adc #38			; distance between objects.
00164C  3  85 rr        	sta z80_x
00164E  3  90 02        	bcc :+
001650  3  E6 rr        	inc z80_i
001652  3               :
001652  3  CA           	dex 			; repeat.
001653  3  D0 DA        	bne iniob0
001655  3               
001655  3  60           	rts
001656  3               
001656  3               ;-----------------------------------------------
001656  3               ; Redraw the screen.
001656  3               ;
001656  3               ; Remove old copy of all sprites for redraw.
001656  3               ;-----------------------------------------------
001656  3               
001656  3               redraw:
001656  3  A5 rr        	lda z80_i 		; place sprite pointer on stack.
001658  3  48           	pha
001659  3  A5 rr        	lda z80_x
00165B  3  48           	pha
00165C  3               
00165C  3  20 F5 1C     	jsr droom		; show screen layout.
00165F  3  20 E8 18     	jsr shwob		; draw objects.
001662  3               numsp0:
001662  3  A9 0C        	lda #NUMSPR		; sprites to draw.
001664  3  85 rr        	sta tmp
001666  3               
001666  3  A9 00        	lda #<sprtab		; sprite table.
001668  3  85 rr        	sta z80_x
00166A  3  A9 0B        	lda #>sprtab
00166C  3  85 rr        	sta z80_i
00166E  3               redrw0:
00166E  3  A0 00        	ldy #0
001670  3  B1 rr        	lda (z80_ix),y		; old sprite type.
001672  3  C9 FF        	cmp #255		; is it enabled?
001674  3  F0 0B        	beq redrw1 		; no, find next one.
001676  3               
001676  3  A0 03        	ldy #var_Y
001678  3  B1 rr        	lda (z80_ix),y 		; sprite y.
00167A  3  C9 B1        	cmp #177		; beyond maximum?
00167C  3  B0 03        	bcs redrw1		; yes, nothing to draw.
00167E  3               
00167E  3  20 D1 0F     	jsr sspria		; show single sprite.
001681  3               
001681  3               redrw1:
001681  3  18           	clc			; next sprite.
001682  3  A5 rr        	lda z80_x
001684  3  69 11        	adc #TABSIZ		; distance to next odd/even entry.
001686  3  85 rr        	sta z80_x
001688  3  90 02        	bcc :+
00168A  3  E6 rr        	inc z80_i
00168C  3               :
00168C  3  C6 rr        	dec tmp			; repeat for remaining sprites.
00168E  3  D0 DE        	bne redrw0
001690  3               
001690  3               rpblc1:
001690  3               ;	jsr dshrp		; redraw shrapnel.
001690  3               
001690  3  68           	pla			; retrieve sprite pointer.
001691  3  85 rr        	sta z80_x
001693  3  68           	pla
001694  3  85 rr        	sta z80_i
001696  3               
001696  3  60           	rts
001697  3               
001697  3               ;----------------------------------------------------------------------
001697  3               ; Clear screen routine.
001697  3               ;
001697  3               ; Fill screenmem $8000-$97ff with ScrFillByte
001697  3               ;----------------------------------------------------------------------
001697  3               
001697  3               cls:
001697  3  A9 68        	lda #>ScreenAddr		; screen address.
001699  3  8D A2 16     	sta clsloop+2
00169C  3  A9 00        	lda #ScrFillByte
00169E  3  A0 00        	ldy #0
0016A0  3               clsloop:
0016A0  3  99 00 68     	sta ScreenAddr,y
0016A3  3  C8           	iny
0016A4  3  D0 FA        	bne clsloop
0016A6  3  EE A2 16     	inc clsloop+2
0016A9  3  AE A2 16     	ldx clsloop+2
0016AC  3  E0 80        	cpx #>(ScreenAddr+ScreenSize)		; _BEEB
0016AE  3  D0 F0        	bne clsloop
0016B0  3  60           	rts
0016B1  3               
0016B1  3               ;----------------------------------------------------------------------
0016B1  3               ; FODDER check
0016B1  3               ;----------------------------------------------------------------------
0016B1  3               
0016B1  3               fdchk:
0016B1  3  A0 00        	ldy #0
0016B3  3  B1 rr        	lda (z80_hl),y	 	; fetch cell.
0016B5  3  C9 04        	cmp #FODDER 		; is it fodder?
0016B7  3  F0 01        	beq :+
0016B9  3  60           	rts 			; no.
0016BA  3               :
0016BA  3  A9 00        	lda #0
0016BC  3  A0 00        	ldy #0
0016BE  3  91 rr        	sta (z80_hl),y 		; rewrite block type.
0016C0  3               
0016C0  3  A5 rr        	lda z80_h		; store pointer to block.
0016C2  3  48           	pha
0016C3  3  A5 rr        	lda z80_l
0016C5  3  48           	pha
0016C6  3               
0016C6  3  38           	sec			; set carry flag for subtraction.
0016C7  3  A5 rr        	lda z80_l 		; find simple displacement for block.
0016C9  3  E9 00        	sbc #<MAP
0016CB  3  85 rr        	sta z80_l
0016CD  3  A5 rr        	lda z80_h
0016CF  3  E9 03        	sbc #>MAP
0016D1  3  85 rr        	sta z80_h
0016D3  3               
0016D3  3  A5 rr        	lda z80_l		; low byte is y coordinate.
0016D5  3  29 1F        	and #31 		; column position 0 - 31.
0016D7  3  85 rr        	sta dispx		; set up x position.
0016D9  3               
0016D9  3  06 rr        	asl z80_l		; multiply displacement by 8.
0016DB  3  26 rr        	rol z80_h
0016DD  3  06 rr        	asl z80_l
0016DF  3  26 rr        	rol z80_h
0016E1  3  06 rr        	asl z80_l
0016E3  3  26 rr        	rol z80_h
0016E5  3               
0016E5  3  A5 rr        	lda z80_h		; x coordinate now in h.
0016E7  3  85 rr        	sta dispy		; set the display coordinate.
0016E9  3               
0016E9  3  A9 00        	lda #0 			; block to write.
0016EB  3  20 5E 1C     	jsr pattr 		; write block.
0016EE  3               
0016EE  3  68           	pla 			; restore block pointer.
0016EF  3  85 rr        	sta z80_l
0016F1  3  68           	pla
0016F2  3  85 rr        	sta z80_h
0016F4  3               
0016F4  3  60           	rts
0016F5  3               
0016F5  3               ;----------------------------------------------------
0016F5  3               ; Scrolly text and puzzle variables.
0016F5  3               ;----------------------------------------------------
0016F5  3               
0016F5  3               .if sflag
0016F5  3               txtbit:	.byte 128		; bit to write.
0016F5  3               txtwid:	.byte 16		; width of ticker message.
0016F5  3               txtpos:	.word msgdat
0016F5  3               txtini:	.word msgdat
0016F5  3               txtscr:	.word ScreenAddr
0016F5  3               .endif
0016F5  3               
0016F5  3               ;----------------------------------------------------
0016F5  3               ; Specialist routines.
0016F5  3               ; Process shrapnel.
0016F5  3               ;----------------------------------------------------
0016F5  3               proshr:
0016F5  3               .if pflag
0016F5  3               	lda #<SHRAPN		; table.
0016F5  3               	sta z80_x
0016F5  3               	lda #>SHRAPN
0016F5  3               	sta z80_i
0016F5  3               
0016F5  3               	lda #NUMSHR		; shrapnel pieces to process.
0016F5  3               	sta shrctr
0016F5  3               prosh0:
0016F5  3               	ldy #0
0016F5  3               	lda (z80_ix),y		; on/off marker.
0016F5  3               	asl a
0016F5  3               proshx:
0016F5  3               	bcs :+
0016F5  3               	jsr prosh1 		; on, so process it.
0016F5  3               :
0016F5  3               	clc
0016F5  3               	lda z80_x
0016F5  3               	adc #SHRSIZ
0016F5  3               	sta z80_x
0016F5  3               	bcc :+
0016F5  3               	inc z80_i
0016F5  3               :
0016F5  3               	dec shrctr		; round again.
0016F5  3               	bne prosh0
0016F5  3               .endif
0016F5  3               .if sflag
0016F5  3               	jsr scrly
0016F5  3               .endif
0016F5  3  60           	rts
0016F6  3               
0016F6  3               .if pflag
0016F6  3               ;----------------------------------------------------
0016F6  3               ; Proces shrapnel piece
0016F6  3               ;----------------------------------------------------
0016F6  3               
0016F6  3               prosh1:
0016F6  3               	jsr plot 		; delete the pixel.
0016F6  3               
0016F6  3               	lda #<shrptr		; shrapnel routine pointers.
0016F6  3               	sta z80_l
0016F6  3               	lda #>shrptr
0016F6  3               	sta z80_h
0016F6  3               
0016F6  3               	ldy #0
0016F6  3               	lda (z80_ix),y		; restore shrapnel type.
0016F6  3               	jsr prosh2 		; run the routine.
0016F6  3               	jsr chkxy		; check x and y are good before we redisplay.
0016F6  3               
0016F6  3               	lda #<SHRSIZ 		; distance to next.
0016F6  3               	sta z80_e
0016F6  3               	lda #>SHRSIZ
0016F6  3               	sta z80_d
0016F6  3               	rts
0016F6  3               
0016F6  3               ;----------------------------------------------------
0016F6  3               ; Run the routine
0016F6  3               ;----------------------------------------------------
0016F6  3               
0016F6  3               prosh2:
0016F6  3               	asl a 			; 2 bytes per address.
0016F6  3               	tay
0016F6  3               	lda shrptr,y
0016F6  3               	sta z80_l
0016F6  3               	lda shrptr+1,y 		; fetch high byte from table.
0016F6  3               	sta z80_h
0016F6  3               	jmp (z80_hl) 		; jump to routine.
0016F6  3               
0016F6  3               ;----------------------------------------------------
0016F6  3               ; Paricle routine table
0016F6  3               ;----------------------------------------------------
0016F6  3               
0016F6  3               shrptr:	.word laser		; laser.
0016F6  3               	.word trail		; vapour trail.
0016F6  3               	.word shrap		; shrapnel from explosion.
0016F6  3               	.word dotl		; horizontal starfield left.
0016F6  3               	.word dotr		; horizontal starfield right.
0016F6  3               	.word dotu		; vertical starfield up.
0016F6  3               	.word dotd		; vertical starfield down.
0016F6  3               	.word ptcusr		; user particle.
0016F6  3               
0016F6  3               ;----------------------------------------------------
0016F6  3               ; Explosion shrapnel.
0016F6  3               ;----------------------------------------------------
0016F6  3               
0016F6  3               shrap:
0016F6  3               	ldy #1
0016F6  3               	lda (z80_ix),y 		; get the angle.
0016F6  3               	clc
0016F6  3               	adc #<shrsin		; shrapnel sine table.
0016F6  3               	sta z80_l
0016F6  3               	lda #>shrsin
0016F6  3               	adc #0
0016F6  3               	sta z80_h
0016F6  3               
0016F6  3               	ldy #0
0016F6  3               	lda (z80_hl),y 		; fetch value from table.
0016F6  3               	sta z80_e
0016F6  3               	inc z80_l 		; next byte of table.
0016F6  3               	bne :+
0016F6  3               	inc z80_h
0016F6  3               :
0016F6  3               	ldy #0
0016F6  3               	lda (z80_hl),y		; fetch value from table.
0016F6  3               	sta z80_d
0016F6  3               	inc z80_l		; next byte of table.
0016F6  3               	bne :+
0016F6  3               	inc z80_h
0016F6  3               :
0016F6  3               	ldy #0
0016F6  3               	lda (z80_hl),y 		; fetch value from table.
0016F6  3               	sta z80_c
0016F6  3               	inc z80_l 		; next byte of table.
0016F6  3               	bne :+
0016F6  3               	inc z80_h
0016F6  3               :
0016F6  3               	ldy #0
0016F6  3               	lda (z80_hl),y 		; fetch value from table.
0016F6  3               	sta z80_b
0016F6  3               
0016F6  3               	ldy #2
0016F6  3               	lda (z80_ix),y 		; x coordinate in hl.
0016F6  3               	clc
0016F6  3               	adc z80_e		; add sine lb
0016F6  3               	sta (z80_ix),y		; store new coordinate lb.
0016F6  3               	ldy #3
0016F6  3               	lda (z80_ix),y
0016F6  3               	adc z80_d		; add sine hb
0016F6  3               	sta (z80_ix),y		; store new coordinate hb.
0016F6  3               
0016F6  3               	ldy #4
0016F6  3               	lda (z80_ix),y	 	; y coordinate in hl.
0016F6  3               	clc
0016F6  3               	adc z80_c		; add cosine lb
0016F6  3               	sta (z80_ix),y		; store new coordinate lb.
0016F6  3               	ldy #5
0016F6  3               	lda (z80_ix),y
0016F6  3               	adc z80_b		; add cosine lb
0016F6  3               	sta (z80_ix),y		; store new coordinate hb.
0016F6  3               
0016F6  3               	rts
0016F6  3               
0016F6  3               ;----------------------------------------------------
0016F6  3               ; Move dots
0016F6  3               ;----------------------------------------------------
0016F6  3               
0016F6  3               dotl:
0016F6  3               	ldy #5
0016F6  3               	lda (z80_ix),y
0016F6  3               	sec
0016F6  3               	sbc #1		 	; move left.
0016F6  3               	sta (z80_ix),y
0016F6  3               	rts
0016F6  3               dotr:
0016F6  3               	ldy #5
0016F6  3               	lda (z80_ix),y
0016F6  3               	clc
0016F6  3               	adc #1		 	; move left.
0016F6  3               	sta (z80_ix),y
0016F6  3               	rts
0016F6  3               dotu:
0016F6  3               	ldy #3
0016F6  3               	lda (z80_ix),y
0016F6  3               	sec
0016F6  3               	sbc #1		 	; move up.
0016F6  3               	sta (z80_ix),y
0016F6  3               	rts
0016F6  3               dotd:
0016F6  3               	ldy #3
0016F6  3               	lda (z80_ix),y
0016F6  3               	clc
0016F6  3               	adc #1			; move down.
0016F6  3               	sta (z80_ix),y
0016F6  3               	rts
0016F6  3               
0016F6  3               ;----------------------------------------------------
0016F6  3               ; Check if coordinates are ok before redrawing at new position.
0016F6  3               ;
0016F6  3               ; left:   X>L		X=L	Ok
0016F6  3               ; right:  R+15>X	X=R	Ok
0016F6  3               ; top:    Y>T		Y=T	Ok
0016F6  3               ; bottom: B+15>Y	Y=B	Ok
0016F6  3               ;----------------------------------------------------
0016F6  3               
0016F6  3               chkxy:
0016F6  3               
0016F6  3               ; top:    Y>T		Y=T	Ok
0016F6  3               
0016F6  3               	ldy #3
0016F6  3               	lda (z80_ix),y	 	; fetch shrapnel coordinate.
0016F6  3               	cmp wntopx		; window top.
0016F6  3               	bcs :+			; compare with top window limit.
0016F6  3               	jmp kilshr		; out of window, kill shrapnel.
0016F6  3               :
0016F6  3               ; left:   X>L		X=L	Ok
0016F6  3               
0016F6  3               	ldy #5
0016F6  3               	lda (z80_ix),y	 	; fetch shrapnel coordinate.
0016F6  3               	cmp wnlftx		; left edge.
0016F6  3               	bcs :+			; compare with left window limit.
0016F6  3               	jmp kilshr		; out of window, kill shrapnel.
0016F6  3               :
0016F6  3               ; bottom: B+15>Y	Y=B	Ok
0016F6  3               
0016F6  3               	lda wnbotx		; point to bottom.
0016F6  3               	clc
0016F6  3               	adc #15
0016F6  3               	ldy #3
0016F6  3               	cmp (z80_ix),y	 	; fetch shrapnel coordinate.
0016F6  3               	bcs :+			; compare with shrapnel x coordinate.
0016F6  3               	jmp kilshr		; off screen, kill shrapnel..
0016F6  3               :
0016F6  3               ; right:  R+15>X	X=R	Ok
0016F6  3               
0016F6  3               	lda wnrgtx		; point to right edge.
0016F6  3               	clc
0016F6  3               	adc #15
0016F6  3               	ldy #5
0016F6  3               	cmp (z80_ix),y	 	; fetch shrapnel coordinate.
0016F6  3               	bcs :+			; compare with window limit.
0016F6  3               	jmp kilshr		; off screen, kill shrapnel.
0016F6  3               :
0016F6  3               
0016F6  3               ;----------------------------------------------------
0016F6  3               ; Drop through.
0016F6  3               ; Display shrapnel.
0016F6  3               ;----------------------------------------------------
0016F6  3               
0016F6  3               plot:
0016F6  3               	ldy #3
0016F6  3               	lda (z80_ix),y		; y integer.
0016F6  3               	sta dispy	 	; workspace coordinates.
0016F6  3               	ldy #5
0016F6  3               	lda (z80_ix),y	 	; x integer.
0016F6  3               	sta dispx 		; workspace coordinates.
0016F6  3               
0016F6  3               	ldy #0
0016F6  3               	lda (z80_ix),y 		; type.
0016F6  3               	bne :+			; is it a laser?
0016F6  3               	jmp plot1 		; yes, draw laser instead.
0016F6  3               :
0016F6  3               plot0:
0016F6  3               	lda dispx		; which pixel within byte do we
0016F6  3               	and #7			; want to set first?
0016F6  3               	tay
0016F6  3               	lda dots,y 		; table of small pixel positions.
0016F6  3               	sta z80_e 		; get value.
0016F6  3               
0016F6  3               	jsr scadd 		; screen address.
0016F6  3               	ldy #0
0016F6  3               	lda (scraddr),y		; see what's already there.
0016F6  3               	eor z80_e
0016F6  3               	sta (scraddr),y 	; put back on screen.
0016F6  3               	rts
0016F6  3               
0016F6  3               plot1:
0016F6  3               	jsr scadd 		; screen address.
0016F6  3               	ldy #0
0016F6  3               	lda (scraddr),y 	; fetch byte there.
0016F6  3               	eor #255 		; toggle all bits.
0016F6  3               	sta (scraddr),y 	; new byte.
0016F6  3               	rts
0016F6  3               
0016F6  3               ;----------------------------------------------------
0016F6  3               ; Switch off shrapnel
0016F6  3               ;----------------------------------------------------
0016F6  3               
0016F6  3               kilshr:
0016F6  3               	lda #128
0016F6  3               	ldy #0
0016F6  3               	sta (z80_ix),y	; switch off shrapnel.
0016F6  3               	rts
0016F6  3               
0016F6  3               ;----------------------------------------------------
0016F6  3               ; Sine/cosine table
0016F6  3               ;----------------------------------------------------
0016F6  3               
0016F6  3               shrsin:	.word 0,1024,391,946,724,724,946,391
0016F6  3               	.word 1024,0,946,65144,724,64811,391,64589
0016F6  3               	.word 0,64512,65144,64589,64811,64811,64589,65144
0016F6  3               	.word 64512,0,64589,391,64811,724,65144,946
0016F6  3               
0016F6  3               ;----------------------------------------------------
0016F6  3               ; Create trail
0016F6  3               ;----------------------------------------------------
0016F6  3               
0016F6  3               trail:
0016F6  3               	ldy #1
0016F6  3               	lda (z80_ix),y 	; time remaining.
0016F6  3               	sec
0016F6  3               	sbc #1
0016F6  3               	sta (z80_ix),y
0016F6  3               	bne :+
0016F6  3               	jmp trailk		; time to switch it off.
0016F6  3               :
0016F6  3               	jsr qrand		; get a random number.
0016F6  3               	lsr a 			; x or y axis?
0016F6  3               	bcc :+
0016F6  3               	jmp trailv		; use y.
0016F6  3               :
0016F6  3               ; Trail horizontal
0016F6  3               
0016F6  3               	lsr a 			; which direction?
0016F6  3               	bcc :+
0016F6  3               	jmp traill		; go left.
0016F6  3               :
0016F6  3               ; Trail right
0016F6  3               
0016F6  3               	ldy #5
0016F6  3               	lda (z80_ix),y
0016F6  3               	clc
0016F6  3               	adc #1	 		; go right.
0016F6  3               	sta (z80_ix),y
0016F6  3               	rts
0016F6  3               
0016F6  3               ; Trail left
0016F6  3               
0016F6  3               traill:
0016F6  3               	ldy #5
0016F6  3               	lda (z80_ix),y
0016F6  3               	sec
0016F6  3               	sbc #1 			; go left.
0016F6  3               	sta (z80_ix),y
0016F6  3               	rts
0016F6  3               
0016F6  3               ; Trail vertical
0016F6  3               
0016F6  3               trailv:
0016F6  3               	lsr a		 	; which direction?
0016F6  3               	bcc :+
0016F6  3               	jmp trailu		; go up.
0016F6  3               :
0016F6  3               ; Trail down
0016F6  3               
0016F6  3               	ldy #3
0016F6  3               	lda (z80_ix),y
0016F6  3               	clc
0016F6  3               	adc #1 			; go down.
0016F6  3               	sta (z80_ix),y
0016F6  3               	rts
0016F6  3               
0016F6  3               ; Trail up
0016F6  3               
0016F6  3               trailu:
0016F6  3               	ldy #3
0016F6  3               	lda (z80_ix),y
0016F6  3               	sec
0016F6  3               	sbc #1 			; go up.
0016F6  3               	sta (z80_ix),y
0016F6  3               	rts
0016F6  3               
0016F6  3               ; Kill trail
0016F6  3               
0016F6  3               trailk:
0016F6  3               	lda #200		; set off-screen to kill vapour trail.
0016F6  3               	ldy #3
0016F6  3               	sta (z80_ix),y
0016F6  3               	rts
0016F6  3               
0016F6  3               ;----------------------------------------------------
0016F6  3               ; Create laser beam
0016F6  3               ;----------------------------------------------------
0016F6  3               
0016F6  3               laser:
0016F6  3               	ldy #1
0016F6  3               	lda (z80_ix),y 		; direction.
0016F6  3               	ror a 			; left or right?
0016F6  3               	bcs :+
0016F6  3               	jmp laserl		; move left.
0016F6  3               :
0016F6  3               ; Laser right
0016F6  3               
0016F6  3               	lda #8			; distance to travel.
0016F6  3               	sta z80_b
0016F6  3               	jmp laserm		; move laser.
0016F6  3               
0016F6  3               ; Laser left
0016F6  3               
0016F6  3               laserl:
0016F6  3               	lda #248		; distance to travel.
0016F6  3               	sta z80_b
0016F6  3               laserm:
0016F6  3               	ldy #5
0016F6  3               	lda (z80_ix),y		; x position.
0016F6  3               	clc
0016F6  3               	adc z80_b		; add distance.
0016F6  3               	sta (z80_ix),y		; set new x coordinate.
0016F6  3               
0016F6  3               ; Test new block.
0016F6  3               
0016F6  3               	sta dispx 		; set x for block collision detection purposes.
0016F6  3               	ldy #3
0016F6  3               	lda (z80_ix),y 		; get y.
0016F6  3               	sta dispy		; set coordinate for collision test.
0016F6  3               	jsr tstbl 		; get block type there.
0016F6  3               	cmp #WALL		; is it solid?
0016F6  3               	bne :+
0016F6  3               	jmp trailk		; yes, it cannot pass.
0016F6  3               :
0016F6  3                       cmp #FODDER             ; is it fodder?
0016F6  3                       bne :+
0016F6  3                       jsr fdchk               ; remove fodder block.
0016F6  3                       jmp trailk              ; destroy laser.
0016F6  3               :
0016F6  3                       rts                     ; no, ignore it.
0016F6  3               
0016F6  3               ;----------------------------------------------------
0016F6  3               ; Dots mask
0016F6  3               ;----------------------------------------------------
0016F6  3               
0016F6  3               dots:	.byte 128,64,32,16,8,4,2,1
0016F6  3               
0016F6  3               
0016F6  3               ;----------------------------------------------------
0016F6  3               ; Plot, preserving de.
0016F6  3               ;----------------------------------------------------
0016F6  3               
0016F6  3               plotde:
0016F6  3               	lda z80_d 		; put de on stack.
0016F6  3               	pha
0016F6  3               	lda z80_e
0016F6  3               	pha
0016F6  3               
0016F6  3               	jsr plot 		; plot pixel.
0016F6  3               
0016F6  3               	pla			; restore de from stack.
0016F6  3               	sta z80_e
0016F6  3               	pla
0016F6  3               	sta z80_d
0016F6  3               
0016F6  3               	rts
0016F6  3               
0016F6  3               ;----------------------------------------------------
0016F6  3               ; Shoot a laser.
0016F6  3               ;----------------------------------------------------
0016F6  3               
0016F6  3               shoot:
0016F6  3               	sta z80_c		; store direction in c register.
0016F6  3               	ldy #8
0016F6  3               	lda (z80_ix),y 		; y coordinate.
0016F6  3               shoot1:
0016F6  3               	clc
0016F6  3               	adc #7 			; down 7 pixels.
0016F6  3               	sta z80_l 		; puty y coordinate in l.
0016F6  3               
0016F6  3               	ldy #9
0016F6  3               	lda (z80_ix),y 		; x coordinate in h.
0016F6  3               	sta z80_h
0016F6  3               
0016F6  3               	lda z80_i		; store pointer to sprite.
0016F6  3               	pha
0016F6  3               	lda z80_x
0016F6  3               	pha
0016F6  3               
0016F6  3               	jsr fpslot 		; find particle slot.
0016F6  3               	bcs :+
0016F6  3               	jmp vapou2		; failed, restore ix.
0016F6  3               :
0016F6  3               	lda #0
0016F6  3               	ldy #0
0016F6  3               	sta (z80_ix),y 		; set up a laser.
0016F6  3               
0016F6  3               	lda z80_c
0016F6  3               	ldy #1
0016F6  3               	sta (z80_ix),y 		; set the direction.
0016F6  3               
0016F6  3               	lda z80_l
0016F6  3               	ldy #3
0016F6  3               	sta (z80_ix),y		; set y coordinate.
0016F6  3               
0016F6  3               	ror z80_c		; check direction we want.
0016F6  3               	bcc :+
0016F6  3               	jmp shootr		; shoot right.
0016F6  3               :
0016F6  3               	lda z80_h		; X position.
0016F6  3               shoot0:
0016F6  3               	and #248		; align on character boundary.
0016F6  3               	ldy #5
0016F6  3               	sta (z80_ix),y		; set x coordinate.
0016F6  3               	jmp vapou0 		; draw first image.
0016F6  3               shootr:
0016F6  3               	lda z80_h		; x position.
0016F6  3               	clc
0016F6  3               	adc #15			; look right.
0016F6  3               	jmp shoot0		; align and continue.
0016F6  3               
0016F6  3               ;----------------------------------------------------
0016F6  3               ; Create a bit of vapour trail.
0016F6  3               ;----------------------------------------------------
0016F6  3               
0016F6  3               vapour:
0016F6  3               	lda z80_i		; store pointer to sprite.
0016F6  3               	pha
0016F6  3               	lda z80_x
0016F6  3               	pha
0016F6  3               
0016F6  3               	ldy #8
0016F6  3               	lda (z80_ix),y 		; y coordinate.
0016F6  3               	clc
0016F6  3               	adc #7			; mid-point of sprite.
0016F6  3               	sta z80_l
0016F6  3               
0016F6  3               	ldy #9
0016F6  3               	lda (z80_ix),y 		; x coordinate.
0016F6  3               	adc #7
0016F6  3               	sta z80_h
0016F6  3               
0016F6  3               	jsr fpslot 		; find particle slot.
0016F6  3               	bcc :+
0016F6  3               	jmp vapou1		; no, we can use it.
0016F6  3               :
0016F6  3               vapou2:
0016F6  3               	pla
0016F6  3               	sta z80_x
0016F6  3               	pla
0016F6  3               	sta z80_i
0016F6  3               	rts
0016F6  3               vapou1:
0016F6  3               	lda z80_l
0016F6  3               	ldy #3
0016F6  3               	sta (z80_ix),y		; set up y.
0016F6  3               
0016F6  3               	lda z80_h
0016F6  3               	ldy #5
0016F6  3               	sta (z80_ix),y 		; set up x coordinate.
0016F6  3               
0016F6  3               	jsr qrand		; get quick random number.
0016F6  3               	and #15			; random time.
0016F6  3               	clc
0016F6  3               	adc #15			; minimum time on screen.
0016F6  3               	ldy #1
0016F6  3               	sta (z80_ix),y		; set time on screen.
0016F6  3               
0016F6  3               	lda #1
0016F6  3               	ldy #0
0016F6  3               	sta (z80_ix),y		; define particle as vapour trail.
0016F6  3               vapou0:
0016F6  3               	jsr chkxy		; plot first position.
0016F6  3               	jmp vapou2
0016F6  3               
0016F6  3               ;----------------------------------------------------
0016F6  3               ; Create a user particle.
0016F6  3               ;----------------------------------------------------
0016F6  3               
0016F6  3               ptusr:
0016F6  3               	sta z80_f		; store timer.
0016F6  3               
0016F6  3               	ldy #8
0016F6  3               	lda (z80_ix),y 		; y coordinate.
0016F6  3               	clc
0016F6  3               	adc #7			; mid-point of sprite.
0016F6  3               	sta z80_l
0016F6  3               
0016F6  3               	ldy #9
0016F6  3               	lda (z80_ix),y 		; x coordinate.
0016F6  3               	clc
0016F6  3               	adc #7			; mid-point of sprite.
0016F6  3               	sta z80_h
0016F6  3               
0016F6  3               	jsr fpslot 		; find particle slot.
0016F6  3               	bcs ptusr1
0016F6  3               	rts 			; out of slots, can't generate anything.
0016F6  3               ptusr1:
0016F6  3               	lda z80_l
0016F6  3               	ldy #3
0016F6  3               	sta (z80_ix),y 		; set up y.
0016F6  3               
0016F6  3               	lda z80_h
0016F6  3               	ldy #5
0016F6  3               	sta (z80_ix),y		; set up x coordinate.
0016F6  3               
0016F6  3               	lda z80_f 		; restore timer.
0016F6  3               	ldy #1
0016F6  3               	sta (z80_ix),y		; set time on screen.
0016F6  3               
0016F6  3               	lda #7
0016F6  3               	ldy #0
0016F6  3               	sta (z80_ix),y		; define particle as user particle.
0016F6  3               
0016F6  3               	jmp chkxy		; plot first position.
0016F6  3               
0016F6  3               ;----------------------------------------------------
0016F6  3               ; Create a vertical or horizontal star.
0016F6  3               ;----------------------------------------------------
0016F6  3               
0016F6  3               star:
0016F6  3               	lda z80_i		; store pointer to sprite.
0016F6  3               	pha
0016F6  3               	lda z80_x
0016F6  3               	pha
0016F6  3               
0016F6  3               	jsr fpslot 		; find particle slot.
0016F6  3               	bcs star7		; found one we can use.
0016F6  3               star0:
0016F6  3               	pla 			; restore sprite pointer.
0016F6  3               	sta z80_x
0016F6  3               	pla
0016F6  3               	sta z80_i
0016F6  3               	rts 			; out of slots, can't generate anything.
0016F6  3               star7:
0016F6  3               	lda z80_c		; direction.
0016F6  3               	and #3 			; is it left?
0016F6  3               	bne :+
0016F6  3               	jmp star1 		; yes, it's left.
0016F6  3               :
0016F6  3               	cmp #1 			; is it right?
0016F6  3               	bne :+
0016F6  3               	jmp star2 		; yes, it's right.
0016F6  3               :
0016F6  3               	cmp #2 			; is it up?
0016F6  3               	bne :+
0016F6  3               	jmp star3 		; yes, it's up.
0016F6  3               :
0016F6  3               	ldy wntopx 		; get edge of screen.
0016F6  3               	iny			; down one pixel.
0016F6  3               	tya
0016F6  3               star8:
0016F6  3               	ldy #3
0016F6  3               	sta (z80_ix),y 		; set y coord.
0016F6  3               	jsr qrand 		; get quick random number.
0016F6  3               star9:
0016F6  3               	ldy #5
0016F6  3               	sta (z80_ix),y		; set x position.
0016F6  3               
0016F6  3               	lda z80_c		; direction.
0016F6  3               	and #3			; zero to three.
0016F6  3               	clc
0016F6  3               	adc #3			; 3 to 6 for starfield.
0016F6  3               	ldy #0
0016F6  3               	sta (z80_ix),y		; define particle as star.
0016F6  3               	jsr chkxy		; plot first position.
0016F6  3               	jmp star0
0016F6  3               star1:
0016F6  3               	jsr qrand		; get quick random number.
0016F6  3               	ldy #3
0016F6  3               	sta (z80_ix),y 		; set y coord.
0016F6  3               
0016F6  3               	lda wnrgtx 		; get edge of screen.
0016F6  3               	clc
0016F6  3               	adc #15			; add width of sprite minus 1.
0016F6  3               	jmp star9
0016F6  3               star2:
0016F6  3               	jsr qrand 		; get quick random number.
0016F6  3               	ldy #3
0016F6  3               	sta (z80_ix),y		; set y coord.
0016F6  3               
0016F6  3               	lda wnlftx		; get edge of screen.
0016F6  3               	jmp star9
0016F6  3               star3:
0016F6  3               	lda wnbotx 		; get edge of screen.
0016F6  3               	clc
0016F6  3               	adc #15 		; height of sprite minus one pixel.
0016F6  3               	jmp star8
0016F6  3               
0016F6  3               ;----------------------------------------------------
0016F6  3               ; Find particle slot for lasers or vapour trail.
0016F6  3               ; can't use alternate accumulator.
0016F6  3               ;----------------------------------------------------
0016F6  3               
0016F6  3               fpslot:
0016F6  3               	lda #<SHRAPN 		; shrapnel table.
0016F6  3               	sta z80_x
0016F6  3               	lda #>SHRAPN
0016F6  3               	sta z80_i
0016F6  3               
0016F6  3               	lda #NUMSHR		; number of pieces in table.
0016F6  3               	sta z80_b
0016F6  3               fpslt0:
0016F6  3               	ldy #0
0016F6  3               	lda (z80_ix),y		; get type.
0016F6  3               	asl a  			; is this slot in use?
0016F6  3               	bcc :+
0016F6  3               	rts			; no, we can use it.
0016F6  3               :
0016F6  3               	clc			; point to more shrapnel.
0016F6  3               	lda z80_x
0016F6  3               	adc #SHRSIZ
0016F6  3               	sta z80_x
0016F6  3               	bcc :+
0016F6  3               	inc z80_i
0016F6  3               :
0016F6  3               	dec z80_b		; repeat for all shrapnel.
0016F6  3               	bne fpslt0
0016F6  3               
0016F6  3               	clc
0016F6  3               	rts 			; out of slots, can't generate anything.
0016F6  3               
0016F6  3               ;----------------------------------------------------
0016F6  3               ; Create an explosion at sprite position.
0016F6  3               ;----------------------------------------------------
0016F6  3               
0016F6  3               explod:
0016F6  3               	sta z80_c 		; particles to create.
0016F6  3               
0016F6  3               	lda z80_i 		; store pointer to sprite.
0016F6  3               	pha
0016F6  3               	lda z80_x
0016F6  3               	pha
0016F6  3               
0016F6  3               	ldy #8
0016F6  3               	lda (z80_ix),y 		; y coordinate.
0016F6  3               	sta z80_l
0016F6  3               	ldy #9
0016F6  3               	lda (z80_ix),y		; x coordinate.
0016F6  3               	sta z80_h
0016F6  3               
0016F6  3               	lda #<SHRAPN		; shrapnel table.
0016F6  3               	sta z80_x
0016F6  3               	lda #>SHRAPN
0016F6  3               	sta z80_i
0016F6  3               
0016F6  3               	lda #NUMSHR		; number of pieces in table.
0016F6  3               	sta explcnt
0016F6  3               expld0:
0016F6  3               	ldy #0
0016F6  3               	lda (z80_ix),y		; get type.
0016F6  3               	asl a 			; is this slot in use?
0016F6  3               	bcs expld1		; no, we can use it.
0016F6  3               expld2:
0016F6  3               	clc
0016F6  3               	lda z80_x
0016F6  3               	adc #SHRSIZ
0016F6  3               	sta z80_x
0016F6  3               	bcc :+
0016F6  3               	inc z80_i
0016F6  3               :
0016F6  3               	dec explcnt		; repeat for all shrapnel.
0016F6  3               	bne expld0
0016F6  3               expld3:
0016F6  3               	pla			; restore sprite pointer.
0016F6  3               	sta z80_x
0016F6  3               	pla
0016F6  3               	sta z80_i
0016F6  3               	rts 			; out of slots, can't generate any more.
0016F6  3               
0016F6  3               expld1:
0016F6  3               	lda z80_c		; shrapnel counter.
0016F6  3               	and #15			; 0 to 15.
0016F6  3               	clc			; add to x.
0016F6  3               	adc z80_l
0016F6  3               	ldy #3
0016F6  3               	sta (z80_ix),y		; y coord.
0016F6  3               
0016F6  3               	lda seed3 		; crap random number.
0016F6  3               	and #15			; 0 to 15.
0016F6  3               	clc 			; add to y.
0016F6  3               	adc z80_h
0016F6  3               	ldy #5
0016F6  3               	sta (z80_ix),y		; x coord.
0016F6  3               
0016F6  3               	lda #2
0016F6  3               	ldy #0
0016F6  3               	sta (z80_ix),y		; switch it on.
0016F6  3               
0016F6  3               	jsr chkxy		; plot first position.
0016F6  3               	jsr qrand		; quick random angle.
0016F6  3               	and #60 		; keep within range.
0016F6  3               	ldy #1
0016F6  3               	sta (z80_ix),y		; angle.
0016F6  3               
0016F6  3               	dec z80_c		; one less piece of shrapnel to generate.
0016F6  3               	bne expld2 		; back to main explosion loop.
0016F6  3               	jmp expld3 		; restore sprite pointer and exit.
0016F6  3               
0016F6  3               ;----------------------------------------------------
0016F6  3               ; Quick random
0016F6  3               ;----------------------------------------------------
0016F6  3               
0016F6  3               qrand:
0016F6  3               	jsr random		; r register.
0016F6  3               	eor seed3		; combine with seed.
0016F6  3               	sta seed3 		; new seed.
0016F6  3               	rts
0016F6  3               
0016F6  3               ;----------------------------------------------------
0016F6  3               ; Display all shrapnel.
0016F6  3               ;----------------------------------------------------
0016F6  3               
0016F6  3               dshrp:
0016F6  3               	lda #<plotde		; display routine.
0016F6  3               	sta proshx+1
0016F6  3               	lda #>plotde
0016F6  3               	sta proshx+2
0016F6  3               	jsr proshr		; process shrapnel.
0016F6  3               
0016F6  3               	lda #<prosh1		; processing routine.
0016F6  3               	sta proshx+1
0016F6  3               	lda #>prosh1
0016F6  3               	sta proshx+2
0016F6  3               	rts
0016F6  3               
0016F6  3               ;------------------------------------------------------
0016F6  3               ; Particle engine.
0016F6  3               ;
0016F6  3               ; Init particle data for 55 particles in SHRAPN table.
0016F6  3               ; Every particle has 6 bytes.
0016F6  3               ;
0016F6  3               ; global:	-
0016F6  3               ; local:	x,y,hl
0016F6  3               ; calls:	-
0016F6  3               ;------------------------------------------------------
0016F6  3               
0016F6  3               inishr:
0016F6  3               	lda #<SHRAPN 		; table.
0016F6  3               	sta z80_l
0016F6  3               	lda #>SHRAPN
0016F6  3               	sta z80_h
0016F6  3               
0016F6  3               	ldy #0
0016F6  3               	ldx #NUMSHR		; shrapnel pieces to process.
0016F6  3               inish0:
0016F6  3               	lda #255 		; kill the shrapnel.
0016F6  3               	sta (z80_hl),y
0016F6  3               
0016F6  3               	clc 			; point there.
0016F6  3               	lda z80_l
0016F6  3               	adc #SHRSIZ		; distance to next.
0016F6  3               	sta z80_l
0016F6  3               	bcc :+
0016F6  3               	inc z80_h
0016F6  3               :
0016F6  3               	dex
0016F6  3               	bne inish0 		; round again.
0016F6  3               	rts
0016F6  3               
0016F6  3               ;------------------------------------------------------
0016F6  3               ; Check for collision between laser and sprite.
0016F6  3               ;------------------------------------------------------
0016F6  3               
0016F6  3               lcol:
0016F6  3               	lda #<SHRAPN		; shrapnel table.
0016F6  3               	sta z80_l
0016F6  3               	lda #>SHRAPN
0016F6  3               	sta z80_h
0016F6  3               
0016F6  3               	lda #NUMSHR		; number of pieces in table.
0016F6  3               	sta z80_b
0016F6  3               lcol0:
0016F6  3               	ldy #0
0016F6  3               	lda (z80_hl),y 		; get type.
0016F6  3               	beq lcol1		; yes, check collision.
0016F6  3               lcol3:
0016F6  3               	clc			; point to more shrapnel.
0016F6  3               	lda z80_l
0016F6  3               	adc #SHRSIZ
0016F6  3               	sta z80_l
0016F6  3               	bcc :+
0016F6  3               	inc z80_h
0016F6  3               :
0016F6  3               	dec z80_b		; repeat for all shrapnel.
0016F6  3               	bne lcol0
0016F6  3               	rts 			; no collision, carry not set.
0016F6  3               lcol1:
0016F6  3               	ldy #3
0016F6  3               	lda (z80_hl),y		; get y.
0016F6  3               	sec
0016F6  3               	ldy #8
0016F6  3               	sbc (z80_ix),y		; subtract sprite y.
0016F6  3               lcolh:
0016F6  3               	cmp #16 		; within range?
0016F6  3               	bcc :+
0016F6  3               	jmp lcol2		; no, missed.
0016F6  3               :
0016F6  3               	ldy #5
0016F6  3               	lda (z80_hl),y 		; get x.
0016F6  3               	sec
0016F6  3               	ldy #9
0016F6  3               	sbc (z80_ix),y 		; subtract sprite y.
0016F6  3               	cmp #16			; within range?
0016F6  3               	bcs :+
0016F6  3               	jmp lcol4 		; yes, collision occurred.
0016F6  3               :
0016F6  3               lcol2:
0016F6  3               	jmp lcol3
0016F6  3               lcol4:
0016F6  3               	sec
0016F6  3               	rts 			; return with carry set for collision.
0016F6  3               .endif
0016F6  3               
0016F6  3               ;------------------------------------------------------
0016F6  3               ; Main game engine code starts here.
0016F6  3               ; After initialisation, mloop is the main loop
0016F6  3               ;------------------------------------------------------
0016F6  3               
0016F6  3               game:
0016F6  3               
0016F6  3               ; Set up screen address table.
0016F6  3               
0016F6  3               setsat:
0016F6  3  A9 00        	lda #<ScreenAddr		; start of screen.
0016F8  3  85 rr        	sta scraddr
0016FA  3  A9 68        	lda #>ScreenAddr
0016FC  3  85 rr        	sta scraddr+1
0016FE  3               
0016FE  3  A0 00        	ldy #0			; vertical lines on screen.
001700  3               setsa0:
001700  3  A5 rr        	lda scraddr
001702  3  99 00 06     	sta SCADTB_lb,y		; write low byte.
001705  3  A5 rr        	lda scraddr+1
001707  3  99 00 07     	sta SCADTB_hb,y		; write high byte.
00170A  3  20 9F 10     	jsr nline		; next line down.
00170D  3  C8           	iny			; next position in table.
00170E  3  D0 F0        	bne setsa0
001710  3               
001710  3               ; Init graphics mode
001710  3               
001710  3  20 2B 0F     	jsr screeninit
001713  3               
001713  3               ; Init AtoMMC joystick
001713  3  20 F6 0E     	jsr joyinit		; AtoMMC joystick on PORT B
001716  3               
001716  3               rpblc2:
001716  3               .if pflag
001716  3               	jsr inishr 		; initialise particle engine.
001716  3               .endif
001716  3               evintr:
001716  3  20 3C 4E     	jsr evnt12 		; call intro/menu event.
001719  3               
001719  3  A9 02        	lda #WALL 		; write default property.
00171B  3  A2 00        	ldx #0
00171D  3               clrmap:
00171D  3  9D 00 03     	sta MAP,x 		; block properties.
001720  3  9D 00 04     	sta MAP+256,x
001723  3  9D 00 05     	sta MAP+512,x
001726  3  E8           	inx			; next byte.
001727  3  D0 F4        	bne clrmap
001729  3               
001729  3  20 24 16     	jsr iniob 		; initialise objects.
00172C  3               
00172C  3  A9 00        	lda #0			; put zero in accumulator.
00172E  3  85 rr        	sta gamwon		; reset game won flag.
001730  3               
001730  3  20 98 18     	jsr inisc 		; init the score.
001733  3               mapst:
001733  3  AD 43 28     	lda stmap 		; start position on map.
001736  3  8D 38 28     	sta roomtb		; set up position in table, if there is one.
001739  3               
001739  3               inipbl:
001739  3  20 F9 24     	jsr initsc 		; set up first screen.
00173C  3               
00173C  3  A9 27        	lda #<ssprit 		; default to spare sprite in table.
00173E  3  85 rr        	sta z80_x
001740  3  A9 28        	lda #>ssprit
001742  3  85 rr        	sta z80_i
001744  3               evini:
001744  3  20 3D 4E     	jsr evnt13 		; initialisation.
001747  3               
001747  3               ; Two restarts.
001747  3               ; First restart - clear all sprites and initialise everything.
001747  3               
001747  3               rstrt:
001747  3  20 38 18     	jsr rsevt 		; restart events.
00174A  3  20 17 16     	jsr xspr 		; clear sprite table.
00174D  3  20 5B 26     	jsr sprlst 		; fetch pointer to screen sprites.
001750  3  20 E4 26     	jsr ispr 		; initialise sprite table.
001753  3               
001753  3  4C 62 17     	jmp rstrt0
001756  3               
001756  3               ; Second restart - clear all but player, and don't initialise him.
001756  3               
001756  3               rstrtn:
001756  3  20 38 18     	jsr rsevt		; restart events.
001759  3  20 88 26     	jsr nspr 		; clear all non-player sprites.
00175C  3  20 5B 26     	jsr sprlst 		; fetch pointer to screen sprites.
00175F  3  20 21 27     	jsr kspr 		; initialise sprite table, no more players.
001762  3               
001762  3               ; Set up the player and/or enemy sprites.
001762  3               
001762  3               rstrt0:
001762  3  A9 00        	lda #0 			; zero in accumulator.
001764  3  85 rr        	sta nexlev 		; reset next level flag.
001766  3  85 rr        	sta restfl 		; reset restart flag.
001768  3  85 rr        	sta deadf 		; reset dead flag.
00176A  3  20 F5 1C     	jsr droom 		; show screen layout.
00176D  3               rpblc0:
00176D  3               .if pflag
00176D  3               	jsr inishr 		; initialise particle engine.
00176D  3               .endif
00176D  3  20 E8 18     	jsr shwob		; draw objects.
001770  3               
001770  3  A9 00        	lda #<sprtab 		; address of sprite table, even sprites.
001772  3  85 rr        	sta z80_x
001774  3  A9 0B        	lda #>sprtab
001776  3  85 rr        	sta z80_i
001778  3               
001778  3  20 C3 22     	jsr dspr 		; display sprites.
00177B  3               
00177B  3  A9 11        	lda #<(sprtab+TABSIZ) 	; address of first odd sprite.
00177D  3  85 rr        	sta z80_x
00177F  3  A9 0B        	lda #>(sprtab+TABSIZ)
001781  3  85 rr        	sta z80_i
001783  3  20 C3 22     	jsr dspr 		; display sprites.
001786  3               
001786  3               mloop:
001786  3  20 C1 0E     	jsr bbcsync
001789  3               
001789  3  20 0E 0F     	jsr vsync 		; synchronise with display.
00178C  3               
00178C  3  A9 00        	lda #<sprtab 		; address of sprite table, even sprites.
00178E  3  85 rr        	sta z80_x
001790  3  A9 0B        	lda #>sprtab
001792  3  85 rr        	sta z80_i
001794  3               
001794  3               DEBUG_PAL PAL_red
001794  3  20 C3 22     	jsr dspr 		; display even sprites.
001797  3               DEBUG_PAL PAL_black
001797  3               
001797  3  20 E7 18     	jsr plsnd 		; play sounds.
00179A  3  20 0E 0F     	jsr vsync 		; synchronise with display.
00179D  3               
00179D  3  A9 11        	lda #<(sprtab+TABSIZ) 	; address of first odd sprite.
00179F  3  85 rr        	sta z80_x
0017A1  3  A9 0B        	lda #>(sprtab+TABSIZ)
0017A3  3  85 rr        	sta z80_i
0017A5  3               
0017A5  3               DEBUG_PAL PAL_red
0017A5  3  20 C3 22     	jsr dspr 		; display odd sprites.
0017A8  3               DEBUG_PAL PAL_black
0017A8  3               
0017A8  3  A9 27        	lda #<(ssprit) 		; point to spare sprite for spawning purposes.
0017AA  3  85 rr        	sta z80_x
0017AC  3  A9 28        	lda #>(ssprit)
0017AE  3  85 rr        	sta z80_i
0017B0  3               evlp1:
0017B0  3               DEBUG_PAL PAL_green
0017B0  3  20 52 4D     	jsr evnt10 		; called once per main loop.
0017B3  3  20 41 22     	jsr pspr 		; process sprites.
0017B6  3               DEBUG_PAL PAL_black
0017B6  3               
0017B6  3               ; Main loop events.
0017B6  3               
0017B6  3  A9 27        	lda #<ssprit 		; point to spare sprite for spawning purposes.
0017B8  3  85 rr        	sta z80_x
0017BA  3  A9 28        	lda #>ssprit
0017BC  3  85 rr        	sta z80_i
0017BE  3               DEBUG_PAL PAL_green
0017BE  3               evlp2:
0017BE  3  20 3B 4E     	jsr evnt11 		; called once per main loop.
0017C1  3               bsortx:
0017C1  3  20 B7 21     	jsr bsort 		; sort sprites.
0017C4  3               DEBUG_PAL PAL_black
0017C4  3               
0017C4  3  A5 rr        	lda nexlev		; finished level flag.
0017C6  3  D0 1F        	bne newlev		; is set, go to next level.
0017C8  3  A5 rr        	lda gamwon		; finished game flag.
0017CA  3  D0 2A        	bne evwon		; is set, finish the game.
0017CC  3  A5 rr        	lda restfl 		; finished level flag.
0017CE  3  C9 01        	cmp #1			; has it been set?
0017D0  3  D0 03        	bne :+
0017D2  3  4C 47 17     	jmp rstrt		; yes, go to next level.
0017D5  3               :
0017D5  3  C9 02        	cmp #2			; has it been set?
0017D7  3  D0 03        	bne :+
0017D9  3  4C 56 17     	jmp rstrtn		; yes, go to next level.
0017DC  3               :
0017DC  3  A5 rr        	lda deadf 		; dead flag.
0017DE  3  D0 1C        	bne pdead		; yes, player dead.
0017E0  3               
0017E0  3               ; back to start of main loop.
0017E0  3               
0017E0  3  E6 rr        	inc frmno
0017E2  3  E6 rr        	inc clock
0017E4  3  4C 86 17     	jmp mloop		; switched to a jmp mloop during test mode.
0017E7  3               
0017E7  3               ;----------------------------------------------------------
0017E7  3               ; New level
0017E7  3               ;----------------------------------------------------------
0017E7  3               
0017E7  3               newlev:
0017E7  3  A5 rr        	lda scno 			; current screen.
0017E9  3  18           	clc
0017EA  3  69 01        	adc #1				; next screen.
0017EC  3  CD BC 62     	cmp numsc			; total number of screens.
0017EF  3  B0 05        	bcs evwon			; yes, game finished.
0017F1  3  85 rr        	sta scno			; set new level number.
0017F3  3  4C 47 17     	jmp rstrt			; restart, clearing all aliens.
0017F6  3               
0017F6  3               evwon:
0017F6  3  20 D6 52     	jsr evnt18		 	; game completed.
0017F9  3  4C 0D 18     	jmp tidyup			; tidy up and return to BASIC/calling routine.
0017FC  3               
0017FC  3               ;----------------------------------------------------------
0017FC  3               ; Player dead.
0017FC  3               ;----------------------------------------------------------
0017FC  3               
0017FC  3               pdead:
0017FC  3  A9 00        	lda #0				; zeroise accumulator.
0017FE  3  85 rr        	sta deadf			; reset dead flag.
001800  3               evdie:
001800  3  20 D4 52     	jsr evnt16 			; death subroutine.
001803  3  A5 rr        	lda numlif			; number of lives.
001805  3  F0 03        	beq :+
001807  3  4C 47 17     	jmp rstrt 			; restart game.
00180A  3               :
00180A  3               evfail:
00180A  3  20 D5 52     	jsr evnt17 			; failure event.
00180D  3               
00180D  3               ;----------------------------------------------------------
00180D  3               ; Tidy things up
00180D  3               ;----------------------------------------------------------
00180D  3               
00180D  3               tidyup:
00180D  3  A0 00        	ldy #0				; digits to check.
00180F  3               tidyu2:
00180F  3  B9 B2 1A     	lda score,y 			; get score digit.
001812  3  CD B8 1A     	cmp hiscor 			; are we larger than high score digit?
001815  3  90 07        	bcc tidyu0			; high score is bigger.
001817  3  D0 0E        	bne tidyu1			; score is greater, record new high score.
001819  3  C8           	iny				; next digit of high score.
00181A  3  C0 06        	cpy #6
00181C  3  D0 F1        	bne tidyu2			; repeat for all digits
00181E  3               tidyu0:
00181E  3  A9 B2        	lda #<score			; return pointing to score.
001820  3  85 rr        	sta z80_c
001822  3  A9 1A        	lda #>score
001824  3  85 rr        	sta z80_b
001826  3  60           	rts
001827  3               tidyu1:
001827  3  A0 05        	ldy #5
001829  3               tidyu3:
001829  3  B9 B2 1A     	lda score,y			; score.
00182C  3  99 B8 1A     	sta hiscor,y			; high score.
00182F  3  88           	dey
001830  3  10 F7        	bpl tidyu3 			; copy score to high score.
001832  3               evnewh:
001832  3  20 D7 52     	jsr evnt19			; new high score event.
001835  3  4C 1E 18     	jmp tidyu0			; tidy up.
001838  3               
001838  3               ;--------------------------------------------------
001838  3               ; Restart event.
001838  3               ;--------------------------------------------------
001838  3               
001838  3               rsevt:
001838  3  A9 27        	lda #<ssprit 			; default to spare element in table.
00183A  3  85 rr        	sta z80_x
00183C  3  A9 28        	lda #>ssprit
00183E  3  85 rr        	sta z80_i
001840  3               evrs:
001840  3  4C 6C 4E     	jmp evnt14	 		; call restart event.
001843  3               
001843  3               ;------------------------------------------------------------------
001843  3               ; Copy number passed in a to string position bc, right-justified.
001843  3               ;
001843  3               ; Input:
001843  3               ;  A  = number
001843  3               ;  BC = string address
001843  3               ;
001843  3               ; Output:
001843  3               ;  BC = string with number
001843  3               ;-----------------------------------------------------------------
001843  3               
001843  3               num2ch:
001843  3  85 rr        	sta z80_d		; Save number
001845  3               
001845  3  A9 00        	lda #0
001847  3  85 rr        	sta flag
001849  3               numdg3:
001849  3  A2 64        	ldx #100		; hundreds column.
00184B  3  86 rr        	stx z80_e
00184D  3  20 5D 18     	jsr numdg		; show digit.
001850  3               numdg2:
001850  3  A2 0A        	ldx #10			; tens column.
001852  3  86 rr        	stx z80_e
001854  3  20 5D 18     	jsr numdg		; show digit.
001857  3               
001857  3  E6 rr        	inc flag
001859  3  A2 01        	ldx #1			; units column.
00185B  3  86 rr        	stx z80_e
00185D  3               numdg:
00185D  3  A9 30        	lda #48			; clear digit.
00185F  3  85 rr        	sta z80_a
001861  3               numdg1:
001861  3  A5 rr        	lda z80_d
001863  3  C5 rr        	cmp z80_e
001865  3  90 0E        	bcc numdg0		; nothing to show.
001867  3  38           	sec
001868  3  A5 rr        	lda z80_d
00186A  3  E5 rr        	sbc z80_e		; subtract from column.
00186C  3  85 rr        	sta z80_d
00186E  3  E6 rr        	inc z80_a		; increment digit.
001870  3  E6 rr        	inc flag
001872  3  4C 61 18     	jmp numdg1		; repeat until column is zero.
001875  3               numdg0:
001875  3  A0 00        	ldy #0
001877  3  A5 rr        	lda z80_a
001879  3  91 rr        	sta (z80_bc),y		; write digit to buffer.
00187B  3  A5 rr        	lda flag
00187D  3  F0 06        	beq :+
00187F  3  E6 rr        	inc z80_c		; next buffer position.
001881  3  D0 02        	bne :+
001883  3  E6 rr        	inc z80_b
001885  3               :
001885  3  60           	rts
001886  3               num2dd:
001886  3  85 rr        	sta z80_d		; Save number
001888  3               
001888  3  A9 01        	lda #1
00188A  3  85 rr        	sta flag
00188C  3               
00188C  3  4C 50 18     	jmp numdg2
00188F  3               num2td:
00188F  3  85 rr        	sta z80_d		; Save number
001891  3               
001891  3  A9 01        	lda #1
001893  3  85 rr        	sta flag
001895  3  4C 49 18     	jmp numdg3
001898  3               
001898  3               ;---------------------------------------------------------
001898  3               ; Reset score to "000000"
001898  3               ;---------------------------------------------------------
001898  3               
001898  3               inisc:
001898  3  A9 30        	lda #'0'
00189A  3  A2 05        	ldx #5			; digits to initialise.
00189C  3               inisc0:
00189C  3  9D B2 1A     	sta score,x 		; write zero digit.
00189F  3  CA           	dex			; next column.
0018A0  3  10 FA        	bpl inisc0		; repeat for all digits.
0018A2  3               
0018A2  3  60           	rts
0018A3  3               
0018A3  3               ;-----------------------------------------------------
0018A3  3               ; Multiply h by d and return in hl.
0018A3  3               ;
0018A3  3               ; Input:
0018A3  3               ;  H = first number
0018A3  3               ;  D = second number
0018A3  3               ;
0018A3  3               ; Output:
0018A3  3               ;  HL = result H x D
0018A3  3               ;-----------------------------------------------------
0018A3  3               
0018A3  3               imul:
0018A3  3  A5 rr        	lda z80_d		; HL = H * D
0018A5  3  85 rr        	sta z80_e
0018A7  3  A5 rr        	lda z80_h
0018A9  3  85 rr        	sta z80_c		; make c first multiplier.
0018AB  3               imul0:
0018AB  3  A9 00        	lda #0			; zeroise total.
0018AD  3  85 rr        	sta z80_l
0018AF  3  85 rr        	sta z80_h
0018B1  3               
0018B1  3  A5 rr        	lda z80_h
0018B3  3  85 rr        	sta z80_d		; zeroise high byte.
0018B5  3               
0018B5  3  A9 08        	lda #8			; repeat 8 times.
0018B7  3  85 rr        	sta z80_b
0018B9  3               imul1:
0018B9  3  46 rr        	lsr z80_c		; rotate rightmost bit into carry.
0018BB  3  90 0E        	bcc imul2		; wasn't set.
0018BD  3  18           	clc			; bit was set, so add de.
0018BE  3  A5 rr        	lda z80_l
0018C0  3  65 rr        	adc z80_e
0018C2  3  85 rr        	sta z80_l
0018C4  3  A5 rr        	lda z80_h
0018C6  3  65 rr        	adc z80_d
0018C8  3  85 rr        	sta z80_h
0018CA  3  18           	clc 			; reset carry.
0018CB  3               imul2:
0018CB  3  06 rr        	asl z80_e 		; shift de 1 bit left.
0018CD  3  26 rr        	rol z80_d
0018CF  3  C6 rr        	dec z80_b
0018D1  3  D0 E6        	bne imul1		; repeat 8 times.
0018D3  3               
0018D3  3  60           	rts
0018D4  3               
0018D4  3               ;-----------------------------------------------
0018D4  3               ; Divide d by e and return in d, remainder in a.
0018D4  3               ;
0018D4  3               ; Input:
0018D4  3               ;  D = first number
0018D4  3               ;  E = second number
0018D4  3               ;
0018D4  3               ; Output:
0018D4  3               ;  D = result D/E
0018D4  3               ;  A = remainder
0018D4  3               ;-----------------------------------------------
0018D4  3               
0018D4  3               idiv:
0018D4  3  A9 00        	lda #0
0018D6  3  A0 08        	ldy #8		 	; bits to shift.
0018D8  3  06 rr        	asl z80_d
0018DA  3               idiv0:
0018DA  3  2A           	rol a 			; multiply d by 2.
0018DB  3  C5 rr        	cmp z80_e 		; test if e is smaller.
0018DD  3  90 02        	bcc idiv1		; e is greater, no division this time.
0018DF  3  E5 rr        	sbc z80_e		; subtract it.
0018E1  3               idiv1:
0018E1  3  26 rr        	rol z80_d		; rotate into d.
0018E3  3  88           	dey
0018E4  3  D0 F4        	bne idiv0		; repeat
0018E6  3  60           	rts
0018E7  3               
0018E7  3               ;---------------------------------------------------
0018E7  3               ; Play AY sound effect
0018E7  3               ;---------------------------------------------------
0018E7  3               
0018E7  3               plsnd:
0018E7  3  60           	rts
0018E8  3               
0018E8  3               ;---------------------------------------------------
0018E8  3               ; Objects handling.
0018E8  3               ; 32 bytes for image
0018E8  3               ; 3 for room, y and x
0018E8  3               ; 3 for starting room, y and x.
0018E8  3               ; 254 = disabled.
0018E8  3               ; 255 = object in player"s pockets.
0018E8  3               ;---------------------------------------------------
0018E8  3               
0018E8  3               ;---------------------------------------------------
0018E8  3               ; Show items present.
0018E8  3               ;---------------------------------------------------
0018E8  3               
0018E8  3               shwob:
0018E8  3  A9 20        	lda #<objdta 			; objects table.
0018EA  3  85 rr        	sta z80_l
0018EC  3  A9 63        	lda #>objdta
0018EE  3  85 rr        	sta z80_h
0018F0  3               
0018F0  3  AD 10 16     	lda numob 			; number of objects in the game.
0018F3  3  85 rr        	sta sprcnt
0018F5  3               shwob0:
0018F5  3  A0 20        	ldy #32 			; distance to room number.
0018F7  3  B1 rr        	lda (z80_hl),y 			; same as an item?
0018F9  3  C5 rr        	cmp scno 			; current location.
0018FB  3  D0 03        	bne :+
0018FD  3  20 12 19     	jsr dobj 			; yes, display object.
001900  3               :
001900  3  18           	clc
001901  3  A5 rr        	lda z80_l
001903  3  69 26        	adc #38 			; distance to next item.
001905  3  85 rr        	sta z80_l
001907  3  A5 rr        	lda z80_h
001909  3  69 00        	adc #0
00190B  3  85 rr        	sta z80_h	 		; point to it.
00190D  3  C6 rr        	dec sprcnt
00190F  3  D0 E4        	bne shwob0 			; repeat for others.
001911  3  60           	rts
001912  3               
001912  3               ;---------------------------------------------------
001912  3               ; Display object.
001912  3               ; hl must point to object's start address.
001912  3               ;
001912  3               ; Input:
001912  3               ;  HL = object address
001912  3               ;---------------------------------------------------
001912  3               
001912  3               dobj:
001912  3  A0 21        	ldy #33
001914  3  B1 rr        	lda (z80_hl),y 			; point to y.
001916  3  85 rr        	sta dispy
001918  3  C8           	iny
001919  3  B1 rr        	lda (z80_hl),y 			; point to x.
00191B  3  85 rr        	sta dispx
00191D  3               dobj1:
00191D  3  4C 6B 0F     	jmp sprite 			; draw this sprite.
001920  3               
001920  3               ;--------------------------------------
001920  3               ; Remove an object.
001920  3               ;
001920  3               ; Input:
001920  3               ;  A = object number
001920  3               ;--------------------------------------
001920  3               
001920  3               remob:
001920  3  CD 10 16     	cmp numob			; number of objects in game.
001923  3  90 01        	bcc :+				; are we checking past the end?
001925  3  60           	rts				; yes, can't get non-existent item.
001926  3               :
001926  3  48           	pha				; remember object.
001927  3  20 35 19     	jsr getob			; pick it up if we haven't already got it.
00192A  3  68           	pla				; retrieve object number.
00192B  3  20 64 19     	jsr gotob			; get its address.
00192E  3  A9 FE        	lda #254
001930  3  A0 20        	ldy #32
001932  3  91 rr        	sta (z80_hl),y			; remove it.
001934  3  60           	rts
001935  3               
001935  3               ;---------------------------------------------------
001935  3               ; Pick up object number held in the accumulator.
001935  3               ;
001935  3               ; Input:
001935  3               ;  A = object number
001935  3               ;---------------------------------------------------
001935  3               
001935  3               getob:
001935  3  CD 10 16     	cmp numob 		; number of objects in game.
001938  3  90 01        	bcc :+			; are we checking past the end?
00193A  3  60           	rts			; yes, can't get non-existent item.
00193B  3               :
00193B  3  20 64 19     	jsr gotob 		; check if we already have it.
00193E  3  C9 FF        	cmp #255
001940  3  D0 01        	bne :+
001942  3  60           	rts			; we already do.
001943  3               :
001943  3  A0 20        	ldy #32
001945  3  B1 rr        	lda (z80_hl),y		; is it on this screen?
001947  3  C5 rr        	cmp scno 		; current screen.
001949  3  D0 14        	bne getob0		; not on screen, so nothing to delete.
00194B  3               
00194B  3  A9 FF        	lda #255
00194D  3  91 rr        	sta (z80_hl),y		; pick it up.
00194F  3  C8           	iny 			; point to y coord.
001950  3               getob1:
001950  3  A0 21        	ldy #33
001952  3  B1 rr        	lda (z80_hl),y		; y coord.
001954  3  85 rr        	sta dispy
001956  3  A0 22        	ldy #34
001958  3  B1 rr        	lda (z80_hl),y 		; x coord.
00195A  3  85 rr        	sta dispx
00195C  3  4C 1D 19     	jmp dobj1 		; delete object sprite.
00195F  3               getob0:
00195F  3  A9 FF        	lda #255
001961  3  91 rr        	sta (z80_hl),y 		; pick it up.
001963  3  60           	rts
001964  3               
001964  3               ;-----------------------------------------------------------------
001964  3               ; Got object check.
001964  3               ; Call with object in accumulator, returns zero set if in pockets.
001964  3               ;
001964  3               ; Input:
001964  3               ;  A = object number
001964  3               ;-----------------------------------------------------------------
001964  3               
001964  3               gotob:
001964  3  CD 10 16     	cmp numob 		; number of objects in game.
001967  3  90 03        	bcc :+ 			; are we checking past the end?
001969  3  4C 70 19     	jmp gotob0 		; yes, we can't have a non-existent object.
00196C  3               :
00196C  3  20 75 19     	jsr findob		; find the object.
00196F  3               gotob1:
00196F  3  60           	rts
001970  3               
001970  3               gotob0:
001970  3  A9 FE        	lda #254 		; missing.
001972  3  4C 6F 19     	jmp gotob1
001975  3               
001975  3               findob:
001975  3  48           	pha			; save object number
001976  3  A9 20        	lda #<objdta 		; objects.
001978  3  85 rr        	sta z80_l
00197A  3  A9 63        	lda #>objdta
00197C  3  85 rr        	sta z80_h
00197E  3  68           	pla			; retreive object number
00197F  3  F0 0F        	beq fndob1 		; is it zero? yes, skip loop.
001981  3  AA           	tax 			; loop counter
001982  3               fndob2:
001982  3  18           	clc
001983  3  A5 rr        	lda z80_l
001985  3  69 26        	adc #38 		; size of each object.
001987  3  85 rr        	sta z80_l
001989  3  90 02        	bcc :+
00198B  3  E6 rr        	inc z80_h
00198D  3               :
00198D  3  CA           	dex 			; repeat until we find address.
00198E  3  D0 F2        	bne fndob2
001990  3               fndob1:
001990  3  A0 20        	ldy #32			; distance to room it's in.
001992  3  B1 rr        	lda (z80_hl),y		; fetch status.
001994  3  60           	rts
001995  3               
001995  3               ;---------------------------------------------
001995  3               ; Drop object number at (dispx, dispy).
001995  3               ;
001995  3               ; Input:
001995  3               ;  A = object number
001995  3               ;---------------------------------------------
001995  3               
001995  3               drpob:
001995  3  CD 10 16     	cmp numob 		; are we checking past the end?
001998  3  90 01        	bcc :+
00199A  3  60           	rts			; yes, can't drop non-existent item.
00199B  3               :
00199B  3  20 64 19     	jsr gotob		; make sure object is in inventory.
00199E  3  C5 rr        	cmp scno		; already on this screen?
0019A0  3  D0 01        	bne :+
0019A2  3  60           	rts			; yes, nothing to do.
0019A3  3               :
0019A3  3  A0 20        	ldy #32
0019A5  3  A5 rr        	lda scno
0019A7  3  91 rr        	sta (z80_hl),y		; bring onto screen.
0019A9  3  A5 rr        	lda dispy		; sprite y coordinate.
0019AB  3  C8           	iny
0019AC  3  91 rr        	sta (z80_hl),y		; point to object y.
0019AE  3  A5 rr        	lda dispx 		; sprite x coordinate.
0019B0  3  C8           	iny
0019B1  3  91 rr        	sta (z80_hl),y 		; point to object x
0019B3  3  4C 12 19     	jmp dobj		; draw the object sprite.
0019B6  3               
0019B6  3               ;-----------------------------------------------
0019B6  3               ; Seek objects at sprite position.
0019B6  3               ;
0019B6  3               ; Output:
0019B6  3               ;  A = object number, if not found A=255
0019B6  3               ;-----------------------------------------------
0019B6  3               
0019B6  3               skobj:
0019B6  3  A9 20        	lda #<objdta 		; pointer to objects.
0019B8  3  85 rr        	sta z80_l
0019BA  3  A9 63        	lda #>objdta
0019BC  3  85 rr        	sta z80_h
0019BE  3               
0019BE  3  AD 10 16     	lda numob 		; number of objects in game.
0019C1  3  85 rr        	sta z80_b 		; set up the loop counter.
0019C3  3               skobj0:
0019C3  3  A5 rr        	lda scno		; current room number.
0019C5  3  A0 20        	ldy #32
0019C7  3  D1 rr        	cmp (z80_hl),y		; is object in here?
0019C9  3  D0 03        	bne :+
0019CB  3  20 E0 19     	jsr skobj1		; yes, check coordinates.
0019CE  3               :
0019CE  3  18           	clc			; point to next object in table.
0019CF  3  A5 rr        	lda z80_l
0019D1  3  69 26        	adc #38			; size of each object.
0019D3  3  85 rr        	sta z80_l
0019D5  3  90 02        	bcc :+
0019D7  3  E6 rr        	inc z80_h
0019D9  3               :
0019D9  3  C6 rr        	dec z80_b
0019DB  3  D0 E6        	bne skobj0		; repeat for all objects.
0019DD  3               
0019DD  3  A9 FF        	lda #255		; end of list and nothing found, return 255.
0019DF  3  60           	rts
0019E0  3               
0019E0  3               skobj1:
0019E0  3  A0 21        	ldy #33			; point to y coordinate.
0019E2  3  B1 rr        	lda (z80_hl),y		; point to y coordinate.
0019E4  3  38           	sec
0019E5  3  A0 08        	ldy #var_newY
0019E7  3  F1 rr        	sbc (z80_ix),y 		; subtract sprite y.
0019E9  3  18           	clc
0019EA  3  69 0F        	adc #15			; add sprite height minus one.
0019EC  3  C9 1F        	cmp #31			; within range?
0019EE  3  90 03        	bcc :+
0019F0  3  4C 0E 1A     	jmp skobj2		; no, ignore object.
0019F3  3               :
0019F3  3  A0 22        	ldy #34			; point to x coordinate now.
0019F5  3  B1 rr        	lda (z80_hl),y 		; get coordinate.
0019F7  3  38           	sec
0019F8  3  A0 09        	ldy #var_newX
0019FA  3  F1 rr        	sbc (z80_ix),y 		; subtract the sprite x.
0019FC  3  18           	clc			; add sprite width minus one.
0019FD  3  69 0F        	adc #15
0019FF  3  C9 1F        	cmp #31			; within range?
001A01  3  90 03        	bcc :+
001A03  3  4C 0E 1A     	jmp skobj2		; no, ignore object.
001A06  3               :
001A06  3  68           	pla			; remove return address from stack.
001A07  3  68           	pla
001A08  3               
001A08  3  AD 10 16     	lda numob 		; objects in game.
001A0B  3  38           	sec
001A0C  3  E5 rr        	sbc z80_b		; subtract loop counter.
001A0E  3               skobj2:
001A0E  3  60           	rts			; accumulator now points to object.
001A0F  3               
001A0F  3               
001A0F  3               ;---------------------------------------------------------------------
001A0F  3               ; Spawn a new sprite.
001A0F  3               ;---------------------------------------------------------------------
001A0F  3               
001A0F  3               spawn:
001A0F  3  A9 00        	lda #<sprtab		; sprite table.
001A11  3  85 rr        	sta z80_l
001A13  3  A9 0B        	lda #>sprtab
001A15  3  85 rr        	sta z80_h
001A17  3               numsp1:
001A17  3  A9 0C        	lda #NUMSPR		; number of sprites.
001A19  3  85 rr        	sta spcnt
001A1B  3               spaw0:
001A1B  3  A0 00        	ldy #var_Type
001A1D  3  B1 rr        	lda (z80_hl),y		; get sprite type.
001A1F  3  C9 FF        	cmp #255		; is it an unused slot?
001A21  3  F0 0F        	beq spaw1 		; yes, we can use this one.
001A23  3               
001A23  3  18           	clc 			; point to next sprite in table.
001A24  3  A5 rr        	lda z80_l
001A26  3  69 11        	adc #TABSIZ		; size of each entry.
001A28  3  85 rr        	sta z80_l
001A2A  3  90 02        	bcc :+
001A2C  3  E6 rr        	inc z80_h
001A2E  3               :
001A2E  3  C6 rr        	dec spcnt		; one less iteration.
001A30  3  D0 E9        	bne spaw0		; keep going until we find a slot.
001A32  3               
001A32  3               ; Didn't find one but drop through and set up a dummy sprite instead.
001A32  3               
001A32  3               spaw1:
001A32  3  A5 rr        	lda z80_i		; address of original sprite.
001A34  3  48           	pha
001A35  3  A5 rr        	lda z80_x
001A37  3  48           	pha
001A38  3               
001A38  3  A5 rr        	lda z80_l		; store spawned sprite address.
001A3A  3  85 rr        	sta spptr
001A3C  3  A5 rr        	lda z80_h
001A3E  3  85 rr        	sta spptr+1
001A40  3               
001A40  3  A5 rr        	lda z80_c
001A42  3  A0 00        	ldy #var_Type
001A44  3  91 rr        	sta (z80_hl),y 		; set the type.
001A46  3  A0 05        	ldy #var_newType
001A48  3  91 rr        	sta (z80_hl),y		; copy
001A4A  3               
001A4A  3  A5 rr        	lda z80_b
001A4C  3  A0 01        	ldy #var_Image
001A4E  3  91 rr        	sta (z80_hl),y		; set the image.
001A50  3  A0 06        	ldy #var_newImage
001A52  3  91 rr        	sta (z80_hl),y		; copy
001A54  3               
001A54  3  A9 00        	lda #0 				; frame zero.
001A56  3  A0 02        	ldy #var_Frame
001A58  3  91 rr        	sta (z80_hl),y		; set frame.
001A5A  3  A0 07        	ldy #var_newFrame
001A5C  3  91 rr        	sta (z80_hl),y		; copy
001A5E  3               
001A5E  3  A0 09        	ldy #9
001A60  3  B1 rr        	lda (z80_ix),y 		; x coordinate.
001A62  3  A0 04        	ldy #var_X
001A64  3  91 rr        	sta (z80_hl),y		; set sprite coordinate.
001A66  3  A0 09        	ldy #var_newX
001A68  3  91 rr        	sta (z80_hl),y		; copy
001A6A  3               
001A6A  3  A0 08        	ldy #8
001A6C  3  B1 rr        	lda (z80_ix),y 		; y coordinate.
001A6E  3  A0 03        	ldy #var_Y
001A70  3  91 rr        	sta (z80_hl),y		; set sprite coordinate.
001A72  3  A0 08        	ldy #var_newY
001A74  3  91 rr        	sta (z80_hl),y		; copy
001A76  3               
001A76  3  A0 0A        	ldy #10				; direction of original.
001A78  3  B1 rr        	lda (z80_ix),y
001A7A  3  A0 0A        	ldy #var_Direction
001A7C  3  91 rr        	sta (z80_hl),y		; direction
001A7E  3               
001A7E  3  A9 00        	lda #0
001A80  3  A0 0D        	ldy #var_jumpLo
001A82  3  91 rr        	sta (z80_hl),y		; reset parameter.
001A84  3  C8           	iny
001A85  3  91 rr        	sta (z80_hl),y		; reset parameter.
001A87  3  C8           	iny
001A88  3  91 rr        	sta (z80_hl),y		; reset parameter.
001A8A  3  C8           	iny
001A8B  3  91 rr        	sta (z80_hl),y		; reset parameter.
001A8D  3               rtssp:
001A8D  3  A5 rr        	lda spptr			; address of new sprite.
001A8F  3  85 rr        	sta z80_x
001A91  3  A5 rr        	lda spptr+1
001A93  3  85 rr        	sta z80_i
001A95  3               evis1:
001A95  3  20 90 4C     	jsr evnt09 			; call sprite initialisation event.
001A98  3               
001A98  3  A5 rr        	lda spptr 			; address of new sprite.
001A9A  3  85 rr        	sta z80_x
001A9C  3  A5 rr        	lda spptr+1
001A9E  3  85 rr        	sta z80_i
001AA0  3               
001AA0  3               	; _BEEB clipping code copied from CPC Engine - MISSING?!
001AA0  3  A0 03        	ldy #var_Y
001AA2  3  B1 rr        	lda (z80_hl), y		; old x coord
001AA4  3  C9 B1        	cmp #SpriteMaxY     ; beyond maximum?
001AA6  3  B0 03        	bcs :+				; yes, don't draw it.
001AA8  3               
001AA8  3  20 D1 0F     	jsr sspria 			; display the new sprite.
001AAB  3               :
001AAB  3  68           	pla					; address of original sprite.
001AAC  3  85 rr        	sta z80_x
001AAE  3  68           	pla
001AAF  3  85 rr        	sta z80_i
001AB1  3               
001AB1  3  60           	rts
001AB2  3               
001AB2  3  30 30 30 30  score:	.byte "000000"		; player"s score.
001AB6  3  30 30        
001AB8  3  30 30 30 30  hiscor:	.byte "000000"		; high score.
001ABC  3  30 30        
001ABE  3  30 30 30 30  bonus:	.byte "000000"		; bonus.
001AC2  3  30 30        
001AC4  3  00 68        grbase:	.word ScreenAddr	; graphics base address.
001AC6  3               
001AC6  3               ;----------------------------------------------------
001AC6  3               ; Check y-pos
001AC6  3               ;----------------------------------------------------
001AC6  3               
001AC6  3               checkx:
001AC6  3  A5 rr        	lda dispy		; y position.
001AC8  3  C9 18        	cmp #24			; off screen?
001ACA  3  B0 01        	bcs :+
001ACC  3  60           	rts			; no, it's okay.
001ACD  3               :
001ACD  3  68           	pla			; remove return address from stack.
001ACE  3  85 rr        	sta z80_l
001AD0  3  68           	pla
001AD1  3  85 rr        	sta z80_h
001AD3  3  60           	rts
001AD4  3               
001AD4  3               ;-----------------------------------------------
001AD4  3               ; Displays the current high score.
001AD4  3               ;-----------------------------------------------
001AD4  3               
001AD4  3               dhisc:
001AD4  3  A9 B8        	lda #<hiscor 		; high score text.
001AD6  3  85 rr        	sta z80_l
001AD8  3  A9 1A        	lda #>hiscor
001ADA  3  85 rr        	sta z80_h
001ADC  3  4C E7 1A     	jmp dscor1		; check in printable range then show 6 digits.
001ADF  3               
001ADF  3               ;------------------------------------------------------
001ADF  3               ; Displays the current score.
001ADF  3               ;------------------------------------------------------
001ADF  3               
001ADF  3               dscor:
001ADF  3  A9 B2        	lda #<score		; score text.
001AE1  3  85 rr        	sta z80_l
001AE3  3  A9 1A        	lda #>score
001AE5  3  85 rr        	sta z80_h
001AE7  3               dscor1:
001AE7  3  20 8B 21     	jsr preprt		; set up font and print position.
001AEA  3  20 C6 1A     	jsr checkx		; make sure we're in a printable range.
001AED  3               
001AED  3  A9 06        	lda #6			; digits to display.
001AEF  3  85 rr        	sta z80_b
001AF1  3  A5 rr        	lda prtmod		; get print mode.
001AF3  3  F0 03        	beq :+			; standard size text?
001AF5  3  4C 14 1B     	jmp bscor0		; no, show double-height.
001AF8  3               :
001AF8  3               dscor0:
001AF8  3  A0 00        	ldy #0
001AFA  3  B1 rr        	lda (z80_hl),y 		; fetch character.
001AFC  3  20 52 11     	jsr pchar 		; display character.
001AFF  3  E6 rr        	inc dispx		; move along x coordinate
001B01  3               
001B01  3  E6 rr        	inc z80_l		; next score column.
001B03  3  D0 02        	bne :+
001B05  3  E6 rr        	inc z80_h
001B07  3               :
001B07  3  C6 rr        	dec z80_b
001B09  3  D0 ED        	bne dscor0 		; repeat for all digits.
001B0B  3               dscor2:
001B0B  3  A5 rr        	lda dispx 		; set up display coordinates.
001B0D  3  85 rr        	sta charx
001B0F  3  A5 rr        	lda dispy
001B11  3  85 rr        	sta chary
001B13  3  60           	rts
001B14  3               
001B14  3               ;------------------------------------------------------
001B14  3               ; Displays the current score in double-height characters.
001B14  3               ;
001B14  3               ; Input:
001B14  3               ;  B  = digit number
001B14  3               ;  HL = score string
001B14  3               ;------------------------------------------------------
001B14  3               
001B14  3               bscor0:
001B14  3  A0 00        	ldy #0
001B16  3               
001B16  3  B1 rr        	lda (z80_hl),y 		; fetch character.
001B18  3  20 0E 21     	jsr bchar 		; display big char.
001B1B  3               
001B1B  3  E6 rr        	inc z80_l 		; next score column.
001B1D  3  D0 02        	bne :+
001B1F  3  E6 rr        	inc z80_h
001B21  3               :
001B21  3  C6 rr        	dec z80_b
001B23  3  F0 03        	beq :+
001B25  3  4C 14 1B     	jmp bscor0 		; repeat for all digits.
001B28  3               :
001B28  3  4C 0B 1B     	jmp dscor2 		; tidy up line and column variables.
001B2B  3               
001B2B  3               ;-----------------------------------------------------
001B2B  3               ; Adds number in the hl pair to the score.
001B2B  3               ;-----------------------------------------------------
001B2B  3               
001B2B  3               addsc:
001B2B  3  A9 B3        	lda #<(score+1) 	; ten thousands column.
001B2D  3  85 rr        	sta z80_e
001B2F  3  A9 1A        	lda #>(score+1)
001B31  3  85 rr        	sta z80_d
001B33  3  A9 10        	lda #<10000		; amount to add each time.
001B35  3  85 rr        	sta z80_c
001B37  3  A9 27        	lda #>10000
001B39  3  85 rr        	sta z80_b
001B3B  3  20 7F 1B     	jsr incsc		; add to score.
001B3E  3               
001B3E  3  E6 rr        	inc z80_e		; thousands column.
001B40  3  D0 02        	bne :+
001B42  3  E6 rr        	inc z80_d
001B44  3               :
001B44  3  A9 E8        	lda #<1000		; amount to add each time.
001B46  3  85 rr        	sta z80_c
001B48  3  A9 03        	lda #>1000
001B4A  3  85 rr        	sta z80_b
001B4C  3  20 7F 1B     	jsr incsc 		; add to score.
001B4F  3               
001B4F  3  E6 rr        	inc z80_e		; hundreds column.
001B51  3  D0 02        	bne :+
001B53  3  E6 rr        	inc z80_d
001B55  3               :
001B55  3  A9 64        	lda #<100		; amount to add each time.
001B57  3  85 rr        	sta z80_c
001B59  3  A9 00        	lda #>100
001B5B  3  85 rr        	sta z80_b
001B5D  3  20 7F 1B     	jsr incsc		; add to score.
001B60  3               
001B60  3  E6 rr        	inc z80_e 		; tens column.
001B62  3  D0 02        	bne :+
001B64  3  E6 rr        	inc z80_d
001B66  3               :
001B66  3  A9 0A        	lda #<10		; amount to add each time.
001B68  3  85 rr        	sta z80_c
001B6A  3  A9 00        	lda #>10
001B6C  3  85 rr        	sta z80_b
001B6E  3  20 7F 1B     	jsr incsc 		; add to score.
001B71  3               
001B71  3  E6 rr        	inc z80_e		; units column.
001B73  3  D0 02        	bne :+
001B75  3  E6 rr        	inc z80_d
001B77  3               :
001B77  3  A9 01        	lda #<1			; units.
001B79  3  85 rr        	sta z80_c
001B7B  3  A9 00        	lda #>1
001B7D  3  85 rr        	sta z80_b
001B7F  3               incsc:
001B7F  3  A5 rr        	lda z80_h		; store amount to add.
001B81  3  48           	pha
001B82  3  A5 rr        	lda z80_l
001B84  3  48           	pha
001B85  3               
001B85  3  38           	sec			; subtract from amount to add.
001B86  3  A5 rr        	lda z80_l
001B88  3  E5 rr        	sbc z80_c
001B8A  3  85 rr        	sta z80_l
001B8C  3  A5 rr        	lda z80_h
001B8E  3  E5 rr        	sbc z80_b
001B90  3  85 rr        	sta z80_h
001B92  3  90 14        	bcc incsc0		; too much, restore value.
001B94  3               
001B94  3  68           	pla			; delete the previous amount from the stack.
001B95  3  68           	pla
001B96  3               
001B96  3  A5 rr        	lda z80_d 		; store column position.
001B98  3  48           	pha
001B99  3  A5 rr        	lda z80_e
001B9B  3  48           	pha
001B9C  3  20 AF 1B     	jsr incsc2		; do the increment.
001B9F  3               
001B9F  3  68           	pla			; restore column.
001BA0  3  85 rr        	sta z80_e
001BA2  3  68           	pla
001BA3  3  85 rr        	sta z80_d
001BA5  3  4C 7F 1B     	jmp incsc		; repeat until all added.
001BA8  3               
001BA8  3               incsc0:
001BA8  3  68           	pla			; restore previous value.
001BA9  3  85 rr        	sta z80_l
001BAB  3  68           	pla
001BAC  3  85 rr        	sta z80_h
001BAE  3  60           	rts
001BAF  3               incsc2:
001BAF  3  A0 00        	ldy #0
001BB1  3  B1 rr        	lda (z80_de),y 		; get amount.
001BB3  3  18           	clc
001BB4  3  69 01        	adc #1			; add one to column.
001BB6  3  91 rr        	sta (z80_de),y		; write new column total.
001BB8  3  C9 3A        	cmp #'9'+1		; gone beyond range of digits?
001BBA  3  B0 01        	bcs :+
001BBC  3  60           	rts			; no, carry on.
001BBD  3               :
001BBD  3  A9 30        	lda #'0'		; make it zero.
001BBF  3  91 rr        	sta (z80_de),y		; write new column total.
001BC1  3  C6 rr        	dec z80_e		; back one column.
001BC3  3  D0 02        	bne :+
001BC5  3  C6 rr        	dec z80_d
001BC7  3               :
001BC7  3  4C AF 1B     	jmp incsc2
001BCA  3               
001BCA  3               ;------------------------------------
001BCA  3               ; Add bonus to score and reset bonus
001BCA  3               ;------------------------------------
001BCA  3               
001BCA  3               addbo:
001BCA  3  A2 05        	ldx #5			; last digit.
001BCC  3  18           	clc			; clear carry.
001BCD  3               addbo0:
001BCD  3  BD B2 1A     	lda score,x		; get score.
001BD0  3  7D BE 1A     	adc bonus,x		; add bonus.
001BD3  3  38           	sec			; 0 to 18.
001BD4  3  E9 30        	sbc #48
001BD6  3  48           	pha
001BD7  3  A9 30        	lda #'0'
001BD9  3  9D BE 1A     	sta bonus,x		; zeroise bonus.
001BDC  3  68           	pla
001BDD  3  C9 3A        	cmp #58			; carried?
001BDF  3  B0 07        	bcs addbo2		; no, do next one.
001BE1  3  38           	sec
001BE2  3  E9 0A        	sbc #10			; subtract 10.
001BE4  3  38           	sec
001BE5  3  4C E9 1B     	jmp addbo1
001BE8  3               addbo2:
001BE8  3  18           	clc
001BE9  3               addbo1:
001BE9  3  9D B2 1A     	sta score,x		; write new score.
001BEC  3  CA           	dex			; next digit.
001BED  3  10 DE        	bpl addbo0		; repeat for all 6 digits.
001BEF  3  60           	rts
001BF0  3               
001BF0  3               ;------------------------------------
001BF0  3               ; Swap score and bonus.
001BF0  3               ;------------------------------------
001BF0  3               
001BF0  3               swpsb:
001BF0  3  A2 05        	ldx #5			; digits to add.
001BF2  3               swpsb0:
001BF2  3  BD B2 1A     	lda score,x 		; get score digits.
001BF5  3  48           	pha			; save digit
001BF6  3  BD BE 1A     	lda bonus,x 		; get bonus digits.
001BF9  3  9D B2 1A     	sta score,x		; switch score-bonus
001BFC  3  68           	pla
001BFD  3  9D BE 1A     	sta bonus,x
001C00  3  CA           	dex 			; repeat for all 6 digits.
001C01  3  10 EF        	bpl swpsb0
001C03  3  60           	rts
001C04  3               
001C04  3               ;----------------------------------------------------
001C04  3               ; Get print address.
001C04  3               ;----------------------------------------------------
001C04  3               
001C04  3               gprad:
001C04  3  98           	tya
001C05  3  48           	pha
001C06  3               
001C06  3  A5 rr        	lda dispx 		; x coordinate.
001C08  3  85 rr        	sta scraddr
001C0A  3  A9 00        	lda #0
001C0C  3  85 rr        	sta scraddr+1
001C0E  3  06 rr        	asl scraddr  	; multiply char by 8
001C10  3  26 rr        	rol scraddr+1
001C12  3  06 rr        	asl scraddr
001C14  3  26 rr        	rol scraddr+1
001C16  3  06 rr        	asl scraddr
001C18  3  26 rr        	rol scraddr+1
001C1A  3               
001C1A  3  A5 rr        	lda dispy		; y coordinate.
001C1C  3  0A           	asl a
001C1D  3  0A           	asl a
001C1E  3  0A           	asl a			; multiply char by 8
001C1F  3  A8           	tay
001C20  3               
001C20  3  18           	clc
001C21  3  A5 rr        	lda scraddr
001C23  3  79 00 06     	adc SCADTB_lb,y
001C26  3  85 rr        	sta scraddr
001C28  3  A5 rr        	lda scraddr+1
001C2A  3  79 00 07     	adc SCADTB_hb,y
001C2D  3  85 rr        	sta scraddr+1
001C2F  3               
001C2F  3  68           	pla
001C30  3  A8           	tay
001C31  3  60           	rts
001C32  3               
001C32  3               ;--------------------------------------------------------------
001C32  3               ; Get property buffer address of char at (dispx, dispy) in hl.
001C32  3               ;
001C32  3               ; Output:
001C32  3               ;  bufaddr = MAP + dispy*32 + dispx
001C32  3               ;--------------------------------------------------------------
001C32  3               
001C32  3               pradd:
001C32  3  A5 rr        	lda dispy 		; y coordinate.
001C34  3  85 rr        	sta bufaddr
001C36  3  A9 00        	lda #0
001C38  3  85 rr        	sta bufaddr+1
001C3A  3  06 rr        	asl bufaddr  		; multiply char by 32
001C3C  3  26 rr        	rol bufaddr+1
001C3E  3  06 rr        	asl bufaddr
001C40  3  26 rr        	rol bufaddr+1
001C42  3  06 rr        	asl bufaddr
001C44  3  26 rr        	rol bufaddr+1
001C46  3  06 rr        	asl bufaddr
001C48  3  26 rr        	rol bufaddr+1
001C4A  3  06 rr        	asl bufaddr
001C4C  3  26 rr        	rol bufaddr+1
001C4E  3  18           	clc			; add address of MAP graphics.
001C4F  3  A5 rr        	lda bufaddr
001C51  3  65 rr        	adc dispx
001C53  3  69 00        	adc #<MAP
001C55  3  85 rr        	sta bufaddr
001C57  3  A5 rr        	lda bufaddr+1
001C59  3  69 03        	adc #>MAP
001C5B  3  85 rr        	sta bufaddr+1
001C5D  3  60           	rts
001C5E  3               
001C5E  3               ;----------------------------------------------
001C5E  3               ; Print attributes, properties and pixels.
001C5E  3               ;
001C5E  3               ; Input:
001C5E  3               ;  A	= tile number
001C5E  3               ;----------------------------------------------
001C5E  3               
001C5E  3               pattr:
001C5E  3  85 rr        	sta z80_b		; store cell in b register for now.
001C60  3  AA           	tax
001C61  3  BD DF 56     	lda bprop,x 		; block properties.
001C64  3  85 rr        	sta z80_c
001C66  3  C9 08        	cmp #COLECT
001C68  3  D0 04        	bne :+
001C6A  3  A5 rr        	lda z80_b
001C6C  3  85 rr        	sta colpatt
001C6E  3               :
001C6E  3  20 32 1C     	jsr pradd 		; get property buffer address.
001C71  3  A5 rr        	lda z80_c
001C73  3  A0 00        	ldy #0
001C75  3  91 rr        	sta (bufaddr),y 	; write property.
001C77  3  A5 rr        	lda z80_b 		; restore cell.
001C79  3               
001C79  3               ; Print attributes, no properties.
001C79  3               
001C79  3               panp:
001C79  3  85 rr        	sta z80_e		; displacement in e.
001C7B  3  A9 00        	lda #0
001C7D  3  85 rr        	sta z80_d		; no high byte.
001C7F  3  06 rr        	asl z80_e  		; multiply char by 8.
001C81  3  26 rr        	rol z80_d
001C83  3  06 rr        	asl z80_e
001C85  3  26 rr        	rol z80_d
001C87  3  06 rr        	asl z80_e
001C89  3  26 rr        	rol z80_d
001C8B  3  18           	clc
001C8C  3  A5 rr        	lda z80_e
001C8E  3  69 0F        	adc #<chgfx 		; address of graphics.
001C90  3  85 rr        	sta tileaddr
001C92  3  A5 rr        	lda z80_d
001C94  3  69 54        	adc #>chgfx
001C96  3  85 rr        	sta tileaddr+1
001C98  3  20 04 1C     	jsr gprad 		; get screen address.
001C9B  3  A0 07        	ldy #7			; number of pixel rows to write.
001C9D  3               panp0:
001C9D  3  B1 rr        	lda (tileaddr),y 	; get image byte.
001C9F  3  49 00        	eor #TxtInvert		; Invert
001CA1  3  91 rr        	sta (scraddr),y 	; copy to screen.
001CA3  3  88           	dey	 		; repeat for 8 pixel rows.
001CA4  3  10 F7        	bpl panp0
001CA6  3  E6 rr        	inc dispx 		; move along one.
001CA8  3  E6 rr        	inc charx
001CAA  3  60           	rts
001CAB  3               
001CAB  3               ;----------------------------------------------
001CAB  3               ; Print character pixels, no more.
001CAB  3               ;
001CAB  3               ; Input:
001CAB  3               ;  A	= character to print
001CAB  3               ;----------------------------------------------
001CAB  3               
001CAB  3               pchr:
001CAB  3  20 52 11     	jsr pchar 		; show character in accumulator.
001CAE  3  E6 rr        	inc dispx		; move along one.
001CB0  3  60           	rts
001CB1  3               
001CB1  3               ;----------------------------------------------------
001CB1  3               ; Shifter sprite routine for objects.
001CB1  3               ;----------------------------------------------------
001CB1  3               
001CB1  3               sprit7:
001CB1  3  A5 rr        	lda z80_b
001CB3  3  F0 0A        	beq sprit0
001CB5  3  A8           	tay
001CB6  3               sprit3:
001CB6  3  46 rr        	lsr spr			; shift into position.
001CB8  3  66 rr        	ror spr+1
001CBA  3  66 rr        	ror spr+2
001CBC  3  88           	dey				; one less iteration.
001CBD  3  D0 F7        	bne sprit3
001CBF  3               sprit0:
001CBF  3  60           	rts 			; now apply to screen.
001CC0  3               
001CC0  3               ;-----------------------------------------------------------
001CC0  3               ; Get room address.
001CC0  3               ;-----------------------------------------------------------
001CC0  3               
001CC0  3               groom:
001CC0  3  A6 rr        	ldx scno 		; screen number.
001CC2  3  A0 00        	ldy #0
001CC4  3               groomx:
001CC4  3  A9 43        	lda #<scdat 		; pointer to screens.
001CC6  3  85 rr        	sta z80_l
001CC8  3  A9 5E        	lda #>scdat
001CCA  3  85 rr        	sta z80_h
001CCC  3               groom1:
001CCC  3  E0 00        	cpx #0			; is it the first one?
001CCE  3  F0 15        	beq groom0 		; no more screens to skip.
001CD0  3               
001CD0  3  18           	clc
001CD1  3  A5 rr        	lda z80_l
001CD3  3  79 43 5E     	adc scdat,y 		; low byte of screen size.
001CD6  3  85 rr        	sta z80_l
001CD8  3  C8           	iny			; point to high byte.
001CD9  3  A5 rr        	lda z80_h
001CDB  3  79 43 5E     	adc scdat,y 		; high byte of screen size.
001CDE  3  85 rr        	sta z80_h
001CE0  3  C8           	iny			; next address.
001CE1  3               
001CE1  3  CA           	dex 			; one less iteration.
001CE2  3  4C CC 1C     	jmp groom1 		; loop until we reach the end.
001CE5  3               groom0:
001CE5  3  AD BC 62     	lda numsc 		; add displacement.
001CE8  3  0A           	asl a
001CE9  3  18           	clc			; add double displacement to address.
001CEA  3  65 rr        	adc z80_l
001CEC  3  85 rr        	sta z80_l
001CEE  3  A5 rr        	lda z80_h
001CF0  3  69 00        	adc #0
001CF2  3  85 rr        	sta z80_h
001CF4  3  60           	rts
001CF5  3               
001CF5  3               ;-----------------------------------------------------------
001CF5  3               ; Draw present room.
001CF5  3               ;-----------------------------------------------------------
001CF5  3               
001CF5  3               droom:
001CF5  3  AD 0C 16     	lda wintop 		; window top.
001CF8  3  85 rr        	sta dispy		; set cursor y position.
001CFA  3               droom2:
001CFA  3  20 C0 1C     	jsr groom 		; get address of current room.
001CFD  3  A9 00        	lda #0	 		; zero in accumulator.
001CFF  3  85 rr        	sta comcnt 		; reset compression counter.
001D01  3  AD 0E 16     	lda winhgt 		; height of window.
001D04  3  85 rr        	sta rrow		; set row counter
001D06  3               droom0:
001D06  3  AD 0D 16     	lda winlft 		; window left edge.
001D09  3  85 rr        	sta dispx 		; set cursor x position.
001D0B  3  AD 0F 16     	lda winwid 		; width of window.
001D0E  3  85 rr        	sta rcol		; set column counter
001D10  3               droom1:
001D10  3  20 21 1D     	jsr flbyt 		; decompress next byte on the fly.
001D13  3  20 5E 1C     	jsr pattr 		; show attributes and block.
001D16  3  C6 rr        	dec rcol		; one less column.
001D18  3  D0 F6        	bne droom1 		; repeat for entire line.
001D1A  3  E6 rr        	inc dispy		; move down one line.
001D1C  3  C6 rr        	dec rrow 		; one less row.
001D1E  3  D0 E6        	bne droom0 		; repeat for all rows.
001D20  3  60           	rts
001D21  3               
001D21  3               ;----------------------------------------------
001D21  3               ; Decompress bytes on-the-fly.
001D21  3               ;----------------------------------------------
001D21  3               
001D21  3               flbyt:
001D21  3  A5 rr        	lda comcnt 		; compression counter.
001D23  3  D0 21        	bne flbyt1		; any more to decompress?  yes.
001D25  3               
001D25  3  A0 00        	ldy #0
001D27  3  B1 rr        	lda (z80_hl),y 		; fetch next byte.
001D29  3  E6 rr        	inc z80_l 		; point to next cell.
001D2B  3  D0 02        	bne :+
001D2D  3  E6 rr        	inc z80_h
001D2F  3               :
001D2F  3  C9 FF        	cmp #255 		; is this byte a control code?
001D31  3  F0 01        	beq :+
001D33  3  60           	rts 			; no, this byte is uncompressed.
001D34  3               :
001D34  3  B1 rr        	lda (z80_hl),y 		; fetch byte type.
001D36  3  85 rr        	sta combyt 		; set up the type.
001D38  3  E6 rr        	inc z80_l 		; point to quantity.
001D3A  3  D0 02        	bne :+
001D3C  3  E6 rr        	inc z80_h
001D3E  3               :
001D3E  3  B1 rr        	lda (z80_hl),y 		; get quantity.
001D40  3  E6 rr        	inc z80_l 		; point to next byte.
001D42  3  D0 02        	bne :+
001D44  3  E6 rr        	inc z80_h
001D46  3               :
001D46  3               flbyt1:
001D46  3  85 rr        	sta comcnt 		; store new quantity.
001D48  3  C6 rr        	dec comcnt		; one less.
001D4A  3  A5 rr        	lda combyt 		; byte to expand.
001D4C  3  60           	rts
001D4D  3               
001D4D  3               ;------------------------------------------
001D4D  3               ; Ladder down check.
001D4D  3               ;
001D4D  3               ; Input:
001D4D  3               ;  IX = sprite pointer
001D4D  3               ;------------------------------------------
001D4D  3               
001D4D  3               laddd:
001D4D  3  A0 09        	ldy #9
001D4F  3  B1 rr        	lda (z80_ix),y		; x coordinate.
001D51  3  85 rr        	sta dispx
001D53  3               
001D53  3  A0 08        	ldy #8
001D55  3  B1 rr        	lda (z80_ix),y		; y coordinate.
001D57  3  29 FE        	and #254		; make it even.
001D59  3  91 rr        	sta (z80_ix),y 		; reset it.
001D5B  3               numsp5:
001D5B  3  18           	clc 			; look down 16 pixels.
001D5C  3  69 10        	adc #16
001D5E  3  85 rr        	sta dispy		; coords in dispx,dispy.
001D60  3  4C 76 1D     	jmp laddv
001D63  3               
001D63  3               ;------------------------------------------
001D63  3               ; Ladder up check.
001D63  3               ;
001D63  3               ; Input:
001D63  3               ;  IX = sprite pointer
001D63  3               ;
001D63  3               ; Output:
001D63  3               ;  A  = 0 is ok, A <>0 is not ok
001D63  3               ;------------------------------------------
001D63  3               
001D63  3               laddu:
001D63  3  A0 09        	ldy #9
001D65  3  B1 rr        	lda (z80_ix),y		; x coordinate.
001D67  3  85 rr        	sta dispx
001D69  3               
001D69  3  A0 08        	ldy #8
001D6B  3  B1 rr        	lda (z80_ix),y		; y coordinate.
001D6D  3  29 FE        	and #254 		; make it even.
001D6F  3  91 rr        	sta (z80_ix),y		; reset it.
001D71  3               numsp6:
001D71  3  18           	clc 			; look 2 pixels above feet.
001D72  3  69 0E        	adc #14
001D74  3  85 rr        	sta dispy		; coords in dispx,dispy.
001D76  3               laddv:
001D76  3  20 B8 1F     	jsr tstbl 		; get map address.
001D79  3  20 83 1E     	jsr ldchk 		; standard ladder check.
001D7C  3  F0 01        	beq :+
001D7E  3  60           	rts 			; no way through.
001D7F  3               :
001D7F  3  E6 rr        	inc bufaddr 		; look right one cell.
001D81  3  D0 02        	bne :+
001D83  3  E6 rr        	inc bufaddr+1
001D85  3               :
001D85  3  20 83 1E     	jsr ldchk 		; do the check.
001D88  3  F0 01        	beq :+
001D8A  3  60           	rts 			; impassable.
001D8B  3               :
001D8B  3  A5 rr        	lda dispx 		; y coordinate.
001D8D  3  29 07        	and #7 			; position straddling block cells.
001D8F  3  D0 01        	bne :+
001D91  3  60           	rts 			; no more checks needed.
001D92  3               :
001D92  3  E6 rr        	inc bufaddr 		; look to third cell.
001D94  3  D0 02        	bne :+
001D96  3  E6 rr        	inc bufaddr+1
001D98  3               :
001D98  3  20 83 1E     	jsr ldchk 		; do the check.
001D9B  3  60           	rts  			; return with zero flag set accordingly.
001D9C  3               
001D9C  3               ;---------------------------------------------------------
001D9C  3               ; Can go up check.
001D9C  3               ;
001D9C  3               ; Input:
001D9C  3               ;  IX = sprite pointer
001D9C  3               ;
001D9C  3               ; Output:
001D9C  3               ;  A  = 0 is ok, A <>0 is not ok
001D9C  3               ;---------------------------------------------------------
001D9C  3               
001D9C  3               cangu:
001D9C  3  A0 09        	ldy #9
001D9E  3  B1 rr        	lda (z80_ix),y		; x coordinate.
001DA0  3  85 rr        	sta dispx
001DA2  3  A0 08        	ldy #8
001DA4  3  B1 rr        	lda (z80_ix),y 		; y coordinate.
001DA6  3  38           	sec
001DA7  3  E9 02        	sbc #2
001DA9  3  85 rr        	sta dispy		; coords in dispx,dispy.
001DAB  3  20 B8 1F     	jsr tstbl 		; get map address.
001DAE  3  20 4E 1E     	jsr lrchk 		; standard left/right check.
001DB1  3  F0 01        	beq :+
001DB3  3  60           	rts			; no way through.
001DB4  3               :
001DB4  3  E6 rr        	inc bufaddr		; look right one cell.
001DB6  3  D0 02        	bne :+
001DB8  3  E6 rr        	inc bufaddr+1
001DBA  3               :
001DBA  3  20 4E 1E     	jsr lrchk 		; do the check.
001DBD  3  F0 01        	beq :+
001DBF  3  60           	rts			; impassable.
001DC0  3               :
001DC0  3  A5 rr        	lda dispx		; x coordinate.
001DC2  3  29 07        	and #7			; position straddling block cells.
001DC4  3  D0 01        	bne :+
001DC6  3  60           	rts			; no more checks needed.
001DC7  3               :
001DC7  3  E6 rr        	inc bufaddr		; look to third cell.
001DC9  3  D0 02        	bne :+
001DCB  3  E6 rr        	inc bufaddr+1
001DCD  3               :
001DCD  3  20 4E 1E     	jsr lrchk		; do the check.
001DD0  3  60           	rts 			; return with zero flag set accordingly.
001DD1  3               
001DD1  3               ;---------------------------------------------------------
001DD1  3               ; Can go down check.
001DD1  3               ;
001DD1  3               ; Input:
001DD1  3               ;  IX = sprite pointer
001DD1  3               ;
001DD1  3               ; Output:
001DD1  3               ;  A  = 0 is ok, A <>0 is not ok
001DD1  3               ;---------------------------------------------------------
001DD1  3               
001DD1  3               cangd:
001DD1  3  A0 09        	ldy #9
001DD3  3  B1 rr        	lda (z80_ix),y 		; x coordinate.
001DD5  3  85 rr        	sta dispx
001DD7  3  A0 08        	ldy #8
001DD9  3  B1 rr        	lda (z80_ix),y		; y coordinate.
001DDB  3               numsp3:
001DDB  3  18           	clc
001DDC  3  69 10        	adc #16 		; look down 16 pixels.
001DDE  3  85 rr        	sta dispy		; coords in dispx,dispy.
001DE0  3  20 B8 1F     	jsr tstbl 		; get map address.
001DE3  3  20 63 1E     	jsr plchk 		; block, platform check.
001DE6  3  F0 01        	beq :+
001DE8  3  60           	rts			; no way through.
001DE9  3               :
001DE9  3  E6 rr        	inc bufaddr		; look right one cell.
001DEB  3  D0 02        	bne :+
001DED  3  E6 rr        	inc bufaddr+1
001DEF  3               :
001DEF  3  20 63 1E     	jsr plchk		; block, platform check.
001DF2  3  F0 01        	beq :+
001DF4  3  60           	rts			; impassable.
001DF5  3               :
001DF5  3  A5 rr        	lda dispx		; x coordinate.
001DF7  3  29 07        	and #7			; position straddling block cells.
001DF9  3  D0 01        	bne :+
001DFB  3  60           	rts			; no more checks needed.
001DFC  3               :
001DFC  3  E6 rr        	inc bufaddr		; look to third cell.
001DFE  3  D0 02        	bne :+
001E00  3  E6 rr        	inc bufaddr+1
001E02  3               :
001E02  3  20 63 1E     	jsr plchk		; block, platform check.
001E05  3  60           	rts			; return with zero flag set accordingly.
001E06  3               
001E06  3               ;---------------------------------------------------------
001E06  3               ; Can go left check.
001E06  3               ;
001E06  3               ; Input:
001E06  3               ;  IX = sprite pointer
001E06  3               ;
001E06  3               ; Output:
001E06  3               ;  A  = 0 is ok, A <>0 is not ok
001E06  3               ;---------------------------------------------------------
001E06  3               
001E06  3               cangl:
001E06  3  A0 08        	ldy #8
001E08  3  B1 rr        	lda (z80_ix),y 		; y coordinate.
001E0A  3  85 rr        	sta dispy
001E0C  3  A0 09        	ldy #9
001E0E  3  B1 rr        	lda (z80_ix),y 		; x coordinate.
001E10  3  38           	sec
001E11  3  E9 02        	sbc #2			; look left 2 pixels.
001E13  3  85 rr        	sta dispx		; coords in dispx,dispy.
001E15  3  4C 27 1E     	jmp cangh		; test if we can go there.
001E18  3               
001E18  3               ;---------------------------------------------------------
001E18  3               ; Can go right check.
001E18  3               ;
001E18  3               ; Input:
001E18  3               ;  IX = sprite pointer
001E18  3               ;
001E18  3               ; Output:
001E18  3               ;  A  = 0 is ok, A <>0 is not ok
001E18  3               ;---------------------------------------------------------
001E18  3               
001E18  3               cangr:
001E18  3  A0 08        	ldy #8
001E1A  3  B1 rr        	lda (z80_ix),y		; y coordinate.
001E1C  3  85 rr        	sta dispy
001E1E  3  A0 09        	ldy #9
001E20  3  B1 rr        	lda (z80_ix),y		; x coordinate.
001E22  3  18           	clc
001E23  3  69 10        	adc #16			; look right 16 pixels.
001E25  3  85 rr        	sta dispx		; coords in dispx,dispy.
001E27  3               cangh:
001E27  3               cangh2:
001E27  3  A9 03        	lda #3			; default rows to write.
001E29  3  85 rr        	sta z80_b
001E2B  3  A5 rr        	lda dispy		; y position.
001E2D  3  29 07        	and #7			; does x straddle cells?
001E2F  3  D0 02        	bne cangh0		; yes, loop counter is good.
001E31  3  C6 rr        	dec z80_b		; one less row to write.
001E33  3               cangh0:
001E33  3  20 B8 1F     	jsr tstbl		; get map address.
001E36  3               cangh1:
001E36  3  20 4E 1E     	jsr lrchk		; standard left/right check.
001E39  3  F0 01        	beq :+
001E3B  3  60           	rts			; no way through.
001E3C  3               :
001E3C  3  48           	pha
001E3D  3  18           	clc
001E3E  3  A5 rr        	lda bufaddr
001E40  3  69 20        	adc #32			; look down.
001E42  3  85 rr        	sta bufaddr
001E44  3  90 02        	bcc :+
001E46  3  E6 rr        	inc bufaddr+1
001E48  3               :
001E48  3  68           	pla
001E49  3               
001E49  3  C6 rr        	dec z80_b
001E4B  3  D0 E9        	bne cangh1
001E4D  3  60           	rts
001E4E  3               
001E4E  3               ;-------------------------------------
001E4E  3               ; Check left/right movement is okay.
001E4E  3               ;
001E4E  3               ; Input:
001E4E  3               ;  bufaddr = MAP + x/8 + y/8*32
001E4E  3               ;
001E4E  3               ; Output:
001E4E  3               ;  A  = 0 is ok, A <>0 is not ok
001E4E  3               ;-------------------------------------
001E4E  3               
001E4E  3               lrchk:
001E4E  3  A0 00        	ldy #0
001E50  3  B1 rr        	lda (bufaddr),y		; fetch map cell.
001E52  3  C9 02        	cmp #WALL 		; is it passable?
001E54  3  F0 0A        	beq lrchkx		; no.
001E56  3               
001E56  3  C9 04        	cmp #FODDER		; fodder has to be dug.
001E58  3  F0 06        	beq lrchkx		; not passable.
001E5A  3  A9 00        	lda #0
001E5C  3  60           	rts
001E5D  3               
001E5D  3               ;--------------------------------------------------------------
001E5D  3               ; Called by mmenu
001E5D  3               ;--------------------------------------------------------------
001E5D  3               
001E5D  3               always:
001E5D  3  A9 FF        	lda #255		; report it as okay.
001E5F  3  60           	rts
001E60  3               
001E60  3               lrchkx:
001E60  3  A9 01        	lda #1 			; reset all bits.
001E62  3  60           	rts
001E63  3               
001E63  3               
001E63  3               ;--------------------------------------------------------------
001E63  3               ; Check platform or solid item is not in way.
001E63  3               ;
001E63  3               ; Input:
001E63  3               ;  bufaddr = MAP + x/8 + y/8*32
001E63  3               ;
001E63  3               ; Output:
001E63  3               ;  A  = 0 is ok, A <>0 is not ok
001E63  3               ;--------------------------------------------------------------
001E63  3               
001E63  3               plchk:
001E63  3  A0 00        	ldy #0
001E65  3  B1 rr        	lda (bufaddr),y 	; fetch map cell.
001E67  3  C9 02        	cmp #WALL 		; is it passable?
001E69  3  F0 F5        	beq lrchkx		; no.
001E6B  3               
001E6B  3  C9 04        	cmp #FODDER		; fodder has to be dug.
001E6D  3  F0 F1        	beq lrchkx		; not passable.
001E6F  3               
001E6F  3  C9 01        	cmp #PLATFM		; platform is solid.
001E71  3  F0 07        	beq plchkx		; not passable.
001E73  3               
001E73  3  C9 03        	cmp #LADDER		; is it a ladder?
001E75  3  F0 E9        	beq lrchkx		; on ladder, deny movement.
001E77  3               plchk0:
001E77  3  A9 00        	lda #0			; report as ok
001E79  3  60           	rts
001E7A  3               plchkx:
001E7A  3  A5 rr        	lda dispy		; x coordinate.
001E7C  3  29 07        	and #7			; position straddling blocks.
001E7E  3  F0 E0        	beq lrchkx		; on platform, deny movement.
001E80  3  4C 77 1E     	jmp plchk0
001E83  3               
001E83  3               ;--------------------------------------------------------------
001E83  3               ; Check ladder is available.
001E83  3               ;
001E83  3               ; Input:
001E83  3               ;  bufaddr = MAP + x/8 + y/8*32
001E83  3               ;
001E83  3               ; Output:
001E83  3               ;  A  = 0 is ok, A <>0 is not ok
001E83  3               ;--------------------------------------------------------------
001E83  3               
001E83  3               ldchk:
001E83  3  A0 00        	ldy #0
001E85  3  B1 rr        	lda (bufaddr),y 	; fetch cell.
001E87  3  C9 03        	cmp #LADDER 		; is it a ladder?
001E89  3  F0 03        	beq :+
001E8B  3  A9 01        	lda #1
001E8D  3  60           	rts  			; return with zero flag set accordingly.
001E8E  3               :
001E8E  3  A9 00        	lda #0
001E90  3  60           	rts
001E91  3               
001E91  3               ;--------------------------------------------------------------
001E91  3               ; Get collectables.
001E91  3               ;--------------------------------------------------------------
001E91  3               
001E91  3               getcol:
001E91  3  A9 08            lda #COLECT             ; collectable blocks.
001E93  3  85 rr            sta z80_b
001E95  3  20 FD 1E         jsr tded                ; test for collectable blocks.
001E98  3  C5 rr            cmp z80_b               ; did we find one?
001E9A  3  F0 01            beq :+
001E9C  3  60               rts                     ; none were found, job done.
001E9D  3               :
001E9D  3  20 A6 1E         jsr gtblk               ; get block.
001EA0  3               
001EA0  3  20 D8 52         jsr evnt20              ; collected block event.
001EA3  3  4C 91 1E         jmp getcol              ; repeat until none left.
001EA6  3               
001EA6  3               ; Get collectable block.
001EA6  3               
001EA6  3               gtblk:
001EA6  3  A0 00        	ldy #0
001EA8  3  B1 rr        	lda (bufaddr),y
001EAA  3  85 rr        	sta z80_a
001EAC  3  A9 00                lda #0
001EAE  3  91 rr                sta (bufaddr),y		; make it empty now.
001EB0  3               
001EB0  3  A5 rr        	lda bufaddr		; set dispx
001EB2  3  29 1F        	and #31
001EB4  3  85 rr        	sta dispx
001EB6  3               
001EB6  3  A5 rr        	lda bufaddr+1		; Set dispy
001EB8  3  38           	sec
001EB9  3  E9 03        	sbc #>MAP
001EBB  3  85 rr        	sta bufaddr+1
001EBD  3  06 rr        	asl bufaddr
001EBF  3  26 rr        	rol bufaddr+1
001EC1  3  06 rr        	asl bufaddr
001EC3  3  26 rr        	rol bufaddr+1
001EC5  3  06 rr        	asl bufaddr
001EC7  3  26 rr        	rol bufaddr+1
001EC9  3  A5 rr        	lda bufaddr+1
001ECB  3  85 rr        	sta dispy
001ECD  3               
001ECD  3  A5 rr        	lda colpatt		; get blocknr
001ECF  3  85 rr        	sta z80_e		; displacement in e.
001ED1  3  A9 00        	lda #0
001ED3  3  85 rr        	sta z80_d		; no high byte.
001ED5  3  06 rr        	asl z80_e  		; multiply char by 8.
001ED7  3  26 rr        	rol z80_d
001ED9  3  06 rr        	asl z80_e
001EDB  3  26 rr        	rol z80_d
001EDD  3  06 rr        	asl z80_e
001EDF  3  26 rr        	rol z80_d
001EE1  3  18           	clc
001EE2  3  A5 rr        	lda z80_e
001EE4  3  69 0F        	adc #<chgfx 		; address of graphics.
001EE6  3  85 rr        	sta tileaddr
001EE8  3  A5 rr        	lda z80_d
001EEA  3  69 54        	adc #>chgfx
001EEC  3  85 rr        	sta tileaddr+1
001EEE  3  20 04 1C     	jsr gprad 		; get screen address.
001EF1  3  A0 07        	ldy #7			; number of pixel rows to write.
001EF3  3               gtblk0:
001EF3  3  B1 rr        	lda (tileaddr),y 	; get image byte.
001EF5  3  51 rr        	eor (scraddr),y 	; XOR tile on screen
001EF7  3  91 rr        	sta (scraddr),y 	; copy to screen.
001EF9  3  88           	dey	 		; repeat for 8 pixel rows.
001EFA  3  10 F7        	bpl gtblk0
001EFC  3  60           	rts
001EFD  3               
001EFD  3               ;--------------------------------------------------------------
001EFD  3               ; Touched deadly block check.
001EFD  3               ; returns with DEADLY (must be non-zero) in accumulator if true.
001EFD  3               ;
001EFD  3               ; Input:
001EFD  3               ;  IX = sprite address
001EFD  3               ;
001EFD  3               ; Output:
001EFD  3               ;  A  = 0 is ok, A=5 is not ok
001EFD  3               ;--------------------------------------------------------------
001EFD  3               
001EFD  3               tded:
001EFD  3  A0 08        	ldy #8
001EFF  3  B1 rr        	lda (z80_ix),y 		; y coordinate.
001F01  3  85 rr        	sta dispy
001F03  3  C8           	iny
001F04  3  B1 rr        	lda (z80_ix),y 		; x coordinate.
001F06  3  85 rr        	sta dispx		; coords in dispx,dispy.
001F08  3  20 B8 1F     	jsr tstbl		; get map address.
001F0B  3  48           	pha
001F0C  3  A9 1F        	lda #31			; default distance to next line down.
001F0E  3  85 rr        	sta z80_e
001F10  3  68           	pla
001F11  3  C5 rr        	cmp z80_b		; is this the required block?
001F13  3  D0 01        	bne :+
001F15  3  60           	rts			; yes.
001F16  3               :
001F16  3  E6 rr        	inc bufaddr 		; next cell.
001F18  3  D0 02        	bne :+
001F1A  3  E6 rr        	inc bufaddr+1
001F1C  3               :
001F1C  3  A0 00        	ldy #0
001F1E  3  B1 rr        	lda (bufaddr),y		; fetch type.
001F20  3  C5 rr        	cmp z80_b 		; is this deadly/custom?
001F22  3  D0 01        	bne :+
001F24  3  60           	rts			; yes.
001F25  3               :
001F25  3  A5 rr        	lda dispx		; horizontal position.
001F27  3  85 rr        	sta z80_c 		; store column in c register.
001F29  3  29 07        	and #7			; is it straddling cells?
001F2B  3  D0 03        	bne :+
001F2D  3  4C 41 1F     	jmp tded0		; no.
001F30  3               :
001F30  3  E6 rr        	inc bufaddr 		; last cell.
001F32  3  D0 02        	bne :+
001F34  3  E6 rr        	inc bufaddr+1
001F36  3               :
001F36  3  A0 00        	ldy #0
001F38  3  B1 rr        	lda (bufaddr),y 	; fetch type.
001F3A  3  C5 rr        	cmp z80_b		; is this the block?
001F3C  3  D0 01        	bne :+
001F3E  3  60           	rts			; yes.
001F3F  3               :
001F3F  3  C6 rr        	dec z80_e		; one less cell to next row down.
001F41  3               tded0:
001F41  3  18           	clc 			; point to next row.
001F42  3  A5 rr        	lda bufaddr
001F44  3  65 rr        	adc z80_e
001F46  3  85 rr        	sta bufaddr
001F48  3  90 02        	bcc :+
001F4A  3  E6 rr        	inc bufaddr+1
001F4C  3               :
001F4C  3  A0 00        	ldy #0
001F4E  3  B1 rr        	lda (bufaddr),y		; fetch left cell block.
001F50  3  C5 rr        	cmp z80_b		; is this fatal?
001F52  3  D0 01        	bne :+
001F54  3  60           	rts			; yes.
001F55  3               :
001F55  3  E6 rr        	inc bufaddr 		; next cell.
001F57  3  D0 02        	bne :+
001F59  3  E6 rr        	inc bufaddr+1
001F5B  3               :
001F5B  3  A0 00        	ldy #0
001F5D  3  B1 rr        	lda (bufaddr),y 	; fetch type.
001F5F  3  C5 rr        	cmp z80_b		; is this fatal?
001F61  3  D0 01        	bne :+
001F63  3  60           	rts			; yes.
001F64  3               :
001F64  3  A5 rr        	lda z80_c		; horizontal position.
001F66  3  29 07        	and #7			; is it straddling cells?
001F68  3  D0 03        	bne :+
001F6A  3  4C 7C 1F     	jmp tded1 		; no.
001F6D  3               :
001F6D  3  E6 rr        	inc bufaddr		; last cell.
001F6F  3  D0 02        	bne :+
001F71  3  E6 rr        	inc bufaddr+1
001F73  3               :
001F73  3  A0 00        	ldy #0
001F75  3  B1 rr        	lda (bufaddr),y		; fetch type.
001F77  3  C5 rr        	cmp z80_b		; is this fatal?
001F79  3  D0 01        	bne :+
001F7B  3  60           	rts			; yes.
001F7C  3               :
001F7C  3               tded1:
001F7C  3  A5 rr        	lda dispy		; vertical position.
001F7E  3  29 07        	and #7 			; is it straddling cells?
001F80  3  D0 01        	bne :+
001F82  3  60           	rts			; no, job done.
001F83  3               :
001F83  3  18           	clc			; point to next row.
001F84  3  A5 rr        	lda bufaddr
001F86  3  65 rr        	adc z80_e
001F88  3  85 rr        	sta bufaddr
001F8A  3  90 02        	bcc :+
001F8C  3  E6 rr        	inc bufaddr+1
001F8E  3               :
001F8E  3  A0 00        	ldy #0
001F90  3  B1 rr        	lda (bufaddr),y 	; fetch left cell block.
001F92  3  C5 rr        	cmp z80_b		; is this fatal?
001F94  3  D0 01        	bne :+
001F96  3  60           	rts			; yes.
001F97  3               :
001F97  3  E6 rr        	inc bufaddr		; next cell.
001F99  3  D0 02        	bne :+
001F9B  3  E6 rr        	inc bufaddr+1
001F9D  3               :
001F9D  3  A0 00        	ldy #0
001F9F  3  B1 rr        	lda (bufaddr),y 	; fetch type.
001FA1  3  C5 rr        	cmp z80_b		; is this fatal?
001FA3  3  D0 01        	bne :+
001FA5  3  60           	rts			; yes.
001FA6  3               :
001FA6  3  A5 rr        	lda z80_c		; horizontal position.
001FA8  3  29 07        	and #7			; is it straddling cells?
001FAA  3  D0 01        	bne :+
001FAC  3  60           	rts			; no.
001FAD  3               :
001FAD  3  E6 rr        	inc bufaddr		; last cell.
001FAF  3  D0 02        	bne :+
001FB1  3  E6 rr        	inc bufaddr+1
001FB3  3               :
001FB3  3  A0 00        	ldy #0
001FB5  3  B1 rr        	lda (bufaddr),y		; fetch final type.
001FB7  3  60           	rts 			; return with final type in accumulator.
001FB8  3               
001FB8  3               ;---------------------------------------------------
001FB8  3               ; Fetch block type at (dispx, dispy).
001FB8  3               ;
001FB8  3               ; Output:
001FB8  3               ;  A = block type
001FB8  3               ;---------------------------------------------------
001FB8  3               
001FB8  3               tstbl:
001FB8  3  A5 rr        	lda dispy 		; fetch y coord.
001FBA  3  4A           	lsr a			; bufaddr = y/8
001FBB  3  4A           	lsr a
001FBC  3  4A           	lsr a
001FBD  3  85 rr        	sta bufaddr
001FBF  3  A9 00        	lda #0
001FC1  3  85 rr        	sta bufaddr+1
001FC3  3               
001FC3  3  06 rr        	asl bufaddr  		; bufaddr = y/8 * 32
001FC5  3  26 rr        	rol bufaddr+1
001FC7  3  06 rr        	asl bufaddr
001FC9  3  26 rr        	rol bufaddr+1
001FCB  3  06 rr        	asl bufaddr
001FCD  3  26 rr        	rol bufaddr+1
001FCF  3  06 rr        	asl bufaddr
001FD1  3  26 rr        	rol bufaddr+1
001FD3  3  06 rr        	asl bufaddr
001FD5  3  26 rr        	rol bufaddr+1
001FD7  3               
001FD7  3  A5 rr        	lda dispx		; x/8
001FD9  3  4A           	lsr a
001FDA  3  4A           	lsr a
001FDB  3  4A           	lsr a
001FDC  3               
001FDC  3  18           	clc			; bufaddr = MAP + x/8 + y/8*32
001FDD  3  65 rr        	adc bufaddr
001FDF  3  69 00        	adc #<MAP
001FE1  3  85 rr        	sta bufaddr
001FE3  3  A5 rr        	lda bufaddr+1
001FE5  3  69 03        	adc #>MAP
001FE7  3  85 rr        	sta bufaddr+1
001FE9  3               
001FE9  3  A0 00        	ldy #0
001FEB  3  B1 rr        	lda (bufaddr),y 	; fetch byte there.
001FED  3  60           	rts
001FEE  3               
001FEE  3               ;-------------------------------------------------------------------
001FEE  3               ; Jump - if we can.
001FEE  3               ; Requires initial speed to be set up in accumulator prior to call.
001FEE  3               ;
001FEE  3               ; Input:
001FEE  3               ;  IX = sprite address
001FEE  3               ;-------------------------------------------------------------------
001FEE  3               
001FEE  3               jump:
001FEE  3  A0 0D        	ldy #var_jumpLo
001FF0  3  B1 rr        	lda (z80_ix),y		; jump table low.
001FF2  3  A0 0E        	ldy #var_jumpHi
001FF4  3  11 rr        	ora (z80_ix),y		; jump table high.
001FF6  3  F0 01        	beq :+
001FF8  3  60           	rts			; already in the air.
001FF9  3               :
001FF9  3  A9 20        	lda #>jtab
001FFB  3  A0 0E        	ldy #var_jumpHi
001FFD  3  91 rr        	sta (z80_ix),y		; set jump high.
001FFF  3  A9 20        	lda #<jtab		; jump table start.
002001  3  A0 0D        	ldy #var_jumpLo
002003  3  91 rr        	sta (z80_ix),y		; set jump low.
002005  3  60           	rts
002006  3               
002006  3               ; Jump table.
002006  3  xx xx xx xx  .align 32
00200A  3  xx xx xx xx  
00200E  3  xx xx xx xx  
002020  3               jtab:
002020  3  F8 FA FC     	.byte 248,250,252
002023  3  FE FE FF     	.byte 254,254,255
002026  3  FF FF 00 00  	.byte 255,255,0,0
00202A  3  00 01 01 01  	.byte 0,1,1,1,2,2
00202E  3  02 02        
002030  3  04 06 08 08  	.byte 4,6,8,8,8,99
002034  3  08 63        
002036  3               .align 1
002036  3               
002036  3               ;------------------------------------------------
002036  3               ; Random numbers code.
002036  3               ; Pseudo-random number generator, 8-bit.
002036  3               ;
002036  3               ; Output:
002036  3               ;  RND = random number
002036  3               ;------------------------------------------------
002036  3               
002036  3               random:
002036  3  A5 rr        	lda seed		; get last random number.
002038  3  0A           	asl a
002039  3  0A           	asl a
00203A  3  18           	clc
00203B  3  65 rr        	adc seed
00203D  3  18           	clc
00203E  3  69 45        	adc #$45
002040  3  85 rr        	sta seed		; store new seed.
002042  3  85 rr        	sta varrnd		; return number in variable.
002044  3  60           	rts
002045  3               
002045  3               ;-------------------------------------------------------
002045  3               ; Joystick and keyboard reading routines.
002045  3               ;
002045  3               ; contrl = 0, Keyboard
002045  3               ;          1, JoyKeyb
002045  3               ;          2, JoyMMC
002045  3               ;-------------------------------------------------------
002045  3               
002045  3               joykey:
002045  3  A5 rr        	lda contrl 		; control flag.
002047  3  C9 01        	cmp #1
002049  3  D0 03        	bne :+
00204B  3  4C 69 20     	jmp joyjoy 		; read keyboard joystick
00204E  3               :
00204E  3  C9 02        	cmp #2
002050  3  D0 03        	bne :+
002052  3  4C F6 0E     	jmp joysin 		; read MMC joystick.
002055  3               :
002055  3               ; Keyboard controls.
002055  3               
002055  3  A9 00        	lda #0		 	; zero reading.
002057  3  85 rr        	sta z80_e
002059  3               
002059  3  A0 06        	ldy #6	 		; address of last key.
00205B  3               joyke0:
00205B  3  B9 76 67     	lda keys,y 		; get key from table.
00205E  3  20 CC 0E     	jsr ktest		; being pressed?
002061  3  26 rr        	rol z80_e 		; rotate into reading.
002063  3               
002063  3  88           	dey		 	; next key.
002064  3  10 F5        	bpl joyke0 		; repeat for all keys.
002066  3  4C 7A 20     	jmp joyjo1 		; store the value.
002069  3               
002069  3               ; Keyboard joystick controls.
002069  3               
002069  3               joyjoy:
002069  3  A9 00        	lda #0		 	; zero reading.
00206B  3  85 rr        	sta z80_e
00206D  3               
00206D  3  A0 06        	ldy #6	 		; address of last key.
00206F  3               joyjo3:
00206F  3  B9 62 0E     	lda jkeys,y 		; get key from table.
002072  3  20 CC 0E     	jsr ktest		; being pressed?
002075  3  26 rr        	rol z80_e 		; rotate into reading.
002077  3               
002077  3  88           	dey		 	; next key.
002078  3  10 F5        	bpl joyjo3 		; repeat for all keys.
00207A  3               joyjo1:
00207A  3  A5 rr        	lda z80_e 		; copy e register to accumulator.
00207C  3               joyjo2:
00207C  3  85 rr        	sta joyval		; remember value.
00207E  3  60           	rts
00207F  3               
00207F  3               ;---------------------------------------------------------------
00207F  3               ; Display message.
00207F  3               ;
00207F  3               ; Input:
00207F  3               ;  A = message number
00207F  3               ;---------------------------------------------------------------
00207F  3               
00207F  3               dmsg:
00207F  3  AA           	tax
002080  3  A9 DA        	lda #<msgdat		; pointer to messages.
002082  3  85 rr        	sta z80_l
002084  3  A9 52        	lda #>msgdat
002086  3  85 rr        	sta z80_h
002088  3  20 9E 21     	jsr getwrd		; get message number.
00208B  3               dmsg3:
00208B  3  20 8B 21     	jsr preprt		; pre-printing stuff.
00208E  3  20 C6 1A     	jsr checkx		; make sure we"re in a printable range.
002091  3  A5 rr        	lda prtmod		; print mode.
002093  3  D0 47        	bne bmsg1		; no, double-height text.
002095  3               dmsg0:
002095  3  A5 rr        	lda z80_h		; store string pointer.
002097  3  48           	pha
002098  3  A5 rr        	lda z80_l
00209A  3  48           	pha
00209B  3               
00209B  3  A0 00        	ldy #0
00209D  3  B1 rr        	lda (z80_hl),y		; fetch byte to display.
00209F  3  29 7F        	and #127		; remove any end marker.
0020A1  3  C9 0D        	cmp #ASCII_NEWLINE
0020A3  3  F0 24        	beq dmsg1
0020A5  3  20 52 11     	jsr pchar		; display character.
0020A8  3  20 76 21     	jsr nexpos 		; display position.
0020AB  3  D0 03        	bne dmsg2		; not on a new line.
0020AD  3  20 7D 21     	jsr nexlin		; next line down.
0020B0  3               dmsg2:
0020B0  3  68           	pla			; retrieve string pointer
0020B1  3  85 rr        	sta z80_l
0020B3  3  68           	pla
0020B4  3  85 rr        	sta z80_h
0020B6  3               
0020B6  3  A0 00        	ldy #0
0020B8  3  B1 rr        	lda (z80_hl),y		; fetch last character.
0020BA  3  0A           	asl a  			; was it the end?
0020BB  3  90 03        	bcc :+
0020BD  3  4C 0B 1B     	jmp dscor2		; yes, job done.
0020C0  3               :
0020C0  3  E6 rr        	inc z80_l		; next character to display.
0020C2  3  D0 02        	bne :+
0020C4  3  E6 rr        	inc z80_h
0020C6  3               :
0020C6  3  4C 95 20     	jmp dmsg0
0020C9  3               dmsg1:
0020C9  3  E6 rr        	inc dispy
0020CB  3  A5 rr        	lda dispy
0020CD  3  C9 18        	cmp #24
0020CF  3  90 04        	bcc dmsg4
0020D1  3  A9 00        	lda #0
0020D3  3  85 rr        	sta dispy
0020D5  3               dmsg4:
0020D5  3  A9 00        	lda #0
0020D7  3  85 rr        	sta dispx
0020D9  3  4C B0 20     	jmp dmsg2
0020DC  3               
0020DC  3               ;----------------------------------------------------------
0020DC  3               ; Display message in big text.
0020DC  3               ;
0020DC  3               ; Input:
0020DC  3               ;  HL = string pointer
0020DC  3               ;----------------------------------------------------------
0020DC  3               
0020DC  3               bmsg1:
0020DC  3  A0 00        	ldy #0
0020DE  3  B1 rr        	lda (z80_hl),y 		; get character to display.
0020E0  3  29 7F        	and #127		; only want 7 bits.
0020E2  3  C9 0D        	cmp #ASCII_NEWLINE
0020E4  3  F0 13        	beq bmsg2
0020E6  3  20 0E 21     	jsr bchar 		; display big char.
0020E9  3               bmsg3:
0020E9  3  A0 00        	ldy #0
0020EB  3  B1 rr        	lda (z80_hl),y 		; look at last character.
0020ED  3  48           	pha
0020EE  3  E6 rr        	inc z80_l 		; next character in list.
0020F0  3  D0 02        	bne :+
0020F2  3  E6 rr        	inc z80_h
0020F4  3               :
0020F4  3  68           	pla
0020F5  3  0A           	asl a  			; was terminator flag set?
0020F6  3  90 E4        	bcc bmsg1		; no, keep going.
0020F8  3               :
0020F8  3  60           	rts
0020F9  3               bmsg2:
0020F9  3  A9 00        	lda #0
0020FB  3  85 rr        	sta dispx
0020FD  3  E6 rr        	inc dispy
0020FF  3  E6 rr        	inc dispy
002101  3  A5 rr        	lda dispy
002103  3  C9 17        	cmp #23
002105  3  90 E2        	bcc bmsg3
002107  3  A9 00        	lda #0
002109  3  85 rr        	sta dispy
00210B  3  4C E9 20     	jmp bmsg3
00210E  3               
00210E  3               ;----------------------------------------------------------
00210E  3               ; Big character display.
00210E  3               ;
00210E  3               ; Input:
00210E  3               ;  A = character
00210E  3               ;----------------------------------------------------------
00210E  3               
00210E  3               bchar:
00210E  3  85 rr        	sta z80_e		; save char in lb
002110  3  A9 00        	lda #0
002112  3  85 rr        	sta z80_d		; reset hb
002114  3               
002114  3  06 rr        	asl z80_e 		; multiply char by 8.
002116  3  26 rr        	rol z80_d
002118  3  06 rr        	asl z80_e
00211A  3  26 rr        	rol z80_d
00211C  3  06 rr        	asl z80_e
00211E  3  26 rr        	rol z80_d		; de = a*8
002120  3               
002120  3  18           	clc			; de = FontPtr + a*8
002121  3  A5 rr        	lda z80_e
002123  3  65 rr        	adc FontPtr 		; address of font.
002125  3  85 rr        	sta z80_e
002127  3  A5 rr        	lda z80_d
002129  3  65 rr        	adc FontPtr+1
00212B  3  85 rr        	sta z80_d
00212D  3               
00212D  3  20 04 1C     	jsr gprad 		; get screen address.
002130  3               
002130  3  A2 00        	ldx #0			; height of character in font.
002132  3               bchar0:
002132  3  A0 00        	ldy #0
002134  3  B1 rr        	lda (z80_de),y 		; get a bit of the font.
002136  3               
002136  3  49 00        	eor #TxtInvert		; Invert
002138  3               
002138  3  91 rr        	sta (scraddr),y
00213A  3  48           	pha
00213B  3  20 9F 10     	jsr nline 		; next line down.
00213E  3  68           	pla
00213F  3  91 rr        	sta (scraddr),y
002141  3  20 9F 10     	jsr nline 		; next line down.
002144  3               
002144  3  18           	clc
002145  3  E6 rr        	inc z80_e 		; next line of font.
002147  3  D0 02        	bne :+
002149  3  E6 rr        	inc z80_d
00214B  3               :
00214B  3  E8           	inx
00214C  3  E0 08        	cpx #8
00214E  3  D0 E2        	bne bchar0
002150  3               
002150  3  20 76 21     	jsr nexpos		; display position.
002153  3  D0 05        	bne bchar2 		; not on a new line.
002155  3               bchar3:
002155  3  E6 rr        	inc dispy
002157  3  20 7D 21     	jsr nexlin 		; next line check.
00215A  3               bchar2:
00215A  3  4C 0B 1B     	jmp dscor2		; tidy up line and column variables.
00215D  3               
00215D  3               
00215D  3               ;-------------------------------------------------
00215D  3               ; Display a character.
00215D  3               ;
00215D  3               ; Input:
00215D  3               ;  A = character
00215D  3               ;-------------------------------------------------
00215D  3               
00215D  3               achar:
00215D  3  85 rr        	sta z80_b 		; copy to b.
00215F  3  20 8B 21     	jsr preprt 		; get ready to print.
002162  3  A5 rr        	lda z80_b		; character in accumulator.
002164  3  A6 rr        	ldx prtmod 		; print mode.
002166  3  F0 03        	beq :+
002168  3  4C 0E 21     	jmp bchar 		; no, double-height text.
00216B  3               :
00216B  3  20 52 11     	jsr pchar 		; display character.
00216E  3  20 76 21     	jsr nexpos 		; display position.
002171  3  F0 E2        	beq bchar3		; next line down.
002173  3  4C 5A 21     	jmp bchar2 		; tidy up.
002176  3               
002176  3               
002176  3               ;-------------------------------------------------
002176  3               ; Get next print column position.
002176  3               ;-------------------------------------------------
002176  3               
002176  3               nexpos:
002176  3  E6 rr        	inc dispx		; move along one position.
002178  3  A5 rr        	lda dispx 		; get coordinate.
00217A  3  29 1F        	and #31
00217C  3  60           	rts 			; return with status in zero flag.
00217D  3               
00217D  3               ;-------------------------------------------------
00217D  3               ; Get next print line position.
00217D  3               ;-------------------------------------------------
00217D  3               
00217D  3               nexlin:
00217D  3  E6 rr        	inc dispy 		; newline.
00217F  3  A5 rr        	lda dispy		; vertical position.
002181  3  C9 18        	cmp #24			; past screen edge?
002183  3  B0 01        	bcs :+
002185  3  60           	rts			; no, still okay.
002186  3               :
002186  3  A9 00        	lda #0			; restart at top.
002188  3  85 rr        	sta dispy
00218A  3  60           	rts
00218B  3               
00218B  3               ;--------------------------------------------------------
00218B  3               ; Pre-print preliminaries.
00218B  3               ;--------------------------------------------------------
00218B  3               
00218B  3               preprt:
00218B  3  A5 rr        	lda FontPtr		; font pointer.
00218D  3  8D C4 1A     	sta grbase		; set up graphics base.
002190  3  A5 rr        	lda FontPtr+1
002192  3  8D C5 1A     	sta grbase+1
002195  3               prescr:
002195  3  A5 rr        	lda charx 		; display coordinates.
002197  3  85 rr        	sta dispx		; set up general coordinates.
002199  3  A5 rr        	lda chary
00219B  3  85 rr        	sta dispy
00219D  3  60           	rts
00219E  3               
00219E  3               ;--------------------------------------------------------------
00219E  3               ; Get messagenr x in hl
00219E  3               ;
00219E  3               ; Input:
00219E  3               ;  HL = pointer to message list
00219E  3               ;  X  = message number.
00219E  3               ;--------------------------------------------------------------
00219E  3               
00219E  3               getwrd:
00219E  3  E0 00        	cpx #0
0021A0  3  D0 01        	bne:+ 			; first word in list?
0021A2  3  60           	rts 			; yep, don't search.
0021A3  3               :
0021A3  3  A0 00        	ldy #0
0021A5  3               getwd0:
0021A5  3  B1 rr        	lda (z80_hl),y
0021A7  3  48           	pha
0021A8  3  E6 rr        	inc z80_l
0021AA  3  D0 02        	bne :+
0021AC  3  E6 rr        	inc z80_h
0021AE  3               :
0021AE  3  68           	pla
0021AF  3  C9 80        	cmp #128		; found end?
0021B1  3  30 F2        	bmi getwd0		; no, carry on.
0021B3  3  CA           	dex			; until we have right number.
0021B4  3  D0 EF        	bne getwd0
0021B6  3  60           	rts
0021B7  3               
0021B7  3               ;-----------------------------------------------------------
0021B7  3               ; Bubble sort.
0021B7  3               ;-----------------------------------------------------------
0021B7  3               
0021B7  3               bsort:
0021B7  3  A9 0B        	lda #NUMSPR - 1		; sprites to swap.
0021B9  3  85 rr        	sta qscnt
0021BB  3               
0021BB  3  A9 00        	lda #<sprtab 		; sprite table.
0021BD  3  85 rr        	sta z80_x
0021BF  3  A9 0B        	lda #>sprtab
0021C1  3  85 rr        	sta z80_i
0021C3  3               bsort0:
0021C3  3  A0 00        	ldy #0
0021C5  3  B1 rr        	lda (z80_ix),y 		; first sprite type.
0021C7  3  C9 FF        	cmp #255 		; is it switched off?
0021C9  3  F0 30        	beq swemp		; yes, may need to switch another in here.
0021CB  3               
0021CB  3  A0 11        	ldy #TABSIZ
0021CD  3  B1 rr        	lda (z80_ix),y 		; check next slot exists.
0021CF  3  C9 FF        	cmp #255 		; is it enabled?
0021D1  3  F0 0A        	beq bsort2 		; no, nothing to swap.
0021D3  3               
0021D3  3  A0 14        	ldy #TABSIZ+3
0021D5  3  B1 rr        	lda (z80_ix),y 		; fetch next sprite's coordinate.
0021D7  3  A0 03        	ldy #3
0021D9  3  D1 rr        	cmp (z80_ix),y 		; compare with this x coordinate.
0021DB  3  90 10        	bcc bsort1		; next sprite is higher - may need to switch.
0021DD  3               bsort2:
0021DD  3  18           	clc
0021DE  3  A5 rr        	lda z80_x
0021E0  3  69 11        	adc #TABSIZ 		; distance to next odd/even entry.
0021E2  3  85 rr        	sta z80_x
0021E4  3  90 02        	bcc :+
0021E6  3  E6 rr        	inc z80_i
0021E8  3               :
0021E8  3  C6 rr        	dec qscnt
0021EA  3  D0 D7        	bne bsort0		; repeat for remaining sprites.
0021EC  3  60           	rts
0021ED  3               
0021ED  3               bsort1:
0021ED  3  A0 11        	ldy #TABSIZ
0021EF  3  B1 rr        	lda (z80_ix),y		; sprite on/off flag.
0021F1  3  C9 FF        	cmp #255		; is it enabled?
0021F3  3  F0 E8        	beq bsort2		; no, nothing to swap.
0021F5  3  20 09 22     	jsr swspr		; swap positions.
0021F8  3  4C DD 21     	jmp bsort2
0021FB  3               swemp:
0021FB  3  A0 11        	ldy #TABSIZ
0021FD  3  B1 rr        	lda (z80_ix),y		; next table entry.
0021FF  3  C9 FF        	cmp #255		; is that one on?
002201  3  F0 DA        	beq bsort2		; no, nothing to swap.
002203  3  20 09 22     	jsr swspr		; swap positions.
002206  3  4C DD 21     	jmp bsort2
002209  3               
002209  3               ; Swap sprites.
002209  3               
002209  3               swspr:
002209  3  A5 rr        	lda z80_x		; table address
00220B  3  85 rr        	sta z80_e		; copy to de pair.
00220D  3  85 rr        	sta z80_l		; copy to hl pair.
00220F  3  A5 rr        	lda z80_i
002211  3  85 rr        	sta z80_h
002213  3  85 rr        	sta z80_d
002215  3               
002215  3  18           	clc
002216  3  A5 rr        	lda z80_l
002218  3  69 11        	adc #TABSIZ		; distance to second entry.
00221A  3  85 rr        	sta z80_l
00221C  3  90 02        	bcc :+
00221E  3  E6 rr        	inc z80_h
002220  3               :
002220  3  A9 11        	lda #TABSIZ		; bytes to swap.
002222  3  85 rr        	sta z80_b
002224  3  A0 00        	ldy #0
002226  3               swspr0:
002226  3  B1 rr        	lda (z80_hl),y		; fetch second byte.
002228  3  48           	pha
002229  3  B1 rr        	lda (z80_de),y 		; fetch first byte.
00222B  3  91 rr        	sta (z80_hl),y 		; copy to second.
00222D  3  68           	pla
00222E  3  91 rr        	sta (z80_de),y 		; copy to first sprite entry.
002230  3               
002230  3  E6 rr        	inc z80_e 		; next byte.
002232  3  D0 02        	bne :+
002234  3  E6 rr        	inc z80_d
002236  3               :
002236  3  E6 rr        	inc z80_l 		; next byte.
002238  3  D0 02        	bne :+
00223A  3  E6 rr        	inc z80_h
00223C  3               :
00223C  3  C6 rr        	dec z80_b
00223E  3  D0 E6        	bne swspr0 		; swap all bytes in table entry.
002240  3  60           	rts
002241  3               
002241  3               ;----------------------------------------------------
002241  3               ; Process sprites.
002241  3               ;----------------------------------------------------
002241  3               
002241  3               pspr:
002241  3  A9 0C        	lda #NUMSPR		; sprites to process.
002243  3  85 rr        	sta sprptr
002245  3               
002245  3  A9 00        	lda #<sprtab 		; sprite table.
002247  3  85 rr        	sta z80_x
002249  3  A9 0B        	lda #>sprtab
00224B  3  85 rr        	sta z80_i
00224D  3               pspr1:
00224D  3  A0 00        	ldy #0
00224F  3  B1 rr        	lda (z80_ix),y		; fetch sprite type.
002251  3  C9 09        	cmp #9 			; within range of sprite types?
002253  3  B0 03        	bcs :+
002255  3  20 68 22     	jsr pspr2 		; yes, process this one.
002258  3               :
002258  3  18           	clc
002259  3  A5 rr        	lda z80_x
00225B  3  69 11        	adc #TABSIZ 		; distance to next odd/even entry.
00225D  3  85 rr        	sta z80_x
00225F  3  90 02        	bcc :+
002261  3  E6 rr        	inc z80_i		; next sprite.
002263  3               :
002263  3  C6 rr        	dec sprptr 		; repeat for remaining sprites.
002265  3  D0 E6        	bne pspr1
002267  3  60           	rts
002268  3               
002268  3               pspr2:
002268  3  A5 rr        	lda z80_x 		; store original sprite pointer.
00226A  3  85 rr        	sta ogptr
00226C  3  A5 rr        	lda z80_i
00226E  3  85 rr        	sta ogptr+1
002270  3  20 7C 22     	jsr pspr3		; do the routine.
002273  3               rtorg:
002273  3  A5 rr        	lda ogptr 		; restore original pointer to sprite.
002275  3  85 rr        	sta z80_x
002277  3  A5 rr        	lda ogptr+1
002279  3  85 rr        	sta z80_i
00227B  3               rtorg0:
00227B  3  60           	rts
00227C  3               
00227C  3               pspr3:
00227C  3  A9 B1        	lda #<evtyp0		; sprite type events list.
00227E  3  85 rr        	sta z80_l
002280  3  A9 22        	lda #>evtyp0
002282  3  85 rr        	sta z80_h
002284  3               pspr4:
002284  3  B1 rr        	lda (z80_ix),y
002286  3  0A           	asl a			; double accumulator.
002287  3  18           	clc
002288  3  65 rr        	adc z80_l
00228A  3  85 rr        	sta z80_l
00228C  3  90 02        	bcc :+
00228E  3  E6 rr        	inc z80_h
002290  3               :
002290  3  B1 rr        	lda (z80_hl),y
002292  3  85 rr        	sta z80_e 		; copy to de.
002294  3  48           	pha
002295  3               
002295  3  E6 rr        	inc z80_l 		; next byte of address.
002297  3  D0 02        	bne :+
002299  3  E6 rr        	inc z80_h
00229B  3               :
00229B  3  B1 rr        	lda (z80_hl),y 		; address high.
00229D  3  85 rr        	sta z80_d
00229F  3               
00229F  3  48           	pha	 		; swap address into hl.
0022A0  3  A5 rr        	lda z80_h
0022A2  3  85 rr        	sta z80_d
0022A4  3  68           	pla
0022A5  3  85 rr        	sta z80_h
0022A7  3  68           	pla
0022A8  3  85 rr        	sta z80_l
0022AA  3  A5 rr        	lda z80_l
0022AC  3  85 rr        	sta z80_e
0022AE  3               
0022AE  3  6C rr rr     	jmp (z80_hl) 		; go there.
0022B1  3               
0022B1  3               ; Address of each sprite type's routine.
0022B1  3               
0022B1  3  44 28        evtyp0:	.word evnt00
0022B3  3  E1 32        evtyp1:	.word evnt01
0022B5  3  ED 3B        evtyp2:	.word evnt02
0022B7  3  8C 3D        evtyp3:	.word evnt03
0022B9  3  0F 41        evtyp4:	.word evnt04
0022BB  3  6A 42        evtyp5:	.word evnt05
0022BD  3  B7 45        evtyp6:	.word evnt06
0022BF  3  21 48        evtyp7:	.word evnt07
0022C1  3  26 4B        evtyp8:	.word evnt08
0022C3  3               
0022C3  3               ;--------------------------------------------------------------
0022C3  3               ; Display sprites.
0022C3  3               ;
0022C3  3               ; Input:
0022C3  3               ;  IX = sprite table
0022C3  3               ;--------------------------------------------------------------
0022C3  3               
0022C3  3               dspr:
0022C3  3  A9 06        	lda #(NUMSPR/2)		; number of sprites to display.
0022C5  3  85 rr        	sta sprcnt
0022C7  3               
0022C7  3               dspr0:
0022C7  3  A0 00        	ldy #var_Type
0022C9  3  B1 rr        	lda (z80_ix),y 		; get sprite type.
0022CB  3  C9 FF        	cmp #255 			; is it enabled?
0022CD  3  D0 45        	bne dspr1 			; yes, it needs deleting.
0022CF  3               
0022CF  3               dspr5:
0022CF  3  A0 05        	ldy #var_newType
0022D1  3  B1 rr        	lda (z80_ix),y 		; new type.
0022D3  3  C9 FF        	cmp #255			; is it enabled?
0022D5  3  F0 03        	beq dspr2			; no, skip
0022D7  3  4C 63 23     	jmp dspr3 			; yes, it needs drawing.
0022DA  3               
0022DA  3               dspr2:
0022DA  3  A0 05        	ldy #var_newType
0022DC  3  B1 rr        	lda (z80_ix),y 		; copy new type.
0022DE  3  A0 00        	ldy #var_Type
0022E0  3  91 rr        	sta (z80_ix),y
0022E2  3  A0 06        	ldy #var_newImage
0022E4  3  B1 rr        	lda (z80_ix),y 		; copy new image number.
0022E6  3  A0 01        	ldy #var_Image
0022E8  3  91 rr        	sta (z80_ix),y
0022EA  3  A0 07        	ldy #var_newFrame
0022EC  3  B1 rr        	lda (z80_ix),y 		; copy new frame.
0022EE  3  A0 02        	ldy #var_Frame
0022F0  3  91 rr        	sta (z80_ix),y
0022F2  3  A0 08        	ldy #var_newY
0022F4  3  B1 rr        	lda (z80_ix),y 		; copy new y.
0022F6  3  A0 03        	ldy #var_Y
0022F8  3  91 rr        	sta (z80_ix),y
0022FA  3  A0 09        	ldy #var_newX
0022FC  3  B1 rr        	lda (z80_ix),y 		; copy new x.
0022FE  3  A0 04        	ldy #var_X
002300  3  91 rr        	sta (z80_ix),y
002302  3               
002302  3  18           	clc
002303  3  A5 rr        	lda z80_x
002305  3  69 22        	adc #(TABSIZ*2)		; distance to next odd/even entry.
002307  3  85 rr        	sta z80_x
002309  3  A5 rr        	lda z80_i
00230B  3  69 00        	adc #0
00230D  3  85 rr        	sta z80_i 			; next sprite.
00230F  3  C6 rr        	dec sprcnt
002311  3  D0 B4        	bne dspr0			; repeat for remaining sprites.
002313  3  60           	rts
002314  3               
002314  3               dspr1:
002314  3               	; _BEEB clipping code copied from CPC Engine
002314  3  A0 03        	ldy #var_Y
002316  3  B1 rr        	lda (z80_ix), y		; old x coord
002318  3  C9 B1        	cmp #SpriteMaxY     ; beyond maximum?
00231A  3  B0 B3        	bcs dspr5			; yes, don't delete it.
00231C  3               
00231C  3  A0 05        	ldy #var_newType
00231E  3  B1 rr        	lda (z80_ix),y 		; type of new sprite.
002320  3  C9 FF        	cmp #255			; is this enabled?
002322  3  D0 06        	bne dspr4 			; yes, display both.
002324  3               
002324  3               dspr6:
002324  3  20 D1 0F     	jsr sspria 			; show single sprite.
002327  3  4C DA 22     	jmp dspr2
00232A  3               
00232A  3               ; Displaying two sprites.  Don't bother redrawing if nothing has changed.
00232A  3               
00232A  3               dspr4:
00232A  3               	; _BEEB clipping code copied from CPC Engine
00232A  3  A0 08        	ldy #var_newY
00232C  3  B1 rr        	lda (z80_ix), y		; old x coord
00232E  3  C9 B1        	cmp #SpriteMaxY     ; beyond maximum?
002330  3  B0 F2        	bcs dspr6			; yes, don't display it.
002332  3               
002332  3  A0 04        	ldy #var_X
002334  3  B1 rr        	lda (z80_ix),y		; old x.
002336  3  A0 09        	ldy #var_newX
002338  3  D1 rr        	cmp (z80_ix),y 		; compare with new value.
00233A  3  D0 21        	bne dspr7 			; they differ, need to redraw.
00233C  3               
00233C  3  A0 03        	ldy #var_Y
00233E  3  B1 rr        	lda (z80_ix),y		; old y.
002340  3  A0 08        	ldy #var_newY
002342  3  D1 rr        	cmp (z80_ix),y 		; compare against new value.
002344  3  D0 17        	bne dspr7			; they differ, need to redraw.
002346  3               
002346  3  A0 02        	ldy #var_Frame
002348  3  B1 rr        	lda (z80_ix),y 		; old frame.
00234A  3  A0 07        	ldy #var_newFrame
00234C  3  D1 rr        	cmp (z80_ix),y 		; compare against new value.
00234E  3  D0 0D        	bne dspr7 			; they differ, need to redraw.
002350  3               
002350  3  A0 01        	ldy #var_Image
002352  3  B1 rr        	lda (z80_ix),y 		; old image.
002354  3  A0 06        	ldy #var_newImage
002356  3  D1 rr        	cmp (z80_ix),y 		; compare against new value.
002358  3  D0 03        	bne dspr7 			; they differ, need to redraw.
00235A  3  4C DA 22     	jmp dspr2			; everything is the same, don't redraw.
00235D  3               
00235D  3               dspr7:
00235D  3  20 08 10     	jsr sspric 			; delete old sprite, draw new one simultaneously.
002360  3  4C DA 22     	jmp dspr2
002363  3               
002363  3               dspr3:
002363  3               	; _BEEB clipping code copied from CPC Engine
002363  3  A0 08        	ldy #var_newY
002365  3  B1 rr        	lda (z80_ix), y		; old x coord
002367  3  C9 B1        	cmp #SpriteMaxY     ; beyond maximum?
002369  3  90 03        	bcc :+				; no, continue
00236B  3  4C DA 22     	jmp dspr2			; yes, don't display it.
00236E  3               :
00236E  3  20 02 10     	jsr ssprib 			; show single sprite.
002371  3  4C DA 22     	jmp dspr2
002374  3               
002374  3               ;-----------------------------------------
002374  3               ; Get sprite address calculations.
002374  3               ; gspran = new sprite, gsprad = old sprite.
002374  3               ;
002374  3               ; Input:
002374  3               ;  IX = sprite address
002374  3               ;-----------------------------------------
002374  3               
002374  3               gspran:
002374  3  A0 08        	ldy #var_newY
002376  3  B1 rr        	lda (z80_ix),y 		; new y coordinate.
002378  3  85 rr        	sta dispy
00237A  3  A0 09        	ldy #var_newX
00237C  3  B1 rr        	lda (z80_ix),y 		; new x coordinate.
00237E  3  85 rr        	sta dispx
002380  3  A0 06        	ldy #var_newImage
002382  3  B1 rr        	lda (z80_ix),y 		; new sprite image.
002384  3  20 4C 26     	jsr gfrm		; fetch start frame for this sprite.
002387  3               
002387  3  A0 00        	ldy #0
002389  3  B1 rr        	lda (z80_hl),y 		; frame in accumulator.
00238B  3  A0 07        	ldy #var_newFrame
00238D  3  18           	clc
00238E  3  71 rr        	adc (z80_ix),y 		; new add frame number.
002390  3  4C AF 23     	jmp gspra0
002393  3               
002393  3               ;-----------------------------------------
002393  3               ; Calculate old sprite address
002393  3               ;
002393  3               ; Input:
002393  3               ;  IX = sprite address
002393  3               ;
002393  3               ; Output:
002393  3               ;  B  = right byte mask
002393  3               ;  C  = left byte mask
002393  3               ;  DE = spriteframe address
002393  3               ;  scraddr = screenaddress(dispx,dispy)
002393  3               ;-----------------------------------------
002393  3               
002393  3               gsprad:
002393  3  A0 03        	ldy #var_Y
002395  3  B1 rr        	lda (z80_ix),y		; y coordinate.
002397  3  85 rr        	sta dispy
002399  3  A0 04        	ldy #var_X
00239B  3  B1 rr        	lda (z80_ix),y		; x coordinate.
00239D  3  85 rr        	sta dispx
00239F  3  A0 01        	ldy #var_Image
0023A1  3  B1 rr        	lda (z80_ix),y 		; sprite image.
0023A3  3  20 4C 26     	jsr gfrm 		; fetch start frame for this sprite.
0023A6  3               
0023A6  3  A0 00        	ldy #0
0023A8  3  B1 rr        	lda (z80_hl),y 		; frame in accumulator.
0023AA  3  A0 02        	ldy #var_Frame
0023AC  3  18           	clc
0023AD  3  71 rr        	adc (z80_ix),y 		; add frame number.
0023AF  3               
0023AF  3               gspra0:
0023AF  3               .if 0
0023AF  3               	lsr a	  		; multiply by 128.
0023AF  3               	sta z80_d 		; store in d.
0023AF  3               	lda #0
0023AF  3               	ror a
0023AF  3               	sta z80_e 		; got low byte.
0023AF  3               .else
0023AF  3  85 rr        	sta z80_e
0023B1  3  A9 00        	lda #0
0023B3  3  85 rr        	sta z80_d
0023B5  3               
0023B5  3  06 rr        	asl z80_e
0023B7  3  26 rr        	rol z80_d
0023B9  3  06 rr        	asl z80_e
0023BB  3  26 rr        	rol z80_d
0023BD  3  06 rr        	asl z80_e
0023BF  3  26 rr        	rol z80_d
0023C1  3  06 rr        	asl z80_e
0023C3  3  26 rr        	rol z80_d
0023C5  3  06 rr        	asl z80_e
0023C7  3  26 rr        	rol z80_d
0023C9  3               
0023C9  3               .endif
0023C9  3               
0023C9  3  18           	clc 			; address of play sprites.
0023CA  3  A5 rr        	lda z80_e
0023CC  3  69 39        	adc #<sprgfx
0023CE  3  85 rr        	sta z80_e
0023D0  3  A5 rr        	lda z80_d
0023D2  3  69 57        	adc #>sprgfx
0023D4  3  85 rr        	sta z80_d
0023D6  3               
0023D6  3  A5 rr        	lda dispx 		; y coordinate.
0023D8  3  29 06        	and #6 			; position within byte boundary.
0023DA  3  AA           	tax	 		; low byte of table displacement.
0023DB  3  86 rr        	stx sprshft
0023DD  3               
0023DD  3               .if 0
0023DD  3               	asl a	  		; multiply by 32.
0023DD  3               	asl a  			; already a multiple
0023DD  3               	asl a  			; of 2, so just 4
0023DD  3               	asl a  			; shifts needed.
0023DD  3               
0023DD  3               	clc 			; add to sprite address.
0023DD  3               	adc z80_e
0023DD  3               	sta z80_e
0023DD  3               	bcc :+
0023DD  3               	inc z80_d
0023DD  3               :
0023DD  3               .endif
0023DD  3               
0023DD  3  BD EA 23     	lda spmask,x		 ; pointer to mask table.
0023E0  3  85 rr        	sta z80_c 		; left mask.
0023E2  3  BD EB 23     	lda spmask+1,x
0023E5  3  85 rr        	sta z80_b 		; right mask.
0023E7  3               ; Drop into screen address routine.
0023E7  3  4C BD 0F     	jmp scadd
0023EA  3               
0023EA  3  FF 00 3F C0  spmask:	.byte 255,0,63,192,15,240,3,252
0023EE  3  0F F0 03 FC  
0023F2  3               
0023F2  3               
0023F2  3               ;-----------------------------------------------------------
0023F2  3               ; Animates a sprite.
0023F2  3               ;
0023F2  3               ; Input:
0023F2  3               ;  IX = sprite address
0023F2  3               ;  HL = last sprite address
0023F2  3               ;-----------------------------------------------------------
0023F2  3               
0023F2  3               animsp:
0023F2  3  25 rr        	and frmno
0023F4  3  F0 01        	beq :+
0023F6  3  60           	rts
0023F7  3               :
0023F7  3  A0 06        	ldy #var_newImage
0023F9  3  B1 rr        	lda (z80_ix),y		; sprite image
0023FB  3  20 4C 26     	jsr gfrm		; get frame data.
0023FE  3               
0023FE  3  E6 rr        	inc z80_l		; point to frames.
002400  3  D0 02        	bne :+
002402  3  E6 rr        	inc z80_h
002404  3               :
002404  3  A0 07        	ldy #var_newFrame
002406  3  B1 rr        	lda (z80_ix),y		; sprite frame.
002408  3  18           	clc
002409  3  69 01        	adc #1			; next one along.
00240B  3  A0 00        	ldy #0
00240D  3  D1 rr        	cmp (z80_hl),y		; reached the last frame?
00240F  3  90 02        	bcc anims0		; no, not yet.
002411  3  A9 00        	lda #0			; start at first frame.
002413  3               anims0:
002413  3  A0 07        	ldy #var_newFrame
002415  3  91 rr        	sta (z80_ix),y		; new frame.
002417  3  60           	rts
002418  3               
002418  3               ;--------------------------------------------------------------
002418  3               ; Animate back
002418  3               ;
002418  3               ; Input:
002418  3               ;  IX = sprite address
002418  3               ;  HL = last sprite address
002418  3               ;--------------------------------------------------------------
002418  3               
002418  3               animbk:
002418  3  25 rr        	and frmno
00241A  3  F0 01        	beq :+
00241C  3  60           	rts
00241D  3               :
00241D  3  A0 06        	ldy #var_newImage
00241F  3  B1 rr        	lda (z80_ix),y		; sprite image.
002421  3  20 4C 26     	jsr gfrm		; get frame data.
002424  3               
002424  3  E6 rr        	inc z80_l 		; point to frames.
002426  3  D0 02        	bne :+
002428  3  E6 rr        	inc z80_h
00242A  3               :
00242A  3  A0 07        	ldy #var_newFrame
00242C  3  B1 rr        	lda (z80_ix),y 		; sprite frame.
00242E  3  F0 03        	beq :+
002430  3  4C 37 24     	jmp rtanb0 		; yes, start at end.
002433  3               :
002433  3  A0 00        	ldy #0
002435  3  B1 rr        	lda (z80_hl),y 		; last sprite.
002437  3               rtanb0:
002437  3  38           	sec
002438  3  E9 01        	sbc #1			; next one along.
00243A  3  4C 13 24     	jmp anims0		; set new frame.
00243D  3               
00243D  3               ;--------------------------------------------------------------
00243D  3               ; Check for collision with other sprite, strict enforcement.
00243D  3               ;
00243D  3               ; Input:
00243D  3               ;  b		= sprite to test for
00243D  3               ;  ix		= current sprite pointer
00243D  3               ;
00243D  3               ; global:	b
00243D  3               ; local:	x,y,hl,de,skptr
00243D  3               ; calls:	-
00243D  3               ;--------------------------------------------------------------
00243D  3               
00243D  3               sktyp:
00243D  3  A9 00        	lda #<sprtab				; sprite table.
00243F  3  85 rr        	sta z80_l
002441  3  A9 0B        	lda #>sprtab
002443  3  85 rr        	sta z80_h
002445  3               numsp2:
002445  3  A9 0C        	lda #NUMSPR				; number of sprites.
002447  3  85 rr        	sta sktptr
002449  3               sktyp0:
002449  3  A5 rr        	lda z80_l 				; store pointer to sprite.
00244B  3  85 rr        	sta skptr
00244D  3  A5 rr        	lda z80_h
00244F  3  85 rr        	sta skptr+1
002451  3               
002451  3  A0 00        	ldy #0
002453  3  B1 rr        	lda (z80_hl),y 				; get sprite type.
002455  3  C5 rr        	cmp z80_b				; is it the type we seek?
002457  3  F0 1D        	beq coltyp				; yes, we can use this one.
002459  3               :
002459  3               sktyp1:
002459  3  18           	clc
00245A  3  A5 rr        	lda skptr				; retrieve sprite pointer.
00245C  3  69 11        	adc #TABSIZ				; size of each entry.
00245E  3  85 rr        	sta z80_l
002460  3  A5 rr        	lda skptr+1
002462  3  69 00        	adc #0
002464  3  85 rr        	sta z80_h
002466  3  C6 rr        	dec sktptr					; one less iteration.
002468  3  D0 DF        	bne sktyp0				; keep going until we find a slot.
00246A  3               :
00246A  3  A9 00        	lda #0					; default to ROM address - no sprite.
00246C  3  85 rr        	sta z80_l
00246E  3  85 rr        	sta z80_h
002470  3  85 rr        	sta skptr				; store pointer to sprite.
002472  3  85 rr        	sta skptr+1
002474  3               
002474  3  18           	clc					; don't return with zero flag set.
002475  3  60           	rts 					; didn't find one.
002476  3               
002476  3               coltyp:
002476  3  A0 00        	ldy #0
002478  3  B1 rr        	lda (z80_ix),y				; current sprite type.
00247A  3  C5 rr        	cmp z80_b				; seeking sprite of same type?
00247C  3  F0 3D        	beq colty1				; yes, need to check we're not detecting ourselves.
00247E  3               colty0:
00247E  3  A0 09        	ldy #9					; distance to x position in table.
002480  3  B1 rr        	lda (z80_hl),y				; fetch x coordinate.
002482  3  85 rr        	sta z80_e
002484  3  88           	dey
002485  3  B1 rr        	lda (z80_hl),y				; fetch y coordinate.
002487  3  85 rr        	sta z80_d
002489  3               
002489  3               ; Drop into collision detection.
002489  3               
002489  3               colc16:
002489  3  A0 09        	ldy #9
00248B  3  B1 rr        	lda (z80_ix),y			 	; x coord.
00248D  3  38           	sec					; subtract x.
00248E  3  E5 rr        	sbc z80_e
002490  3  B0 05        	bcs  colc1a 				; result is positive.
002492  3  49 FF        	eor #$ff				; make negative positive.
002494  3  18           	clc
002495  3  69 01        	adc #1
002497  3               colc1a:
002497  3  C9 10        	cmp #16 				; within x range?
002499  3  B0 BE        	bcs sktyp1				; no - they"ve missed.
00249B  3  85 rr        	sta z80_c				; store difference.
00249D  3               
00249D  3  A0 08        	ldy #8
00249F  3  B1 rr        	lda (z80_ix),y				; y coord.
0024A1  3  38           	sec
0024A2  3  E5 rr        	sbc z80_d				; subtract y.
0024A4  3  B0 05        	bcs colc1b				; result is positive.
0024A6  3  49 FF        	eor #$ff				; make negative positive.
0024A8  3  18           	clc
0024A9  3  69 01        	adc #1
0024AB  3               colc1b:
0024AB  3  C9 10        	cmp #16					; within y range?
0024AD  3  B0 AA        	bcs sktyp1 				; no - they've missed.
0024AF  3  18           	clc					; add x difference.
0024B0  3  65 rr        	adc z80_c
0024B2  3  C9 1A        	cmp #26					; only 5 corner pixels touching?
0024B4  3  B0 02        	bcs :+
0024B6  3  38           	sec
0024B7  3  60           	rts 					; carry set if there's a collision.
0024B8  3               :
0024B8  3  4C 59 24     	jmp sktyp1				; try next sprite in table.
0024BB  3               colty1:
0024BB  3  A5 rr        	lda z80_x  				; compare the two.
0024BD  3  C5 rr        	cmp z80_l
0024BF  3  D0 09        	bne end_col
0024C1  3  A5 rr        	lda z80_i
0024C3  3  C5 rr        	cmp z80_h
0024C5  3  D0 03        	bne end_col
0024C7  3  4C 59 24     	jmp sktyp1 				; addresses are identical.
0024CA  3               end_col:
0024CA  3  4C 7E 24     	jmp colty0
0024CD  3               
0024CD  3               ;-----------------------------------------------------------
0024CD  3               ; Display number, left aligned
0024CD  3               ;
0024CD  3               ; Input:
0024CD  3               ;  a		= number
0024CD  3               ;
0024CD  3               ; global:	-
0024CD  3               ; local:	a,y,bc,hl,displ0
0024CD  3               ; calls:	num2ch,dmsg3
0024CD  3               ;-----------------------------------------------------------
0024CD  3               
0024CD  3               disply:
0024CD  3  85 rr        	sta z80_a
0024CF  3  A9 F5        	lda #<displ0				; display workspace.
0024D1  3  85 rr        	sta z80_c
0024D3  3  A9 24        	lda #>displ0
0024D5  3  85 rr        	sta z80_b
0024D7  3  A5 rr        	lda z80_a
0024D9  3  20 43 18     	jsr num2ch				; convert accumulator to string.
0024DC  3               displ1:
0024DC  3  C6 rr        	dec z80_c				; back one character.
0024DE  3  D0 02        	bne :+
0024E0  3  C6 rr        	dec z80_b
0024E2  3               :
0024E2  3  A0 00        	ldy #0
0024E4  3  B1 rr        	lda (z80_bc),y				; fetch digit.
0024E6  3  09 80        	ora #128				; insert end marker.
0024E8  3  91 rr        	sta (z80_bc),y				; new value.
0024EA  3               
0024EA  3  A9 F5        	lda #<displ0				; display space.
0024EC  3  85 rr        	sta z80_l
0024EE  3  A9 24        	lda #>displ0
0024F0  3  85 rr        	sta z80_h
0024F2  3  4C 8B 20     	jmp dmsg3				; display the string.
0024F5  3               
0024F5  3  00 00 00 8D  displ0:	.byte 0,0,0,13+128
0024F9  3               
0024F9  3               ;----------------------------------------------------------------
0024F9  3               ; Initialise screen.
0024F9  3               ;
0024F9  3               ; global:	roomtb,scno
0024F9  3               ; local:	-
0024F9  3               ; calls:	tstcs
0024F9  3               ;----------------------------------------------------------------
0024F9  3               
0024F9  3               initsc:
0024F9  3  AD 38 28     	lda roomtb 			; whereabouts in the map are we?
0024FC  3  20 06 25     	jsr tstsc 			; find displacement.
0024FF  3  C9 FF        	cmp #255 			; is it valid?
002501  3  F0 02        	beq init_end 			; no, it's rubbish.
002503  3  85 rr        	sta scno			; store new room number.
002505  3               init_end:
002505  3  60           	rts
002506  3               
002506  3               ;----------------------------------------------------------------
002506  3               ; Test screen.
002506  3               ;
002506  3               ; global:	-
002506  3               ; local:	x
002506  3               ; calls:	-
002506  3               ;----------------------------------------------------------------
002506  3               
002506  3               tstsc:
002506  3  85 rr        	sta tmproom
002508  3  18           	clc
002509  3  69 03        	adc #MAPWID 			; add width in case we"re negative.
00250B  3  AA           	tax 				; add displacement to map data.
00250C  3  BD 3A 28     	lda mapdat-MAPWID,x 		; find room number there.
00250F  3  60           	rts
002510  3               
002510  3               ;--------------------------
002510  3               ; Screen left.
002510  3               ;--------------------------
002510  3               
002510  3               scrl:
002510  3  AD 38 28     	lda roomtb 			; present room table pointer.
002513  3  38           	sec
002514  3  E9 01        	sbc #1				; room left.
002516  3               scrl0:
002516  3  20 06 25     	jsr tstsc			; test screen.
002519  3  C9 FF        	cmp #255			; is there a screen this way?
00251B  3  D0 01        	bne :+
00251D  3  60           	rts				; no, return to loop.
00251E  3               :
00251E  3  A5 rr        	lda tmproom			; restore room displacement.
002520  3  8D 38 28     	sta roomtb			; new room table position.
002523  3               scrl1:
002523  3  20 F9 24     	jsr initsc 			; set new screen.
002526  3  A9 02        	lda #2
002528  3  85 rr        	sta restfl 			; set it.
00252A  3  60           	rts
00252B  3               scrr:
00252B  3  AD 38 28     	lda roomtb 			; room table pointer.
00252E  3  18           	clc
00252F  3  69 01        	adc #1				; room right.
002531  3  4C 16 25     	jmp scrl0
002534  3               scru:
002534  3  AD 38 28     	lda roomtb 			; room table pointer.
002537  3  38           	sec
002538  3  E9 03        	sbc #MAPWID 			; room up.
00253A  3  4C 16 25     	jmp scrl0
00253D  3               scrd:
00253D  3  AD 38 28     	lda roomtb 			; room table pointer.
002540  3  18           	clc
002541  3  69 03        	adc #MAPWID 			; room down.
002543  3  4C 16 25     	jmp scrl0
002546  3               
002546  3               ;-----------------------------------------
002546  3               ; Jump to new screen.
002546  3               ;-----------------------------------------
002546  3               
002546  3               nwscr:
002546  3  A2 00        	ldx #0				; start of map data.
002548  3               nwscr0:
002548  3  DD 3D 28     	cmp mapdat,x
00254B  3  F0 06        	beq nwscr1			; have we found a match for screen?
00254D  3  E8           	inx 				; next room.
00254E  3  E0 50        	cpx #80				; zero room count, 80 to search.
002550  3  D0 F6        	bne nwscr0			; keep looking.
002552  3  60           	rts
002553  3               nwscr1:
002553  3  8E 38 28     	stx roomtb			; set the map position.
002556  3  4C 23 25     	jmp scrl1			; draw new room.
002559  3               
002559  3               
002559  3               ;----------------------------------------------------------
002559  3               ; Gravity processing.
002559  3               ;----------------------------------------------------------
002559  3               
002559  3               grav:
002559  3  A0 0D        	ldy #var_jumpLo
00255B  3  B1 rr        	lda (z80_ix),y			; jump pointer low.
00255D  3  85 rr        	sta z80_l
00255F  3  A0 0E        	ldy #var_jumpHi
002561  3  B1 rr        	lda (z80_ix),y			; jump pointer high.
002563  3  85 rr        	sta z80_h
002565  3  05 rr        	ora z80_l			; merge in low byte.
002567  3  D0 01        	bne :+
002569  3  60           	rts				; if neither is set, we're not in the air.
00256A  3               :
00256A  3  A0 00        	ldy #0
00256C  3  B1 rr        	lda (z80_hl),y			; pixels to move.
00256E  3  85 rr        	sta z80_a
002570  3  C9 63        	cmp #99				; reached the end?
002572  3  D0 06        	bne grav0			; no, continue.
002574  3               grav2:
002574  3  C6 rr        	dec z80_l			; go back to previous value.
002576  3               	; 6502 WARNING - not updating 16-bit pointer properly!
002576  3  B1 rr        	lda (z80_hl),y			; fetch that from table.
002578  3  85 rr        	sta z80_a
00257A  3               grav0:
00257A  3  E6 rr        	inc z80_l			; point to next table entry.
00257C  3               	; 6502 WARNING - not updating 16-bit pointer properly!
00257C  3  A5 rr        	lda z80_l
00257E  3  A0 0D        	ldy #var_jumpLo
002580  3  91 rr        	sta (z80_ix),y			; store new pointer low.
002582  3  A5 rr        	lda z80_h
002584  3  A0 0E        	ldy #var_jumpHi
002586  3  91 rr        	sta (z80_ix),y			; store new pointer high.
002588  3               grav1:
002588  3  A5 rr        	lda z80_a
00258A  3  D0 01        	bne :+				; any movement required?
00258C  3  60           	rts				; no, not this time.
00258D  3               :
00258D  3  A5 rr        	lda z80_a
00258F  3  C9 80        	cmp #128			; is it up or down?
002591  3  B0 15        	bcs gravu			; it's up.
002593  3               gravd:
002593  3  85 rr        	sta z80_b			; set pixels to move.
002595  3               gravd0:
002595  3  20 D1 1D     	jsr cangd			; can we go down?
002598  3  D0 28        	bne gravst			; can't move down, so stop.
00259A  3  A0 08        	ldy #8
00259C  3  B1 rr        	lda (z80_ix),y			; adjust new x coord.
00259E  3  18           	clc
00259F  3  69 01        	adc #1
0025A1  3  91 rr        	sta (z80_ix),y
0025A3  3  C6 rr        	dec z80_b
0025A5  3  D0 EE        	bne gravd0
0025A7  3  60           	rts
0025A8  3               gravu:
0025A8  3  49 FF        	eor #$ff			; flip the sign so it's positive.
0025AA  3  18           	clc
0025AB  3  69 01        	adc #1
0025AD  3  85 rr        	sta z80_b			; set pixels to move.
0025AF  3               gravu0:
0025AF  3  20 9C 1D     	jsr cangu			; can we go up?
0025B2  3  D0 6E        	bne ifalls			; can't move up, go down next.
0025B4  3  A0 08        	ldy #8
0025B6  3  B1 rr        	lda (z80_ix),y
0025B8  3  38           	sec
0025B9  3  E9 01        	sbc #1
0025BB  3  91 rr        	sta (z80_ix),y			; adjust new x coord.
0025BD  3  C6 rr        	dec z80_b
0025BF  3  D0 EE        	bne gravu0
0025C1  3  60           	rts
0025C2  3               gravst:
0025C2  3  A0 0D        	ldy #var_jumpLo
0025C4  3  B1 rr        	lda (z80_ix),y			; jump pointer low.
0025C6  3  85 rr        	sta z80_l
0025C8  3  A0 0E        	ldy #var_jumpHi
0025CA  3  B1 rr        	lda (z80_ix),y			; jump pointer high.
0025CC  3  85 rr        	sta z80_h
0025CE  3               
0025CE  3  A9 00        	lda #0				; null value in pointer.
0025D0  3  A0 0D        	ldy #var_jumpLo
0025D2  3  91 rr        	sta (z80_ix),y			; store new pointer low.
0025D4  3  C8           	iny
0025D5  3  91 rr        	sta (z80_ix),y			; store new pointer high.
0025D7  3               
0025D7  3  A0 00        	ldy #0
0025D9  3  B1 rr        	lda (z80_hl),y			; fetch byte from table.
0025DB  3  C9 63        	cmp #99				; is it the end marker?
0025DD  3               evftf:
0025DD  3  F0 01        	beq :+				; yes, fallen too far.
0025DF  3  60           	rts
0025E0  3               :
0025E0  3  4C D3 52     	jmp evnt15			; EVENT FELLTOOFAR
0025E3  3               
0025E3  3               ;------------------------------------------------
0025E3  3               ; Initiate fall check.
0025E3  3               ;------------------------------------------------
0025E3  3               
0025E3  3               ifall:
0025E3  3  A0 0D        	ldy #var_jumpLo
0025E5  3  B1 rr        	lda (z80_ix),y 			; jump pointer low.
0025E7  3  85 rr        	sta z80_l
0025E9  3  A0 0E        	ldy #var_jumpHi
0025EB  3  B1 rr        	lda (z80_ix),y 			; jump pointer high.
0025ED  3  85 rr        	sta z80_h			; high byte in accumulator.
0025EF  3  05 rr        	ora z80_l			; merge in low byte.
0025F1  3  F0 01        	beq :+
0025F3  3  60           	rts				; if either is set, we're already in the air.
0025F4  3               :
0025F4  3  A0 09        	ldy #9
0025F6  3  B1 rr        	lda (z80_ix),y			; y coordinate.
0025F8  3  85 rr        	sta dispx
0025FA  3               numsp7:
0025FA  3  A0 08        	ldy #8
0025FC  3  B1 rr        	lda (z80_ix),y			; look x coordinate.
0025FE  3  18           	clc
0025FF  3  69 10        	adc #16				; add 16 pixels.
002601  3  85 rr        	sta dispy			; set up test coordinates.
002603  3  20 B8 1F     	jsr tstbl			; get map address.
002606  3  20 63 1E     	jsr plchk			; block, platform check.
002609  3  F0 01        	beq :+
00260B  3  60           	rts				; it's solid, don't fall.
00260C  3               :
00260C  3  E6 rr        	inc bufaddr			; look right one cell.
00260E  3  20 63 1E     	jsr plchk			; block, platform check.
002611  3  F0 01        	beq :+
002613  3  60           	rts				; it's solid, don't fall.
002614  3               :
002614  3  A5 rr        	lda dispx			; y coordinate.
002616  3  29 07        	and #7				; position straddling block cells.
002618  3  F0 08        	beq ifalls			; no more checks needed.
00261A  3  E6 rr        	inc bufaddr			; look to third cell.
00261C  3  20 63 1E     	jsr plchk			; block, platform check.
00261F  3  F0 01        	beq :+
002621  3  60           	rts				; it's solid, don't fall.
002622  3               :
002622  3               ifalls:
002622  3  A9 20        	lda #<jtab			; jump table start.
002624  3  85 rr        	sta z80_l
002626  3  A9 20        	lda #>jtab
002628  3  85 rr        	sta z80_h
00262A  3               ifal0:
00262A  3  E6 rr        	inc z80_l			; point to next value.
00262C  3  D0 02        	bne :+
00262E  3  E6 rr        	inc z80_h
002630  3               :
002630  3  A0 00        	ldy #0
002632  3  B1 rr        	lda (z80_hl),y			; fetch value.
002634  3  F0 F4        	beq ifal0			; no, get next value.
002636  3  C9 63        	cmp #99				; reached end of table?
002638  3  D0 01        	bne :+
00263A  3  60           	rts				; yes, don't fall.
00263B  3               :
00263B  3  C9 80        	cmp #128			; is it going up?
00263D  3  B0 EB        	bcs ifal0			; yes, looking for first movement down.
00263F  3               
00263F  3  A0 0D        	ldy #var_jumpLo
002641  3  A5 rr        	lda z80_l
002643  3  91 rr        	sta (z80_ix),y 			; set jump low.
002645  3  A0 0E        	ldy #var_jumpHi
002647  3  A5 rr        	lda z80_h
002649  3  91 rr        	sta (z80_ix),y 			; set jump high.
00264B  3  60           	rts
00264C  3               
00264C  3               
00264C  3               ;----------------------------------------------------
00264C  3               ; Get frame data for a particular sprite.
00264C  3               ; Input:
00264C  3               ;  a		= framenumer
00264C  3               ; Output:
00264C  3               ;  hl		= frame address
00264C  3               ;
00264C  3               ; global:	hl,frmptr
00264C  3               ; local:	-
00264C  3               ; calls:	-
00264C  3               ;----------------------------------------------------
00264C  3               
00264C  3               gfrm:
00264C  3  0A           	asl a	 		 	; multiple of 2.
00264D  3  18           	clc
00264E  3  6D 15 16     	adc frmptr 			; frames used by game.
002651  3  85 rr        	sta z80_l
002653  3  AD 16 16     	lda frmptr+1
002656  3  69 00        	adc #0
002658  3  85 rr        	sta z80_h 			; point to frame start.
00265A  3  60           	rts
00265B  3               
00265B  3               ;----------------------------------------------------
00265B  3               ; Find sprite list for current room.
00265B  3               ;
00265B  3               ; global:	hl
00265B  3               ; local:	x,y
00265B  3               ; calls:	-
00265B  3               ;----------------------------------------------------
00265B  3               
00265B  3               sprlst:
00265B  3  A9 BD        	lda #<nmedat 			; list of enemy sprites.
00265D  3  85 rr        	sta z80_l
00265F  3  A9 62        	lda #>nmedat
002661  3  85 rr        	sta z80_h
002663  3  A6 rr        	ldx scno 			; screen number.
002665  3  D0 01        	bne sprls2 			; is it the first screen?
002667  3  60           	rts 				; yes, don't need to search data.
002668  3               sprls2:
002668  3  A0 00        	ldy #0
00266A  3               sprls1:
00266A  3  B1 rr        	lda (z80_hl),y 			; fetch type of sprite.
00266C  3  C9 FF        	cmp #255			; is it an end marker?
00266E  3  F0 0E        	beq sprls0 			; yes, end of this room.
002670  3               
002670  3  18           	clc 				; point to next sprite in list.
002671  3  A5 rr        	lda z80_l
002673  3  69 04        	adc #NMESIZ
002675  3  85 rr        	sta z80_l
002677  3  90 02        	bcc :+
002679  3  E6 rr        	inc z80_h
00267B  3               :
00267B  3  4C 6A 26     	jmp sprls1 			; continue until end of room.
00267E  3               sprls0:
00267E  3  E6 rr        	inc z80_l 			; point to start of next screen.s
002680  3  D0 02        	bne :+
002682  3  E6 rr        	inc z80_h
002684  3               :
002684  3  CA           	dex
002685  3  D0 E3        	bne sprls1 			; continue until room found.
002687  3  60           	rts
002688  3               
002688  3               
002688  3               ;----------------------------------------------------
002688  3               ; Clear all but a single player sprite.
002688  3               ;
002688  3               ; global:	-
002688  3               ; local:	x,y,ix
002688  3               ; calls:	-
002688  3               ;----------------------------------------------------
002688  3               
002688  3               nspr:
002688  3  A9 0C        	lda #NUMSPR			; sprite slots in table.
00268A  3  85 rr        	sta sprcnt
00268C  3  A9 00        	lda #<sprtab 			; sprite table.
00268E  3  85 rr        	sta z80_x
002690  3  A9 0B        	lda #>sprtab
002692  3  85 rr        	sta z80_i
002694  3               nspr0:
002694  3  A0 00        	ldy #0 				; fetch sprite type.
002696  3  B1 rr        	lda (z80_ix),y 			; is it a player?
002698  3  F0 1A        	beq nspr1 			; yes, keep this one.
00269A  3               
00269A  3  A9 FF        	lda #255
00269C  3  A0 00        	ldy #0 				; fetch sprite type.
00269E  3  91 rr        	sta (z80_ix),y 			; delete sprite.
0026A0  3  A0 05        	ldy #5
0026A2  3  91 rr        	sta (z80_ix),y 			; remove next type.
0026A4  3               
0026A4  3  18           	clc	 			; next sprite.
0026A5  3  A5 rr        	lda z80_x
0026A7  3  69 11        	adc #TABSIZ 			; distance to next odd/even entry.
0026A9  3  85 rr        	sta z80_x
0026AB  3  90 02        	bcc :+
0026AD  3  E6 rr        	inc z80_i
0026AF  3               :
0026AF  3  C6 rr        	dec sprcnt	 			; one less space in the table.
0026B1  3  D0 E1        	bne nspr0
0026B3  3  60           	rts
0026B4  3               nspr1:
0026B4  3  A9 FF        	lda #255
0026B6  3  A0 00        	ldy #0
0026B8  3  91 rr        	sta (z80_ix),y 			; delete sprite.
0026BA  3               
0026BA  3  18           	clc	 			; point to next sprite.
0026BB  3  A5 rr        	lda z80_x
0026BD  3  69 11        	adc #TABSIZ 			; distance to next odd/even entry.
0026BF  3  85 rr        	sta z80_x
0026C1  3  90 02        	bcc :+
0026C3  3  E6 rr        	inc z80_i
0026C5  3               :
0026C5  3  C6 rr        	dec sprcnt	 			; one less to do.
0026C7  3  D0 01        	bne nspr2
0026C9  3  60           	rts
0026CA  3               nspr2:
0026CA  3  A9 FF        	lda #255
0026CC  3  A0 00        	ldy #0
0026CE  3  91 rr        	sta (z80_ix),y 			; delete sprite.
0026D0  3  A0 05        	ldy #5
0026D2  3  91 rr        	sta (z80_ix),y 			; remove next type.
0026D4  3               
0026D4  3  18           	clc	 			; next sprite.
0026D5  3  A5 rr        	lda z80_x
0026D7  3  69 11        	adc #TABSIZ 			; distance to next odd/even entry.
0026D9  3  85 rr        	sta z80_x
0026DB  3  90 02        	bcc :+
0026DD  3  E6 rr        	inc z80_i
0026DF  3               :
0026DF  3  C6 rr        	dec sprcnt	 			; one less space in table.
0026E1  3  D0 E7        	bne nspr2
0026E3  3  60           	rts
0026E4  3               
0026E4  3               ;----------------------------------------------------------
0026E4  3               ; Two initialisation routines.
0026E4  3               ; Initialise sprites - copy everything from list to table.
0026E4  3               ;
0026E4  3               ; global:	-
0026E4  3               ; local:	x,y,ix
0026E4  3               ; calls:	cpsp
0026E4  3               ;----------------------------------------------------------
0026E4  3               
0026E4  3               ispr:
0026E4  3  A9 0C        	lda #NUMSPR			; sprite slots in table.
0026E6  3  85 rr        	sta sprcnt
0026E8  3  A9 00        	lda #<sprtab			; sprite table.
0026EA  3  85 rr        	sta z80_x
0026EC  3  A9 0B        	lda #>sprtab
0026EE  3  85 rr        	sta z80_i
0026F0  3               ispr2:
0026F0  3  A0 00        	ldy #0
0026F2  3  B1 rr        	lda (z80_hl),y 			; fetch byte.
0026F4  3  C9 FF        	cmp #255 			; is it an end marker?
0026F6  3  D0 01        	bne :+
0026F8  3  60           	rts 				; yes, no more to do.
0026F9  3               :
0026F9  3               ispr1:
0026F9  3  A0 00        	ldy #0
0026FB  3  B1 rr        	lda (z80_ix),y 			; fetch sprite type.
0026FD  3  C9 FF        	cmp #255 			; is it enabled yet?
0026FF  3  D0 08        	bne ispr4			; yes, try another slot.
002701  3               
002701  3  A0 05        	ldy #5
002703  3  B1 rr        	lda (z80_ix),y		 	; next type.
002705  3  C9 FF        	cmp #255 			; is it enabled yet?
002707  3  F0 10        	beq ispr3 			; no, process this one.
002709  3               ispr4:
002709  3  18           	clc 				; next sprite.
00270A  3  A5 rr        	lda z80_x
00270C  3  69 11        	adc #TABSIZ		 	; distance to next odd/even entry.
00270E  3  85 rr        	sta z80_x
002710  3  90 02        	bcc :+
002712  3  E6 rr        	inc z80_i
002714  3               :
002714  3  C6 rr        	dec sprcnt
002716  3  D0 E1        	bne ispr1 			; repeat for remaining sprites.
002718  3  60           	rts  				; no more room in table.
002719  3               ispr3:
002719  3  20 6C 27     	jsr cpsp			; initialise a sprite.
00271C  3  C6 rr        	dec sprcnt			; one less space in the table.
00271E  3  D0 D0        	bne ispr2
002720  3  60           	rts
002721  3               
002721  3               
002721  3               ;-----------------------------------------------------------------------
002721  3               ; Initialise sprites - but not player, we're keeping the old one.
002721  3               ;
002721  3               ; global:	-
002721  3               ; local:	x,y,ix
002721  3               ; calls:	cpsp
002721  3               ;-----------------------------------------------------------------------
002721  3               
002721  3               kspr:
002721  3  A2 0C        	ldx #NUMSPR			; sprite slots in table.
002723  3  A9 00        	lda #<sprtab 			; sprite table.
002725  3  85 rr        	sta z80_x
002727  3  A9 0B        	lda #>sprtab
002729  3  85 rr        	sta z80_i
00272B  3               kspr2:
00272B  3  A0 00        	ldy #0
00272D  3  B1 rr        	lda (z80_hl),y 			; fetch byte.
00272F  3  C9 FF        	cmp #255 			; is it an end marker?
002731  3  D0 01        	bne :+
002733  3  60           	rts 				; yes, no more to do.
002734  3               :
002734  3  C9 00        	cmp #0
002736  3  D0 0E        	bne kspr1 			; no, add to table as normal.
002738  3               
002738  3  18           	clc 				; next sprite.
002739  3  A5 rr        	lda z80_l
00273B  3  69 04        	adc #NMESIZ		 	; distance to next odd/even entry.
00273D  3  85 rr        	sta z80_l
00273F  3  90 02        	bcc :+
002741  3  E6 rr        	inc z80_h
002743  3               :
002743  3  4C 2B 27     	jmp kspr2
002746  3               kspr1:
002746  3  A0 00        	ldy #0 				; fetch sprite type.
002748  3  B1 rr        	lda (z80_ix),y
00274A  3  C9 FF        	cmp #255 			; is it enabled yet?
00274C  3  D0 08        	bne kspr4 			; yes, try another slot.
00274E  3               
00274E  3  A0 05        	ldy #5 				; next type.
002750  3  B1 rr        	lda (z80_ix),y
002752  3  C9 FF        	cmp #255 			; is it enabled yet?
002754  3  F0 0F        	beq kspr3 			; no, process this one.
002756  3               kspr4:
002756  3  18           	clc 				; next sprite.
002757  3  A5 rr        	lda z80_x
002759  3  69 11        	adc #TABSIZ		 	; distance to next odd/even entry.
00275B  3  85 rr        	sta z80_x
00275D  3  90 02        	bcc :+
00275F  3  E6 rr        	inc z80_i
002761  3               :
002761  3  CA           	dex	 			; repeat for remaining sprites.
002762  3  D0 E2        	bne kspr1
002764  3  60           	rts  				; no more room in table.
002765  3               kspr3:
002765  3  20 6C 27     	jsr cpsp 			; copy sprite to table.
002768  3  CA           	dex	 			; one less space in the table.
002769  3  D0 C0        	bne kspr2
00276B  3  60           	rts
00276C  3               
00276C  3               ;----------------------------------------------
00276C  3               ; Copy sprite from list to table.
00276C  3               ;
00276C  3               ; global:	hl,ix
00276C  3               ; local:	y
00276C  3               ; calls:	evnt09
00276C  3               ;----------------------------------------------
00276C  3               
00276C  3               cpsp:
00276C  3  A0 00        	ldy #0					; fetch byte from table.
00276E  3  B1 rr        	lda (z80_hl),y
002770  3               	; y=var_Type
002770  3  91 rr        	sta (z80_ix),y			; set up type.
002772  3  A0 05        	ldy #var_newType
002774  3  91 rr        	sta (z80_ix),y 			; set up type.
002776  3               
002776  3  E6 rr        	inc z80_l 				; move to next byte.
002778  3  D0 02        	bne :+
00277A  3  E6 rr        	inc z80_h
00277C  3               :
00277C  3  A0 00        	ldy #0 					; fetch byte from table.
00277E  3  B1 rr        	lda (z80_hl),y
002780  3  A0 06        	ldy #var_newImage
002782  3  91 rr        	sta (z80_ix),y			; set up image.
002784  3               
002784  3  E6 rr        	inc z80_l 				; move to next byte.
002786  3  D0 02        	bne :+
002788  3  E6 rr        	inc z80_h
00278A  3               :
00278A  3  A0 00        	ldy #0
00278C  3  B1 rr        	lda (z80_hl),y 			; fetch byte from table.
00278E  3  A0 08        	ldy #var_newY
002790  3  91 rr        	sta (z80_ix),y 			; set up coordinate.
002792  3               
002792  3  A9 C8        	lda #200 				; set initial coordinate off screen.
002794  3  A0 03        	ldy #var_Y
002796  3  91 rr        	sta (z80_ix),y
002798  3               
002798  3  E6 rr        	inc z80_l 				; move to next byte.
00279A  3  D0 02        	bne :+
00279C  3  E6 rr        	inc z80_h
00279E  3               :
00279E  3  A0 00        	ldy #0 					; fetch byte from table.
0027A0  3  B1 rr        	lda (z80_hl),y
0027A2  3  A0 09        	ldy #var_newX
0027A4  3  91 rr        	sta (z80_ix),y 			; set up coordinate.
0027A6  3               
0027A6  3  E6 rr        	inc z80_l 				; move to next byte.
0027A8  3  D0 02        	bne :+
0027AA  3  E6 rr        	inc z80_h
0027AC  3               :
0027AC  3  A9 00        	lda #0					; zeroes in accumulator.
0027AE  3  A0 07        	ldy #var_newFrame 		; reset frame number.
0027B0  3  91 rr        	sta (z80_ix),y
0027B2  3  A0 0A        	ldy #var_Direction 		; reset direction.
0027B4  3  91 rr        	sta (z80_ix),y
0027B6  3  A0 0D        	ldy #var_jumpLo			; reset jump pointer low.
0027B8  3  91 rr        	sta (z80_ix),y
0027BA  3  A0 0E        	ldy #var_jumpHi	 		; reset jump pointer high.
0027BC  3  91 rr        	sta (z80_ix),y
0027BE  3               
0027BE  3  A9 FF        	lda #255 				; reset data pointer to auto-restore.
0027C0  3  A0 10        	ldy #var_dataHi
0027C2  3  91 rr        	sta (z80_ix),y
0027C4  3               evis0:
0027C4  3  A5 rr        	lda z80_i
0027C6  3  48           	pha
0027C7  3  A5 rr        	lda z80_x
0027C9  3  48           	pha
0027CA  3  A5 rr        	lda z80_h
0027CC  3  48           	pha
0027CD  3  A5 rr        	lda z80_l
0027CF  3  48           	pha
0027D0  3               
0027D0  3  20 90 4C     	jsr evnt09 				; perform event.
0027D3  3               
0027D3  3  68           	pla
0027D4  3  85 rr        	sta z80_l
0027D6  3  68           	pla
0027D7  3  85 rr        	sta z80_h
0027D9  3  68           	pla
0027DA  3  85 rr        	sta z80_x
0027DC  3  68           	pla
0027DD  3  85 rr        	sta z80_i
0027DF  3               
0027DF  3  18           	clc
0027E0  3  A5 rr        	lda z80_x 			; distance to next odd/even entry.
0027E2  3  69 11        	adc #TABSIZ		 	; next sprite.
0027E4  3  85 rr        	sta z80_x
0027E6  3  90 02        	bcc :+
0027E8  3  E6 rr        	inc z80_i
0027EA  3               :
0027EA  3  60           	rts
0027EB  3               
0027EB  3               
0027EB  3               ;-------------------------------------
0027EB  3               ; Clear the play area window.
0027EB  3               ;-------------------------------------
0027EB  3               
0027EB  3               clw:
0027EB  3  AD 0C 16     	lda wintop			; get coordinates of window.
0027EE  3  85 rr        	sta dispy			; put into dispx for calculation.
0027F0  3  AD 0D 16     	lda winlft
0027F3  3  85 rr        	sta dispx
0027F5  3               
0027F5  3  AD 0E 16     	lda winhgt			; height of window.
0027F8  3  85 rr        	sta rrow			; copy to b register.
0027FA  3               clw3:
0027FA  3  AD 0F 16     	lda winwid 			; width of window.
0027FD  3  85 rr        	sta rcol
0027FF  3               clw2:
0027FF  3  20 04 1C     	jsr gprad 			; get print address.
002802  3  A9 00        	lda #0				; zero byte to write.
002804  3  A0 07        	ldy #7				; pixel height of each cell.
002806  3               clw1:
002806  3  91 rr        	sta (scraddr),y 	; copy to screen.
002808  3  88           	dey					; next screen row down.
002809  3  10 FB        	bpl clw1
00280B  3               
00280B  3  E6 rr        	inc dispx			; next column.
00280D  3  C6 rr        	dec rcol			; one less to do.
00280F  3  D0 EE        	bne clw2			; repeat for remaining columns.
002811  3               
002811  3  AD 0D 16     	lda winlft			; get left edge.
002814  3  85 rr        	sta dispx 			; reset x.
002816  3  E6 rr        	inc dispy 			; next line down.
002818  3               
002818  3  C6 rr        	dec rrow
00281A  3  D0 DE        	bne clw3			; repeat down the screen.
00281C  3               
00281C  3  AD 0C 16     	lda wintop			; get coordinates of window.
00281F  3  85 rr        	sta chary			; put into display position.
002821  3  AD 0D 16     	lda winlft
002824  3  85 rr        	sta charx
002826  3  60           	rts
002827  3               
002827  3               
002827  3               ;----------------------------------------------------------
002827  3               ; Effects code.
002827  3               ; Ticker routine is called 25 times per second.
002827  3               ;
002827  3               ; HL = txtscr = left text screen address
002827  3               ; DE = txtscr+txtwid-1 = right text screen address
002827  3               ; BC = txtpos = text scroller position
002827  3               ;
002827  3               ;----------------------------------------------------------
002827  3               
002827  3               .if sflag
002827  3               scrly:
002827  3               	rts
002827  3               	.word txtscr         	; get left screen address.
002827  3               	sta scr_l
002827  3               	lda txtscr+1
002827  3               	sta scr_l+1
002827  3               	sta scr_r+1
002827  3               
002827  3               	stx xtmp
002827  3               
002827  3               	clc         		; get right screen address.
002827  3               	lda scr_l
002827  3               	adc txtwid
002827  3               	sta scr_r
002827  3               	dec scr_r
002827  3               scrly1:
002827  3               	ldy txtwid		; set txtwide
002827  3               	dey
002827  3               	clc
002827  3               scrly0:
002827  3               	lda (scr_l),y		; scroll 1 line
002827  3               	rol a
002827  3               	sta (scr_l),y
002827  3               	dey
002827  3               	bpl scrly0
002827  3               
002827  3               	clc			; point to next line
002827  3               	lda scr_l
002827  3               	adc #32
002827  3               	sta scr_l
002827  3               	bcc scrly1		; repeat 8 times
002827  3               
002827  3               	lda txtpos 		; get text pointer.
002827  3               	sta scr_txt
002827  3               	lda txtpos+1
002827  3               	sta scr_txt+1
002827  3               
002827  3               	ldy #0
002827  3               	lda (scr_txt),y 		; find character we're displaying.
002827  3               	and #127 		; remove end marker bit if applicable.
002827  3               	cmp #ASCII_NEWLINE			; is it newline?
002827  3               	bne scrly5 		; no, it's okay.
002827  3               	lda #32			; convert to a space instead.
002827  3               scrly5:
002827  3               	sta fntaddr		; calculate char address
002827  3               	lda #0
002827  3               	sta fntaddr+1
002827  3               	asl fntaddr  		; multiply char by 8.
002827  3               	rol fntaddr+1
002827  3               	asl fntaddr
002827  3               	rol fntaddr+1
002827  3               	asl fntaddr
002827  3               	rol fntaddr+1
002827  3               	lda fntaddr
002827  3               	clc
002827  3               	adc FontPtr
002827  3               	sta scrly3+1		; that's the low byte.
002827  3               	lda fntaddr+1
002827  3               	adc FontPtr+1
002827  3               	sta scrly3+2		; add displacement.
002827  3               
002827  3               	ldx #0
002827  3               scrly3:
002827  3               	lda $3333,x		; get image of char line.
002827  3               	and txtbit
002827  3               	beq scrly2		; don't plot pixel
002827  3               	ldy scrline,x
002827  3               	lda (scr_r),y
002827  3               	clc
002827  3               	ora #1
002827  3               	sta (scr_r),y		; plot pixel
002827  3               scrly2:
002827  3               	inx			; next line of char.
002827  3               	cpx #8
002827  3               	bne scrly3
002827  3               
002827  3               	lsr txtbit		; bit of text to display.
002827  3               	bcs :+
002827  3               	rts
002827  3               :
002827  3               	ldy #0
002827  3               	lda (scr_txt),y 	; what was the character?
002827  3               	asl a	  		; end of message?
002827  3               	bcs scrly4
002827  3               	inc txtpos
002827  3               	bne :+
002827  3               	inc txtpos+1
002827  3               :
002827  3               	jmp scrly6 		; not yet - continue.
002827  3               scrly4:
002827  3               	lda txtini 		; start of scrolling message.
002827  3               	sta txtpos
002827  3               	lda txtini+1
002827  3               	sta txtpos+1
002827  3               scrly6:
002827  3               	lda #128
002827  3               	sta txtbit
002827  3               	ldx xtmp
002827  3               	rts
002827  3               
002827  3               scrline:	.byte $00,$20,$40,$60,$80,$a0,$c0,$e0
002827  3               
002827  3               ;-------------------------------------------------------
002827  3               ; Entry TICKER command
002827  3               ;
002827  3               ; Entry:
002827  3               ;  z80_b = message nr
002827  3               ;  z80_c = width
002827  3               ;-------------------------------------------------------
002827  3               
002827  3               iscrly:
002827  3               	jsr prescr 		; set up display position.
002827  3               
002827  3               	lda #<msgdat 		; text messages.
002827  3               	sta z80_l
002827  3               	lda #>msgdat
002827  3               	sta z80_h
002827  3               
002827  3               	lda z80_c 		; width.
002827  3               	sec
002827  3               	sbc #1			; subtract one.
002827  3               	cmp #32 		; is it between 1 and 32?
002827  3               	bcc :+
002827  3               	lda #$60
002827  3               	jmp iscrl0		; no, disable messages.
002827  3               :
002827  3               	ldx z80_b		; message number.
002827  3               	jsr getwrd 		; find message start.
002827  3               
002827  3               	lda z80_l		; set initial text position.
002827  3               	sta txtini
002827  3               	lda z80_h
002827  3               	sta txtini+1
002827  3               
002827  3               	lda #$ad		; code for lda adrr
002827  3               iscrl0:
002827  3               	sta scrly		; enable/disable scrolling routine.
002827  3               
002827  3               	jsr prescr 		; set up display position.
002827  3               	jsr gprad 		; get print address.
002827  3               
002827  3               	lda scraddr 		; set text screen address.
002827  3               	sta txtscr
002827  3               	lda scraddr+1
002827  3               	sta txtscr+1
002827  3               
002827  3               	lda z80_c		; width.
002827  3               	sta txtwid		; set width in working storage.
002827  3               
002827  3               	lda #128 		; start with leftmost bit.
002827  3               	sta txtbit
002827  3               
002827  3               	jmp scrly4
002827  3               .endif
002827  3               
002827  3               ;------------------------------------------------------------------
002827  3               ; Sprite table
002827  3               ;------------------------------------------------------------------
002827  3               
002827  3               
002827  3               ; ix+0  = type.
002827  3               ; ix+1  = sprite image number.
002827  3               ; ix+2  = frame.
002827  3               ; ix+3  = y coord.
002827  3               ; ix+4  = x coord.
002827  3               
002827  3               ; ix+5  = new type.
002827  3               ; ix+6  = new image number.
002827  3               ; ix+7  = new frame.
002827  3               ; ix+8  = new y coord.
002827  3               ; ix+9  = new x coord.
002827  3               
002827  3               ; ix+10 = direction.
002827  3               ; ix+11 = parameter 1.
002827  3               ; ix+12 = parameter 2.
002827  3               ; ix+13 = jump pointer low.
002827  3               ; ix+14 = jump pointer high.
002827  3               ; ix+15 = data pointer low.
002827  3               ; ix+16 = data pointer high.
002827  3               
002827  3               ; block NUMSPR * TABSIZ,255
002827  3               ; sprtab NUMSPR*TABSIZ,255
002827  3               
002827  3  FF FF FF FF  ssprit:	.byte 255,255,255,255,255,255,255,0,192,120,0,0,0,255,255,255,255
00282B  3  FF FF FF 00  
00282F  3  C0 78 00 00  
002838  3  07           roomtb:	.byte 7                      ; start room map offset.
002839  3               
002839  3               ; User routine.  Put your own code in here to be called with USER instruction.
002839  3               ; if USER has an argument it will be passed in the accumulator.
002839  3               
002839  3               user:
002839  3  60           	rts
00283A  3               
00283A  3               ; Everything below here will be generated by the editors.
00283A  3               
00283A  3               script_start:
00283A  3               
00283A  3               WINDOWTOP = 0
00283A  3               WINDOWLFT = 0
00283A  3               WINDOWHGT = 23
00283A  3               WINDOWWID = 26 ;
00283A  3               MAPWID = 3
00283A  3  FF FF FF             .byte 255,255,255
00283D  3               mapdat:
00283D  3  FF 00 FF             .byte 255,0,255
002840  3  FF FF FF             .byte 255,255,255
002843  3  01           stmap:  .byte 1
002844  3               
002844  3               evnt00:
002844  3  A9 04                lda #4
002846  3  C5 rr                cmp varg
002848  3  F0 03                beq *+5
00284A  3  4C 69 28             jmp a00080
00284D  3  A9 00                lda #0
00284F  3  A0 06                ldy #6
002851  3  91 rr                sta (z80_ix),y
002853  3  A9 00                lda #0
002855  3  A0 07                ldy #7
002857  3  91 rr                sta (z80_ix),y
002859  3  A9 B0                lda #176
00285B  3  A0 08                ldy #8
00285D  3  91 rr                sta (z80_ix),y
00285F  3  A9 00                lda #0
002861  3  A0 09                ldy #9
002863  3  91 rr                sta (z80_ix),y
002865  3  A9 00                lda #0
002867  3  85 rr                sta varg
002869  3  A9 03        a00080: lda #3
00286B  3  C5 rr                cmp varg
00286D  3  F0 03                beq *+5
00286F  3  4C 7E 28             jmp a00123
002872  3  A9 13                lda #19
002874  3  A0 06                ldy #6
002876  3  91 rr                sta (z80_ix),y
002878  3  A9 01                lda #1
00287A  3  A0 07                ldy #7
00287C  3  91 rr                sta (z80_ix),y
00287E  3  A0 08        a00123: ldy #8
002880  3  B1 rr                lda (z80_ix),y
002882  3  85 rr                sta vara
002884  3  A0 09                ldy #9
002886  3  B1 rr                lda (z80_ix),y
002888  3  85 rr                sta varb
00288A  3  A9 01                lda #1
00288C  3  C5 rr                cmp varl
00288E  3  F0 03                beq *+5
002890  3  4C BE 28             jmp a00261
002893  3  A9 08                lda #8
002895  3  85 rr                sta z80_c
002897  3  A9 09                lda #9
002899  3  85 rr                sta z80_b
00289B  3  20 0F 1A             jsr spawn
00289E  3  A5 rr                lda spptr
0028A0  3  85 rr                sta z80_x
0028A2  3  A5 rr                lda spptr+1
0028A4  3  85 rr                sta z80_i
0028A6  3  A9 28                lda #40
0028A8  3  A0 08                ldy #8
0028AA  3  91 rr                sta (z80_ix),y
0028AC  3  A9 60                lda #96
0028AE  3  A0 09                ldy #9
0028B0  3  91 rr                sta (z80_ix),y
0028B2  3  A9 63                lda #99
0028B4  3  85 rr                sta varl
0028B6  3  A5 rr                lda ogptr
0028B8  3  85 rr                sta z80_x
0028BA  3  A5 rr                lda ogptr+1
0028BC  3  85 rr                sta z80_i
0028BE  3  A5 rr        a00261: lda varg
0028C0  3  C9 02                cmp #2
0028C2  3  90 03                bcc *+5
0028C4  3  4C 3E 2A             jmp a01062
0028C7  3  20 B6 19             jsr skobj
0028CA  3  85 rr                sta varobj
0028CC  3  A9 08                lda #8
0028CE  3  C5 rr                cmp varobj
0028D0  3  F0 03                beq *+5
0028D2  3  4C 15 29             jmp a00431
0028D5  3  A5 rr                lda varobj
0028D7  3  20 35 19             jsr getob
0028DA  3  A9 03                lda #3
0028DC  3  85 rr                sta z80_c
0028DE  3  A5 rr                lda vark
0028E0  3  18                   clc
0028E1  3  65 rr                adc z80_c
0028E3  3  85 rr                sta vark
0028E5  3  A9 07                lda #7
0028E7  3  85 rr                sta chary
0028E9  3  A9 1D                lda #29
0028EB  3  85 rr                sta charx
0028ED  3  A9 18                lda #24
0028EF  3  20 7F 20             jsr dmsg
0028F2  3  A9 07                lda #7
0028F4  3  85 rr                sta chary
0028F6  3  A9 1D                lda #29
0028F8  3  85 rr                sta charx
0028FA  3  A5 rr                lda vark
0028FC  3  20 CD 24             jsr disply
0028FF  3  A9 32                lda #50
002901  3  0A                   asl a
002902  3  8D 2A 0F             sta sndtyp
002905  3  A9 0F                lda #15
002907  3  C5 rr                cmp vark
002909  3  90 03                bcc *+5
00290B  3  4C 12 29             jmp a00426
00290E  3  A9 0F                lda #15
002910  3  85 rr                sta vark
002912  3  4C 3B 29     a00426: jmp a00512
002915  3  A9 58        a00431: lda #88
002917  3  A0 08                ldy #8
002919  3  91 rr                sta (z80_ix),y
00291B  3  A9 60                lda #96
00291D  3  A0 09                ldy #9
00291F  3  91 rr                sta (z80_ix),y
002921  3  20 B6 19             jsr skobj
002924  3  85 rr                sta varobj
002926  3  A9 08                lda #8
002928  3  C5 rr                cmp varobj
00292A  3  F0 03                beq *+5
00292C  3  4C 2F 29             jmp a00484
00292F  3  A5 rr        a00484: lda vara
002931  3  A0 08                ldy #8
002933  3  91 rr                sta (z80_ix),y
002935  3  A5 rr                lda varb
002937  3  A0 09                ldy #9
002939  3  91 rr                sta (z80_ix),y
00293B  3  A9 01        a00512: lda #1
00293D  3  85 rr                sta z80_b
00293F  3  20 3D 24             jsr sktyp
002942  3  B0 03                bcs :+
002944  3  4C 3E 2A             jmp a01062
002947  3               :
002947  3  A5 rr                lda skptr
002949  3  85 rr                sta z80_x
00294B  3  A5 rr                lda skptr+1
00294D  3  85 rr                sta z80_i
00294F  3  A0 08                ldy #8
002951  3  B1 rr                lda (z80_ix),y
002953  3  85 rr                sta varo
002955  3  A0 09                ldy #9
002957  3  B1 rr                lda (z80_ix),y
002959  3  85 rr                sta varp
00295B  3  A5 rr                lda ogptr
00295D  3  85 rr                sta z80_x
00295F  3  A5 rr                lda ogptr+1
002961  3  85 rr                sta z80_i
002963  3  A5 rr                lda varo
002965  3  85 rr                sta varq
002967  3  A0 08                ldy #8
002969  3  B1 rr                lda (z80_ix),y
00296B  3  C5 rr                cmp varq
00296D  3  90 03                bcc *+5
00296F  3  4C 82 29             jmp a00664
002972  3  A0 08                ldy #8
002974  3  B1 rr                lda (z80_ix),y
002976  3  85 rr                sta z80_c
002978  3  A5 rr                lda varq
00297A  3  38                   sec
00297B  3  E5 rr                sbc z80_c
00297D  3  85 rr                sta varq
00297F  3  4C 93 29             jmp a00702
002982  3  A0 08        a00664: ldy #8
002984  3  B1 rr                lda (z80_ix),y
002986  3  85 rr                sta varq
002988  3  A5 rr                lda varo
00298A  3  85 rr                sta z80_c
00298C  3  A5 rr                lda varq
00298E  3  38                   sec
00298F  3  E5 rr                sbc z80_c
002991  3  85 rr                sta varq
002993  3  A5 rr        a00702: lda varq
002995  3  C9 0C                cmp #12
002997  3  90 03                bcc *+5
002999  3  4C CC 29             jmp a00823
00299C  3  A5 rr                lda varp
00299E  3  85 rr                sta varq
0029A0  3  A0 09                ldy #9
0029A2  3  B1 rr                lda (z80_ix),y
0029A4  3  C5 rr                cmp varq
0029A6  3  90 03                bcc *+5
0029A8  3  4C BB 29             jmp a00785
0029AB  3  A0 09                ldy #9
0029AD  3  B1 rr                lda (z80_ix),y
0029AF  3  85 rr                sta z80_c
0029B1  3  A5 rr                lda varq
0029B3  3  38                   sec
0029B4  3  E5 rr                sbc z80_c
0029B6  3  85 rr                sta varq
0029B8  3  4C CC 29             jmp a00823
0029BB  3  A0 09        a00785: ldy #9
0029BD  3  B1 rr                lda (z80_ix),y
0029BF  3  85 rr                sta varq
0029C1  3  A5 rr                lda varp
0029C3  3  85 rr                sta z80_c
0029C5  3  A5 rr                lda varq
0029C7  3  38                   sec
0029C8  3  E5 rr                sbc z80_c
0029CA  3  85 rr                sta varq
0029CC  3  A5 rr        a00823: lda varq
0029CE  3  C9 0C                cmp #12
0029D0  3  90 03                bcc *+5
0029D2  3  4C 3E 2A             jmp a01062
0029D5  3  A9 13                lda #19
0029D7  3  A0 06                ldy #6
0029D9  3  91 rr                sta (z80_ix),y
0029DB  3  A9 00                lda #0
0029DD  3  C5 rr                cmp varg
0029DF  3  F0 03                beq *+5
0029E1  3  4C E8 29             jmp a00879
0029E4  3  A9 03                lda #3
0029E6  3  85 rr                sta varg
0029E8  3  A9 01        a00879: lda #1
0029EA  3  C5 rr                cmp varg
0029EC  3  F0 03                beq *+5
0029EE  3  4C F5 29             jmp a00903
0029F1  3  A9 06                lda #6
0029F3  3  85 rr                sta varg
0029F5  3  A9 06        a00903: lda #6
0029F7  3  85 rr                sta z80_c
0029F9  3  A9 00                lda #0
0029FB  3  85 rr                sta z80_b
0029FD  3  20 0F 1A             jsr spawn
002A00  3  A5 rr                lda spptr
002A02  3  85 rr                sta z80_x
002A04  3  A5 rr                lda spptr+1
002A06  3  85 rr                sta z80_i
002A08  3  A9 C8                lda #200
002A0A  3  A0 0C                ldy #12
002A0C  3  91 rr                sta (z80_ix),y
002A0E  3  A9 00                lda #0
002A10  3  A0 06                ldy #6
002A12  3  91 rr                sta (z80_ix),y
002A14  3  A5 rr                lda ogptr
002A16  3  85 rr                sta z80_x
002A18  3  A5 rr                lda ogptr+1
002A1A  3  85 rr                sta z80_i
002A1C  3  A9 13                lda #19
002A1E  3  A0 06                ldy #6
002A20  3  91 rr                sta (z80_ix),y
002A22  3  A9 01                lda #1
002A24  3  A0 07                ldy #7
002A26  3  91 rr                sta (z80_ix),y
002A28  3  A9 00                lda #0
002A2A  3  A0 08                ldy #8
002A2C  3  91 rr                sta (z80_ix),y
002A2E  3  A9 F0                lda #240
002A30  3  A0 09                ldy #9
002A32  3  91 rr                sta (z80_ix),y
002A34  3  A9 03                lda #3
002A36  3  C5 rr                cmp varg
002A38  3  F0 03                beq *+5
002A3A  3  4C 3E 2A             jmp a01062
002A3D  3  60                   rts
002A3E  3  A5 rr        a01062: lda varh
002A40  3  85 rr                sta vars
002A42  3  A5 rr                lda varh
002A44  3  85 rr                sta vart
002A46  3  A5 rr                lda vars
002A48  3  4A                   lsr a
002A49  3  4A                   lsr a
002A4A  3  4A                   lsr a
002A4B  3  4A                   lsr a
002A4C  3  85 rr                sta vars
002A4E  3  A5 rr                lda vars
002A50  3  85 rr                sta varq
002A52  3  A5 rr                lda varq
002A54  3  0A                   asl a
002A55  3  0A                   asl a
002A56  3  0A                   asl a
002A57  3  0A                   asl a
002A58  3  85 rr                sta varq
002A5A  3  A5 rr                lda varq
002A5C  3  85 rr                sta z80_c
002A5E  3  A5 rr                lda vart
002A60  3  38                   sec
002A61  3  E5 rr                sbc z80_c
002A63  3  85 rr                sta vart
002A65  3  A9 03                lda #3
002A67  3  C5 rr                cmp scno
002A69  3  F0 03                beq *+5
002A6B  3  4C 72 2A             jmp a01182
002A6E  3  A9 63                lda #99
002A70  3  85 rr                sta vart
002A72  3  A9 01        a01182: lda #1
002A74  3  C5 rr                cmp varg
002A76  3  90 03                bcc *+5
002A78  3  4C 85 2A             jmp a01219
002A7B  3  A5 rr                lda varg
002A7D  3  C9 05                cmp #5
002A7F  3  90 03                bcc *+5
002A81  3  4C 85 2A             jmp a01219
002A84  3  60                   rts
002A85  3  A9 FF        a01219: lda #255
002A87  3  85 rr                sta varobj
002A89  3  A9 00                lda #0
002A8B  3  C5 rr                cmp varg
002A8D  3  F0 03                beq *+5
002A8F  3  4C 9D 2A             jmp a01268
002A92  3  20 B6 19             jsr skobj
002A95  3  85 rr                sta varobj
002A97  3  A9 FF                lda #255
002A99  3  A0 0A                ldy #10
002A9B  3  91 rr                sta (z80_ix),y
002A9D  3  A9 18        a01268: lda #24
002A9F  3  A0 09                ldy #9
002AA1  3  91 rr                sta (z80_ix),y
002AA3  3  A9 18                lda #24
002AA5  3  A0 08                ldy #8
002AA7  3  91 rr                sta (z80_ix),y
002AA9  3  A9 01                lda #1
002AAB  3  C5 rr                cmp scno
002AAD  3  90 03                bcc *+5
002AAF  3  4C B8 2A             jmp a01325
002AB2  3  A9 30                lda #48
002AB4  3  A0 08                ldy #8
002AB6  3  91 rr                sta (z80_ix),y
002AB8  3  A9 05        a01325: lda #5
002ABA  3  C5 rr                cmp varg
002ABC  3  F0 03                beq *+5
002ABE  3  4C D7 2A             jmp a01386
002AC1  3  A9 00                lda #0
002AC3  3  20 35 19             jsr getob
002AC6  3  A0 09                ldy #9
002AC8  3  B1 rr                lda (z80_ix),y
002ACA  3  85 rr                sta dispx
002ACC  3  A0 08                ldy #8
002ACE  3  B1 rr                lda (z80_ix),y
002AD0  3  85 rr                sta dispy
002AD2  3  A9 00                lda #0
002AD4  3  20 95 19             jsr drpob
002AD7  3  A9 06        a01386: lda #6
002AD9  3  C5 rr                cmp varg
002ADB  3  F0 03                beq *+5
002ADD  3  4C FC 2A             jmp a01462
002AE0  3  A9 00                lda #0
002AE2  3  A0 0A                ldy #10
002AE4  3  D1 rr                cmp (z80_ix),y
002AE6  3  F0 03                beq *+5
002AE8  3  4C FC 2A             jmp a01462
002AEB  3  A0 09                ldy #9
002AED  3  B1 rr                lda (z80_ix),y
002AEF  3  85 rr                sta dispx
002AF1  3  A0 08                ldy #8
002AF3  3  B1 rr                lda (z80_ix),y
002AF5  3  85 rr                sta dispy
002AF7  3  A9 00                lda #0
002AF9  3  20 95 19             jsr drpob
002AFC  3  A9 00        a01462: lda #0
002AFE  3  85 rr                sta vard
002B00  3  A9 00                lda #0
002B02  3  C5 rr                cmp varobj
002B04  3  F0 03                beq *+5
002B06  3  4C 1D 2B             jmp a01530
002B09  3  A0 08                ldy #8
002B0B  3  B1 rr                lda (z80_ix),y
002B0D  3  85 rr                sta varo
002B0F  3  A0 09                ldy #9
002B11  3  B1 rr                lda (z80_ix),y
002B13  3  85 rr                sta varp
002B15  3  A9 02                lda #2
002B17  3  85 rr                sta varg
002B19  3  A9 01                lda #1
002B1B  3  85 rr                sta vard
002B1D  3  A9 A8        a01530: lda #168
002B1F  3  A0 09                ldy #9
002B21  3  91 rr                sta (z80_ix),y
002B23  3  A9 01                lda #1
002B25  3  C5 rr                cmp varobj
002B27  3  F0 03                beq *+5
002B29  3  4C 40 2B             jmp a01605
002B2C  3  A0 08                ldy #8
002B2E  3  B1 rr                lda (z80_ix),y
002B30  3  85 rr                sta varo
002B32  3  A0 09                ldy #9
002B34  3  B1 rr                lda (z80_ix),y
002B36  3  85 rr                sta varp
002B38  3  A9 02                lda #2
002B3A  3  85 rr                sta varg
002B3C  3  A9 01                lda #1
002B3E  3  85 rr                sta vard
002B40  3  A9 05        a01605: lda #5
002B42  3  C5 rr                cmp varg
002B44  3  F0 03                beq *+5
002B46  3  4C 5F 2B             jmp a01666
002B49  3  A9 01                lda #1
002B4B  3  20 35 19             jsr getob
002B4E  3  A0 09                ldy #9
002B50  3  B1 rr                lda (z80_ix),y
002B52  3  85 rr                sta dispx
002B54  3  A0 08                ldy #8
002B56  3  B1 rr                lda (z80_ix),y
002B58  3  85 rr                sta dispy
002B5A  3  A9 01                lda #1
002B5C  3  20 95 19             jsr drpob
002B5F  3  A9 06        a01666: lda #6
002B61  3  C5 rr                cmp varg
002B63  3  F0 03                beq *+5
002B65  3  4C 84 2B             jmp a01741
002B68  3  A9 01                lda #1
002B6A  3  A0 0A                ldy #10
002B6C  3  D1 rr                cmp (z80_ix),y
002B6E  3  F0 03                beq *+5
002B70  3  4C 84 2B             jmp a01741
002B73  3  A0 09                ldy #9
002B75  3  B1 rr                lda (z80_ix),y
002B77  3  85 rr                sta dispx
002B79  3  A0 08                ldy #8
002B7B  3  B1 rr                lda (z80_ix),y
002B7D  3  85 rr                sta dispy
002B7F  3  A9 01                lda #1
002B81  3  20 95 19             jsr drpob
002B84  3  A9 98        a01741: lda #152
002B86  3  A0 08                ldy #8
002B88  3  91 rr                sta (z80_ix),y
002B8A  3  A9 01                lda #1
002B8C  3  C5 rr                cmp scno
002B8E  3  90 03                bcc *+5
002B90  3  4C 99 2B             jmp a01786
002B93  3  A9 80                lda #128
002B95  3  A0 08                ldy #8
002B97  3  91 rr                sta (z80_ix),y
002B99  3  A9 02        a01786: lda #2
002B9B  3  C5 rr                cmp varobj
002B9D  3  F0 03                beq *+5
002B9F  3  4C B2 2B             jmp a01838
002BA2  3  A0 08                ldy #8
002BA4  3  B1 rr                lda (z80_ix),y
002BA6  3  85 rr                sta varo
002BA8  3  A0 09                ldy #9
002BAA  3  B1 rr                lda (z80_ix),y
002BAC  3  85 rr                sta varp
002BAE  3  A9 02                lda #2
002BB0  3  85 rr                sta varg
002BB2  3  A9 05        a01838: lda #5
002BB4  3  C5 rr                cmp varg
002BB6  3  F0 03                beq *+5
002BB8  3  4C D1 2B             jmp a01900
002BBB  3  A9 02                lda #2
002BBD  3  20 35 19             jsr getob
002BC0  3  A0 09                ldy #9
002BC2  3  B1 rr                lda (z80_ix),y
002BC4  3  85 rr                sta dispx
002BC6  3  A0 08                ldy #8
002BC8  3  B1 rr                lda (z80_ix),y
002BCA  3  85 rr                sta dispy
002BCC  3  A9 02                lda #2
002BCE  3  20 95 19             jsr drpob
002BD1  3  A9 06        a01900: lda #6
002BD3  3  C5 rr                cmp varg
002BD5  3  F0 03                beq *+5
002BD7  3  4C F6 2B             jmp a01975
002BDA  3  A9 02                lda #2
002BDC  3  A0 0A                ldy #10
002BDE  3  D1 rr                cmp (z80_ix),y
002BE0  3  F0 03                beq *+5
002BE2  3  4C F6 2B             jmp a01975
002BE5  3  A0 09                ldy #9
002BE7  3  B1 rr                lda (z80_ix),y
002BE9  3  85 rr                sta dispx
002BEB  3  A0 08                ldy #8
002BED  3  B1 rr                lda (z80_ix),y
002BEF  3  85 rr                sta dispy
002BF1  3  A9 02                lda #2
002BF3  3  20 95 19             jsr drpob
002BF6  3  A9 18        a01975: lda #24
002BF8  3  A0 09                ldy #9
002BFA  3  91 rr                sta (z80_ix),y
002BFC  3  A9 03                lda #3
002BFE  3  C5 rr                cmp varobj
002C00  3  F0 03                beq *+5
002C02  3  4C 15 2C             jmp a02041
002C05  3  A0 08                ldy #8
002C07  3  B1 rr                lda (z80_ix),y
002C09  3  85 rr                sta varo
002C0B  3  A0 09                ldy #9
002C0D  3  B1 rr                lda (z80_ix),y
002C0F  3  85 rr                sta varp
002C11  3  A9 02                lda #2
002C13  3  85 rr                sta varg
002C15  3  A9 05        a02041: lda #5
002C17  3  C5 rr                cmp varg
002C19  3  F0 03                beq *+5
002C1B  3  4C 34 2C             jmp a02102
002C1E  3  A9 03                lda #3
002C20  3  20 35 19             jsr getob
002C23  3  A0 09                ldy #9
002C25  3  B1 rr                lda (z80_ix),y
002C27  3  85 rr                sta dispx
002C29  3  A0 08                ldy #8
002C2B  3  B1 rr                lda (z80_ix),y
002C2D  3  85 rr                sta dispy
002C2F  3  A9 03                lda #3
002C31  3  20 95 19             jsr drpob
002C34  3  A9 06        a02102: lda #6
002C36  3  C5 rr                cmp varg
002C38  3  F0 03                beq *+5
002C3A  3  4C 59 2C             jmp a02178
002C3D  3  A9 03                lda #3
002C3F  3  A0 0A                ldy #10
002C41  3  D1 rr                cmp (z80_ix),y
002C43  3  F0 03                beq *+5
002C45  3  4C 59 2C             jmp a02178
002C48  3  A0 09                ldy #9
002C4A  3  B1 rr                lda (z80_ix),y
002C4C  3  85 rr                sta dispx
002C4E  3  A0 08                ldy #8
002C50  3  B1 rr                lda (z80_ix),y
002C52  3  85 rr                sta dispy
002C54  3  A9 03                lda #3
002C56  3  20 95 19             jsr drpob
002C59  3  A9 60        a02178: lda #96
002C5B  3  A0 09                ldy #9
002C5D  3  91 rr                sta (z80_ix),y
002C5F  3  A9 10                lda #16
002C61  3  A0 08                ldy #8
002C63  3  91 rr                sta (z80_ix),y
002C65  3  A9 04                lda #4
002C67  3  C5 rr                cmp varobj
002C69  3  F0 03                beq *+5
002C6B  3  4C 7E 2C             jmp a02257
002C6E  3  A0 08                ldy #8
002C70  3  B1 rr                lda (z80_ix),y
002C72  3  85 rr                sta varo
002C74  3  A0 09                ldy #9
002C76  3  B1 rr                lda (z80_ix),y
002C78  3  85 rr                sta varp
002C7A  3  A9 02                lda #2
002C7C  3  85 rr                sta varg
002C7E  3  A9 05        a02257: lda #5
002C80  3  C5 rr                cmp varg
002C82  3  F0 03                beq *+5
002C84  3  4C 9D 2C             jmp a02319
002C87  3  A9 04                lda #4
002C89  3  20 35 19             jsr getob
002C8C  3  A0 09                ldy #9
002C8E  3  B1 rr                lda (z80_ix),y
002C90  3  85 rr                sta dispx
002C92  3  A0 08                ldy #8
002C94  3  B1 rr                lda (z80_ix),y
002C96  3  85 rr                sta dispy
002C98  3  A9 04                lda #4
002C9A  3  20 95 19             jsr drpob
002C9D  3  A9 06        a02319: lda #6
002C9F  3  C5 rr                cmp varg
002CA1  3  F0 03                beq *+5
002CA3  3  4C C2 2C             jmp a02394
002CA6  3  A9 04                lda #4
002CA8  3  A0 0A                ldy #10
002CAA  3  D1 rr                cmp (z80_ix),y
002CAC  3  F0 03                beq *+5
002CAE  3  4C C2 2C             jmp a02394
002CB1  3  A0 09                ldy #9
002CB3  3  B1 rr                lda (z80_ix),y
002CB5  3  85 rr                sta dispx
002CB7  3  A0 08                ldy #8
002CB9  3  B1 rr                lda (z80_ix),y
002CBB  3  85 rr                sta dispy
002CBD  3  A9 04                lda #4
002CBF  3  20 95 19             jsr drpob
002CC2  3  A9 A0        a02394: lda #160
002CC4  3  A0 08                ldy #8
002CC6  3  91 rr                sta (z80_ix),y
002CC8  3  A9 05                lda #5
002CCA  3  C5 rr                cmp varobj
002CCC  3  F0 03                beq *+5
002CCE  3  4C E5 2C             jmp a02468
002CD1  3  A0 08                ldy #8
002CD3  3  B1 rr                lda (z80_ix),y
002CD5  3  85 rr                sta varo
002CD7  3  A0 09                ldy #9
002CD9  3  B1 rr                lda (z80_ix),y
002CDB  3  85 rr                sta varp
002CDD  3  A9 02                lda #2
002CDF  3  85 rr                sta varg
002CE1  3  A9 01                lda #1
002CE3  3  85 rr                sta vard
002CE5  3  A9 05        a02468: lda #5
002CE7  3  C5 rr                cmp varg
002CE9  3  F0 03                beq *+5
002CEB  3  4C 04 2D             jmp a02530
002CEE  3  A9 05                lda #5
002CF0  3  20 35 19             jsr getob
002CF3  3  A0 09                ldy #9
002CF5  3  B1 rr                lda (z80_ix),y
002CF7  3  85 rr                sta dispx
002CF9  3  A0 08                ldy #8
002CFB  3  B1 rr                lda (z80_ix),y
002CFD  3  85 rr                sta dispy
002CFF  3  A9 05                lda #5
002D01  3  20 95 19             jsr drpob
002D04  3  A9 06        a02530: lda #6
002D06  3  C5 rr                cmp varg
002D08  3  F0 03                beq *+5
002D0A  3  4C 29 2D             jmp a02605
002D0D  3  A9 05                lda #5
002D0F  3  A0 0A                ldy #10
002D11  3  D1 rr                cmp (z80_ix),y
002D13  3  F0 03                beq *+5
002D15  3  4C 29 2D             jmp a02605
002D18  3  A0 09                ldy #9
002D1A  3  B1 rr                lda (z80_ix),y
002D1C  3  85 rr                sta dispx
002D1E  3  A0 08                ldy #8
002D20  3  B1 rr                lda (z80_ix),y
002D22  3  85 rr                sta dispy
002D24  3  A9 05                lda #5
002D26  3  20 95 19             jsr drpob
002D29  3  A9 58        a02605: lda #88
002D2B  3  A0 08                ldy #8
002D2D  3  91 rr                sta (z80_ix),y
002D2F  3  A9 30                lda #48
002D31  3  A0 09                ldy #9
002D33  3  91 rr                sta (z80_ix),y
002D35  3  A9 01                lda #1
002D37  3  C5 rr                cmp scno
002D39  3  90 03                bcc *+5
002D3B  3  4C 44 2D             jmp a02662
002D3E  3  A9 18                lda #24
002D40  3  A0 09                ldy #9
002D42  3  91 rr                sta (z80_ix),y
002D44  3  A9 06        a02662: lda #6
002D46  3  C5 rr                cmp varobj
002D48  3  F0 03                beq *+5
002D4A  3  4C 61 2D             jmp a02723
002D4D  3  A0 08                ldy #8
002D4F  3  B1 rr                lda (z80_ix),y
002D51  3  85 rr                sta varo
002D53  3  A0 09                ldy #9
002D55  3  B1 rr                lda (z80_ix),y
002D57  3  85 rr                sta varp
002D59  3  A9 02                lda #2
002D5B  3  85 rr                sta varg
002D5D  3  A9 03                lda #3
002D5F  3  85 rr                sta vard
002D61  3  A9 05        a02723: lda #5
002D63  3  C5 rr                cmp varg
002D65  3  F0 03                beq *+5
002D67  3  4C 80 2D             jmp a02784
002D6A  3  A9 06                lda #6
002D6C  3  20 35 19             jsr getob
002D6F  3  A0 09                ldy #9
002D71  3  B1 rr                lda (z80_ix),y
002D73  3  85 rr                sta dispx
002D75  3  A0 08                ldy #8
002D77  3  B1 rr                lda (z80_ix),y
002D79  3  85 rr                sta dispy
002D7B  3  A9 06                lda #6
002D7D  3  20 95 19             jsr drpob
002D80  3  A9 06        a02784: lda #6
002D82  3  C5 rr                cmp varg
002D84  3  F0 03                beq *+5
002D86  3  4C A5 2D             jmp a02859
002D89  3  A9 06                lda #6
002D8B  3  A0 0A                ldy #10
002D8D  3  D1 rr                cmp (z80_ix),y
002D8F  3  F0 03                beq *+5
002D91  3  4C A5 2D             jmp a02859
002D94  3  A0 09                ldy #9
002D96  3  B1 rr                lda (z80_ix),y
002D98  3  85 rr                sta dispx
002D9A  3  A0 08                ldy #8
002D9C  3  B1 rr                lda (z80_ix),y
002D9E  3  85 rr                sta dispy
002DA0  3  A9 06                lda #6
002DA2  3  20 95 19             jsr drpob
002DA5  3  A9 90        a02859: lda #144
002DA7  3  A0 09                ldy #9
002DA9  3  91 rr                sta (z80_ix),y
002DAB  3  A9 01                lda #1
002DAD  3  C5 rr                cmp scno
002DAF  3  90 03                bcc *+5
002DB1  3  4C BA 2D             jmp a02904
002DB4  3  A9 A8                lda #168
002DB6  3  A0 09                ldy #9
002DB8  3  91 rr                sta (z80_ix),y
002DBA  3  A9 07        a02904: lda #7
002DBC  3  C5 rr                cmp varobj
002DBE  3  F0 03                beq *+5
002DC0  3  4C D7 2D             jmp a02964
002DC3  3  A0 08                ldy #8
002DC5  3  B1 rr                lda (z80_ix),y
002DC7  3  85 rr                sta varo
002DC9  3  A0 09                ldy #9
002DCB  3  B1 rr                lda (z80_ix),y
002DCD  3  85 rr                sta varp
002DCF  3  A9 02                lda #2
002DD1  3  85 rr                sta varg
002DD3  3  A9 02                lda #2
002DD5  3  85 rr                sta vard
002DD7  3  A9 05        a02964: lda #5
002DD9  3  C5 rr                cmp varg
002DDB  3  F0 03                beq *+5
002DDD  3  4C F6 2D             jmp a03026
002DE0  3  A9 07                lda #7
002DE2  3  20 35 19             jsr getob
002DE5  3  A0 09                ldy #9
002DE7  3  B1 rr                lda (z80_ix),y
002DE9  3  85 rr                sta dispx
002DEB  3  A0 08                ldy #8
002DED  3  B1 rr                lda (z80_ix),y
002DEF  3  85 rr                sta dispy
002DF1  3  A9 07                lda #7
002DF3  3  20 95 19             jsr drpob
002DF6  3  A9 06        a03026: lda #6
002DF8  3  C5 rr                cmp varg
002DFA  3  F0 03                beq *+5
002DFC  3  4C 32 2E             jmp a03153
002DFF  3  A9 07                lda #7
002E01  3  A0 0A                ldy #10
002E03  3  D1 rr                cmp (z80_ix),y
002E05  3  F0 03                beq *+5
002E07  3  4C 1B 2E             jmp a03101
002E0A  3  A0 09                ldy #9
002E0C  3  B1 rr                lda (z80_ix),y
002E0E  3  85 rr                sta dispx
002E10  3  A0 08                ldy #8
002E12  3  B1 rr                lda (z80_ix),y
002E14  3  85 rr                sta dispy
002E16  3  A9 07                lda #7
002E18  3  20 95 19             jsr drpob
002E1B  3  A5 rr        a03101: lda vara
002E1D  3  A0 08                ldy #8
002E1F  3  91 rr                sta (z80_ix),y
002E21  3  A5 rr                lda varb
002E23  3  A0 09                ldy #9
002E25  3  91 rr                sta (z80_ix),y
002E27  3  A9 FF                lda #255
002E29  3  A0 0A                ldy #10
002E2B  3  91 rr                sta (z80_ix),y
002E2D  3  A9 03                lda #3
002E2F  3  85 rr                sta varg
002E31  3  60                   rts
002E32  3  A9 02        a03153: lda #2
002E34  3  C5 rr                cmp varg
002E36  3  F0 03                beq *+5
002E38  3  4C C6 2F             jmp a04012
002E3B  3  A5 rr                lda varobj
002E3D  3  A0 0A                ldy #10
002E3F  3  91 rr                sta (z80_ix),y
002E41  3  A5 rr                lda varobj
002E43  3  20 35 19             jsr getob
002E46  3  A5 rr                lda varo
002E48  3  A0 08                ldy #8
002E4A  3  91 rr                sta (z80_ix),y
002E4C  3  A5 rr                lda varp
002E4E  3  A0 09                ldy #9
002E50  3  91 rr                sta (z80_ix),y
002E52  3  A5 rr                lda vars
002E54  3  C5 rr                cmp varobj
002E56  3  F0 03                beq *+5
002E58  3  4C E7 2E             jmp a03537
002E5B  3  A9 50                lda #<80
002E5D  3  85 rr                sta z80_l
002E5F  3  A9 00                lda #>80
002E61  3  85 rr                sta z80_h
002E63  3  20 2B 1B             jsr addsc
002E66  3  A9 01                lda #1
002E68  3  85 rr                sta chary
002E6A  3  A9 1B                lda #27
002E6C  3  85 rr                sta charx
002E6E  3  20 DF 1A             jsr dscor
002E71  3  A9 04                lda #4
002E73  3  85 rr                sta chary
002E75  3  A9 1B                lda #27
002E77  3  85 rr                sta charx
002E79  3  A9 08                lda #8
002E7B  3  85 rr                sta z80_c
002E7D  3  A9 09                lda #9
002E7F  3  85 rr                sta z80_b
002E81  3  20 0F 1A             jsr spawn
002E84  3  A5 rr                lda spptr
002E86  3  85 rr                sta z80_x
002E88  3  A5 rr                lda spptr+1
002E8A  3  85 rr                sta z80_i
002E8C  3  A5 rr                lda vard
002E8E  3  A0 0A                ldy #10
002E90  3  91 rr                sta (z80_ix),y
002E92  3  A5 rr                lda vard
002E94  3  85 rr                sta z80_c
002E96  3  A0 06                ldy #6
002E98  3  B1 rr                lda (z80_ix),y
002E9A  3  18                   clc
002E9B  3  65 rr                adc z80_c
002E9D  3  A0 06                ldy #6
002E9F  3  91 rr                sta (z80_ix),y
002EA1  3  A9 32                lda #50
002EA3  3  A0 0C                ldy #12
002EA5  3  91 rr                sta (z80_ix),y
002EA7  3  A9 00                lda #0
002EA9  3  A0 0B                ldy #11
002EAB  3  91 rr                sta (z80_ix),y
002EAD  3  A9 00                lda #0
002EAF  3  C5 rr                cmp scno
002EB1  3  90 03                bcc *+5
002EB3  3  4C BC 2E             jmp a03445
002EB6  3  A9 01                lda #1
002EB8  3  A0 0B                ldy #11
002EBA  3  91 rr                sta (z80_ix),y
002EBC  3  A9 02        a03445: lda #2
002EBE  3  C5 rr                cmp scno
002EC0  3  90 03                bcc *+5
002EC2  3  4C CB 2E             jmp a03476
002EC5  3  A9 02                lda #2
002EC7  3  A0 0B                ldy #11
002EC9  3  91 rr                sta (z80_ix),y
002ECB  3  A9 00        a03476: lda #0
002ECD  3  85 rr                sta varg
002ECF  3  A5 rr                lda ogptr
002ED1  3  85 rr                sta z80_x
002ED3  3  A5 rr                lda ogptr+1
002ED5  3  85 rr                sta z80_i
002ED7  3  A5 rr                lda vara
002ED9  3  A0 08                ldy #8
002EDB  3  91 rr                sta (z80_ix),y
002EDD  3  A5 rr                lda varb
002EDF  3  A0 09                ldy #9
002EE1  3  91 rr                sta (z80_ix),y
002EE3  3  60                   rts
002EE4  3  4C C6 2F             jmp a04012
002EE7  3  A5 rr        a03537: lda vart
002EE9  3  C5 rr                cmp varobj
002EEB  3  F0 03                beq *+5
002EED  3  4C 74 2F             jmp a03834
002EF0  3  A9 01                lda #1
002EF2  3  85 rr                sta varq
002EF4  3  A9 50                lda #<80
002EF6  3  85 rr                sta z80_l
002EF8  3  A9 00                lda #>80
002EFA  3  85 rr                sta z80_h
002EFC  3  20 2B 1B             jsr addsc
002EFF  3  A9 01                lda #1
002F01  3  85 rr                sta chary
002F03  3  A9 1B                lda #27
002F05  3  85 rr                sta charx
002F07  3  20 DF 1A             jsr dscor
002F0A  3  A9 04                lda #4
002F0C  3  85 rr                sta chary
002F0E  3  A9 1B                lda #27
002F10  3  85 rr                sta charx
002F12  3  A9 08                lda #8
002F14  3  85 rr                sta z80_c
002F16  3  A9 09                lda #9
002F18  3  85 rr                sta z80_b
002F1A  3  20 0F 1A             jsr spawn
002F1D  3  A5 rr                lda spptr
002F1F  3  85 rr                sta z80_x
002F21  3  A5 rr                lda spptr+1
002F23  3  85 rr                sta z80_i
002F25  3  A5 rr                lda vard
002F27  3  85 rr                sta z80_c
002F29  3  A0 06                ldy #6
002F2B  3  B1 rr                lda (z80_ix),y
002F2D  3  18                   clc
002F2E  3  65 rr                adc z80_c
002F30  3  A0 06                ldy #6
002F32  3  91 rr                sta (z80_ix),y
002F34  3  A9 32                lda #50
002F36  3  A0 0C                ldy #12
002F38  3  91 rr                sta (z80_ix),y
002F3A  3  A9 00                lda #0
002F3C  3  C5 rr                cmp scno
002F3E  3  90 03                bcc *+5
002F40  3  4C 49 2F             jmp a03742
002F43  3  A9 01                lda #1
002F45  3  A0 0B                ldy #11
002F47  3  91 rr                sta (z80_ix),y
002F49  3  A9 02        a03742: lda #2
002F4B  3  C5 rr                cmp scno
002F4D  3  90 03                bcc *+5
002F4F  3  4C 58 2F             jmp a03772
002F52  3  A9 02                lda #2
002F54  3  A0 0B                ldy #11
002F56  3  91 rr                sta (z80_ix),y
002F58  3  A9 00        a03772: lda #0
002F5A  3  85 rr                sta varg
002F5C  3  A5 rr                lda ogptr
002F5E  3  85 rr                sta z80_x
002F60  3  A5 rr                lda ogptr+1
002F62  3  85 rr                sta z80_i
002F64  3  A5 rr                lda vara
002F66  3  A0 08                ldy #8
002F68  3  91 rr                sta (z80_ix),y
002F6A  3  A5 rr                lda varb
002F6C  3  A0 09                ldy #9
002F6E  3  91 rr                sta (z80_ix),y
002F70  3  60                   rts
002F71  3  4C C6 2F             jmp a04012
002F74  3  A9 64        a03834: lda #<100
002F76  3  85 rr                sta z80_l
002F78  3  A9 00                lda #>100
002F7A  3  85 rr                sta z80_h
002F7C  3  20 2B 1B             jsr addsc
002F7F  3  A9 01                lda #1
002F81  3  85 rr                sta chary
002F83  3  A9 1B                lda #27
002F85  3  85 rr                sta charx
002F87  3  20 DF 1A             jsr dscor
002F8A  3  A9 04                lda #4
002F8C  3  85 rr                sta chary
002F8E  3  A9 1B                lda #27
002F90  3  85 rr                sta charx
002F92  3  A9 04                lda #4
002F94  3  85 rr                sta z80_c
002F96  3  A9 0E                lda #14
002F98  3  85 rr                sta z80_b
002F9A  3  20 0F 1A             jsr spawn
002F9D  3  A5 rr                lda spptr
002F9F  3  85 rr                sta z80_x
002FA1  3  A5 rr                lda spptr+1
002FA3  3  85 rr                sta z80_i
002FA5  3  A5 rr                lda vard
002FA7  3  A0 0A                ldy #10
002FA9  3  91 rr                sta (z80_ix),y
002FAB  3  A5 rr                lda varobj
002FAD  3  A0 0B                ldy #11
002FAF  3  91 rr                sta (z80_ix),y
002FB1  3  A5 rr                lda ogptr
002FB3  3  85 rr                sta z80_x
002FB5  3  A5 rr                lda ogptr+1
002FB7  3  85 rr                sta z80_i
002FB9  3  A5 rr                lda vara
002FBB  3  A0 08                ldy #8
002FBD  3  91 rr                sta (z80_ix),y
002FBF  3  A5 rr                lda varb
002FC1  3  A0 09                ldy #9
002FC3  3  91 rr                sta (z80_ix),y
002FC5  3  60                   rts
002FC6  3  A5 rr        a04012: lda vara
002FC8  3  A0 08                ldy #8
002FCA  3  91 rr                sta (z80_ix),y
002FCC  3  A5 rr                lda varb
002FCE  3  A0 09                ldy #9
002FD0  3  91 rr                sta (z80_ix),y
002FD2  3  A9 05                lda #5
002FD4  3  C5 rr                cmp varg
002FD6  3  F0 03                beq *+5
002FD8  3  4C DF 2F             jmp a04064
002FDB  3  A9 00                lda #0
002FDD  3  85 rr                sta varg
002FDF  3  A9 00        a04064: lda #0
002FE1  3  85 rr                sta varq
002FE3  3  A5 rr                lda joyval
002FE5  3  29 20                and #32
002FE7  3  F0 03                beq :+
002FE9  3  4C F0 2F             jmp a04098
002FEC  3               :
002FEC  3  A9 01                lda #1
002FEE  3  85 rr                sta varq
002FF0  3  A5 rr        a04098: lda joyval
002FF2  3  29 10                and #16
002FF4  3  F0 03                beq :+
002FF6  3  4C FD 2F             jmp a04123
002FF9  3               :
002FF9  3  A9 01                lda #1
002FFB  3  85 rr                sta varq
002FFD  3  A9 01        a04123: lda #1
002FFF  3  C5 rr                cmp varq
003001  3  F0 03                beq *+5
003003  3  4C 75 30             jmp a04376
003006  3  A9 00                lda #0
003008  3  A0 0B                ldy #11
00300A  3  D1 rr                cmp (z80_ix),y
00300C  3  F0 03                beq *+5
00300E  3  4C 75 30             jmp a04376
003011  3  A9 00                lda #0
003013  3  C5 rr                cmp vark
003015  3  90 03                bcc *+5
003017  3  4C 75 30             jmp a04376
00301A  3  A9 02                lda #2
00301C  3  85 rr                sta z80_c
00301E  3  A9 08                lda #8
003020  3  85 rr                sta z80_b
003022  3  20 0F 1A             jsr spawn
003025  3  A9 01                lda #1
003027  3  A0 0B                ldy #11
003029  3  91 rr                sta (z80_ix),y
00302B  3  A5 rr                lda spptr
00302D  3  85 rr                sta z80_x
00302F  3  A5 rr                lda spptr+1
003031  3  85 rr                sta z80_i
003033  3  A5 rr                lda clock
003035  3  A0 0C                ldy #12
003037  3  91 rr                sta (z80_ix),y
003039  3  A9 FF                lda #255
00303B  3  85 rr                sta z80_c
00303D  3  A0 0C                ldy #12
00303F  3  B1 rr                lda (z80_ix),y
003041  3  18                   clc
003042  3  65 rr                adc z80_c
003044  3  A0 0C                ldy #12
003046  3  91 rr                sta (z80_ix),y
003048  3  A9 FF                lda #255
00304A  3  85 rr                sta z80_c
00304C  3  A5 rr                lda vark
00304E  3  18                   clc
00304F  3  65 rr                adc z80_c
003051  3  85 rr                sta vark
003053  3  A9 07                lda #7
003055  3  85 rr                sta chary
003057  3  A9 1D                lda #29
003059  3  85 rr                sta charx
00305B  3  A9 18                lda #24
00305D  3  20 7F 20             jsr dmsg
003060  3  A9 07                lda #7
003062  3  85 rr                sta chary
003064  3  A9 1D                lda #29
003066  3  85 rr                sta charx
003068  3  A5 rr                lda vark
00306A  3  20 CD 24             jsr disply
00306D  3  A5 rr                lda ogptr
00306F  3  85 rr                sta z80_x
003071  3  A5 rr                lda ogptr+1
003073  3  85 rr                sta z80_i
003075  3  A5 rr        a04376: lda joyval
003077  3  29 08                and #8
003079  3  F0 03                beq :+
00307B  3  4C F9 30             jmp a04645
00307E  3               :
00307E  3  20 9C 1D             jsr cangu
003081  3  F0 03                beq :+
003083  3  4C 98 30             jmp a04447
003086  3               :
003086  3  A0 08                ldy #8
003088  3  B1 rr                lda (z80_ix),y
00308A  3  38                   sec
00308B  3  E9 02                sbc #2
00308D  3  91 rr                sta (z80_ix),y
00308F  3  A9 00                lda #0
003091  3  A0 06                ldy #6
003093  3  91 rr                sta (z80_ix),y
003095  3  4C D2 30             jmp a04572
003098  3  A0 09        a04447: ldy #9
00309A  3  B1 rr                lda (z80_ix),y
00309C  3  18                   clc
00309D  3  69 02                adc #2
00309F  3  91 rr                sta (z80_ix),y
0030A1  3  20 9C 1D             jsr cangu
0030A4  3  F0 03                beq :+
0030A6  3  4C AC 30             jmp a04487
0030A9  3               :
0030A9  3  4C D2 30             jmp a04572
0030AC  3  A0 09        a04487: ldy #9
0030AE  3  B1 rr                lda (z80_ix),y
0030B0  3  38                   sec
0030B1  3  E9 02                sbc #2
0030B3  3  91 rr                sta (z80_ix),y
0030B5  3  A0 09                ldy #9
0030B7  3  B1 rr                lda (z80_ix),y
0030B9  3  38                   sec
0030BA  3  E9 02                sbc #2
0030BC  3  91 rr                sta (z80_ix),y
0030BE  3  20 9C 1D             jsr cangu
0030C1  3  F0 03                beq :+
0030C3  3  4C C9 30             jmp a04550
0030C6  3               :
0030C6  3  4C D2 30             jmp a04572
0030C9  3  A0 09        a04550: ldy #9
0030CB  3  B1 rr                lda (z80_ix),y
0030CD  3  18                   clc
0030CE  3  69 02                adc #2
0030D0  3  91 rr                sta (z80_ix),y
0030D2  3  A0 08        a04572: ldy #8
0030D4  3  B1 rr                lda (z80_ix),y
0030D6  3  C5 rr                cmp vara
0030D8  3  90 03                bcc *+5
0030DA  3  4C F9 30             jmp a04645
0030DD  3  A9 00                lda #0
0030DF  3  C5 rr                cmp varc
0030E1  3  F0 03                beq *+5
0030E3  3  4C EB 30             jmp a04619
0030E6  3  A9 00                lda #0
0030E8  3  20 F2 23             jsr animsp
0030EB  3  A9 02        a04619: lda #2
0030ED  3  C5 rr                cmp varc
0030EF  3  F0 03                beq *+5
0030F1  3  4C F9 30             jmp a04645
0030F4  3  A9 00                lda #0
0030F6  3  20 F2 23             jsr animsp
0030F9  3  A5 rr        a04645: lda joyval
0030FB  3  29 04                and #4
0030FD  3  F0 03                beq :+
0030FF  3  4C 7D 31             jmp a04913
003102  3               :
003102  3  20 D1 1D             jsr cangd
003105  3  F0 03                beq :+
003107  3  4C 1C 31             jmp a04716
00310A  3               :
00310A  3  A0 08                ldy #8
00310C  3  B1 rr                lda (z80_ix),y
00310E  3  18                   clc
00310F  3  69 02                adc #2
003111  3  91 rr                sta (z80_ix),y
003113  3  A9 01                lda #1
003115  3  A0 06                ldy #6
003117  3  91 rr                sta (z80_ix),y
003119  3  4C 56 31             jmp a04840
00311C  3  A0 09        a04716: ldy #9
00311E  3  B1 rr                lda (z80_ix),y
003120  3  18                   clc
003121  3  69 02                adc #2
003123  3  91 rr                sta (z80_ix),y
003125  3  20 D1 1D             jsr cangd
003128  3  F0 03                beq :+
00312A  3  4C 30 31             jmp a04756
00312D  3               :
00312D  3  4C 56 31             jmp a04840
003130  3  A0 09        a04756: ldy #9
003132  3  B1 rr                lda (z80_ix),y
003134  3  38                   sec
003135  3  E9 02                sbc #2
003137  3  91 rr                sta (z80_ix),y
003139  3  A0 09                ldy #9
00313B  3  B1 rr                lda (z80_ix),y
00313D  3  38                   sec
00313E  3  E9 02                sbc #2
003140  3  91 rr                sta (z80_ix),y
003142  3  20 D1 1D             jsr cangd
003145  3  F0 03                beq :+
003147  3  4C 4D 31             jmp a04818
00314A  3               :
00314A  3  4C 56 31             jmp a04840
00314D  3  A0 09        a04818: ldy #9
00314F  3  B1 rr                lda (z80_ix),y
003151  3  18                   clc
003152  3  69 02                adc #2
003154  3  91 rr                sta (z80_ix),y
003156  3  A5 rr        a04840: lda vara
003158  3  A0 08                ldy #8
00315A  3  D1 rr                cmp (z80_ix),y
00315C  3  90 03                bcc *+5
00315E  3  4C 7D 31             jmp a04913
003161  3  A9 00                lda #0
003163  3  C5 rr                cmp varc
003165  3  F0 03                beq *+5
003167  3  4C 6F 31             jmp a04888
00316A  3  A9 00                lda #0
00316C  3  20 F2 23             jsr animsp
00316F  3  A9 02        a04888: lda #2
003171  3  C5 rr                cmp varc
003173  3  F0 03                beq *+5
003175  3  4C 7D 31             jmp a04913
003178  3  A9 00                lda #0
00317A  3  20 F2 23             jsr animsp
00317D  3  A5 rr        a04913: lda joyval
00317F  3  29 01                and #1
003181  3  F0 03                beq :+
003183  3  4C 0C 32             jmp a05204
003186  3               :
003186  3  A0 09                ldy #9
003188  3  B1 rr                lda (z80_ix),y
00318A  3  C9 BF                cmp #191
00318C  3  90 03                bcc *+5
00318E  3  4C 0C 32             jmp a05204
003191  3  20 18 1E             jsr cangr
003194  3  F0 03                beq :+
003196  3  4C AB 31             jmp a05007
003199  3               :
003199  3  A9 02                lda #2
00319B  3  A0 06                ldy #6
00319D  3  91 rr                sta (z80_ix),y
00319F  3  A0 09                ldy #9
0031A1  3  B1 rr                lda (z80_ix),y
0031A3  3  18                   clc
0031A4  3  69 02                adc #2
0031A6  3  91 rr                sta (z80_ix),y
0031A8  3  4C E5 31             jmp a05131
0031AB  3  A0 08        a05007: ldy #8
0031AD  3  B1 rr                lda (z80_ix),y
0031AF  3  38                   sec
0031B0  3  E9 02                sbc #2
0031B2  3  91 rr                sta (z80_ix),y
0031B4  3  20 18 1E             jsr cangr
0031B7  3  F0 03                beq :+
0031B9  3  4C BF 31             jmp a05047
0031BC  3               :
0031BC  3  4C E5 31             jmp a05131
0031BF  3  A0 08        a05047: ldy #8
0031C1  3  B1 rr                lda (z80_ix),y
0031C3  3  18                   clc
0031C4  3  69 02                adc #2
0031C6  3  91 rr                sta (z80_ix),y
0031C8  3  A0 08                ldy #8
0031CA  3  B1 rr                lda (z80_ix),y
0031CC  3  18                   clc
0031CD  3  69 02                adc #2
0031CF  3  91 rr                sta (z80_ix),y
0031D1  3  20 18 1E             jsr cangr
0031D4  3  F0 03                beq :+
0031D6  3  4C DC 31             jmp a05109
0031D9  3               :
0031D9  3  4C E5 31             jmp a05131
0031DC  3  A0 08        a05109: ldy #8
0031DE  3  B1 rr                lda (z80_ix),y
0031E0  3  38                   sec
0031E1  3  E9 02                sbc #2
0031E3  3  91 rr                sta (z80_ix),y
0031E5  3  A5 rr        a05131: lda varb
0031E7  3  A0 09                ldy #9
0031E9  3  D1 rr                cmp (z80_ix),y
0031EB  3  90 03                bcc *+5
0031ED  3  4C 0C 32             jmp a05204
0031F0  3  A9 00                lda #0
0031F2  3  C5 rr                cmp varc
0031F4  3  F0 03                beq *+5
0031F6  3  4C FE 31             jmp a05179
0031F9  3  A9 00                lda #0
0031FB  3  20 F2 23             jsr animsp
0031FE  3  A9 02        a05179: lda #2
003200  3  C5 rr                cmp varc
003202  3  F0 03                beq *+5
003204  3  4C 0C 32             jmp a05204
003207  3  A9 00                lda #0
003209  3  20 F2 23             jsr animsp
00320C  3  A5 rr        a05204: lda joyval
00320E  3  29 02                and #2
003210  3  F0 03                beq :+
003212  3  4C 9B 32             jmp a05495
003215  3               :
003215  3  A9 01                lda #1
003217  3  A0 09                ldy #9
003219  3  D1 rr                cmp (z80_ix),y
00321B  3  90 03                bcc *+5
00321D  3  4C 9B 32             jmp a05495
003220  3  20 06 1E             jsr cangl
003223  3  F0 03                beq :+
003225  3  4C 3A 32             jmp a05297
003228  3               :
003228  3  A0 09                ldy #9
00322A  3  B1 rr                lda (z80_ix),y
00322C  3  38                   sec
00322D  3  E9 02                sbc #2
00322F  3  91 rr                sta (z80_ix),y
003231  3  A9 03                lda #3
003233  3  A0 06                ldy #6
003235  3  91 rr                sta (z80_ix),y
003237  3  4C 74 32             jmp a05422
00323A  3  A0 08        a05297: ldy #8
00323C  3  B1 rr                lda (z80_ix),y
00323E  3  38                   sec
00323F  3  E9 02                sbc #2
003241  3  91 rr                sta (z80_ix),y
003243  3  20 06 1E             jsr cangl
003246  3  F0 03                beq :+
003248  3  4C 4E 32             jmp a05337
00324B  3               :
00324B  3  4C 74 32             jmp a05422
00324E  3  A0 08        a05337: ldy #8
003250  3  B1 rr                lda (z80_ix),y
003252  3  18                   clc
003253  3  69 02                adc #2
003255  3  91 rr                sta (z80_ix),y
003257  3  A0 08                ldy #8
003259  3  B1 rr                lda (z80_ix),y
00325B  3  18                   clc
00325C  3  69 02                adc #2
00325E  3  91 rr                sta (z80_ix),y
003260  3  20 06 1E             jsr cangl
003263  3  F0 03                beq :+
003265  3  4C 6B 32             jmp a05400
003268  3               :
003268  3  4C 74 32             jmp a05422
00326B  3  A0 08        a05400: ldy #8
00326D  3  B1 rr                lda (z80_ix),y
00326F  3  38                   sec
003270  3  E9 02                sbc #2
003272  3  91 rr                sta (z80_ix),y
003274  3  A0 09        a05422: ldy #9
003276  3  B1 rr                lda (z80_ix),y
003278  3  C5 rr                cmp varb
00327A  3  90 03                bcc *+5
00327C  3  4C 9B 32             jmp a05495
00327F  3  A9 00                lda #0
003281  3  C5 rr                cmp varc
003283  3  F0 03                beq *+5
003285  3  4C 8D 32             jmp a05469
003288  3  A9 00                lda #0
00328A  3  20 F2 23             jsr animsp
00328D  3  A9 02        a05469: lda #2
00328F  3  C5 rr                cmp varc
003291  3  F0 03                beq *+5
003293  3  4C 9B 32             jmp a05495
003296  3  A9 00                lda #0
003298  3  20 F2 23             jsr animsp
00329B  3  A9 FA        a05495: lda #250
00329D  3  A0 08                ldy #8
00329F  3  D1 rr                cmp (z80_ix),y
0032A1  3  90 03                bcc *+5
0032A3  3  4C AC 32             jmp a05530
0032A6  3  A9 00                lda #0
0032A8  3  A0 08                ldy #8
0032AA  3  91 rr                sta (z80_ix),y
0032AC  3  A9 B0        a05530: lda #176
0032AE  3  A0 08                ldy #8
0032B0  3  D1 rr                cmp (z80_ix),y
0032B2  3  90 03                bcc *+5
0032B4  3  4C BD 32             jmp a05567
0032B7  3  A9 B0                lda #176
0032B9  3  A0 08                ldy #8
0032BB  3  91 rr                sta (z80_ix),y
0032BD  3  A9 01        a05567: lda #1
0032BF  3  C5 rr                cmp varg
0032C1  3  F0 03                beq *+5
0032C3  3  4C E0 32             jmp a05640
0032C6  3  A0 06                ldy #6
0032C8  3  B1 rr                lda (z80_ix),y
0032CA  3  C9 04                cmp #4
0032CC  3  90 03                bcc *+5
0032CE  3  4C E0 32             jmp a05640
0032D1  3  A9 04                lda #4
0032D3  3  85 rr                sta z80_c
0032D5  3  A0 06                ldy #6
0032D7  3  B1 rr                lda (z80_ix),y
0032D9  3  18                   clc
0032DA  3  65 rr                adc z80_c
0032DC  3  A0 06                ldy #6
0032DE  3  91 rr                sta (z80_ix),y
0032E0  3  60           a05640: rts
0032E1  3               .out .sprintf("EVENT 0 SIZE = %d", (* - evnt00))
0032E1  3               
0032E1  3               evnt01:
0032E1  3  A9 00                lda #0
0032E3  3  C5 rr                cmp scno
0032E5  3  F0 03                beq *+5
0032E7  3  4C EE 32             jmp b00027
0032EA  3  A9 0A                lda #10
0032EC  3  85 rr                sta varq
0032EE  3  A9 01        b00027: lda #1
0032F0  3  C5 rr                cmp scno
0032F2  3  F0 03                beq *+5
0032F4  3  4C FB 32             jmp b00051
0032F7  3  A9 09                lda #9
0032F9  3  85 rr                sta varq
0032FB  3  A9 02        b00051: lda #2
0032FD  3  C5 rr                cmp scno
0032FF  3  F0 03                beq *+5
003301  3  4C 08 33             jmp b00076
003304  3  A9 08                lda #8
003306  3  85 rr                sta varq
003308  3  A9 03        b00076: lda #3
00330A  3  C5 rr                cmp scno
00330C  3  F0 03                beq *+5
00330E  3  4C 15 33             jmp b00101
003311  3  A9 07                lda #7
003313  3  85 rr                sta varq
003315  3  A0 0B        b00101: ldy #11
003317  3  B1 rr                lda (z80_ix),y
003319  3  C9 02                cmp #2
00331B  3  90 03                bcc *+5
00331D  3  4C 50 33             jmp b00229
003320  3  A9 00                lda #0
003322  3  C5 rr                cmp clock
003324  3  F0 03                beq *+5
003326  3  4C 50 33             jmp b00229
003329  3  A0 0C                ldy #12
00332B  3  B1 rr                lda (z80_ix),y
00332D  3  18                   clc
00332E  3  69 01                adc #1
003330  3  A0 0C                ldy #12
003332  3  91 rr                sta (z80_ix),y
003334  3  A5 rr                lda varq
003336  3  A0 0C                ldy #12
003338  3  D1 rr                cmp (z80_ix),y
00333A  3  F0 03                beq *+5
00333C  3  4C 50 33             jmp b00229
00333F  3  A9 00                lda #0
003341  3  A0 0C                ldy #12
003343  3  91 rr                sta (z80_ix),y
003345  3  A0 0B                ldy #11
003347  3  B1 rr                lda (z80_ix),y
003349  3  18                   clc
00334A  3  69 01                adc #1
00334C  3  A0 0B                ldy #11
00334E  3  91 rr                sta (z80_ix),y
003350  3  A9 02        b00229: lda #2
003352  3  C5 rr                cmp varg
003354  3  F0 03                beq *+5
003356  3  4C 5A 33             jmp b00249
003359  3  60                   rts
00335A  3  A0 0B        b00249: ldy #11
00335C  3  B1 rr                lda (z80_ix),y
00335E  3  C9 02                cmp #2
003360  3  90 03                bcc *+5
003362  3  4C 84 33             jmp b00326
003365  3  A9 00                lda #0
003367  3  C5 rr                cmp varc
003369  3  F0 03                beq *+5
00336B  3  4C 73 33             jmp b00296
00336E  3  A9 00                lda #0
003370  3  20 F2 23             jsr animsp
003373  3  A9 02        b00296: lda #2
003375  3  C5 rr                cmp varc
003377  3  F0 03                beq *+5
003379  3  4C 81 33             jmp b00321
00337C  3  A9 00                lda #0
00337E  3  20 F2 23             jsr animsp
003381  3  4C 89 33     b00321: jmp b00335
003384  3  A9 00        b00326: lda #0
003386  3  20 F2 23             jsr animsp
003389  3  A0 0A        b00335: ldy #10
00338B  3  B1 rr                lda (z80_ix),y
00338D  3  85 rr                sta vard
00338F  3  A9 00                lda #0
003391  3  85 rr                sta varo
003393  3  A9 00                lda #0
003395  3  A0 08                ldy #8
003397  3  D1 rr                cmp (z80_ix),y
003399  3  90 03                bcc *+5
00339B  3  4C 1E 34             jmp b00643
00339E  3  20 9C 1D             jsr cangu
0033A1  3  F0 03                beq :+
0033A3  3  4C AA 33             jmp b00400
0033A6  3               :
0033A6  3  A9 01                lda #1
0033A8  3  85 rr                sta varo
0033AA  3  A9 00        b00400: lda #0
0033AC  3  C5 rr                cmp varo
0033AE  3  F0 03                beq *+5
0033B0  3  4C E4 33             jmp b00521
0033B3  3  A9 00                lda #0
0033B5  3  A0 09                ldy #9
0033B7  3  D1 rr                cmp (z80_ix),y
0033B9  3  90 03                bcc *+5
0033BB  3  4C E4 33             jmp b00521
0033BE  3  A9 FF                lda #255
0033C0  3  85 rr                sta z80_c
0033C2  3  A0 09                ldy #9
0033C4  3  B1 rr                lda (z80_ix),y
0033C6  3  18                   clc
0033C7  3  65 rr                adc z80_c
0033C9  3  A0 09                ldy #9
0033CB  3  91 rr                sta (z80_ix),y
0033CD  3  20 9C 1D             jsr cangu
0033D0  3  F0 03                beq :+
0033D2  3  4C D9 33             jmp b00496
0033D5  3               :
0033D5  3  A9 02                lda #2
0033D7  3  85 rr                sta varo
0033D9  3  A0 09        b00496: ldy #9
0033DB  3  B1 rr                lda (z80_ix),y
0033DD  3  18                   clc
0033DE  3  69 01                adc #1
0033E0  3  A0 09                ldy #9
0033E2  3  91 rr                sta (z80_ix),y
0033E4  3  A9 00        b00521: lda #0
0033E6  3  C5 rr                cmp varo
0033E8  3  F0 03                beq *+5
0033EA  3  4C 1E 34             jmp b00643
0033ED  3  A0 09                ldy #9
0033EF  3  B1 rr                lda (z80_ix),y
0033F1  3  C9 C0                cmp #192
0033F3  3  90 03                bcc *+5
0033F5  3  4C 1E 34             jmp b00643
0033F8  3  A0 09                ldy #9
0033FA  3  B1 rr                lda (z80_ix),y
0033FC  3  18                   clc
0033FD  3  69 01                adc #1
0033FF  3  A0 09                ldy #9
003401  3  91 rr                sta (z80_ix),y
003403  3  20 9C 1D             jsr cangu
003406  3  F0 03                beq :+
003408  3  4C 0F 34             jmp b00608
00340B  3               :
00340B  3  A9 03                lda #3
00340D  3  85 rr                sta varo
00340F  3  A9 FF        b00608: lda #255
003411  3  85 rr                sta z80_c
003413  3  A0 09                ldy #9
003415  3  B1 rr                lda (z80_ix),y
003417  3  18                   clc
003418  3  65 rr                adc z80_c
00341A  3  A0 09                ldy #9
00341C  3  91 rr                sta (z80_ix),y
00341E  3  A9 00        b00643: lda #0
003420  3  A0 08                ldy #8
003422  3  D1 rr                cmp (z80_ix),y
003424  3  F0 03                beq *+5
003426  3  4C 2D 34             jmp b00673
003429  3  A9 00                lda #0
00342B  3  85 rr                sta varo
00342D  3  A9 00        b00673: lda #0
00342F  3  C5 rr                cmp varo
003431  3  90 03                bcc *+5
003433  3  4C 7D 34             jmp b00836
003436  3  A9 00                lda #0
003438  3  C5 rr                cmp vard
00343A  3  F0 03                beq *+5
00343C  3  4C 7D 34             jmp b00836
00343F  3  A9 F8                lda #248
003441  3  85 rr                sta z80_c
003443  3  A0 08                ldy #8
003445  3  B1 rr                lda (z80_ix),y
003447  3  18                   clc
003448  3  65 rr                adc z80_c
00344A  3  A0 08                ldy #8
00344C  3  91 rr                sta (z80_ix),y
00344E  3  A9 01                lda #1
003450  3  85 rr                sta z80_b
003452  3  20 3D 24             jsr sktyp
003455  3  B0 03                bcs :+
003457  3  4C 5E 34             jmp b00772
00345A  3               :
00345A  3  A9 00                lda #0
00345C  3  85 rr                sta varo
00345E  3  A9 08        b00772: lda #8
003460  3  85 rr                sta z80_b
003462  3  20 3D 24             jsr sktyp
003465  3  B0 03                bcs :+
003467  3  4C 6E 34             jmp b00801
00346A  3               :
00346A  3  A9 00                lda #0
00346C  3  85 rr                sta varo
00346E  3  A9 08        b00801: lda #8
003470  3  85 rr                sta z80_c
003472  3  A0 08                ldy #8
003474  3  B1 rr                lda (z80_ix),y
003476  3  18                   clc
003477  3  65 rr                adc z80_c
003479  3  A0 08                ldy #8
00347B  3  91 rr                sta (z80_ix),y
00347D  3  A9 00        b00836: lda #0
00347F  3  85 rr                sta varp
003481  3  A0 08                ldy #8
003483  3  B1 rr                lda (z80_ix),y
003485  3  C9 B0                cmp #176
003487  3  90 03                bcc *+5
003489  3  4C 0C 35             jmp b01131
00348C  3  20 D1 1D             jsr cangd
00348F  3  F0 03                beq :+
003491  3  4C 98 34             jmp b00888
003494  3               :
003494  3  A9 01                lda #1
003496  3  85 rr                sta varp
003498  3  A9 00        b00888: lda #0
00349A  3  C5 rr                cmp varp
00349C  3  F0 03                beq *+5
00349E  3  4C D2 34             jmp b01009
0034A1  3  A9 00                lda #0
0034A3  3  A0 09                ldy #9
0034A5  3  D1 rr                cmp (z80_ix),y
0034A7  3  90 03                bcc *+5
0034A9  3  4C D2 34             jmp b01009
0034AC  3  A9 FF                lda #255
0034AE  3  85 rr                sta z80_c
0034B0  3  A0 09                ldy #9
0034B2  3  B1 rr                lda (z80_ix),y
0034B4  3  18                   clc
0034B5  3  65 rr                adc z80_c
0034B7  3  A0 09                ldy #9
0034B9  3  91 rr                sta (z80_ix),y
0034BB  3  20 D1 1D             jsr cangd
0034BE  3  F0 03                beq :+
0034C0  3  4C C7 34             jmp b00984
0034C3  3               :
0034C3  3  A9 02                lda #2
0034C5  3  85 rr                sta varp
0034C7  3  A0 09        b00984: ldy #9
0034C9  3  B1 rr                lda (z80_ix),y
0034CB  3  18                   clc
0034CC  3  69 01                adc #1
0034CE  3  A0 09                ldy #9
0034D0  3  91 rr                sta (z80_ix),y
0034D2  3  A9 00        b01009: lda #0
0034D4  3  C5 rr                cmp varp
0034D6  3  F0 03                beq *+5
0034D8  3  4C 0C 35             jmp b01131
0034DB  3  A0 09                ldy #9
0034DD  3  B1 rr                lda (z80_ix),y
0034DF  3  C9 C0                cmp #192
0034E1  3  90 03                bcc *+5
0034E3  3  4C 0C 35             jmp b01131
0034E6  3  A0 09                ldy #9
0034E8  3  B1 rr                lda (z80_ix),y
0034EA  3  18                   clc
0034EB  3  69 01                adc #1
0034ED  3  A0 09                ldy #9
0034EF  3  91 rr                sta (z80_ix),y
0034F1  3  20 D1 1D             jsr cangd
0034F4  3  F0 03                beq :+
0034F6  3  4C FD 34             jmp b01096
0034F9  3               :
0034F9  3  A9 03                lda #3
0034FB  3  85 rr                sta varp
0034FD  3  A9 FF        b01096: lda #255
0034FF  3  85 rr                sta z80_c
003501  3  A0 09                ldy #9
003503  3  B1 rr                lda (z80_ix),y
003505  3  18                   clc
003506  3  65 rr                adc z80_c
003508  3  A0 09                ldy #9
00350A  3  91 rr                sta (z80_ix),y
00350C  3  A9 AF        b01131: lda #175
00350E  3  A0 08                ldy #8
003510  3  D1 rr                cmp (z80_ix),y
003512  3  90 03                bcc *+5
003514  3  4C 21 35             jmp b01175
003517  3  A9 B0                lda #176
003519  3  A0 08                ldy #8
00351B  3  91 rr                sta (z80_ix),y
00351D  3  A9 00                lda #0
00351F  3  85 rr                sta varp
003521  3  A9 00        b01175: lda #0
003523  3  C5 rr                cmp varp
003525  3  90 03                bcc *+5
003527  3  4C 71 35             jmp b01338
00352A  3  A9 01                lda #1
00352C  3  C5 rr                cmp vard
00352E  3  F0 03                beq *+5
003530  3  4C 71 35             jmp b01338
003533  3  A9 08                lda #8
003535  3  85 rr                sta z80_c
003537  3  A0 08                ldy #8
003539  3  B1 rr                lda (z80_ix),y
00353B  3  18                   clc
00353C  3  65 rr                adc z80_c
00353E  3  A0 08                ldy #8
003540  3  91 rr                sta (z80_ix),y
003542  3  A9 01                lda #1
003544  3  85 rr                sta z80_b
003546  3  20 3D 24             jsr sktyp
003549  3  B0 03                bcs :+
00354B  3  4C 52 35             jmp b01273
00354E  3               :
00354E  3  A9 00                lda #0
003550  3  85 rr                sta varp
003552  3  A9 08        b01273: lda #8
003554  3  85 rr                sta z80_b
003556  3  20 3D 24             jsr sktyp
003559  3  B0 03                bcs :+
00355B  3  4C 62 35             jmp b01303
00355E  3               :
00355E  3  A9 00                lda #0
003560  3  85 rr                sta varp
003562  3  A9 F8        b01303: lda #248
003564  3  85 rr                sta z80_c
003566  3  A0 08                ldy #8
003568  3  B1 rr                lda (z80_ix),y
00356A  3  18                   clc
00356B  3  65 rr                adc z80_c
00356D  3  A0 08                ldy #8
00356F  3  91 rr                sta (z80_ix),y
003571  3  A9 00        b01338: lda #0
003573  3  85 rr                sta vars
003575  3  A0 09                ldy #9
003577  3  B1 rr                lda (z80_ix),y
003579  3  C9 C0                cmp #192
00357B  3  90 03                bcc *+5
00357D  3  4C 00 36             jmp b01633
003580  3  20 18 1E             jsr cangr
003583  3  F0 03                beq :+
003585  3  4C 8C 35             jmp b01390
003588  3               :
003588  3  A9 01                lda #1
00358A  3  85 rr                sta vars
00358C  3  A9 00        b01390: lda #0
00358E  3  C5 rr                cmp vars
003590  3  F0 03                beq *+5
003592  3  4C C6 35             jmp b01512
003595  3  A9 00                lda #0
003597  3  A0 08                ldy #8
003599  3  D1 rr                cmp (z80_ix),y
00359B  3  90 03                bcc *+5
00359D  3  4C C6 35             jmp b01512
0035A0  3  A9 FF                lda #255
0035A2  3  85 rr                sta z80_c
0035A4  3  A0 08                ldy #8
0035A6  3  B1 rr                lda (z80_ix),y
0035A8  3  18                   clc
0035A9  3  65 rr                adc z80_c
0035AB  3  A0 08                ldy #8
0035AD  3  91 rr                sta (z80_ix),y
0035AF  3  20 18 1E             jsr cangr
0035B2  3  F0 03                beq :+
0035B4  3  4C BB 35             jmp b01486
0035B7  3               :
0035B7  3  A9 02                lda #2
0035B9  3  85 rr                sta vars
0035BB  3  A0 08        b01486: ldy #8
0035BD  3  B1 rr                lda (z80_ix),y
0035BF  3  18                   clc
0035C0  3  69 01                adc #1
0035C2  3  A0 08                ldy #8
0035C4  3  91 rr                sta (z80_ix),y
0035C6  3  A9 00        b01512: lda #0
0035C8  3  C5 rr                cmp vars
0035CA  3  F0 03                beq *+5
0035CC  3  4C 00 36             jmp b01633
0035CF  3  A0 08                ldy #8
0035D1  3  B1 rr                lda (z80_ix),y
0035D3  3  C9 B0                cmp #176
0035D5  3  90 03                bcc *+5
0035D7  3  4C 00 36             jmp b01633
0035DA  3  A0 08                ldy #8
0035DC  3  B1 rr                lda (z80_ix),y
0035DE  3  18                   clc
0035DF  3  69 01                adc #1
0035E1  3  A0 08                ldy #8
0035E3  3  91 rr                sta (z80_ix),y
0035E5  3  20 18 1E             jsr cangr
0035E8  3  F0 03                beq :+
0035EA  3  4C F1 35             jmp b01598
0035ED  3               :
0035ED  3  A9 03                lda #3
0035EF  3  85 rr                sta vars
0035F1  3  A9 FF        b01598: lda #255
0035F3  3  85 rr                sta z80_c
0035F5  3  A0 08                ldy #8
0035F7  3  B1 rr                lda (z80_ix),y
0035F9  3  18                   clc
0035FA  3  65 rr                adc z80_c
0035FC  3  A0 08                ldy #8
0035FE  3  91 rr                sta (z80_ix),y
003600  3  A9 00        b01633: lda #0
003602  3  C5 rr                cmp vars
003604  3  90 03                bcc *+5
003606  3  4C 50 36             jmp b01796
003609  3  A9 02                lda #2
00360B  3  C5 rr                cmp vard
00360D  3  F0 03                beq *+5
00360F  3  4C 50 36             jmp b01796
003612  3  A9 08                lda #8
003614  3  85 rr                sta z80_c
003616  3  A0 09                ldy #9
003618  3  B1 rr                lda (z80_ix),y
00361A  3  18                   clc
00361B  3  65 rr                adc z80_c
00361D  3  A0 09                ldy #9
00361F  3  91 rr                sta (z80_ix),y
003621  3  A9 01                lda #1
003623  3  85 rr                sta z80_b
003625  3  20 3D 24             jsr sktyp
003628  3  B0 03                bcs :+
00362A  3  4C 31 36             jmp b01731
00362D  3               :
00362D  3  A9 00                lda #0
00362F  3  85 rr                sta vars
003631  3  A9 08        b01731: lda #8
003633  3  85 rr                sta z80_b
003635  3  20 3D 24             jsr sktyp
003638  3  B0 03                bcs :+
00363A  3  4C 41 36             jmp b01761
00363D  3               :
00363D  3  A9 00                lda #0
00363F  3  85 rr                sta vars
003641  3  A9 F8        b01761: lda #248
003643  3  85 rr                sta z80_c
003645  3  A0 09                ldy #9
003647  3  B1 rr                lda (z80_ix),y
003649  3  18                   clc
00364A  3  65 rr                adc z80_c
00364C  3  A0 09                ldy #9
00364E  3  91 rr                sta (z80_ix),y
003650  3  A9 00        b01796: lda #0
003652  3  85 rr                sta vart
003654  3  A9 00                lda #0
003656  3  A0 09                ldy #9
003658  3  D1 rr                cmp (z80_ix),y
00365A  3  90 03                bcc *+5
00365C  3  4C DF 36             jmp b02091
00365F  3  20 06 1E             jsr cangl
003662  3  F0 03                beq :+
003664  3  4C 6B 36             jmp b01848
003667  3               :
003667  3  A9 01                lda #1
003669  3  85 rr                sta vart
00366B  3  A9 00        b01848: lda #0
00366D  3  C5 rr                cmp vart
00366F  3  F0 03                beq *+5
003671  3  4C A5 36             jmp b01969
003674  3  A9 00                lda #0
003676  3  A0 08                ldy #8
003678  3  D1 rr                cmp (z80_ix),y
00367A  3  90 03                bcc *+5
00367C  3  4C A5 36             jmp b01969
00367F  3  A9 FF                lda #255
003681  3  85 rr                sta z80_c
003683  3  A0 08                ldy #8
003685  3  B1 rr                lda (z80_ix),y
003687  3  18                   clc
003688  3  65 rr                adc z80_c
00368A  3  A0 08                ldy #8
00368C  3  91 rr                sta (z80_ix),y
00368E  3  20 06 1E             jsr cangl
003691  3  F0 03                beq :+
003693  3  4C 9A 36             jmp b01943
003696  3               :
003696  3  A9 02                lda #2
003698  3  85 rr                sta vart
00369A  3  A0 08        b01943: ldy #8
00369C  3  B1 rr                lda (z80_ix),y
00369E  3  18                   clc
00369F  3  69 01                adc #1
0036A1  3  A0 08                ldy #8
0036A3  3  91 rr                sta (z80_ix),y
0036A5  3  A9 00        b01969: lda #0
0036A7  3  C5 rr                cmp vart
0036A9  3  F0 03                beq *+5
0036AB  3  4C DF 36             jmp b02091
0036AE  3  A0 08                ldy #8
0036B0  3  B1 rr                lda (z80_ix),y
0036B2  3  C9 B0                cmp #176
0036B4  3  90 03                bcc *+5
0036B6  3  4C DF 36             jmp b02091
0036B9  3  A0 08                ldy #8
0036BB  3  B1 rr                lda (z80_ix),y
0036BD  3  18                   clc
0036BE  3  69 01                adc #1
0036C0  3  A0 08                ldy #8
0036C2  3  91 rr                sta (z80_ix),y
0036C4  3  20 06 1E             jsr cangl
0036C7  3  F0 03                beq :+
0036C9  3  4C D0 36             jmp b02056
0036CC  3               :
0036CC  3  A9 03                lda #3
0036CE  3  85 rr                sta vart
0036D0  3  A9 FF        b02056: lda #255
0036D2  3  85 rr                sta z80_c
0036D4  3  A0 08                ldy #8
0036D6  3  B1 rr                lda (z80_ix),y
0036D8  3  18                   clc
0036D9  3  65 rr                adc z80_c
0036DB  3  A0 08                ldy #8
0036DD  3  91 rr                sta (z80_ix),y
0036DF  3  A9 00        b02091: lda #0
0036E1  3  C5 rr                cmp vart
0036E3  3  90 03                bcc *+5
0036E5  3  4C 2F 37             jmp b02254
0036E8  3  A9 03                lda #3
0036EA  3  C5 rr                cmp vard
0036EC  3  F0 03                beq *+5
0036EE  3  4C 2F 37             jmp b02254
0036F1  3  A9 F8                lda #248
0036F3  3  85 rr                sta z80_c
0036F5  3  A0 09                ldy #9
0036F7  3  B1 rr                lda (z80_ix),y
0036F9  3  18                   clc
0036FA  3  65 rr                adc z80_c
0036FC  3  A0 09                ldy #9
0036FE  3  91 rr                sta (z80_ix),y
003700  3  A9 01                lda #1
003702  3  85 rr                sta z80_b
003704  3  20 3D 24             jsr sktyp
003707  3  B0 03                bcs :+
003709  3  4C 10 37             jmp b02189
00370C  3               :
00370C  3  A9 00                lda #0
00370E  3  85 rr                sta vart
003710  3  A9 08        b02189: lda #8
003712  3  85 rr                sta z80_b
003714  3  20 3D 24             jsr sktyp
003717  3  B0 03                bcs :+
003719  3  4C 20 37             jmp b02219
00371C  3               :
00371C  3  A9 00                lda #0
00371E  3  85 rr                sta vart
003720  3  A9 08        b02219: lda #8
003722  3  85 rr                sta z80_c
003724  3  A0 09                ldy #9
003726  3  B1 rr                lda (z80_ix),y
003728  3  18                   clc
003729  3  65 rr                adc z80_c
00372B  3  A0 09                ldy #9
00372D  3  91 rr                sta (z80_ix),y
00372F  3  A9 00        b02254: lda #0
003731  3  85 rr                sta varq
003733  3  A9 02                lda #2
003735  3  A0 0B                ldy #11
003737  3  D1 rr                cmp (z80_ix),y
003739  3  F0 03                beq *+5
00373B  3  4C 61 37             jmp b02350
00373E  3  A9 00                lda #0
003740  3  C5 rr                cmp varc
003742  3  F0 03                beq *+5
003744  3  4C 4B 37             jmp b02309
003747  3  A9 01                lda #1
003749  3  85 rr                sta varq
00374B  3  A9 03        b02309: lda #3
00374D  3  C5 rr                cmp scno
00374F  3  F0 03                beq *+5
003751  3  4C 61 37             jmp b02350
003754  3  A9 02                lda #2
003756  3  C5 rr                cmp varc
003758  3  F0 03                beq *+5
00375A  3  4C 61 37             jmp b02350
00375D  3  A9 01                lda #1
00375F  3  85 rr                sta varq
003761  3  A9 01        b02350: lda #1
003763  3  A0 0B                ldy #11
003765  3  D1 rr                cmp (z80_ix),y
003767  3  F0 03                beq *+5
003769  3  4C 82 37             jmp b02414
00376C  3  A9 01                lda #1
00376E  3  C5 rr                cmp scno
003770  3  90 03                bcc *+5
003772  3  4C 82 37             jmp b02414
003775  3  A9 00                lda #0
003777  3  C5 rr                cmp varc
003779  3  F0 03                beq *+5
00377B  3  4C 82 37             jmp b02414
00377E  3  A9 01                lda #1
003780  3  85 rr                sta varq
003782  3  A5 rr        b02414: lda vard
003784  3  C9 02                cmp #2
003786  3  90 03                bcc *+5
003788  3  4C 48 38             jmp b02781
00378B  3  A5 rr                lda varb
00378D  3  A0 09                ldy #9
00378F  3  D1 rr                cmp (z80_ix),y
003791  3  90 03                bcc *+5
003793  3  4C D5 37             jmp b02568
003796  3  A9 00                lda #0
003798  3  C5 rr                cmp vart
00379A  3  90 03                bcc *+5
00379C  3  4C A6 37             jmp b02483
00379F  3  A9 03                lda #3
0037A1  3  85 rr                sta vard
0037A3  3  4C D2 37             jmp b02563
0037A6  3  A9 00        b02483: lda #0
0037A8  3  C5 rr                cmp vard
0037AA  3  F0 03                beq *+5
0037AC  3  4C C2 37             jmp b02534
0037AF  3  A9 00                lda #0
0037B1  3  C5 rr                cmp varo
0037B3  3  90 03                bcc *+5
0037B5  3  4C BB 37             jmp b02521
0037B8  3  4C BF 37             jmp b02529
0037BB  3  A9 01        b02521: lda #1
0037BD  3  85 rr                sta vard
0037BF  3  4C D2 37     b02529: jmp b02563
0037C2  3  A9 00        b02534: lda #0
0037C4  3  C5 rr                cmp varp
0037C6  3  90 03                bcc *+5
0037C8  3  4C CE 37             jmp b02555
0037CB  3  4C D2 37             jmp b02563
0037CE  3  A9 00        b02555: lda #0
0037D0  3  85 rr                sta vard
0037D2  3  4C 45 38     b02563: jmp b02776
0037D5  3  A5 rr        b02568: lda varb
0037D7  3  A0 09                ldy #9
0037D9  3  D1 rr                cmp (z80_ix),y
0037DB  3  F0 03                beq *+5
0037DD  3  4C 09 38             jmp b02666
0037E0  3  A9 00                lda #0
0037E2  3  C5 rr                cmp vard
0037E4  3  F0 03                beq *+5
0037E6  3  4C F9 37             jmp b02637
0037E9  3  A9 00                lda #0
0037EB  3  C5 rr                cmp varo
0037ED  3  F0 03                beq *+5
0037EF  3  4C F6 37             jmp b02632
0037F2  3  A9 01                lda #1
0037F4  3  85 rr                sta vard
0037F6  3  4C 06 38     b02632: jmp b02662
0037F9  3  A9 00        b02637: lda #0
0037FB  3  C5 rr                cmp varp
0037FD  3  F0 03                beq *+5
0037FF  3  4C 06 38             jmp b02662
003802  3  A9 00                lda #0
003804  3  85 rr                sta vard
003806  3  4C 45 38     b02662: jmp b02776
003809  3  A9 00        b02666: lda #0
00380B  3  C5 rr                cmp vars
00380D  3  90 03                bcc *+5
00380F  3  4C 19 38             jmp b02696
003812  3  A9 02                lda #2
003814  3  85 rr                sta vard
003816  3  4C 45 38             jmp b02776
003819  3  A9 00        b02696: lda #0
00381B  3  C5 rr                cmp vard
00381D  3  F0 03                beq *+5
00381F  3  4C 35 38             jmp b02747
003822  3  A9 00                lda #0
003824  3  C5 rr                cmp varo
003826  3  90 03                bcc *+5
003828  3  4C 2E 38             jmp b02734
00382B  3  4C 32 38             jmp b02742
00382E  3  A9 01        b02734: lda #1
003830  3  85 rr                sta vard
003832  3  4C 45 38     b02742: jmp b02776
003835  3  A9 00        b02747: lda #0
003837  3  C5 rr                cmp varp
003839  3  90 03                bcc *+5
00383B  3  4C 41 38             jmp b02768
00383E  3  4C 45 38             jmp b02776
003841  3  A9 00        b02768: lda #0
003843  3  85 rr                sta vard
003845  3  4C 08 39     b02776: jmp b03136
003848  3  A0 08        b02781: ldy #8
00384A  3  B1 rr                lda (z80_ix),y
00384C  3  C5 rr                cmp vara
00384E  3  90 03                bcc *+5
003850  3  4C 92 38             jmp b02918
003853  3  A9 00                lda #0
003855  3  C5 rr                cmp varp
003857  3  90 03                bcc *+5
003859  3  4C 63 38             jmp b02833
00385C  3  A9 01                lda #1
00385E  3  85 rr                sta vard
003860  3  4C 8F 38             jmp b02914
003863  3  A9 03        b02833: lda #3
003865  3  C5 rr                cmp vard
003867  3  F0 03                beq *+5
003869  3  4C 7F 38             jmp b02884
00386C  3  A9 00                lda #0
00386E  3  C5 rr                cmp vart
003870  3  90 03                bcc *+5
003872  3  4C 78 38             jmp b02871
003875  3  4C 7C 38             jmp b02879
003878  3  A9 02        b02871: lda #2
00387A  3  85 rr                sta vard
00387C  3  4C 8F 38     b02879: jmp b02914
00387F  3  A9 00        b02884: lda #0
003881  3  C5 rr                cmp vars
003883  3  90 03                bcc *+5
003885  3  4C 8B 38             jmp b02906
003888  3  4C 8F 38             jmp b02914
00388B  3  A9 03        b02906: lda #3
00388D  3  85 rr                sta vard
00388F  3  4C 08 39     b02914: jmp b03136
003892  3  A5 rr        b02918: lda vara
003894  3  A0 08                ldy #8
003896  3  D1 rr                cmp (z80_ix),y
003898  3  F0 03                beq *+5
00389A  3  4C CC 38             jmp b03026
00389D  3  A9 02                lda #2
00389F  3  C5 rr                cmp vard
0038A1  3  F0 03                beq *+5
0038A3  3  4C B9 38             jmp b02992
0038A6  3  A9 00                lda #0
0038A8  3  C5 rr                cmp vars
0038AA  3  90 03                bcc *+5
0038AC  3  4C B2 38             jmp b02979
0038AF  3  4C B6 38             jmp b02987
0038B2  3  A9 03        b02979: lda #3
0038B4  3  85 rr                sta vard
0038B6  3  4C C9 38     b02987: jmp b03021
0038B9  3  A9 00        b02992: lda #0
0038BB  3  C5 rr                cmp vart
0038BD  3  90 03                bcc *+5
0038BF  3  4C C5 38             jmp b03013
0038C2  3  4C C9 38             jmp b03021
0038C5  3  A9 02        b03013: lda #2
0038C7  3  85 rr                sta vard
0038C9  3  4C 08 39     b03021: jmp b03136
0038CC  3  A9 00        b03026: lda #0
0038CE  3  C5 rr                cmp varo
0038D0  3  90 03                bcc *+5
0038D2  3  4C DC 38             jmp b03056
0038D5  3  A9 00                lda #0
0038D7  3  85 rr                sta vard
0038D9  3  4C 08 39             jmp b03136
0038DC  3  A9 02        b03056: lda #2
0038DE  3  C5 rr                cmp vard
0038E0  3  F0 03                beq *+5
0038E2  3  4C F8 38             jmp b03107
0038E5  3  A9 00                lda #0
0038E7  3  C5 rr                cmp vars
0038E9  3  90 03                bcc *+5
0038EB  3  4C F1 38             jmp b03094
0038EE  3  4C F5 38             jmp b03102
0038F1  3  A9 03        b03094: lda #3
0038F3  3  85 rr                sta vard
0038F5  3  4C 08 39     b03102: jmp b03136
0038F8  3  A9 00        b03107: lda #0
0038FA  3  C5 rr                cmp vart
0038FC  3  90 03                bcc *+5
0038FE  3  4C 04 39             jmp b03128
003901  3  4C 08 39             jmp b03136
003904  3  A9 02        b03128: lda #2
003906  3  85 rr                sta vard
003908  3  A5 rr        b03136: lda vard
00390A  3  A0 06                ldy #6
00390C  3  91 rr                sta (z80_ix),y
00390E  3  A9 09                lda #9
003910  3  85 rr                sta z80_c
003912  3  A0 06                ldy #6
003914  3  B1 rr                lda (z80_ix),y
003916  3  18                   clc
003917  3  65 rr                adc z80_c
003919  3  A0 06                ldy #6
00391B  3  91 rr                sta (z80_ix),y
00391D  3  A9 00                lda #0
00391F  3  A0 0B                ldy #11
003921  3  D1 rr                cmp (z80_ix),y
003923  3  F0 03                beq *+5
003925  3  4C 63 39             jmp b03321
003928  3  A9 00                lda #0
00392A  3  C5 rr                cmp varc
00392C  3  F0 03                beq *+5
00392E  3  4C 41 39             jmp b03256
003931  3  A9 00                lda #0
003933  3  85 rr                sta varo
003935  3  A9 00                lda #0
003937  3  85 rr                sta varp
003939  3  A9 00                lda #0
00393B  3  85 rr                sta vars
00393D  3  A9 00                lda #0
00393F  3  85 rr                sta vart
003941  3  A9 00        b03256: lda #0
003943  3  C5 rr                cmp scno
003945  3  F0 03                beq *+5
003947  3  4C 63 39             jmp b03321
00394A  3  A9 02                lda #2
00394C  3  C5 rr                cmp varc
00394E  3  F0 03                beq *+5
003950  3  4C 63 39             jmp b03321
003953  3  A9 00                lda #0
003955  3  85 rr                sta varo
003957  3  A9 00                lda #0
003959  3  85 rr                sta varp
00395B  3  A9 00                lda #0
00395D  3  85 rr                sta vars
00395F  3  A9 00                lda #0
003961  3  85 rr                sta vart
003963  3  A9 00        b03321: lda #0
003965  3  C5 rr                cmp vard
003967  3  F0 03                beq *+5
003969  3  4C 00 3A             jmp b03651
00396C  3  A9 00                lda #0
00396E  3  C5 rr                cmp varo
003970  3  90 03                bcc *+5
003972  3  4C 00 3A             jmp b03651
003975  3  A9 02                lda #2
003977  3  C5 rr                cmp varo
003979  3  F0 03                beq *+5
00397B  3  4C 8D 39             jmp b03407
00397E  3  A9 FF                lda #255
003980  3  85 rr                sta z80_c
003982  3  A0 09                ldy #9
003984  3  B1 rr                lda (z80_ix),y
003986  3  18                   clc
003987  3  65 rr                adc z80_c
003989  3  A0 09                ldy #9
00398B  3  91 rr                sta (z80_ix),y
00398D  3  A9 03        b03407: lda #3
00398F  3  C5 rr                cmp varo
003991  3  F0 03                beq *+5
003993  3  4C A1 39             jmp b03449
003996  3  A0 09                ldy #9
003998  3  B1 rr                lda (z80_ix),y
00399A  3  18                   clc
00399B  3  69 01                adc #1
00399D  3  A0 09                ldy #9
00399F  3  91 rr                sta (z80_ix),y
0039A1  3  A9 00        b03449: lda #0
0039A3  3  A0 08                ldy #8
0039A5  3  D1 rr                cmp (z80_ix),y
0039A7  3  90 03                bcc *+5
0039A9  3  4C BB 39             jmp b03506
0039AC  3  A9 FF                lda #255
0039AE  3  85 rr                sta z80_c
0039B0  3  A0 08                ldy #8
0039B2  3  B1 rr                lda (z80_ix),y
0039B4  3  18                   clc
0039B5  3  65 rr                adc z80_c
0039B7  3  A0 08                ldy #8
0039B9  3  91 rr                sta (z80_ix),y
0039BB  3  A9 00        b03506: lda #0
0039BD  3  A0 08                ldy #8
0039BF  3  D1 rr                cmp (z80_ix),y
0039C1  3  90 03                bcc *+5
0039C3  3  4C D5 39             jmp b03564
0039C6  3  A9 FF                lda #255
0039C8  3  85 rr                sta z80_c
0039CA  3  A0 08                ldy #8
0039CC  3  B1 rr                lda (z80_ix),y
0039CE  3  18                   clc
0039CF  3  65 rr                adc z80_c
0039D1  3  A0 08                ldy #8
0039D3  3  91 rr                sta (z80_ix),y
0039D5  3  A9 01        b03564: lda #1
0039D7  3  C5 rr                cmp varq
0039D9  3  F0 03                beq *+5
0039DB  3  4C 00 3A             jmp b03651
0039DE  3  A9 00                lda #0
0039E0  3  A0 08                ldy #8
0039E2  3  D1 rr                cmp (z80_ix),y
0039E4  3  90 03                bcc *+5
0039E6  3  4C 00 3A             jmp b03651
0039E9  3  20 9C 1D             jsr cangu
0039EC  3  F0 03                beq :+
0039EE  3  4C 00 3A             jmp b03651
0039F1  3               :
0039F1  3  A9 FF                lda #255
0039F3  3  85 rr                sta z80_c
0039F5  3  A0 08                ldy #8
0039F7  3  B1 rr                lda (z80_ix),y
0039F9  3  18                   clc
0039FA  3  65 rr                adc z80_c
0039FC  3  A0 08                ldy #8
0039FE  3  91 rr                sta (z80_ix),y
003A00  3  A9 01        b03651: lda #1
003A02  3  C5 rr                cmp vard
003A04  3  F0 03                beq *+5
003A06  3  4C 6E 3A             jmp b03880
003A09  3  A9 00                lda #0
003A0B  3  C5 rr                cmp varp
003A0D  3  90 03                bcc *+5
003A0F  3  4C 6E 3A             jmp b03880
003A12  3  A9 02                lda #2
003A14  3  C5 rr                cmp varp
003A16  3  F0 03                beq *+5
003A18  3  4C 2A 3A             jmp b03737
003A1B  3  A9 FF                lda #255
003A1D  3  85 rr                sta z80_c
003A1F  3  A0 09                ldy #9
003A21  3  B1 rr                lda (z80_ix),y
003A23  3  18                   clc
003A24  3  65 rr                adc z80_c
003A26  3  A0 09                ldy #9
003A28  3  91 rr                sta (z80_ix),y
003A2A  3  A9 03        b03737: lda #3
003A2C  3  C5 rr                cmp varp
003A2E  3  F0 03                beq *+5
003A30  3  4C 3E 3A             jmp b03779
003A33  3  A0 09                ldy #9
003A35  3  B1 rr                lda (z80_ix),y
003A37  3  18                   clc
003A38  3  69 01                adc #1
003A3A  3  A0 09                ldy #9
003A3C  3  91 rr                sta (z80_ix),y
003A3E  3  A0 08        b03779: ldy #8
003A40  3  B1 rr                lda (z80_ix),y
003A42  3  18                   clc
003A43  3  69 02                adc #2
003A45  3  91 rr                sta (z80_ix),y
003A47  3  A9 01                lda #1
003A49  3  C5 rr                cmp varq
003A4B  3  F0 03                beq *+5
003A4D  3  4C 6E 3A             jmp b03880
003A50  3  A0 08                ldy #8
003A52  3  B1 rr                lda (z80_ix),y
003A54  3  C9 B0                cmp #176
003A56  3  90 03                bcc *+5
003A58  3  4C 6E 3A             jmp b03880
003A5B  3  20 D1 1D             jsr cangd
003A5E  3  F0 03                beq :+
003A60  3  4C 6E 3A             jmp b03880
003A63  3               :
003A63  3  A0 08                ldy #8
003A65  3  B1 rr                lda (z80_ix),y
003A67  3  18                   clc
003A68  3  69 01                adc #1
003A6A  3  A0 08                ldy #8
003A6C  3  91 rr                sta (z80_ix),y
003A6E  3  A9 02        b03880: lda #2
003A70  3  C5 rr                cmp vard
003A72  3  F0 03                beq *+5
003A74  3  4C DC 3A             jmp b04108
003A77  3  A9 00                lda #0
003A79  3  C5 rr                cmp vars
003A7B  3  90 03                bcc *+5
003A7D  3  4C DC 3A             jmp b04108
003A80  3  A9 02                lda #2
003A82  3  C5 rr                cmp vars
003A84  3  F0 03                beq *+5
003A86  3  4C 98 3A             jmp b03965
003A89  3  A9 FF                lda #255
003A8B  3  85 rr                sta z80_c
003A8D  3  A0 08                ldy #8
003A8F  3  B1 rr                lda (z80_ix),y
003A91  3  18                   clc
003A92  3  65 rr                adc z80_c
003A94  3  A0 08                ldy #8
003A96  3  91 rr                sta (z80_ix),y
003A98  3  A9 03        b03965: lda #3
003A9A  3  C5 rr                cmp vars
003A9C  3  F0 03                beq *+5
003A9E  3  4C AC 3A             jmp b04008
003AA1  3  A0 08                ldy #8
003AA3  3  B1 rr                lda (z80_ix),y
003AA5  3  18                   clc
003AA6  3  69 01                adc #1
003AA8  3  A0 08                ldy #8
003AAA  3  91 rr                sta (z80_ix),y
003AAC  3  A0 09        b04008: ldy #9
003AAE  3  B1 rr                lda (z80_ix),y
003AB0  3  18                   clc
003AB1  3  69 02                adc #2
003AB3  3  91 rr                sta (z80_ix),y
003AB5  3  A9 01                lda #1
003AB7  3  C5 rr                cmp varq
003AB9  3  F0 03                beq *+5
003ABB  3  4C DC 3A             jmp b04108
003ABE  3  A0 09                ldy #9
003AC0  3  B1 rr                lda (z80_ix),y
003AC2  3  C9 C0                cmp #192
003AC4  3  90 03                bcc *+5
003AC6  3  4C DC 3A             jmp b04108
003AC9  3  20 18 1E             jsr cangr
003ACC  3  F0 03                beq :+
003ACE  3  4C DC 3A             jmp b04108
003AD1  3               :
003AD1  3  A0 09                ldy #9
003AD3  3  B1 rr                lda (z80_ix),y
003AD5  3  18                   clc
003AD6  3  69 01                adc #1
003AD8  3  A0 09                ldy #9
003ADA  3  91 rr                sta (z80_ix),y
003ADC  3  A9 03        b04108: lda #3
003ADE  3  C5 rr                cmp vard
003AE0  3  F0 03                beq *+5
003AE2  3  4C 4E 3B             jmp b04346
003AE5  3  A9 00                lda #0
003AE7  3  C5 rr                cmp vart
003AE9  3  90 03                bcc *+5
003AEB  3  4C 4E 3B             jmp b04346
003AEE  3  A9 02                lda #2
003AF0  3  C5 rr                cmp vart
003AF2  3  F0 03                beq *+5
003AF4  3  4C 06 3B             jmp b04194
003AF7  3  A9 FF                lda #255
003AF9  3  85 rr                sta z80_c
003AFB  3  A0 08                ldy #8
003AFD  3  B1 rr                lda (z80_ix),y
003AFF  3  18                   clc
003B00  3  65 rr                adc z80_c
003B02  3  A0 08                ldy #8
003B04  3  91 rr                sta (z80_ix),y
003B06  3  A9 03        b04194: lda #3
003B08  3  C5 rr                cmp vart
003B0A  3  F0 03                beq *+5
003B0C  3  4C 1A 3B             jmp b04236
003B0F  3  A0 08                ldy #8
003B11  3  B1 rr                lda (z80_ix),y
003B13  3  18                   clc
003B14  3  69 01                adc #1
003B16  3  A0 08                ldy #8
003B18  3  91 rr                sta (z80_ix),y
003B1A  3  A0 09        b04236: ldy #9
003B1C  3  B1 rr                lda (z80_ix),y
003B1E  3  38                   sec
003B1F  3  E9 02                sbc #2
003B21  3  91 rr                sta (z80_ix),y
003B23  3  A9 01                lda #1
003B25  3  C5 rr                cmp varq
003B27  3  F0 03                beq *+5
003B29  3  4C 4E 3B             jmp b04346
003B2C  3  A9 00                lda #0
003B2E  3  A0 09                ldy #9
003B30  3  D1 rr                cmp (z80_ix),y
003B32  3  90 03                bcc *+5
003B34  3  4C 4E 3B             jmp b04346
003B37  3  20 06 1E             jsr cangl
003B3A  3  F0 03                beq :+
003B3C  3  4C 4E 3B             jmp b04346
003B3F  3               :
003B3F  3  A9 FF                lda #255
003B41  3  85 rr                sta z80_c
003B43  3  A0 09                ldy #9
003B45  3  B1 rr                lda (z80_ix),y
003B47  3  18                   clc
003B48  3  65 rr                adc z80_c
003B4A  3  A0 09                ldy #9
003B4C  3  91 rr                sta (z80_ix),y
003B4E  3  A0 08        b04346: ldy #8
003B50  3  B1 rr                lda (z80_ix),y
003B52  3  85 rr                sta varo
003B54  3  A5 rr                lda varo
003B56  3  4A                   lsr a
003B57  3  85 rr                sta varo
003B59  3  A5 rr                lda varo
003B5B  3  0A                   asl a
003B5C  3  85 rr                sta varo
003B5E  3  A5 rr                lda varo
003B60  3  A0 08                ldy #8
003B62  3  D1 rr                cmp (z80_ix),y
003B64  3  90 03                bcc *+5
003B66  3  4C 8F 3B             jmp b04488
003B69  3  A9 00                lda #0
003B6B  3  C5 rr                cmp vard
003B6D  3  F0 03                beq *+5
003B6F  3  4C 84 3B             jmp b04463
003B72  3  A9 FF                lda #255
003B74  3  85 rr                sta z80_c
003B76  3  A0 08                ldy #8
003B78  3  B1 rr                lda (z80_ix),y
003B7A  3  18                   clc
003B7B  3  65 rr                adc z80_c
003B7D  3  A0 08                ldy #8
003B7F  3  91 rr                sta (z80_ix),y
003B81  3  4C 8F 3B             jmp b04488
003B84  3  A0 08        b04463: ldy #8
003B86  3  B1 rr                lda (z80_ix),y
003B88  3  18                   clc
003B89  3  69 01                adc #1
003B8B  3  A0 08                ldy #8
003B8D  3  91 rr                sta (z80_ix),y
003B8F  3  A0 09        b04488: ldy #9
003B91  3  B1 rr                lda (z80_ix),y
003B93  3  85 rr                sta varp
003B95  3  A5 rr                lda varp
003B97  3  4A                   lsr a
003B98  3  85 rr                sta varp
003B9A  3  A5 rr                lda varp
003B9C  3  0A                   asl a
003B9D  3  85 rr                sta varp
003B9F  3  A5 rr                lda varp
003BA1  3  A0 09                ldy #9
003BA3  3  D1 rr                cmp (z80_ix),y
003BA5  3  90 03                bcc *+5
003BA7  3  4C D0 3B             jmp b04631
003BAA  3  A9 02                lda #2
003BAC  3  C5 rr                cmp vard
003BAE  3  F0 03                beq *+5
003BB0  3  4C C1 3B             jmp b04596
003BB3  3  A0 09                ldy #9
003BB5  3  B1 rr                lda (z80_ix),y
003BB7  3  18                   clc
003BB8  3  69 01                adc #1
003BBA  3  A0 09                ldy #9
003BBC  3  91 rr                sta (z80_ix),y
003BBE  3  4C D0 3B             jmp b04631
003BC1  3  A9 FF        b04596: lda #255
003BC3  3  85 rr                sta z80_c
003BC5  3  A0 09                ldy #9
003BC7  3  B1 rr                lda (z80_ix),y
003BC9  3  18                   clc
003BCA  3  65 rr                adc z80_c
003BCC  3  A0 09                ldy #9
003BCE  3  91 rr                sta (z80_ix),y
003BD0  3  A5 rr        b04631: lda vard
003BD2  3  A0 0A                ldy #10
003BD4  3  91 rr                sta (z80_ix),y
003BD6  3  A9 02                lda #2
003BD8  3  A0 0B                ldy #11
003BDA  3  D1 rr                cmp (z80_ix),y
003BDC  3  F0 03                beq *+5
003BDE  3  4C E1 3B             jmp b04667
003BE1  3  A9 01        b04667: lda #1
003BE3  3  A0 0B                ldy #11
003BE5  3  D1 rr                cmp (z80_ix),y
003BE7  3  F0 03                beq *+5
003BE9  3  4C EC 3B             jmp b04690
003BEC  3  60           b04690: rts
003BED  3               .out .sprintf("EVENT 1 SIZE = %d", (* - evnt01))
003BED  3               
003BED  3               evnt02:
003BED  3  A9 00                lda #0
003BEF  3  C5 rr                cmp clock
003BF1  3  F0 03                beq *+5
003BF3  3  4C 40 3C             jmp c00181
003BF6  3  A0 0A                ldy #10
003BF8  3  B1 rr                lda (z80_ix),y
003BFA  3  38                   sec
003BFB  3  E9 01                sbc #1
003BFD  3  A0 0A                ldy #10
003BFF  3  91 rr                sta (z80_ix),y
003C01  3  A9 FA                lda #250
003C03  3  A0 0A                ldy #10
003C05  3  D1 rr                cmp (z80_ix),y
003C07  3  F0 03                beq *+5
003C09  3  4C 40 3C             jmp c00181
003C0C  3  A5 rr                lda vara
003C0E  3  A0 08                ldy #8
003C10  3  91 rr                sta (z80_ix),y
003C12  3  A5 rr                lda varb
003C14  3  A0 09                ldy #9
003C16  3  91 rr                sta (z80_ix),y
003C18  3  A9 00                lda #0
003C1A  3  85 rr                sta z80_b
003C1C  3  20 3D 24             jsr sktyp
003C1F  3  B0 03                bcs :+
003C21  3  4C 40 3C             jmp c00181
003C24  3               :
003C24  3  A5 rr                lda skptr
003C26  3  85 rr                sta z80_x
003C28  3  A5 rr                lda skptr+1
003C2A  3  85 rr                sta z80_i
003C2C  3  A9 00                lda #0
003C2E  3  A0 0B                ldy #11
003C30  3  91 rr                sta (z80_ix),y
003C32  3  A5 rr                lda ogptr
003C34  3  85 rr                sta z80_x
003C36  3  A5 rr                lda ogptr+1
003C38  3  85 rr                sta z80_i
003C3A  3  A9 FF                lda #255
003C3C  3  A0 05                ldy #5
003C3E  3  91 rr                sta (z80_ix),y
003C40  3  A9 03        c00181: lda #3
003C42  3  C5 rr                cmp varg
003C44  3  F0 03                beq *+5
003C46  3  4C 7D 3C             jmp c00311
003C49  3  A5 rr                lda vara
003C4B  3  A0 08                ldy #8
003C4D  3  91 rr                sta (z80_ix),y
003C4F  3  A5 rr                lda varb
003C51  3  A0 09                ldy #9
003C53  3  91 rr                sta (z80_ix),y
003C55  3  A9 00                lda #0
003C57  3  85 rr                sta z80_b
003C59  3  20 3D 24             jsr sktyp
003C5C  3  B0 03                bcs :+
003C5E  3  4C 7D 3C             jmp c00311
003C61  3               :
003C61  3  A5 rr                lda skptr
003C63  3  85 rr                sta z80_x
003C65  3  A5 rr                lda skptr+1
003C67  3  85 rr                sta z80_i
003C69  3  A9 00                lda #0
003C6B  3  A0 0B                ldy #11
003C6D  3  91 rr                sta (z80_ix),y
003C6F  3  A5 rr                lda ogptr
003C71  3  85 rr                sta z80_x
003C73  3  A5 rr                lda ogptr+1
003C75  3  85 rr                sta z80_i
003C77  3  A9 FF                lda #255
003C79  3  A0 05                ldy #5
003C7B  3  91 rr                sta (z80_ix),y
003C7D  3  A9 00        c00311: lda #0
003C7F  3  C5 rr                cmp varc
003C81  3  F0 03                beq *+5
003C83  3  4C 8B 3C             jmp c00337
003C86  3  A9 00                lda #0
003C88  3  20 F2 23             jsr animsp
003C8B  3  A9 01        c00337: lda #1
003C8D  3  85 rr                sta z80_b
003C8F  3  20 3D 24             jsr sktyp
003C92  3  B0 03                bcs :+
003C94  3  4C 8B 3D             jmp c00884
003C97  3               :
003C97  3  A5 rr                lda ogptr
003C99  3  85 rr                sta z80_x
003C9B  3  A5 rr                lda ogptr+1
003C9D  3  85 rr                sta z80_i
003C9F  3  A0 08                ldy #8
003CA1  3  B1 rr                lda (z80_ix),y
003CA3  3  85 rr                sta varo
003CA5  3  A0 09                ldy #9
003CA7  3  B1 rr                lda (z80_ix),y
003CA9  3  85 rr                sta varp
003CAB  3  A5 rr                lda skptr
003CAD  3  85 rr                sta z80_x
003CAF  3  A5 rr                lda skptr+1
003CB1  3  85 rr                sta z80_i
003CB3  3  A5 rr                lda varo
003CB5  3  85 rr                sta varq
003CB7  3  A0 08                ldy #8
003CB9  3  B1 rr                lda (z80_ix),y
003CBB  3  C5 rr                cmp varo
003CBD  3  90 03                bcc *+5
003CBF  3  4C D2 3C             jmp c00489
003CC2  3  A0 08                ldy #8
003CC4  3  B1 rr                lda (z80_ix),y
003CC6  3  85 rr                sta z80_c
003CC8  3  A5 rr                lda varq
003CCA  3  38                   sec
003CCB  3  E5 rr                sbc z80_c
003CCD  3  85 rr                sta varq
003CCF  3  4C E3 3C             jmp c00527
003CD2  3  A0 08        c00489: ldy #8
003CD4  3  B1 rr                lda (z80_ix),y
003CD6  3  85 rr                sta varq
003CD8  3  A5 rr                lda varo
003CDA  3  85 rr                sta z80_c
003CDC  3  A5 rr                lda varq
003CDE  3  38                   sec
003CDF  3  E5 rr                sbc z80_c
003CE1  3  85 rr                sta varq
003CE3  3  A5 rr        c00527: lda varq
003CE5  3  C9 05                cmp #5
003CE7  3  90 03                bcc *+5
003CE9  3  4C 8B 3D             jmp c00884
003CEC  3  A5 rr                lda varp
003CEE  3  85 rr                sta varq
003CF0  3  A0 09                ldy #9
003CF2  3  B1 rr                lda (z80_ix),y
003CF4  3  C5 rr                cmp varp
003CF6  3  90 03                bcc *+5
003CF8  3  4C 0B 3D             jmp c00610
003CFB  3  A0 09                ldy #9
003CFD  3  B1 rr                lda (z80_ix),y
003CFF  3  85 rr                sta z80_c
003D01  3  A5 rr                lda varq
003D03  3  38                   sec
003D04  3  E5 rr                sbc z80_c
003D06  3  85 rr                sta varq
003D08  3  4C 1C 3D             jmp c00648
003D0B  3  A0 09        c00610: ldy #9
003D0D  3  B1 rr                lda (z80_ix),y
003D0F  3  85 rr                sta varq
003D11  3  A5 rr                lda varp
003D13  3  85 rr                sta z80_c
003D15  3  A5 rr                lda varq
003D17  3  38                   sec
003D18  3  E5 rr                sbc z80_c
003D1A  3  85 rr                sta varq
003D1C  3  A5 rr        c00648: lda varq
003D1E  3  C9 05                cmp #5
003D20  3  90 03                bcc *+5
003D22  3  4C 8B 3D             jmp c00884
003D25  3  A9 32                lda #<50
003D27  3  85 rr                sta z80_l
003D29  3  A9 00                lda #>50
003D2B  3  85 rr                sta z80_h
003D2D  3  20 2B 1B             jsr addsc
003D30  3  A9 01                lda #1
003D32  3  85 rr                sta chary
003D34  3  A9 1B                lda #27
003D36  3  85 rr                sta charx
003D38  3  20 DF 1A             jsr dscor
003D3B  3  A9 04                lda #4
003D3D  3  85 rr                sta chary
003D3F  3  A9 1B                lda #27
003D41  3  85 rr                sta charx
003D43  3  A9 64                lda #100
003D45  3  A0 0C                ldy #12
003D47  3  91 rr                sta (z80_ix),y
003D49  3  A9 08                lda #8
003D4B  3  A0 05                ldy #5
003D4D  3  91 rr                sta (z80_ix),y
003D4F  3  A5 rr                lda ogptr
003D51  3  85 rr                sta z80_x
003D53  3  A5 rr                lda ogptr+1
003D55  3  85 rr                sta z80_i
003D57  3  A5 rr                lda vara
003D59  3  A0 08                ldy #8
003D5B  3  91 rr                sta (z80_ix),y
003D5D  3  A5 rr                lda varb
003D5F  3  A0 09                ldy #9
003D61  3  91 rr                sta (z80_ix),y
003D63  3  A9 00                lda #0
003D65  3  85 rr                sta z80_b
003D67  3  20 3D 24             jsr sktyp
003D6A  3  B0 03                bcs :+
003D6C  3  4C 8B 3D             jmp c00884
003D6F  3               :
003D6F  3  A5 rr                lda skptr
003D71  3  85 rr                sta z80_x
003D73  3  A5 rr                lda skptr+1
003D75  3  85 rr                sta z80_i
003D77  3  A9 00                lda #0
003D79  3  A0 0B                ldy #11
003D7B  3  91 rr                sta (z80_ix),y
003D7D  3  A5 rr                lda ogptr
003D7F  3  85 rr                sta z80_x
003D81  3  A5 rr                lda ogptr+1
003D83  3  85 rr                sta z80_i
003D85  3  A9 FF                lda #255
003D87  3  A0 05                ldy #5
003D89  3  91 rr                sta (z80_ix),y
003D8B  3  60           c00884: rts
003D8C  3               .out .sprintf("EVENT 2 SIZE = %d", (* - evnt02))
003D8C  3               
003D8C  3               evnt03:
003D8C  3  A0 08                ldy #8
003D8E  3  B1 rr                lda (z80_ix),y
003D90  3  C9 C8                cmp #200
003D92  3  90 03                bcc *+5
003D94  3  4C D3 3E             jmp d00659
003D97  3  A9 00                lda #0
003D99  3  85 rr                sta z80_b
003D9B  3  20 3D 24             jsr sktyp
003D9E  3  B0 03                bcs :+
003DA0  3  4C D3 3E             jmp d00659
003DA3  3               :
003DA3  3  A9 96                lda #<150
003DA5  3  85 rr                sta z80_l
003DA7  3  A9 00                lda #>150
003DA9  3  85 rr                sta z80_h
003DAB  3  20 2B 1B             jsr addsc
003DAE  3  A9 01                lda #1
003DB0  3  85 rr                sta chary
003DB2  3  A9 1B                lda #27
003DB4  3  85 rr                sta charx
003DB6  3  20 DF 1A             jsr dscor
003DB9  3  A9 04                lda #4
003DBB  3  85 rr                sta chary
003DBD  3  A9 1B                lda #27
003DBF  3  85 rr                sta charx
003DC1  3  A5 rr                lda skptr
003DC3  3  85 rr                sta z80_x
003DC5  3  A5 rr                lda skptr+1
003DC7  3  85 rr                sta z80_i
003DC9  3  A9 00                lda #0
003DCB  3  85 rr                sta varg
003DCD  3  A5 rr                lda vari
003DCF  3  18                   clc
003DD0  3  69 01                adc #1
003DD2  3  85 rr                sta vari
003DD4  3  A5 rr                lda vari
003DD6  3  85 rr                sta varo
003DD8  3  A9 19                lda #25
003DDA  3  C5 rr                cmp vari
003DDC  3  F0 03                beq *+5
003DDE  3  4C E8 3D             jmp d00190
003DE1  3  A5 rr                lda numlif
003DE3  3  18                   clc
003DE4  3  69 01                adc #1
003DE6  3  85 rr                sta numlif
003DE8  3  A9 32        d00190: lda #50
003DEA  3  C5 rr                cmp vari
003DEC  3  F0 03                beq *+5
003DEE  3  4C F8 3D             jmp d00223
003DF1  3  A5 rr                lda numlif
003DF3  3  18                   clc
003DF4  3  69 01                adc #1
003DF6  3  85 rr                sta numlif
003DF8  3  A5 rr        d00223: lda vari
003DFA  3  C5 rr                cmp varo
003DFC  3  90 03                bcc *+5
003DFE  3  4C 3B 3E             jmp d00356
003E01  3  A9 02                lda #2
003E03  3  85 rr                sta chary
003E05  3  A9 1A                lda #26
003E07  3  85 rr                sta charx
003E09  3  A9 18                lda #24
003E0B  3  20 7F 20             jsr dmsg
003E0E  3  A9 02                lda #2
003E10  3  85 rr                sta chary
003E12  3  A9 1D                lda #29
003E14  3  85 rr                sta charx
003E16  3  A9 18                lda #24
003E18  3  20 7F 20             jsr dmsg
003E1B  3  A9 02                lda #2
003E1D  3  85 rr                sta chary
003E1F  3  A9 1B                lda #27
003E21  3  85 rr                sta charx
003E23  3  A5 rr                lda numlif
003E25  3  85 rr                sta loopa
003E27  3  A5 rr        d00316: lda charx
003E29  3  85 rr                sta dispx
003E2B  3  A5 rr                lda chary
003E2D  3  85 rr                sta dispy
003E2F  3  A9 57                lda #87
003E31  3  20 5E 1C             jsr pattr
003E34  3  C6 rr                dec loopa
003E36  3  F0 03                beq :+
003E38  3  4C 27 3E             jmp d00316
003E3B  3               :
003E3B  3  A5 rr        d00356: lda varj
003E3D  3  18                   clc
003E3E  3  69 01                adc #1
003E40  3  85 rr                sta varj
003E42  3  A9 0D                lda #13
003E44  3  85 rr                sta chary
003E46  3  A9 1D                lda #29
003E48  3  85 rr                sta charx
003E4A  3  A9 18                lda #24
003E4C  3  20 7F 20             jsr dmsg
003E4F  3  A9 0D                lda #13
003E51  3  85 rr                sta chary
003E53  3  A9 1D                lda #29
003E55  3  85 rr                sta charx
003E57  3  A5 rr                lda vari
003E59  3  20 CD 24             jsr disply
003E5C  3  A5 rr                lda scno
003E5E  3  C9 02                cmp #2
003E60  3  90 03                bcc *+5
003E62  3  4C 80 3E             jmp d00490
003E65  3  A9 06                lda #6
003E67  3  C5 rr                cmp varj
003E69  3  F0 03                beq *+5
003E6B  3  4C 7D 3E             jmp d00485
003E6E  3  A9 00                lda #0
003E70  3  85 rr                sta varj
003E72  3  A9 00                lda #0
003E74  3  85 rr                sta scno
003E76  3  20 46 25             jsr nwscr
003E79  3  A9 01                lda #1
003E7B  3  85 rr                sta restfl
003E7D  3  4C BF 3E     d00485: jmp d00613
003E80  3  A9 07        d00490: lda #7
003E82  3  C5 rr                cmp varj
003E84  3  F0 03                beq *+5
003E86  3  4C BF 3E             jmp d00613
003E89  3  A9 07                lda #7
003E8B  3  C5 rr                cmp varf
003E8D  3  F0 03                beq *+5
003E8F  3  4C B0 3E             jmp d00584
003E92  3  A9 00                lda #0
003E94  3  85 rr                sta varf
003E96  3  A9 63                lda #99
003E98  3  85 rr                sta varj
003E9A  3  A9 04                lda #4
003E9C  3  85 rr                sta scno
003E9E  3  20 46 25             jsr nwscr
003EA1  3  A5 rr                lda varr
003EA3  3  18                   clc
003EA4  3  69 01                adc #1
003EA6  3  85 rr                sta varr
003EA8  3  A9 01                lda #1
003EAA  3  85 rr                sta restfl
003EAC  3  60                   rts
003EAD  3  4C BF 3E             jmp d00613
003EB0  3  A9 00        d00584: lda #0
003EB2  3  85 rr                sta varj
003EB4  3  A9 05                lda #5
003EB6  3  85 rr                sta scno
003EB8  3  20 46 25             jsr nwscr
003EBB  3  A9 01                lda #1
003EBD  3  85 rr                sta restfl
003EBF  3  A5 rr        d00613: lda ogptr
003EC1  3  85 rr                sta z80_x
003EC3  3  A5 rr                lda ogptr+1
003EC5  3  85 rr                sta z80_i
003EC7  3  A9 C8                lda #200
003EC9  3  A0 08                ldy #8
003ECB  3  91 rr                sta (z80_ix),y
003ECD  3  A9 1E                lda #30
003ECF  3  A0 0C                ldy #12
003ED1  3  91 rr                sta (z80_ix),y
003ED3  3  A9 00        d00659: lda #0
003ED5  3  A0 0C                ldy #12
003ED7  3  D1 rr                cmp (z80_ix),y
003ED9  3  90 03                bcc *+5
003EDB  3  4C 8D 40             jmp d01570
003EDE  3  A0 0C                ldy #12
003EE0  3  B1 rr                lda (z80_ix),y
003EE2  3  38                   sec
003EE3  3  E9 01                sbc #1
003EE5  3  A0 0C                ldy #12
003EE7  3  91 rr                sta (z80_ix),y
003EE9  3  A5 rr                lda varr
003EEB  3  85 rr                sta varo
003EED  3  A9 00                lda #0
003EEF  3  85 rr                sta varr
003EF1  3  A9 1D                lda #29
003EF3  3  A0 0C                ldy #12
003EF5  3  D1 rr                cmp (z80_ix),y
003EF7  3  F0 03                beq *+5
003EF9  3  4C 04 3F             jmp d00763
003EFC  3  A9 C4                lda #196
003EFE  3  85 rr                sta varr
003F00  3  A9 03                lda #3
003F02  3  85 rr                sta varq
003F04  3  A9 1A        d00763: lda #26
003F06  3  A0 0C                ldy #12
003F08  3  D1 rr                cmp (z80_ix),y
003F0A  3  F0 03                beq *+5
003F0C  3  4C 17 3F             jmp d00802
003F0F  3  A9 26                lda #38
003F11  3  85 rr                sta varr
003F13  3  A9 03                lda #3
003F15  3  85 rr                sta varq
003F17  3  A9 17        d00802: lda #23
003F19  3  A0 0C                ldy #12
003F1B  3  D1 rr                cmp (z80_ix),y
003F1D  3  F0 03                beq *+5
003F1F  3  4C AA 3F             jmp d01103
003F22  3  A9 54                lda #84
003F24  3  85 rr                sta varr
003F26  3  A9 02                lda #2
003F28  3  85 rr                sta varq
003F2A  3  A9 10                lda #16
003F2C  3  85 rr                sta chary
003F2E  3  A9 1D                lda #29
003F30  3  85 rr                sta charx
003F32  3  A5 rr                lda charx
003F34  3  85 rr                sta dispx
003F36  3  A5 rr                lda chary
003F38  3  85 rr                sta dispy
003F3A  3  A9 39                lda #57
003F3C  3  20 5E 1C             jsr pattr
003F3F  3  A5 rr                lda charx
003F41  3  85 rr                sta dispx
003F43  3  A5 rr                lda chary
003F45  3  85 rr                sta dispy
003F47  3  A9 39                lda #57
003F49  3  20 5E 1C             jsr pattr
003F4C  3  A9 11                lda #17
003F4E  3  85 rr                sta chary
003F50  3  A9 1D                lda #29
003F52  3  85 rr                sta charx
003F54  3  A5 rr                lda charx
003F56  3  85 rr                sta dispx
003F58  3  A5 rr                lda chary
003F5A  3  85 rr                sta dispy
003F5C  3  A9 30                lda #48
003F5E  3  20 5E 1C             jsr pattr
003F61  3  A5 rr                lda charx
003F63  3  85 rr                sta dispx
003F65  3  A5 rr                lda chary
003F67  3  85 rr                sta dispy
003F69  3  A9 58                lda #88
003F6B  3  20 5E 1C             jsr pattr
003F6E  3  A5 rr                lda charx
003F70  3  85 rr                sta dispx
003F72  3  A5 rr                lda chary
003F74  3  85 rr                sta dispy
003F76  3  A9 39                lda #57
003F78  3  20 5E 1C             jsr pattr
003F7B  3  A9 12                lda #18
003F7D  3  85 rr                sta chary
003F7F  3  A9 1D                lda #29
003F81  3  85 rr                sta charx
003F83  3  A5 rr                lda charx
003F85  3  85 rr                sta dispx
003F87  3  A5 rr                lda chary
003F89  3  85 rr                sta dispy
003F8B  3  A9 39                lda #57
003F8D  3  20 5E 1C             jsr pattr
003F90  3  A5 rr                lda charx
003F92  3  85 rr                sta dispx
003F94  3  A5 rr                lda chary
003F96  3  85 rr                sta dispy
003F98  3  A9 59                lda #89
003F9A  3  20 5E 1C             jsr pattr
003F9D  3  A5 rr                lda charx
003F9F  3  85 rr                sta dispx
003FA1  3  A5 rr                lda chary
003FA3  3  85 rr                sta dispy
003FA5  3  A9 39                lda #57
003FA7  3  20 5E 1C             jsr pattr
003FAA  3  A9 14        d01103: lda #20
003FAC  3  A0 0C                ldy #12
003FAE  3  D1 rr                cmp (z80_ix),y
003FB0  3  F0 03                beq *+5
003FB2  3  4C BD 3F             jmp d01142
003FB5  3  A9 01                lda #1
003FB7  3  85 rr                sta varq
003FB9  3  A9 D3                lda #211
003FBB  3  85 rr                sta varr
003FBD  3  A9 0E        d01142: lda #14
003FBF  3  A0 0C                ldy #12
003FC1  3  D1 rr                cmp (z80_ix),y
003FC3  3  F0 03                beq *+5
003FC5  3  4C 50 40             jmp d01444
003FC8  3  A9 10                lda #16
003FCA  3  85 rr                sta chary
003FCC  3  A9 1D                lda #29
003FCE  3  85 rr                sta charx
003FD0  3  A5 rr                lda charx
003FD2  3  85 rr                sta dispx
003FD4  3  A5 rr                lda chary
003FD6  3  85 rr                sta dispy
003FD8  3  A9 30                lda #48
003FDA  3  20 5E 1C             jsr pattr
003FDD  3  A5 rr                lda charx
003FDF  3  85 rr                sta dispx
003FE1  3  A5 rr                lda chary
003FE3  3  85 rr                sta dispy
003FE5  3  A9 31                lda #49
003FE7  3  20 5E 1C             jsr pattr
003FEA  3  A9 11                lda #17
003FEC  3  85 rr                sta chary
003FEE  3  A9 1D                lda #29
003FF0  3  85 rr                sta charx
003FF2  3  A5 rr                lda charx
003FF4  3  85 rr                sta dispx
003FF6  3  A5 rr                lda chary
003FF8  3  85 rr                sta dispy
003FFA  3  A9 35                lda #53
003FFC  3  20 5E 1C             jsr pattr
003FFF  3  A5 rr                lda charx
004001  3  85 rr                sta dispx
004003  3  A5 rr                lda chary
004005  3  85 rr                sta dispy
004007  3  A9 36                lda #54
004009  3  20 5E 1C             jsr pattr
00400C  3  A5 rr                lda charx
00400E  3  85 rr                sta dispx
004010  3  A5 rr                lda chary
004012  3  85 rr                sta dispy
004014  3  A9 37                lda #55
004016  3  20 5E 1C             jsr pattr
004019  3  A9 12                lda #18
00401B  3  85 rr                sta chary
00401D  3  A9 1D                lda #29
00401F  3  85 rr                sta charx
004021  3  A5 rr                lda charx
004023  3  85 rr                sta dispx
004025  3  A5 rr                lda chary
004027  3  85 rr                sta dispy
004029  3  A9 3A                lda #58
00402B  3  20 5E 1C             jsr pattr
00402E  3  A5 rr                lda charx
004030  3  85 rr                sta dispx
004032  3  A5 rr                lda chary
004034  3  85 rr                sta dispy
004036  3  A9 3B                lda #59
004038  3  20 5E 1C             jsr pattr
00403B  3  A5 rr                lda charx
00403D  3  85 rr                sta dispx
00403F  3  A5 rr                lda chary
004041  3  85 rr                sta dispy
004043  3  A9 3C                lda #60
004045  3  20 5E 1C             jsr pattr
004048  3  A9 02                lda #2
00404A  3  85 rr                sta varq
00404C  3  A9 54                lda #84
00404E  3  85 rr                sta varr
004050  3  A9 05        d01444: lda #5
004052  3  A0 0C                ldy #12
004054  3  D1 rr                cmp (z80_ix),y
004056  3  90 03                bcc *+5
004058  3  4C 6E 40             jmp d01505
00405B  3  A0 0C                ldy #12
00405D  3  B1 rr                lda (z80_ix),y
00405F  3  C9 0C                cmp #12
004061  3  90 03                bcc *+5
004063  3  4C 6E 40             jmp d01505
004066  3  A9 01                lda #1
004068  3  85 rr                sta varq
00406A  3  A9 D3                lda #211
00406C  3  85 rr                sta varr
00406E  3  A9 00        d01505: lda #0
004070  3  C5 rr                cmp varr
004072  3  90 03                bcc *+5
004074  3  4C 77 40             jmp d01522
004077  3  A5 rr        d01522: lda varo
004079  3  85 rr                sta varr
00407B  3  A9 00                lda #0
00407D  3  A0 0C                ldy #12
00407F  3  D1 rr                cmp (z80_ix),y
004081  3  F0 03                beq *+5
004083  3  4C 8D 40             jmp d01570
004086  3  A9 FF                lda #255
004088  3  A0 05                ldy #5
00408A  3  91 rr                sta (z80_ix),y
00408C  3  60                   rts
00408D  3  A9 00        d01570: lda #0
00408F  3  A0 08                ldy #8
004091  3  D1 rr                cmp (z80_ix),y
004093  3  F0 03                beq *+5
004095  3  4C B9 40             jmp d01666
004098  3  A9 08                lda #8
00409A  3  85 rr                sta z80_c
00409C  3  A0 08                ldy #8
00409E  3  B1 rr                lda (z80_ix),y
0040A0  3  18                   clc
0040A1  3  65 rr                adc z80_c
0040A3  3  A0 08                ldy #8
0040A5  3  91 rr                sta (z80_ix),y
0040A7  3  A9 08                lda #8
0040A9  3  85 rr                sta z80_c
0040AB  3  A0 08                ldy #8
0040AD  3  B1 rr                lda (z80_ix),y
0040AF  3  38                   sec
0040B0  3  E5 rr                sbc z80_c
0040B2  3  A0 08                ldy #8
0040B4  3  91 rr                sta (z80_ix),y
0040B6  3  4C D7 40             jmp d01735
0040B9  3  A9 08        d01666: lda #8
0040BB  3  85 rr                sta z80_c
0040BD  3  A0 08                ldy #8
0040BF  3  B1 rr                lda (z80_ix),y
0040C1  3  38                   sec
0040C2  3  E5 rr                sbc z80_c
0040C4  3  A0 08                ldy #8
0040C6  3  91 rr                sta (z80_ix),y
0040C8  3  A9 08                lda #8
0040CA  3  85 rr                sta z80_c
0040CC  3  A0 08                ldy #8
0040CE  3  B1 rr                lda (z80_ix),y
0040D0  3  18                   clc
0040D1  3  65 rr                adc z80_c
0040D3  3  A0 08                ldy #8
0040D5  3  91 rr                sta (z80_ix),y
0040D7  3  A9 00        d01735: lda #0
0040D9  3  C5 rr                cmp varc
0040DB  3  F0 03                beq *+5
0040DD  3  4C E5 40             jmp d01761
0040E0  3  A9 00                lda #0
0040E2  3  20 F2 23             jsr animsp
0040E5  3  A9 00        d01761: lda #0
0040E7  3  A0 0C                ldy #12
0040E9  3  D1 rr                cmp (z80_ix),y
0040EB  3  F0 03                beq *+5
0040ED  3  4C 0E 41             jmp d01844
0040F0  3  A9 00                lda #0
0040F2  3  C5 rr                cmp varg
0040F4  3  F0 03                beq *+5
0040F6  3  4C FF 40             jmp d01813
0040F9  3  A9 FF                lda #255
0040FB  3  A0 05                ldy #5
0040FD  3  91 rr                sta (z80_ix),y
0040FF  3  A9 03        d01813: lda #3
004101  3  C5 rr                cmp varg
004103  3  F0 03                beq *+5
004105  3  4C 0E 41             jmp d01844
004108  3  A9 FF                lda #255
00410A  3  A0 05                ldy #5
00410C  3  91 rr                sta (z80_ix),y
00410E  3  60           d01844: rts
00410F  3               .out .sprintf("EVENT 3 SIZE = %d", (* - evnt03))
00410F  3               
00410F  3               evnt04:
00410F  3  A9 00                lda #0
004111  3  C5 rr                cmp varc
004113  3  F0 03                beq *+5
004115  3  4C 1D 41             jmp e00027
004118  3  A9 00                lda #0
00411A  3  20 F2 23             jsr animsp
00411D  3  A9 02        e00027: lda #2
00411F  3  C5 rr                cmp varg
004121  3  F0 03                beq *+5
004123  3  4C 26 41             jmp e00044
004126  3  A9 01        e00044: lda #1
004128  3  A0 0A                ldy #10
00412A  3  D1 rr                cmp (z80_ix),y
00412C  3  90 03                bcc *+5
00412E  3  4C 37 41             jmp e00079
004131  3  A9 0F                lda #15
004133  3  A0 06                ldy #6
004135  3  91 rr                sta (z80_ix),y
004137  3  A0 0C        e00079: ldy #12
004139  3  B1 rr                lda (z80_ix),y
00413B  3  18                   clc
00413C  3  69 01                adc #1
00413E  3  A0 0C                ldy #12
004140  3  91 rr                sta (z80_ix),y
004142  3  A9 97                lda #151
004144  3  85 rr                sta varo
004146  3  A0 0C                ldy #12
004148  3  B1 rr                lda (z80_ix),y
00414A  3  85 rr                sta z80_c
00414C  3  A5 rr                lda varo
00414E  3  38                   sec
00414F  3  E5 rr                sbc z80_c
004151  3  85 rr                sta varo
004153  3  A9 00                lda #0
004155  3  C5 rr                cmp varc
004157  3  F0 03                beq *+5
004159  3  4C 6B 41             jmp e00191
00415C  3  A9 78                lda #120
00415E  3  C5 rr                cmp varo
004160  3  90 03                bcc *+5
004162  3  4C 6B 41             jmp e00191
004165  3  A5 rr                lda varo
004167  3  0A                   asl a
004168  3  8D 2A 0F             sta sndtyp
00416B  3  A9 96        e00191: lda #150
00416D  3  A0 0C                ldy #12
00416F  3  D1 rr                cmp (z80_ix),y
004171  3  F0 03                beq *+5
004173  3  4C 82 41             jmp e00241
004176  3  A5 rr                lda vara
004178  3  A0 08                ldy #8
00417A  3  91 rr                sta (z80_ix),y
00417C  3  A5 rr                lda varb
00417E  3  A0 09                ldy #9
004180  3  91 rr                sta (z80_ix),y
004182  3  A9 00        e00241: lda #0
004184  3  C5 rr                cmp varc
004186  3  F0 03                beq *+5
004188  3  4C EB 41             jmp e00469
00418B  3  A9 00                lda #0
00418D  3  A0 0A                ldy #10
00418F  3  D1 rr                cmp (z80_ix),y
004191  3  F0 03                beq *+5
004193  3  4C A5 41             jmp e00315
004196  3  A9 FF                lda #255
004198  3  85 rr                sta z80_c
00419A  3  A0 08                ldy #8
00419C  3  B1 rr                lda (z80_ix),y
00419E  3  18                   clc
00419F  3  65 rr                adc z80_c
0041A1  3  A0 08                ldy #8
0041A3  3  91 rr                sta (z80_ix),y
0041A5  3  A9 01        e00315: lda #1
0041A7  3  A0 0A                ldy #10
0041A9  3  D1 rr                cmp (z80_ix),y
0041AB  3  F0 03                beq *+5
0041AD  3  4C BB 41             jmp e00363
0041B0  3  A0 08                ldy #8
0041B2  3  B1 rr                lda (z80_ix),y
0041B4  3  18                   clc
0041B5  3  69 01                adc #1
0041B7  3  A0 08                ldy #8
0041B9  3  91 rr                sta (z80_ix),y
0041BB  3  A9 02        e00363: lda #2
0041BD  3  A0 0A                ldy #10
0041BF  3  D1 rr                cmp (z80_ix),y
0041C1  3  F0 03                beq *+5
0041C3  3  4C D1 41             jmp e00411
0041C6  3  A0 09                ldy #9
0041C8  3  B1 rr                lda (z80_ix),y
0041CA  3  18                   clc
0041CB  3  69 01                adc #1
0041CD  3  A0 09                ldy #9
0041CF  3  91 rr                sta (z80_ix),y
0041D1  3  A9 03        e00411: lda #3
0041D3  3  A0 0A                ldy #10
0041D5  3  D1 rr                cmp (z80_ix),y
0041D7  3  F0 03                beq *+5
0041D9  3  4C EB 41             jmp e00469
0041DC  3  A9 FF                lda #255
0041DE  3  85 rr                sta z80_c
0041E0  3  A0 09                ldy #9
0041E2  3  B1 rr                lda (z80_ix),y
0041E4  3  18                   clc
0041E5  3  65 rr                adc z80_c
0041E7  3  A0 09                ldy #9
0041E9  3  91 rr                sta (z80_ix),y
0041EB  3  A5 rr        e00469: lda vara
0041ED  3  A0 08                ldy #8
0041EF  3  D1 rr                cmp (z80_ix),y
0041F1  3  F0 03                beq *+5
0041F3  3  4C 69 42             jmp e00729
0041F6  3  A5 rr                lda varb
0041F8  3  A0 09                ldy #9
0041FA  3  D1 rr                cmp (z80_ix),y
0041FC  3  F0 03                beq *+5
0041FE  3  4C 69 42             jmp e00729
004201  3  A9 01                lda #1
004203  3  85 rr                sta varg
004205  3  A9 00                lda #0
004207  3  A0 08                ldy #8
004209  3  91 rr                sta (z80_ix),y
00420B  3  A9 00                lda #0
00420D  3  A0 09                ldy #9
00420F  3  91 rr                sta (z80_ix),y
004211  3  A9 02                lda #2
004213  3  85 rr                sta z80_d
004215  3  20 36 20             jsr random
004218  3  85 rr                sta z80_h
00421A  3  20 A3 18             jsr imul
00421D  3  A5 rr                lda z80_h
00421F  3  85 rr                sta varrnd
004221  3  A9 01                lda #1
004223  3  C5 rr                cmp varrnd
004225  3  F0 03                beq *+5
004227  3  4C 30 42             jmp e00610
00422A  3  A9 B0                lda #176
00422C  3  A0 08                ldy #8
00422E  3  91 rr                sta (z80_ix),y
004230  3  A9 02        e00610: lda #2
004232  3  85 rr                sta z80_d
004234  3  20 36 20             jsr random
004237  3  85 rr                sta z80_h
004239  3  20 A3 18             jsr imul
00423C  3  A5 rr                lda z80_h
00423E  3  85 rr                sta varrnd
004240  3  A9 01                lda #1
004242  3  C5 rr                cmp varrnd
004244  3  F0 03                beq *+5
004246  3  4C 4F 42             jmp e00672
004249  3  A9 C0                lda #192
00424B  3  A0 09                ldy #9
00424D  3  91 rr                sta (z80_ix),y
00424F  3  A9 03        e00672: lda #3
004251  3  85 rr                sta z80_c
004253  3  A9 0D                lda #13
004255  3  85 rr                sta z80_b
004257  3  20 0F 1A             jsr spawn
00425A  3  A5 rr                lda ogptr
00425C  3  85 rr                sta z80_x
00425E  3  A5 rr                lda ogptr+1
004260  3  85 rr                sta z80_i
004262  3  A9 FF                lda #255
004264  3  A0 05                ldy #5
004266  3  91 rr                sta (z80_ix),y
004268  3  60                   rts
004269  3  60           e00729: rts
00426A  3               .out .sprintf("EVENT 4 SIZE = %d", (* - evnt04))
00426A  3               
00426A  3               evnt05:
00426A  3  A9 05                lda #5
00426C  3  C5 rr                cmp scno
00426E  3  F0 03                beq *+5
004270  3  4C AA 43             jmp f00648
004273  3  A5 rr                lda varo
004275  3  C9 FF                cmp #255
004277  3  90 03                bcc *+5
004279  3  4C D5 42             jmp f00217
00427C  3  A9 02                lda #2
00427E  3  85 rr                sta chary
004280  3  A9 08                lda #8
004282  3  85 rr                sta charx
004284  3  A9 07                lda #7
004286  3  85 rr                sta z80_c
004288  3  A5 rr                lda varf
00428A  3  18                   clc
00428B  3  65 rr                adc z80_c
00428D  3  85 rr                sta varf
00428F  3  A5 rr                lda varf
004291  3  20 7F 20             jsr dmsg
004294  3  A9 02                lda #2
004296  3  85 rr                sta chary
004298  3  A9 0C                lda #12
00429A  3  85 rr                sta charx
00429C  3  A9 04                lda #4
00429E  3  20 7F 20             jsr dmsg
0042A1  3  A9 FF                lda #255
0042A3  3  85 rr                sta z80_c
0042A5  3  A5 rr                lda varf
0042A7  3  18                   clc
0042A8  3  65 rr                adc z80_c
0042AA  3  85 rr                sta varf
0042AC  3  A9 15                lda #21
0042AE  3  85 rr                sta chary
0042B0  3  A9 08                lda #8
0042B2  3  85 rr                sta charx
0042B4  3  A5 rr                lda varf
0042B6  3  20 7F 20             jsr dmsg
0042B9  3  A9 0C                lda #12
0042BB  3  85 rr                sta charx
0042BD  3  A9 15                lda #21
0042BF  3  85 rr                sta chary
0042C1  3  A9 04                lda #4
0042C3  3  20 7F 20             jsr dmsg
0042C6  3  A9 06                lda #6
0042C8  3  85 rr                sta z80_c
0042CA  3  A5 rr                lda varf
0042CC  3  38                   sec
0042CD  3  E5 rr                sbc z80_c
0042CF  3  85 rr                sta varf
0042D1  3  A9 FF                lda #255
0042D3  3  85 rr                sta varo
0042D5  3  A9 00        f00217: lda #0
0042D7  3  C5 rr                cmp varc
0042D9  3  F0 03                beq *+5
0042DB  3  4C F2 42             jmp f00278
0042DE  3  A9 FF                lda #255
0042E0  3  85 rr                sta z80_c
0042E2  3  A0 08                ldy #8
0042E4  3  B1 rr                lda (z80_ix),y
0042E6  3  18                   clc
0042E7  3  65 rr                adc z80_c
0042E9  3  A0 08                ldy #8
0042EB  3  91 rr                sta (z80_ix),y
0042ED  3  A9 00                lda #0
0042EF  3  20 F2 23             jsr animsp
0042F2  3  A9 02        f00278: lda #2
0042F4  3  C5 rr                cmp varc
0042F6  3  F0 03                beq *+5
0042F8  3  4C 0F 43             jmp f00338
0042FB  3  A9 FF                lda #255
0042FD  3  85 rr                sta z80_c
0042FF  3  A0 08                ldy #8
004301  3  B1 rr                lda (z80_ix),y
004303  3  18                   clc
004304  3  65 rr                adc z80_c
004306  3  A0 08                ldy #8
004308  3  91 rr                sta (z80_ix),y
00430A  3  A9 00                lda #0
00430C  3  20 F2 23             jsr animsp
00430F  3  A5 rr        f00338: lda joyval
004311  3  29 10                and #16
004313  3  F0 03                beq :+
004315  3  4C 1E 43             jmp f00370
004318  3               :
004318  3  A9 20                lda #32
00431A  3  A0 08                ldy #8
00431C  3  91 rr                sta (z80_ix),y
00431E  3  A5 rr        f00370: lda joyval
004320  3  29 20                and #32
004322  3  F0 03                beq :+
004324  3  4C 2D 43             jmp f00401
004327  3               :
004327  3  A9 20                lda #32
004329  3  A0 08                ldy #8
00432B  3  91 rr                sta (z80_ix),y
00432D  3  A9 20        f00401: lda #32
00432F  3  A0 08                ldy #8
004331  3  D1 rr                cmp (z80_ix),y
004333  3  F0 03                beq *+5
004335  3  4C 69 43             jmp f00521
004338  3  A9 00                lda #0
00433A  3  C5 rr                cmp varl
00433C  3  F0 03                beq *+5
00433E  3  4C 4B 43             jmp f00460
004341  3  A5 rr                lda varl
004343  3  18                   clc
004344  3  69 01                adc #1
004346  3  85 rr                sta varl
004348  3  4C 4F 43             jmp f00468
00434B  3  A9 00        f00460: lda #0
00434D  3  85 rr                sta varl
00434F  3  A5 rr        f00468: lda varf
004351  3  18                   clc
004352  3  69 01                adc #1
004354  3  85 rr                sta varf
004356  3  A5 rr                lda varf
004358  3  85 rr                sta scno
00435A  3  20 46 25             jsr nwscr
00435D  3  A5 rr                lda scno
00435F  3  4A                   lsr a
004360  3  85 rr                sta scno
004362  3  20 46 25             jsr nwscr
004365  3  A9 01                lda #1
004367  3  85 rr                sta restfl
004369  3  A9 09        f00521: lda #9
00436B  3  A0 06                ldy #6
00436D  3  D1 rr                cmp (z80_ix),y
00436F  3  F0 03                beq *+5
004371  3  4C 9F 43             jmp f00626
004374  3  A9 03                lda #3
004376  3  C5 rr                cmp varf
004378  3  90 03                bcc *+5
00437A  3  4C 88 43             jmp f00582
00437D  3  A9 60                lda #96
00437F  3  A0 09                ldy #9
004381  3  D1 rr                cmp (z80_ix),y
004383  3  F0 03                beq *+5
004385  3  4C 88 43             jmp f00582
004388  3  A9 06        f00582: lda #6
00438A  3  C5 rr                cmp varf
00438C  3  90 03                bcc *+5
00438E  3  4C 9F 43             jmp f00626
004391  3  A9 60                lda #96
004393  3  A0 09                ldy #9
004395  3  D1 rr                cmp (z80_ix),y
004397  3  F0 03                beq *+5
004399  3  4C 9F 43             jmp f00626
00439C  3  4C 9F 43             jmp f00626
00439F  3  A9 00        f00626: lda #0
0043A1  3  A0 06                ldy #6
0043A3  3  D1 rr                cmp (z80_ix),y
0043A5  3  F0 03                beq *+5
0043A7  3  4C AA 43             jmp f00648
0043AA  3  A9 06        f00648: lda #6
0043AC  3  C5 rr                cmp scno
0043AE  3  F0 03                beq *+5
0043B0  3  4C B6 45             jmp f01695
0043B3  3  A5 rr                lda joyval
0043B5  3  29 10                and #16
0043B7  3  F0 03                beq :+
0043B9  3  4C C7 43             jmp f00703
0043BC  3               :
0043BC  3  A9 04                lda #4
0043BE  3  85 rr                sta scno
0043C0  3  20 46 25             jsr nwscr
0043C3  3  A9 01                lda #1
0043C5  3  85 rr                sta restfl
0043C7  3  A5 rr        f00703: lda joyval
0043C9  3  29 20                and #32
0043CB  3  F0 03                beq :+
0043CD  3  4C DB 43             jmp f00742
0043D0  3               :
0043D0  3  A9 04                lda #4
0043D2  3  85 rr                sta scno
0043D4  3  20 46 25             jsr nwscr
0043D7  3  A9 01                lda #1
0043D9  3  85 rr                sta restfl
0043DB  3  A9 00        f00742: lda #0
0043DD  3  A0 0A                ldy #10
0043DF  3  D1 rr                cmp (z80_ix),y
0043E1  3  90 03                bcc *+5
0043E3  3  4C F1 43             jmp f00791
0043E6  3  A0 0A                ldy #10
0043E8  3  B1 rr                lda (z80_ix),y
0043EA  3  38                   sec
0043EB  3  E9 01                sbc #1
0043ED  3  A0 0A                ldy #10
0043EF  3  91 rr                sta (z80_ix),y
0043F1  3  A5 rr        f00791: lda joyval
0043F3  3  29 40                and #64
0043F5  3  F0 03                beq :+
0043F7  3  4C 2A 44             jmp f00907
0043FA  3               :
0043FA  3  A9 00                lda #0
0043FC  3  A0 0A                ldy #10
0043FE  3  D1 rr                cmp (z80_ix),y
004400  3  F0 03                beq *+5
004402  3  4C 2A 44             jmp f00907
004405  3  A9 63                lda #99
004407  3  A0 0C                ldy #12
004409  3  D1 rr                cmp (z80_ix),y
00440B  3  F0 03                beq *+5
00440D  3  4C 2A 44             jmp f00907
004410  3  A5 rr                lda varn
004412  3  18                   clc
004413  3  69 01                adc #1
004415  3  85 rr                sta varn
004417  3  A9 02                lda #2
004419  3  C5 rr                cmp varn
00441B  3  90 03                bcc *+5
00441D  3  4C 24 44             jmp f00893
004420  3  A9 00                lda #0
004422  3  85 rr                sta varn
004424  3  A9 05        f00893: lda #5
004426  3  A0 0A                ldy #10
004428  3  91 rr                sta (z80_ix),y
00442A  3  A9 0F        f00907: lda #15
00442C  3  85 rr                sta chary
00442E  3  A9 05                lda #5
004430  3  85 rr                sta charx
004432  3  A9 1E                lda #30
004434  3  20 7F 20             jsr dmsg
004437  3  A9 10                lda #16
004439  3  85 rr                sta chary
00443B  3  A9 06                lda #6
00443D  3  85 rr                sta charx
00443F  3  A9 1F                lda #31
004441  3  20 7F 20             jsr dmsg
004444  3  A9 0F                lda #15
004446  3  85 rr                sta chary
004448  3  A9 0D                lda #13
00444A  3  85 rr                sta charx
00444C  3  A9 1B                lda #27
00444E  3  85 rr                sta z80_c
004450  3  A5 rr                lda varn
004452  3  18                   clc
004453  3  65 rr                adc z80_c
004455  3  85 rr                sta varn
004457  3  A5 rr                lda varn
004459  3  20 7F 20             jsr dmsg
00445C  3  A9 1B                lda #27
00445E  3  85 rr                sta z80_c
004460  3  A5 rr                lda varn
004462  3  38                   sec
004463  3  E5 rr                sbc z80_c
004465  3  85 rr                sta varn
004467  3  A9 0C                lda #12
004469  3  85 rr                sta chary
00446B  3  A9 04                lda #4
00446D  3  85 rr                sta charx
00446F  3  A9 B4                lda #180
004471  3  C5 rr                cmp clock
004473  3  90 03                bcc *+5
004475  3  4C 93 44             jmp f01119
004478  3  A9 12                lda #18
00447A  3  85 rr                sta loopa
00447C  3  A5 rr        f01074: lda charx
00447E  3  85 rr                sta dispx
004480  3  A5 rr                lda chary
004482  3  85 rr                sta dispy
004484  3  A9 17                lda #23
004486  3  20 5E 1C             jsr pattr
004489  3  C6 rr                dec loopa
00448B  3  F0 03                beq :+
00448D  3  4C 7C 44             jmp f01074
004490  3               :
004490  3  4C 98 44             jmp f01127
004493  3  A9 15        f01119: lda #21
004495  3  20 7F 20             jsr dmsg
004498  3  A5 rr        f01127: lda varo
00449A  3  C9 FF                cmp #255
00449C  3  90 03                bcc *+5
00449E  3  4C 30 45             jmp f01425
0044A1  3  A9 FF                lda #255
0044A3  3  85 rr                sta varo
0044A5  3  A9 02                lda #2
0044A7  3  85 rr                sta chary
0044A9  3  A9 0A                lda #10
0044AB  3  85 rr                sta charx
0044AD  3  A9 0F                lda #15
0044AF  3  20 7F 20             jsr dmsg
0044B2  3  A9 03                lda #3
0044B4  3  85 rr                sta chary
0044B6  3  A9 07                lda #7
0044B8  3  85 rr                sta charx
0044BA  3  A9 10                lda #16
0044BC  3  20 7F 20             jsr dmsg
0044BF  3  A9 08                lda #8
0044C1  3  85 rr                sta chary
0044C3  3  A9 02                lda #2
0044C5  3  85 rr                sta charx
0044C7  3  A9 11                lda #17
0044C9  3  20 7F 20             jsr dmsg
0044CC  3  A9 09                lda #9
0044CE  3  85 rr                sta chary
0044D0  3  A9 04                lda #4
0044D2  3  85 rr                sta charx
0044D4  3  A9 12                lda #18
0044D6  3  20 7F 20             jsr dmsg
0044D9  3  A9 15                lda #21
0044DB  3  85 rr                sta chary
0044DD  3  A9 01                lda #1
0044DF  3  85 rr                sta charx
0044E1  3  A9 13                lda #19
0044E3  3  20 7F 20             jsr dmsg
0044E6  3  A9 16                lda #22
0044E8  3  85 rr                sta chary
0044EA  3  A9 01                lda #1
0044EC  3  85 rr                sta charx
0044EE  3  A9 14                lda #20
0044F0  3  20 7F 20             jsr dmsg
0044F3  3  A9 17                lda #23
0044F5  3  85 rr                sta chary
0044F7  3  A9 02                lda #2
0044F9  3  85 rr                sta charx
0044FB  3  A9 1D                lda #29
0044FD  3  85 rr                sta varq
0044FF  3  A9 06                lda #6
004501  3  85 rr                sta loopa
004503  3  A5 rr        f01335: lda charx
004505  3  85 rr                sta dispx
004507  3  A5 rr                lda chary
004509  3  85 rr                sta dispy
00450B  3  A5 rr                lda varq
00450D  3  20 5E 1C             jsr pattr
004510  3  A5 rr                lda varq
004512  3  18                   clc
004513  3  69 01                adc #1
004515  3  85 rr                sta varq
004517  3  C6 rr                dec loopa
004519  3  F0 03                beq :+
00451B  3  4C 03 45             jmp f01335
00451E  3               :
00451E  3  A5 rr                lda charx
004520  3  85 rr                sta dispx
004522  3  A5 rr                lda chary
004524  3  85 rr                sta dispy
004526  3  A9 17                lda #23
004528  3  20 5E 1C             jsr pattr
00452B  3  A9 16                lda #22
00452D  3  20 7F 20             jsr dmsg
004530  3  A9 10        f01425: lda #16
004532  3  A0 06                ldy #6
004534  3  D1 rr                cmp (z80_ix),y
004536  3  F0 03                beq *+5
004538  3  4C 5B 45             jmp f01515
00453B  3  20 06 1E             jsr cangl
00453E  3  F0 03                beq :+
004540  3  4C 55 45             jmp f01501
004543  3               :
004543  3  A9 FF                lda #255
004545  3  85 rr                sta z80_c
004547  3  A0 09                ldy #9
004549  3  B1 rr                lda (z80_ix),y
00454B  3  18                   clc
00454C  3  65 rr                adc z80_c
00454E  3  A0 09                ldy #9
004550  3  91 rr                sta (z80_ix),y
004552  3  4C 5B 45             jmp f01515
004555  3  A9 11        f01501: lda #17
004557  3  A0 06                ldy #6
004559  3  91 rr                sta (z80_ix),y
00455B  3  A9 11        f01515: lda #17
00455D  3  A0 06                ldy #6
00455F  3  D1 rr                cmp (z80_ix),y
004561  3  F0 03                beq *+5
004563  3  4C 82 45             jmp f01594
004566  3  20 18 1E             jsr cangr
004569  3  F0 03                beq :+
00456B  3  4C 7C 45             jmp f01581
00456E  3               :
00456E  3  A0 09                ldy #9
004570  3  B1 rr                lda (z80_ix),y
004572  3  18                   clc
004573  3  69 01                adc #1
004575  3  A0 09                ldy #9
004577  3  91 rr                sta (z80_ix),y
004579  3  4C 82 45             jmp f01594
00457C  3  A9 10        f01581: lda #16
00457E  3  A0 06                ldy #6
004580  3  91 rr                sta (z80_ix),y
004582  3  A9 00        f01594: lda #0
004584  3  C5 rr                cmp varc
004586  3  F0 03                beq *+5
004588  3  4C 90 45             jmp f01620
00458B  3  A9 00                lda #0
00458D  3  20 F2 23             jsr animsp
004590  3  A9 05        f01620: lda #5
004592  3  85 rr                sta z80_b
004594  3  20 3D 24             jsr sktyp
004597  3  B0 03                bcs :+
004599  3  4C B6 45             jmp f01695
00459C  3               :
00459C  3  A9 10                lda #16
00459E  3  A0 06                ldy #6
0045A0  3  D1 rr                cmp (z80_ix),y
0045A2  3  F0 03                beq *+5
0045A4  3  4C B0 45             jmp f01682
0045A7  3  A9 11                lda #17
0045A9  3  A0 06                ldy #6
0045AB  3  91 rr                sta (z80_ix),y
0045AD  3  4C B6 45             jmp f01695
0045B0  3  A9 10        f01682: lda #16
0045B2  3  A0 06                ldy #6
0045B4  3  91 rr                sta (z80_ix),y
0045B6  3  60           f01695: rts
0045B7  3               .out .sprintf("EVENT 5 SIZE = %d", (* - evnt05))
0045B7  3               
0045B7  3               evnt06:
0045B7  3  A9 00                lda #0
0045B9  3  A0 0C                ldy #12
0045BB  3  D1 rr                cmp (z80_ix),y
0045BD  3  90 03                bcc *+5
0045BF  3  4C FE 46             jmp g00681
0045C2  3  A9 FF                lda #255
0045C4  3  85 rr                sta z80_c
0045C6  3  A0 0C                ldy #12
0045C8  3  B1 rr                lda (z80_ix),y
0045CA  3  18                   clc
0045CB  3  65 rr                adc z80_c
0045CD  3  A0 0C                ldy #12
0045CF  3  91 rr                sta (z80_ix),y
0045D1  3  A9 96                lda #150
0045D3  3  A0 0C                ldy #12
0045D5  3  D1 rr                cmp (z80_ix),y
0045D7  3  90 03                bcc *+5
0045D9  3  4C 25 46             jmp g00239
0045DC  3  A9 00                lda #0
0045DE  3  C5 rr                cmp varc
0045E0  3  F0 03                beq *+5
0045E2  3  4C F8 45             jmp g00143
0045E5  3  A0 06                ldy #6
0045E7  3  B1 rr                lda (z80_ix),y
0045E9  3  18                   clc
0045EA  3  69 01                adc #1
0045EC  3  A0 06                ldy #6
0045EE  3  91 rr                sta (z80_ix),y
0045F0  3  A0 0C                ldy #12
0045F2  3  B1 rr                lda (z80_ix),y
0045F4  3  0A                   asl a
0045F5  3  8D 2A 0F             sta sndtyp
0045F8  3  A9 02        g00143: lda #2
0045FA  3  C5 rr                cmp varc
0045FC  3  F0 03                beq *+5
0045FE  3  4C 14 46             jmp g00203
004601  3  A0 06                ldy #6
004603  3  B1 rr                lda (z80_ix),y
004605  3  18                   clc
004606  3  69 01                adc #1
004608  3  A0 06                ldy #6
00460A  3  91 rr                sta (z80_ix),y
00460C  3  A0 0C                ldy #12
00460E  3  B1 rr                lda (z80_ix),y
004610  3  0A                   asl a
004611  3  8D 2A 0F             sta sndtyp
004614  3  A9 04        g00203: lda #4
004616  3  A0 06                ldy #6
004618  3  D1 rr                cmp (z80_ix),y
00461A  3  F0 03                beq *+5
00461C  3  4C 25 46             jmp g00239
00461F  3  A9 00                lda #0
004621  3  A0 06                ldy #6
004623  3  91 rr                sta (z80_ix),y
004625  3  A9 BE        g00239: lda #190
004627  3  A0 0C                ldy #12
004629  3  D1 rr                cmp (z80_ix),y
00462B  3  F0 03                beq *+5
00462D  3  4C AD 46             jmp g00512
004630  3  A9 08                lda #8
004632  3  85 rr                sta varm
004634  3  A9 FF                lda #255
004636  3  85 rr                sta z80_c
004638  3  A5 rr                lda numlif
00463A  3  18                   clc
00463B  3  65 rr                adc z80_c
00463D  3  85 rr                sta numlif
00463F  3  A9 02                lda #2
004641  3  85 rr                sta chary
004643  3  A9 1A                lda #26
004645  3  85 rr                sta charx
004647  3  A9 18                lda #24
004649  3  20 7F 20             jsr dmsg
00464C  3  A9 02                lda #2
00464E  3  85 rr                sta chary
004650  3  A9 1D                lda #29
004652  3  85 rr                sta charx
004654  3  A9 18                lda #24
004656  3  20 7F 20             jsr dmsg
004659  3  A9 02                lda #2
00465B  3  85 rr                sta chary
00465D  3  A9 1B                lda #27
00465F  3  85 rr                sta charx
004661  3  A9 00                lda #0
004663  3  C5 rr                cmp numlif
004665  3  90 03                bcc *+5
004667  3  4C 82 46             jmp g00428
00466A  3  A5 rr                lda numlif
00466C  3  85 rr                sta loopa
00466E  3  A5 rr        g00388: lda charx
004670  3  85 rr                sta dispx
004672  3  A5 rr                lda chary
004674  3  85 rr                sta dispy
004676  3  A9 57                lda #87
004678  3  20 5E 1C             jsr pattr
00467B  3  C6 rr                dec loopa
00467D  3  F0 03                beq :+
00467F  3  4C 6E 46             jmp g00388
004682  3               :
004682  3  A9 00        g00428: lda #0
004684  3  C5 rr                cmp numlif
004686  3  F0 03                beq *+5
004688  3  4C AD 46             jmp g00512
00468B  3  A9 02                lda #2
00468D  3  85 rr                sta varg
00468F  3  A9 0C                lda #12
004691  3  85 rr                sta varm
004693  3  A9 06                lda #6
004695  3  85 rr                sta chary
004697  3  A9 0B                lda #11
004699  3  85 rr                sta charx
00469B  3  A9 00                lda #0
00469D  3  20 7F 20             jsr dmsg
0046A0  3  A9 11                lda #17
0046A2  3  85 rr                sta chary
0046A4  3  A9 0B                lda #11
0046A6  3  85 rr                sta charx
0046A8  3  A9 01                lda #1
0046AA  3  20 7F 20             jsr dmsg
0046AD  3  A9 0A        g00512: lda #10
0046AF  3  A0 0C                ldy #12
0046B1  3  D1 rr                cmp (z80_ix),y
0046B3  3  F0 03                beq *+5
0046B5  3  4C C5 46             jmp g00560
0046B8  3  A9 00                lda #0
0046BA  3  C5 rr                cmp numlif
0046BC  3  F0 03                beq *+5
0046BE  3  4C C5 46             jmp g00560
0046C1  3  A9 01                lda #1
0046C3  3  85 rr                sta gamwon
0046C5  3  A0 0C        g00560: ldy #12
0046C7  3  B1 rr                lda (z80_ix),y
0046C9  3  C9 96                cmp #150
0046CB  3  90 03                bcc *+5
0046CD  3  4C E1 46             jmp g00619
0046D0  3  A9 50                lda #80
0046D2  3  A0 0C                ldy #12
0046D4  3  D1 rr                cmp (z80_ix),y
0046D6  3  90 03                bcc *+5
0046D8  3  4C E1 46             jmp g00619
0046DB  3  A9 13                lda #19
0046DD  3  A0 06                ldy #6
0046DF  3  91 rr                sta (z80_ix),y
0046E1  3  A0 0C        g00619: ldy #12
0046E3  3  B1 rr                lda (z80_ix),y
0046E5  3  C9 28                cmp #40
0046E7  3  90 03                bcc *+5
0046E9  3  4C FE 46             jmp g00681
0046EC  3  A9 01                lda #1
0046EE  3  A0 07                ldy #7
0046F0  3  91 rr                sta (z80_ix),y
0046F2  3  A9 B0                lda #176
0046F4  3  A0 08                ldy #8
0046F6  3  91 rr                sta (z80_ix),y
0046F8  3  A9 00                lda #0
0046FA  3  A0 09                ldy #9
0046FC  3  91 rr                sta (z80_ix),y
0046FE  3  A9 00        g00681: lda #0
004700  3  A0 0C                ldy #12
004702  3  D1 rr                cmp (z80_ix),y
004704  3  F0 03                beq *+5
004706  3  4C 20 48             jmp g01293
004709  3  A9 00                lda #0
00470B  3  A0 0B                ldy #11
00470D  3  91 rr                sta (z80_ix),y
00470F  3  A9 01                lda #1
004711  3  85 rr                sta z80_b
004713  3  20 3D 24             jsr sktyp
004716  3  B0 03                bcs :+
004718  3  4C 21 47             jmp g00752
00471B  3               :
00471B  3  A9 01                lda #1
00471D  3  A0 0B                ldy #11
00471F  3  91 rr                sta (z80_ix),y
004721  3  A9 08        g00752: lda #8
004723  3  85 rr                sta z80_b
004725  3  20 3D 24             jsr sktyp
004728  3  B0 03                bcs :+
00472A  3  4C 33 47             jmp g00788
00472D  3               :
00472D  3  A9 01                lda #1
00472F  3  A0 0B                ldy #11
004731  3  91 rr                sta (z80_ix),y
004733  3  A9 10        g00788: lda #16
004735  3  85 rr                sta z80_c
004737  3  A0 09                ldy #9
004739  3  B1 rr                lda (z80_ix),y
00473B  3  18                   clc
00473C  3  65 rr                adc z80_c
00473E  3  A0 09                ldy #9
004740  3  91 rr                sta (z80_ix),y
004742  3  A9 01                lda #1
004744  3  85 rr                sta z80_b
004746  3  20 3D 24             jsr sktyp
004749  3  B0 03                bcs :+
00474B  3  4C 54 47             jmp g00858
00474E  3               :
00474E  3  A9 01                lda #1
004750  3  A0 0B                ldy #11
004752  3  91 rr                sta (z80_ix),y
004754  3  A9 08        g00858: lda #8
004756  3  85 rr                sta z80_c
004758  3  A0 09                ldy #9
00475A  3  B1 rr                lda (z80_ix),y
00475C  3  18                   clc
00475D  3  65 rr                adc z80_c
00475F  3  A0 09                ldy #9
004761  3  91 rr                sta (z80_ix),y
004763  3  A9 01                lda #1
004765  3  85 rr                sta z80_b
004767  3  20 3D 24             jsr sktyp
00476A  3  B0 03                bcs :+
00476C  3  4C 75 47             jmp g00928
00476F  3               :
00476F  3  A9 01                lda #1
004771  3  A0 0B                ldy #11
004773  3  91 rr                sta (z80_ix),y
004775  3  A9 18        g00928: lda #24
004777  3  85 rr                sta z80_c
004779  3  A0 09                ldy #9
00477B  3  B1 rr                lda (z80_ix),y
00477D  3  38                   sec
00477E  3  E5 rr                sbc z80_c
004780  3  A0 09                ldy #9
004782  3  91 rr                sta (z80_ix),y
004784  3  A9 10                lda #16
004786  3  85 rr                sta z80_c
004788  3  A0 08                ldy #8
00478A  3  B1 rr                lda (z80_ix),y
00478C  3  38                   sec
00478D  3  E5 rr                sbc z80_c
00478F  3  A0 08                ldy #8
004791  3  91 rr                sta (z80_ix),y
004793  3  A9 01                lda #1
004795  3  85 rr                sta z80_b
004797  3  20 3D 24             jsr sktyp
00479A  3  B0 03                bcs :+
00479C  3  4C A5 47             jmp g01033
00479F  3               :
00479F  3  A9 01                lda #1
0047A1  3  A0 0B                ldy #11
0047A3  3  91 rr                sta (z80_ix),y
0047A5  3  A9 08        g01033: lda #8
0047A7  3  85 rr                sta z80_c
0047A9  3  A0 08                ldy #8
0047AB  3  B1 rr                lda (z80_ix),y
0047AD  3  38                   sec
0047AE  3  E5 rr                sbc z80_c
0047B0  3  A0 08                ldy #8
0047B2  3  91 rr                sta (z80_ix),y
0047B4  3  A9 01                lda #1
0047B6  3  85 rr                sta z80_b
0047B8  3  20 3D 24             jsr sktyp
0047BB  3  B0 03                bcs :+
0047BD  3  4C C6 47             jmp g01103
0047C0  3               :
0047C0  3  A9 01                lda #1
0047C2  3  A0 0B                ldy #11
0047C4  3  91 rr                sta (z80_ix),y
0047C6  3  A9 18        g01103: lda #24
0047C8  3  85 rr                sta z80_c
0047CA  3  A0 08                ldy #8
0047CC  3  B1 rr                lda (z80_ix),y
0047CE  3  18                   clc
0047CF  3  65 rr                adc z80_c
0047D1  3  A0 08                ldy #8
0047D3  3  91 rr                sta (z80_ix),y
0047D5  3  A5 rr                lda joyval
0047D7  3  29 10                and #16
0047D9  3  F0 03                beq :+
0047DB  3  4C E4 47             jmp g01169
0047DE  3               :
0047DE  3  A9 00                lda #0
0047E0  3  A0 0B                ldy #11
0047E2  3  91 rr                sta (z80_ix),y
0047E4  3  A5 rr        g01169: lda joyval
0047E6  3  29 20                and #32
0047E8  3  F0 03                beq :+
0047EA  3  4C F3 47             jmp g01201
0047ED  3               :
0047ED  3  A9 00                lda #0
0047EF  3  A0 0B                ldy #11
0047F1  3  91 rr                sta (z80_ix),y
0047F3  3  A9 00        g01201: lda #0
0047F5  3  A0 0B                ldy #11
0047F7  3  D1 rr                cmp (z80_ix),y
0047F9  3  F0 03                beq *+5
0047FB  3  4C 20 48             jmp g01293
0047FE  3  A9 04                lda #4
004800  3  85 rr                sta varg
004802  3  A5 rr                lda scno
004804  3  18                   clc
004805  3  69 01                adc #1
004807  3  85 rr                sta scno
004809  3  20 46 25             jsr nwscr
00480C  3  A5 rr                lda scno
00480E  3  85 rr                sta varm
004810  3  A5 rr                lda scno
004812  3  38                   sec
004813  3  E9 01                sbc #1
004815  3  85 rr                sta scno
004817  3  20 46 25             jsr nwscr
00481A  3  A9 FF                lda #255
00481C  3  A0 05                ldy #5
00481E  3  91 rr                sta (z80_ix),y
004820  3  60           g01293: rts
004821  3               .out .sprintf("EVENT 6 SIZE = %d", (* - evnt06))
004821  3               
004821  3               evnt07:
004821  3  A9 00                lda #0
004823  3  C5 rr                cmp varj
004825  3  90 03                bcc *+5
004827  3  4C 35 48             jmp h00045
00482A  3  A0 0B                ldy #11
00482C  3  B1 rr                lda (z80_ix),y
00482E  3  18                   clc
00482F  3  69 01                adc #1
004831  3  A0 0B                ldy #11
004833  3  91 rr                sta (z80_ix),y
004835  3  A9 5F        h00045: lda #95
004837  3  C5 rr                cmp varj
004839  3  F0 03                beq *+5
00483B  3  4C 51 48             jmp h00100
00483E  3  A9 A0                lda #160
004840  3  A0 08                ldy #8
004842  3  91 rr                sta (z80_ix),y
004844  3  A9 00                lda #0
004846  3  85 rr                sta chary
004848  3  A9 07                lda #7
00484A  3  85 rr                sta charx
00484C  3  A9 19                lda #25
00484E  3  20 7F 20             jsr dmsg
004851  3  A9 63        h00100: lda #99
004853  3  C5 rr                cmp varj
004855  3  F0 03                beq *+5
004857  3  4C 75 48             jmp h00176
00485A  3  A9 AA                lda #170
00485C  3  A0 0B                ldy #11
00485E  3  91 rr                sta (z80_ix),y
004860  3  A9 80                lda #128
004862  3  A0 09                ldy #9
004864  3  D1 rr                cmp (z80_ix),y
004866  3  F0 03                beq *+5
004868  3  4C 71 48             jmp h00167
00486B  3  A9 68                lda #104
00486D  3  A0 09                ldy #9
00486F  3  91 rr                sta (z80_ix),y
004871  3  A9 0B        h00167: lda #11
004873  3  85 rr                sta varm
004875  3  A9 5D        h00176: lda #93
004877  3  C5 rr                cmp varj
004879  3  F0 03                beq *+5
00487B  3  4C 8B 48             jmp h00217
00487E  3  A9 00                lda #0
004880  3  85 rr                sta chary
004882  3  A9 00                lda #0
004884  3  85 rr                sta charx
004886  3  A9 1A                lda #26
004888  3  20 7F 20             jsr dmsg
00488B  3  A9 C0        h00217: lda #192
00488D  3  A0 09                ldy #9
00488F  3  D1 rr                cmp (z80_ix),y
004891  3  90 03                bcc *+5
004893  3  4C 9C 48             jmp h00254
004896  3  A9 C8                lda #200
004898  3  A0 08                ldy #8
00489A  3  91 rr                sta (z80_ix),y
00489C  3  A9 5F        h00254: lda #95
00489E  3  C5 rr                cmp varj
0048A0  3  90 03                bcc *+5
0048A2  3  4C B5 48             jmp h00304
0048A5  3  A9 A0                lda #160
0048A7  3  A0 08                ldy #8
0048A9  3  91 rr                sta (z80_ix),y
0048AB  3  A5 rr                lda varj
0048AD  3  38                   sec
0048AE  3  E9 01                sbc #1
0048B0  3  85 rr                sta varj
0048B2  3  4C 09 4B             jmp h01545
0048B5  3  A9 00        h00304: lda #0
0048B7  3  A0 0B                ldy #11
0048B9  3  D1 rr                cmp (z80_ix),y
0048BB  3  F0 03                beq *+5
0048BD  3  4C C7 48             jmp h00342
0048C0  3  A5 rr                lda varj
0048C2  3  38                   sec
0048C3  3  E9 01                sbc #1
0048C5  3  85 rr                sta varj
0048C7  3  A0 06        h00342: ldy #6
0048C9  3  B1 rr                lda (z80_ix),y
0048CB  3  C9 12                cmp #18
0048CD  3  90 03                bcc *+5
0048CF  3  4C 32 49             jmp h00571
0048D2  3  A9 64                lda #100
0048D4  3  A0 08                ldy #8
0048D6  3  D1 rr                cmp (z80_ix),y
0048D8  3  90 03                bcc *+5
0048DA  3  4C 0F 49             jmp h00496
0048DD  3  A9 5E                lda #94
0048DF  3  C5 rr                cmp varj
0048E1  3  90 03                bcc *+5
0048E3  3  4C FE 48             jmp h00457
0048E6  3  A9 FF                lda #255
0048E8  3  85 rr                sta z80_c
0048EA  3  A0 09                ldy #9
0048EC  3  B1 rr                lda (z80_ix),y
0048EE  3  18                   clc
0048EF  3  65 rr                adc z80_c
0048F1  3  A0 09                ldy #9
0048F3  3  91 rr                sta (z80_ix),y
0048F5  3  A9 10                lda #16
0048F7  3  A0 06                ldy #6
0048F9  3  91 rr                sta (z80_ix),y
0048FB  3  4C 0F 49             jmp h00496
0048FE  3  A9 11        h00457: lda #17
004900  3  A0 06                ldy #6
004902  3  91 rr                sta (z80_ix),y
004904  3  A0 09                ldy #9
004906  3  B1 rr                lda (z80_ix),y
004908  3  18                   clc
004909  3  69 01                adc #1
00490B  3  A0 09                ldy #9
00490D  3  91 rr                sta (z80_ix),y
00490F  3  A9 4B        h00496: lda #75
004911  3  A0 09                ldy #9
004913  3  D1 rr                cmp (z80_ix),y
004915  3  90 03                bcc *+5
004917  3  4C 32 49             jmp h00571
00491A  3  A9 00                lda #0
00491C  3  C5 rr                cmp varc
00491E  3  F0 03                beq *+5
004920  3  4C 32 49             jmp h00571
004923  3  A9 FF                lda #255
004925  3  85 rr                sta z80_c
004927  3  A0 09                ldy #9
004929  3  B1 rr                lda (z80_ix),y
00492B  3  18                   clc
00492C  3  65 rr                adc z80_c
00492E  3  A0 09                ldy #9
004930  3  91 rr                sta (z80_ix),y
004932  3  A9 00        h00571: lda #0
004934  3  C5 rr                cmp varc
004936  3  F0 03                beq *+5
004938  3  4C 4B 49             jmp h00618
00493B  3  A0 06                ldy #6
00493D  3  B1 rr                lda (z80_ix),y
00493F  3  C9 12                cmp #18
004941  3  90 03                bcc *+5
004943  3  4C 4B 49             jmp h00618
004946  3  A9 00                lda #0
004948  3  20 F2 23             jsr animsp
00494B  3  A9 07        h00618: lda #7
00494D  3  85 rr                sta z80_b
00494F  3  20 3D 24             jsr sktyp
004952  3  B0 03                bcs :+
004954  3  4C 6D 49             jmp h00688
004957  3               :
004957  3  A0 06                ldy #6
004959  3  B1 rr                lda (z80_ix),y
00495B  3  C9 12                cmp #18
00495D  3  90 03                bcc *+5
00495F  3  4C 6D 49             jmp h00688
004962  3  A0 09                ldy #9
004964  3  B1 rr                lda (z80_ix),y
004966  3  18                   clc
004967  3  69 01                adc #1
004969  3  A0 09                ldy #9
00496B  3  91 rr                sta (z80_ix),y
00496D  3  A9 10        h00688: lda #16
00496F  3  A0 06                ldy #6
004971  3  D1 rr                cmp (z80_ix),y
004973  3  F0 03                beq *+5
004975  3  4C 92 49             jmp h00763
004978  3  A9 00                lda #0
00497A  3  C5 rr                cmp varj
00497C  3  90 03                bcc *+5
00497E  3  4C 92 49             jmp h00763
004981  3  A9 58                lda #88
004983  3  A0 09                ldy #9
004985  3  D1 rr                cmp (z80_ix),y
004987  3  90 03                bcc *+5
004989  3  4C 92 49             jmp h00763
00498C  3  A9 11                lda #17
00498E  3  A0 06                ldy #6
004990  3  91 rr                sta (z80_ix),y
004992  3  A9 12        h00763: lda #18
004994  3  A0 06                ldy #6
004996  3  D1 rr                cmp (z80_ix),y
004998  3  F0 03                beq *+5
00499A  3  4C D1 4A             jmp h01436
00499D  3  A9 50                lda #80
00499F  3  C5 rr                cmp varj
0049A1  3  90 03                bcc *+5
0049A3  3  4C BA 49             jmp h00845
0049A6  3  A5 rr                lda varj
0049A8  3  C9 5C                cmp #92
0049AA  3  90 03                bcc *+5
0049AC  3  4C BA 49             jmp h00845
0049AF  3  A0 09                ldy #9
0049B1  3  B1 rr                lda (z80_ix),y
0049B3  3  18                   clc
0049B4  3  69 01                adc #1
0049B6  3  A0 09                ldy #9
0049B8  3  91 rr                sta (z80_ix),y
0049BA  3  A0 09        h00845: ldy #9
0049BC  3  B1 rr                lda (z80_ix),y
0049BE  3  C9 1E                cmp #30
0049C0  3  90 03                bcc *+5
0049C2  3  4C 0C 4A             jmp h01020
0049C5  3  A9 00                lda #0
0049C7  3  A0 0C                ldy #12
0049C9  3  91 rr                sta (z80_ix),y
0049CB  3  A9 00                lda #0
0049CD  3  C5 rr                cmp varc
0049CF  3  F0 03                beq *+5
0049D1  3  4C 0C 4A             jmp h01020
0049D4  3  A0 07                ldy #7
0049D6  3  B1 rr                lda (z80_ix),y
0049D8  3  18                   clc
0049D9  3  69 01                adc #1
0049DB  3  A0 07                ldy #7
0049DD  3  91 rr                sta (z80_ix),y
0049DF  3  A0 09                ldy #9
0049E1  3  B1 rr                lda (z80_ix),y
0049E3  3  18                   clc
0049E4  3  69 01                adc #1
0049E6  3  A0 09                ldy #9
0049E8  3  91 rr                sta (z80_ix),y
0049EA  3  A9 1E                lda #30
0049EC  3  A0 09                ldy #9
0049EE  3  D1 rr                cmp (z80_ix),y
0049F0  3  F0 03                beq *+5
0049F2  3  4C FB 49             jmp h00985
0049F5  3  A9 50                lda #80
0049F7  3  A0 0C                ldy #12
0049F9  3  91 rr                sta (z80_ix),y
0049FB  3  A9 03        h00985: lda #3
0049FD  3  A0 07                ldy #7
0049FF  3  D1 rr                cmp (z80_ix),y
004A01  3  F0 03                beq *+5
004A03  3  4C 0C 4A             jmp h01020
004A06  3  A9 00                lda #0
004A08  3  A0 07                ldy #7
004A0A  3  91 rr                sta (z80_ix),y
004A0C  3  A9 01        h01020: lda #1
004A0E  3  A0 0C                ldy #12
004A10  3  D1 rr                cmp (z80_ix),y
004A12  3  90 03                bcc *+5
004A14  3  4C 47 4A             jmp h01146
004A17  3  A0 0C                ldy #12
004A19  3  B1 rr                lda (z80_ix),y
004A1B  3  38                   sec
004A1C  3  E9 01                sbc #1
004A1E  3  A0 0C                ldy #12
004A20  3  91 rr                sta (z80_ix),y
004A22  3  A9 00                lda #0
004A24  3  C5 rr                cmp varc
004A26  3  F0 03                beq *+5
004A28  3  4C 36 4A             jmp h01111
004A2B  3  A0 07                ldy #7
004A2D  3  B1 rr                lda (z80_ix),y
004A2F  3  18                   clc
004A30  3  69 01                adc #1
004A32  3  A0 07                ldy #7
004A34  3  91 rr                sta (z80_ix),y
004A36  3  A9 05        h01111: lda #5
004A38  3  A0 07                ldy #7
004A3A  3  D1 rr                cmp (z80_ix),y
004A3C  3  F0 03                beq *+5
004A3E  3  4C 47 4A             jmp h01146
004A41  3  A9 03                lda #3
004A43  3  A0 07                ldy #7
004A45  3  91 rr                sta (z80_ix),y
004A47  3  A9 1F        h01146: lda #31
004A49  3  A0 09                ldy #9
004A4B  3  D1 rr                cmp (z80_ix),y
004A4D  3  F0 03                beq *+5
004A4F  3  4C 58 4A             jmp h01182
004A52  3  A9 00                lda #0
004A54  3  A0 07                ldy #7
004A56  3  91 rr                sta (z80_ix),y
004A58  3  A9 01        h01182: lda #1
004A5A  3  A0 0C                ldy #12
004A5C  3  D1 rr                cmp (z80_ix),y
004A5E  3  F0 03                beq *+5
004A60  3  4C D1 4A             jmp h01436
004A63  3  A9 00                lda #0
004A65  3  C5 rr                cmp varc
004A67  3  F0 03                beq *+5
004A69  3  4C 82 4A             jmp h01272
004A6C  3  A0 09                ldy #9
004A6E  3  B1 rr                lda (z80_ix),y
004A70  3  18                   clc
004A71  3  69 01                adc #1
004A73  3  A0 09                ldy #9
004A75  3  91 rr                sta (z80_ix),y
004A77  3  A0 07                ldy #7
004A79  3  B1 rr                lda (z80_ix),y
004A7B  3  18                   clc
004A7C  3  69 01                adc #1
004A7E  3  A0 07                ldy #7
004A80  3  91 rr                sta (z80_ix),y
004A82  3  A9 02        h01272: lda #2
004A84  3  C5 rr                cmp varc
004A86  3  F0 03                beq *+5
004A88  3  4C A1 4A             jmp h01340
004A8B  3  A0 09                ldy #9
004A8D  3  B1 rr                lda (z80_ix),y
004A8F  3  18                   clc
004A90  3  69 01                adc #1
004A92  3  A0 09                ldy #9
004A94  3  91 rr                sta (z80_ix),y
004A96  3  A0 07                ldy #7
004A98  3  B1 rr                lda (z80_ix),y
004A9A  3  18                   clc
004A9B  3  69 01                adc #1
004A9D  3  A0 07                ldy #7
004A9F  3  91 rr                sta (z80_ix),y
004AA1  3  A9 02        h01340: lda #2
004AA3  3  A0 07                ldy #7
004AA5  3  D1 rr                cmp (z80_ix),y
004AA7  3  90 03                bcc *+5
004AA9  3  4C B2 4A             jmp h01376
004AAC  3  A9 00                lda #0
004AAE  3  A0 07                ldy #7
004AB0  3  91 rr                sta (z80_ix),y
004AB2  3  A9 50        h01376: lda #80
004AB4  3  A0 09                ldy #9
004AB6  3  D1 rr                cmp (z80_ix),y
004AB8  3  F0 03                beq *+5
004ABA  3  4C D1 4A             jmp h01436
004ABD  3  A9 00                lda #0
004ABF  3  C5 rr                cmp varj
004AC1  3  F0 03                beq *+5
004AC3  3  4C D1 4A             jmp h01436
004AC6  3  A9 00                lda #0
004AC8  3  85 rr                sta scno
004ACA  3  20 46 25             jsr nwscr
004ACD  3  A9 01                lda #1
004ACF  3  85 rr                sta restfl
004AD1  3  A5 rr        h01436: lda joyval
004AD3  3  29 10                and #16
004AD5  3  F0 03                beq :+
004AD7  3  4C ED 4A             jmp h01490
004ADA  3               :
004ADA  3  A9 00                lda #0
004ADC  3  85 rr                sta varj
004ADE  3  A9 00                lda #0
004AE0  3  85 rr                sta varl
004AE2  3  A9 00                lda #0
004AE4  3  85 rr                sta scno
004AE6  3  20 46 25             jsr nwscr
004AE9  3  A9 01                lda #1
004AEB  3  85 rr                sta restfl
004AED  3  A5 rr        h01490: lda joyval
004AEF  3  29 20                and #32
004AF1  3  F0 03                beq :+
004AF3  3  4C 09 4B             jmp h01545
004AF6  3               :
004AF6  3  A9 00                lda #0
004AF8  3  85 rr                sta varj
004AFA  3  A9 00                lda #0
004AFC  3  85 rr                sta varl
004AFE  3  A9 00                lda #0
004B00  3  85 rr                sta scno
004B02  3  20 46 25             jsr nwscr
004B05  3  A9 01                lda #1
004B07  3  85 rr                sta restfl
004B09  3  A9 5A        h01545: lda #90
004B0B  3  C5 rr                cmp varj
004B0D  3  F0 03                beq *+5
004B0F  3  4C 25 4B             jmp h01599
004B12  3  A9 00                lda #0
004B14  3  85 rr                sta varj
004B16  3  A9 00                lda #0
004B18  3  85 rr                sta varl
004B1A  3  A9 00                lda #0
004B1C  3  85 rr                sta scno
004B1E  3  20 46 25             jsr nwscr
004B21  3  A9 01                lda #1
004B23  3  85 rr                sta restfl
004B25  3  60           h01599: rts
004B26  3               .out .sprintf("EVENT 7 SIZE = %d", (* - evnt07))
004B26  3               
004B26  3               evnt08:
004B26  3  A9 00                lda #0
004B28  3  A0 0C                ldy #12
004B2A  3  D1 rr                cmp (z80_ix),y
004B2C  3  90 03                bcc *+5
004B2E  3  4C 8F 4C             jmp i00748
004B31  3  A9 00                lda #0
004B33  3  20 F2 23             jsr animsp
004B36  3  A0 0C                ldy #12
004B38  3  B1 rr                lda (z80_ix),y
004B3A  3  38                   sec
004B3B  3  E9 01                sbc #1
004B3D  3  A0 0C                ldy #12
004B3F  3  91 rr                sta (z80_ix),y
004B41  3  A9 01                lda #1
004B43  3  C5 rr                cmp varc
004B45  3  90 03                bcc *+5
004B47  3  4C 60 4B             jmp i00121
004B4A  3  A9 50                lda #80
004B4C  3  A0 0C                ldy #12
004B4E  3  D1 rr                cmp (z80_ix),y
004B50  3  90 03                bcc *+5
004B52  3  4C 5D 4B             jmp i00116
004B55  3  A0 0C                ldy #12
004B57  3  B1 rr                lda (z80_ix),y
004B59  3  0A                   asl a
004B5A  3  8D 2A 0F             sta sndtyp
004B5D  3  4C 60 4B     i00116: jmp i00121
004B60  3  A9 00        i00121: lda #0
004B62  3  A0 0C                ldy #12
004B64  3  D1 rr                cmp (z80_ix),y
004B66  3  F0 03                beq *+5
004B68  3  4C 8F 4C             jmp i00748
004B6B  3  A9 00                lda #0
004B6D  3  85 rr                sta varo
004B6F  3  A9 06                lda #CUSTOM
004B71  3  85 rr                sta z80_b
004B73  3  20 FD 1E             jsr tded
004B76  3  C5 rr                cmp z80_b
004B78  3  F0 03                beq :+
004B7A  3  4C 57 4C             jmp i00626
004B7D  3               :
004B7D  3  A9 10                lda #16
004B7F  3  85 rr                sta z80_c
004B81  3  A0 08                ldy #8
004B83  3  B1 rr                lda (z80_ix),y
004B85  3  18                   clc
004B86  3  65 rr                adc z80_c
004B88  3  A0 08                ldy #8
004B8A  3  91 rr                sta (z80_ix),y
004B8C  3  A9 01                lda #1
004B8E  3  85 rr                sta z80_b
004B90  3  20 3D 24             jsr sktyp
004B93  3  B0 03                bcs :+
004B95  3  4C 9C 4B             jmp i00243
004B98  3               :
004B98  3  A9 01                lda #1
004B9A  3  85 rr                sta varo
004B9C  3  A9 08        i00243: lda #8
004B9E  3  85 rr                sta z80_b
004BA0  3  20 3D 24             jsr sktyp
004BA3  3  B0 03                bcs :+
004BA5  3  4C AC 4B             jmp i00273
004BA8  3               :
004BA8  3  A9 01                lda #1
004BAA  3  85 rr                sta varo
004BAC  3  A9 20        i00273: lda #32
004BAE  3  85 rr                sta z80_c
004BB0  3  A0 08                ldy #8
004BB2  3  B1 rr                lda (z80_ix),y
004BB4  3  38                   sec
004BB5  3  E5 rr                sbc z80_c
004BB7  3  A0 08                ldy #8
004BB9  3  91 rr                sta (z80_ix),y
004BBB  3  A9 01                lda #1
004BBD  3  85 rr                sta z80_b
004BBF  3  20 3D 24             jsr sktyp
004BC2  3  B0 03                bcs :+
004BC4  3  4C CB 4B             jmp i00337
004BC7  3               :
004BC7  3  A9 01                lda #1
004BC9  3  85 rr                sta varo
004BCB  3  A9 08        i00337: lda #8
004BCD  3  85 rr                sta z80_b
004BCF  3  20 3D 24             jsr sktyp
004BD2  3  B0 03                bcs :+
004BD4  3  4C DB 4B             jmp i00367
004BD7  3               :
004BD7  3  A9 01                lda #1
004BD9  3  85 rr                sta varo
004BDB  3  A9 10        i00367: lda #16
004BDD  3  85 rr                sta z80_c
004BDF  3  A0 08                ldy #8
004BE1  3  B1 rr                lda (z80_ix),y
004BE3  3  18                   clc
004BE4  3  65 rr                adc z80_c
004BE6  3  A0 08                ldy #8
004BE8  3  91 rr                sta (z80_ix),y
004BEA  3  A9 10                lda #16
004BEC  3  85 rr                sta z80_c
004BEE  3  A0 09                ldy #9
004BF0  3  B1 rr                lda (z80_ix),y
004BF2  3  18                   clc
004BF3  3  65 rr                adc z80_c
004BF5  3  A0 09                ldy #9
004BF7  3  91 rr                sta (z80_ix),y
004BF9  3  A9 01                lda #1
004BFB  3  85 rr                sta z80_b
004BFD  3  20 3D 24             jsr sktyp
004C00  3  B0 03                bcs :+
004C02  3  4C 09 4C             jmp i00467
004C05  3               :
004C05  3  A9 01                lda #1
004C07  3  85 rr                sta varo
004C09  3  A9 08        i00467: lda #8
004C0B  3  85 rr                sta z80_b
004C0D  3  20 3D 24             jsr sktyp
004C10  3  B0 03                bcs :+
004C12  3  4C 19 4C             jmp i00497
004C15  3               :
004C15  3  A9 01                lda #1
004C17  3  85 rr                sta varo
004C19  3  A9 20        i00497: lda #32
004C1B  3  85 rr                sta z80_c
004C1D  3  A0 09                ldy #9
004C1F  3  B1 rr                lda (z80_ix),y
004C21  3  38                   sec
004C22  3  E5 rr                sbc z80_c
004C24  3  A0 09                ldy #9
004C26  3  91 rr                sta (z80_ix),y
004C28  3  A9 01                lda #1
004C2A  3  85 rr                sta z80_b
004C2C  3  20 3D 24             jsr sktyp
004C2F  3  B0 03                bcs :+
004C31  3  4C 38 4C             jmp i00561
004C34  3               :
004C34  3  A9 01                lda #1
004C36  3  85 rr                sta varo
004C38  3  A9 08        i00561: lda #8
004C3A  3  85 rr                sta z80_b
004C3C  3  20 3D 24             jsr sktyp
004C3F  3  B0 03                bcs :+
004C41  3  4C 48 4C             jmp i00591
004C44  3               :
004C44  3  A9 01                lda #1
004C46  3  85 rr                sta varo
004C48  3  A9 10        i00591: lda #16
004C4A  3  85 rr                sta z80_c
004C4C  3  A0 09                ldy #9
004C4E  3  B1 rr                lda (z80_ix),y
004C50  3  18                   clc
004C51  3  65 rr                adc z80_c
004C53  3  A0 09                ldy #9
004C55  3  91 rr                sta (z80_ix),y
004C57  3  A9 00        i00626: lda #0
004C59  3  C5 rr                cmp varo
004C5B  3  F0 03                beq *+5
004C5D  3  4C 84 4C             jmp i00722
004C60  3  A9 00                lda #0
004C62  3  A0 0B                ldy #11
004C64  3  D1 rr                cmp (z80_ix),y
004C66  3  90 03                bcc *+5
004C68  3  4C 7A 4C             jmp i00701
004C6B  3  A9 FF                lda #255
004C6D  3  85 rr                sta z80_c
004C6F  3  A0 0B                ldy #11
004C71  3  B1 rr                lda (z80_ix),y
004C73  3  18                   clc
004C74  3  65 rr                adc z80_c
004C76  3  A0 0B                ldy #11
004C78  3  91 rr                sta (z80_ix),y
004C7A  3  A9 01        i00701: lda #1
004C7C  3  A0 05                ldy #5
004C7E  3  91 rr                sta (z80_ix),y
004C80  3  60                   rts
004C81  3  4C 8F 4C             jmp i00748
004C84  3  A0 0C        i00722: ldy #12
004C86  3  B1 rr                lda (z80_ix),y
004C88  3  18                   clc
004C89  3  69 01                adc #1
004C8B  3  A0 0C                ldy #12
004C8D  3  91 rr                sta (z80_ix),y
004C8F  3  60           i00748: rts
004C90  3               .out .sprintf("EVENT 8 SIZE = %d", (* - evnt08))
004C90  3               
004C90  3               evnt09:
004C90  3  A9 05                lda #5
004C92  3  A0 05                ldy #5
004C94  3  D1 rr                cmp (z80_ix),y
004C96  3  F0 03                beq *+5
004C98  3  4C B5 4C             jmp j00078
004C9B  3  A9 00                lda #0
004C9D  3  A0 09                ldy #9
004C9F  3  D1 rr                cmp (z80_ix),y
004CA1  3  F0 03                beq *+5
004CA3  3  4C AF 4C             jmp j00064
004CA6  3  A9 63                lda #99
004CA8  3  A0 0C                ldy #12
004CAA  3  91 rr                sta (z80_ix),y
004CAC  3  4C B5 4C             jmp j00078
004CAF  3  A9 00        j00064: lda #0
004CB1  3  A0 0C                ldy #12
004CB3  3  91 rr                sta (z80_ix),y
004CB5  3  A9 02        j00078: lda #2
004CB7  3  A0 05                ldy #5
004CB9  3  D1 rr                cmp (z80_ix),y
004CBB  3  F0 03                beq *+5
004CBD  3  4C E6 4C             jmp j00177
004CC0  3  A9 28                lda #40
004CC2  3  0A                   asl a
004CC3  3  8D 2A 0F             sta sndtyp
004CC6  3  A9 07                lda #7
004CC8  3  85 rr                sta chary
004CCA  3  A9 1D                lda #29
004CCC  3  85 rr                sta charx
004CCE  3  A9 18                lda #24
004CD0  3  20 7F 20             jsr dmsg
004CD3  3  A9 07                lda #7
004CD5  3  85 rr                sta chary
004CD7  3  A9 1D                lda #29
004CD9  3  85 rr                sta charx
004CDB  3  A5 rr                lda vark
004CDD  3  20 CD 24             jsr disply
004CE0  3  A9 FF                lda #255
004CE2  3  A0 0A                ldy #10
004CE4  3  91 rr                sta (z80_ix),y
004CE6  3  A9 00        j00177: lda #0
004CE8  3  A0 05                ldy #5
004CEA  3  D1 rr                cmp (z80_ix),y
004CEC  3  F0 03                beq *+5
004CEE  3  4C 03 4D             jmp j00240
004CF1  3  A9 00                lda #0
004CF3  3  A0 0B                ldy #11
004CF5  3  91 rr                sta (z80_ix),y
004CF7  3  A9 00                lda #0
004CF9  3  A0 0C                ldy #12
004CFB  3  91 rr                sta (z80_ix),y
004CFD  3  A9 FF                lda #255
004CFF  3  A0 0A                ldy #10
004D01  3  91 rr                sta (z80_ix),y
004D03  3  A9 08        j00240: lda #8
004D05  3  A0 05                ldy #5
004D07  3  D1 rr                cmp (z80_ix),y
004D09  3  F0 03                beq *+5
004D0B  3  4C 51 4D             jmp j00415
004D0E  3  A9 14                lda #20
004D10  3  A0 0C                ldy #12
004D12  3  91 rr                sta (z80_ix),y
004D14  3  A0 06                ldy #6
004D16  3  B1 rr                lda (z80_ix),y
004D18  3  A0 0B                ldy #11
004D1A  3  91 rr                sta (z80_ix),y
004D1C  3  A9 08                lda #8
004D1E  3  85 rr                sta z80_c
004D20  3  A0 0B                ldy #11
004D22  3  B1 rr                lda (z80_ix),y
004D24  3  38                   sec
004D25  3  E5 rr                sbc z80_c
004D27  3  A0 0B                ldy #11
004D29  3  91 rr                sta (z80_ix),y
004D2B  3  A9 01                lda #1
004D2D  3  A0 0A                ldy #10
004D2F  3  91 rr                sta (z80_ix),y
004D31  3  A5 rr                lda varr
004D33  3  85 rr                sta z80_c
004D35  3  A0 0B                ldy #11
004D37  3  B1 rr                lda (z80_ix),y
004D39  3  18                   clc
004D3A  3  65 rr                adc z80_c
004D3C  3  A0 0B                ldy #11
004D3E  3  91 rr                sta (z80_ix),y
004D40  3  A9 02                lda #2
004D42  3  A0 0B                ldy #11
004D44  3  D1 rr                cmp (z80_ix),y
004D46  3  90 03                bcc *+5
004D48  3  4C 51 4D             jmp j00415
004D4B  3  A9 02                lda #2
004D4D  3  A0 0B                ldy #11
004D4F  3  91 rr                sta (z80_ix),y
004D51  3  60           j00415: rts
004D52  3               .out .sprintf("EVENT 9 SIZE = %d", (* - evnt09))
004D52  3               
004D52  3               evnt10:
004D52  3  A5 rr                lda joyval
004D54  3  29 40                and #64
004D56  3  F0 03                beq :+
004D58  3  4C 68 4D             jmp k00046
004D5B  3               :
004D5B  3  A5 rr                lda joyval
004D5D  3  29 20                and #32
004D5F  3  F0 03                beq :+
004D61  3  4C 68 4D             jmp k00046
004D64  3               :
004D64  3  A9 01                lda #1
004D66  3  85 rr                sta gamwon
004D68  3  A5 rr        k00046: lda varc
004D6A  3  18                   clc
004D6B  3  69 01                adc #1
004D6D  3  85 rr                sta varc
004D6F  3  A9 03                lda #3
004D71  3  C5 rr                cmp varc
004D73  3  90 03                bcc *+5
004D75  3  4C 7C 4D             jmp k00086
004D78  3  A9 00                lda #0
004D7A  3  85 rr                sta varc
004D7C  3  A5 rr        k00086: lda scno
004D7E  3  C9 04                cmp #4
004D80  3  90 03                bcc *+5
004D82  3  4C 3A 4E             jmp k00467
004D85  3  A9 AA                lda #170
004D87  3  85 rr                sta z80_d
004D89  3  20 36 20             jsr random
004D8C  3  85 rr                sta z80_h
004D8E  3  20 A3 18             jsr imul
004D91  3  A5 rr                lda z80_h
004D93  3  85 rr                sta varrnd
004D95  3  A5 rr                lda varrnd
004D97  3  C5 rr                cmp clock
004D99  3  F0 03                beq *+5
004D9B  3  4C ED 4D             jmp k00318
004D9E  3  A0 08                ldy #8
004DA0  3  B1 rr                lda (z80_ix),y
004DA2  3  85 rr                sta varo
004DA4  3  A0 09                ldy #9
004DA6  3  B1 rr                lda (z80_ix),y
004DA8  3  85 rr                sta varp
004DAA  3  A9 58                lda #88
004DAC  3  A0 08                ldy #8
004DAE  3  91 rr                sta (z80_ix),y
004DB0  3  A9 60                lda #96
004DB2  3  A0 09                ldy #9
004DB4  3  91 rr                sta (z80_ix),y
004DB6  3  20 B6 19             jsr skobj
004DB9  3  85 rr                sta varobj
004DBB  3  A9 08                lda #8
004DBD  3  C5 rr                cmp varobj
004DBF  3  F0 03                beq *+5
004DC1  3  4C C7 4D             jmp k00238
004DC4  3  4C E1 4D             jmp k00291
004DC7  3  A5 rr        k00238: lda vark
004DC9  3  C9 0F                cmp #15
004DCB  3  90 03                bcc *+5
004DCD  3  4C E1 4D             jmp k00291
004DD0  3  A0 09                ldy #9
004DD2  3  B1 rr                lda (z80_ix),y
004DD4  3  85 rr                sta dispx
004DD6  3  A0 08                ldy #8
004DD8  3  B1 rr                lda (z80_ix),y
004DDA  3  85 rr                sta dispy
004DDC  3  A9 08                lda #8
004DDE  3  20 95 19             jsr drpob
004DE1  3  A5 rr        k00291: lda varo
004DE3  3  A0 08                ldy #8
004DE5  3  91 rr                sta (z80_ix),y
004DE7  3  A5 rr                lda varp
004DE9  3  A0 09                ldy #9
004DEB  3  91 rr                sta (z80_ix),y
004DED  3  A9 00        k00318: lda #0
004DEF  3  C5 rr                cmp vark
004DF1  3  F0 03                beq *+5
004DF3  3  4C 3A 4E             jmp k00467
004DF6  3  A9 32                lda #50
004DF8  3  C5 rr                cmp clock
004DFA  3  F0 03                beq *+5
004DFC  3  4C 0C 4E             jmp k00377
004DFF  3  A9 1B                lda #27
004E01  3  85 rr                sta charx
004E03  3  A9 06                lda #6
004E05  3  85 rr                sta chary
004E07  3  A9 03                lda #3
004E09  3  20 7F 20             jsr dmsg
004E0C  3  A9 64        k00377: lda #100
004E0E  3  C5 rr                cmp clock
004E10  3  F0 03                beq *+5
004E12  3  4C 22 4E             jmp k00419
004E15  3  A9 1B                lda #27
004E17  3  85 rr                sta charx
004E19  3  A9 06                lda #6
004E1B  3  85 rr                sta chary
004E1D  3  A9 03                lda #3
004E1F  3  20 7F 20             jsr dmsg
004E22  3  A9 3C        k00419: lda #60
004E24  3  C5 rr                cmp clock
004E26  3  90 03                bcc *+5
004E28  3  4C 3A 4E             jmp k00467
004E2B  3  A5 rr                lda clock
004E2D  3  C9 5A                cmp #90
004E2F  3  90 03                bcc *+5
004E31  3  4C 3A 4E             jmp k00467
004E34  3  A5 rr                lda clock
004E36  3  0A                   asl a
004E37  3  8D 2A 0F             sta sndtyp
004E3A  3  60           k00467: rts
004E3B  3               .out .sprintf("EVENT 10 SIZE = %d", (* - evnt10))
004E3B  3               
004E3B  3               evnt11:
004E3B  3  60                   rts
004E3C  3               .out .sprintf("EVENT 11 SIZE = %d", (* - evnt11))
004E3C  3               
004E3C  3               evnt12:
004E3C  3  60                   rts
004E3D  3               .out .sprintf("EVENT 12 SIZE = %d", (* - evnt12))
004E3D  3               
004E3D  3               evnt13:
004E3D  3  A9 00                lda #0
004E3F  3  85 rr                sta varq
004E41  3  A9 00                lda #0
004E43  3  85 rr                sta varr
004E45  3  A9 00                lda #0
004E47  3  85 rr                sta varm
004E49  3  A9 03                lda #3
004E4B  3  85 rr                sta vark
004E4D  3  A9 06                lda #6
004E4F  3  85 rr                sta scno
004E51  3  20 46 25             jsr nwscr
004E54  3  A9 00                lda #0
004E56  3  85 rr                sta varl
004E58  3  A9 00                lda #0
004E5A  3  85 rr                sta vari
004E5C  3  A9 00                lda #0
004E5E  3  85 rr                sta varj
004E60  3  A9 03                lda #3
004E62  3  85 rr                sta numlif
004E64  3  20 97 16             jsr cls
004E67  3  A9 00                lda #0
004E69  3  85 rr                sta varf
004E6B  3  60                   rts
004E6C  3               .out .sprintf("EVENT 13 SIZE = %d", (* - evnt13))
004E6C  3               
004E6C  3               evnt14:
004E6C  3  A9 00                lda #0
004E6E  3  85 rr                sta varq
004E70  3  A9 0F                lda #15
004E72  3  85 rr                sta vars
004E74  3  A9 01                lda #1
004E76  3  C5 rr                cmp varl
004E78  3  F0 03                beq *+5
004E7A  3  4C 81 4E             jmp o00043
004E7D  3  A9 47                lda #71
004E7F  3  85 rr                sta vars
004E81  3  20 97 16     o00043: jsr cls
004E84  3  A5 rr                lda scno
004E86  3  C9 06                cmp #6
004E88  3  90 03                bcc *+5
004E8A  3  4C 50 4F             jmp o00450
004E8D  3  A9 00                lda #0
004E8F  3  85 rr                sta chary
004E91  3  A9 1B                lda #27
004E93  3  85 rr                sta charx
004E95  3  A9 02                lda #2
004E97  3  20 7F 20             jsr dmsg
004E9A  3  A9 02                lda #2
004E9C  3  85 rr                sta chary
004E9E  3  A9 1A                lda #26
004EA0  3  85 rr                sta charx
004EA2  3  A9 18                lda #24
004EA4  3  20 7F 20             jsr dmsg
004EA7  3  A9 02                lda #2
004EA9  3  85 rr                sta chary
004EAB  3  A9 1D                lda #29
004EAD  3  85 rr                sta charx
004EAF  3  A9 18                lda #24
004EB1  3  20 7F 20             jsr dmsg
004EB4  3  A9 02                lda #2
004EB6  3  85 rr                sta chary
004EB8  3  A9 1B                lda #27
004EBA  3  85 rr                sta charx
004EBC  3  A5 rr                lda numlif
004EBE  3  85 rr                sta loopa
004EC0  3  A5 rr        o00164: lda charx
004EC2  3  85 rr                sta dispx
004EC4  3  A5 rr                lda chary
004EC6  3  85 rr                sta dispy
004EC8  3  A9 57                lda #87
004ECA  3  20 5E 1C             jsr pattr
004ECD  3  C6 rr                dec loopa
004ECF  3  F0 03                beq :+
004ED1  3  4C C0 4E             jmp o00164
004ED4  3               :
004ED4  3  A9 03                lda #3
004ED6  3  85 rr                sta chary
004ED8  3  A9 1B                lda #27
004EDA  3  85 rr                sta charx
004EDC  3  A9 0E                lda #14
004EDE  3  20 7F 20             jsr dmsg
004EE1  3  A9 06                lda #6
004EE3  3  85 rr                sta chary
004EE5  3  A9 1B                lda #27
004EE7  3  85 rr                sta charx
004EE9  3  A9 03                lda #3
004EEB  3  20 7F 20             jsr dmsg
004EEE  3  A9 09                lda #9
004EF0  3  85 rr                sta chary
004EF2  3  A9 1B                lda #27
004EF4  3  85 rr                sta charx
004EF6  3  A9 04                lda #4
004EF8  3  20 7F 20             jsr dmsg
004EFB  3  A9 0C                lda #12
004EFD  3  85 rr                sta chary
004EFF  3  A9 1B                lda #27
004F01  3  85 rr                sta charx
004F03  3  A9 05                lda #5
004F05  3  20 7F 20             jsr dmsg
004F08  3  A9 01                lda #1
004F0A  3  85 rr                sta chary
004F0C  3  A9 1B                lda #27
004F0E  3  85 rr                sta charx
004F10  3  20 DF 1A             jsr dscor
004F13  3  A9 04                lda #4
004F15  3  85 rr                sta chary
004F17  3  A9 1B                lda #27
004F19  3  85 rr                sta charx
004F1B  3  A9 1D                lda #29
004F1D  3  85 rr                sta charx
004F1F  3  A9 07                lda #7
004F21  3  85 rr                sta chary
004F23  3  A5 rr                lda vark
004F25  3  20 CD 24             jsr disply
004F28  3  A9 0A                lda #10
004F2A  3  85 rr                sta chary
004F2C  3  A9 1D                lda #29
004F2E  3  85 rr                sta charx
004F30  3  A5 rr                lda varf
004F32  3  18                   clc
004F33  3  69 01                adc #1
004F35  3  85 rr                sta varf
004F37  3  A5 rr                lda varf
004F39  3  20 CD 24             jsr disply
004F3C  3  A5 rr                lda varf
004F3E  3  38                   sec
004F3F  3  E9 01                sbc #1
004F41  3  85 rr                sta varf
004F43  3  A9 1D                lda #29
004F45  3  85 rr                sta charx
004F47  3  A9 0D                lda #13
004F49  3  85 rr                sta chary
004F4B  3  A5 rr                lda vari
004F4D  3  20 CD 24             jsr disply
004F50  3  A9 0E        o00450: lda #14
004F52  3  85 rr                sta varp
004F54  3  A9 24                lda #36
004F56  3  85 rr                sta varq
004F58  3  A9 0A                lda #10
004F5A  3  85 rr                sta loopa
004F5C  3  A9 1B        o00475: lda #27
004F5E  3  85 rr                sta charx
004F60  3  A5 rr                lda varp
004F62  3  85 rr                sta chary
004F64  3  A5 rr                lda charx
004F66  3  85 rr                sta dispx
004F68  3  A5 rr                lda chary
004F6A  3  85 rr                sta dispy
004F6C  3  A5 rr                lda varq
004F6E  3  20 5E 1C             jsr pattr
004F71  3  A5 rr                lda varq
004F73  3  18                   clc
004F74  3  69 01                adc #1
004F76  3  85 rr                sta varq
004F78  3  A5 rr                lda charx
004F7A  3  85 rr                sta dispx
004F7C  3  A5 rr                lda chary
004F7E  3  85 rr                sta dispy
004F80  3  A5 rr                lda varq
004F82  3  20 5E 1C             jsr pattr
004F85  3  A5 rr                lda varq
004F87  3  18                   clc
004F88  3  69 01                adc #1
004F8A  3  85 rr                sta varq
004F8C  3  A5 rr                lda charx
004F8E  3  85 rr                sta dispx
004F90  3  A5 rr                lda chary
004F92  3  85 rr                sta dispy
004F94  3  A5 rr                lda varq
004F96  3  20 5E 1C             jsr pattr
004F99  3  A5 rr                lda varq
004F9B  3  18                   clc
004F9C  3  69 01                adc #1
004F9E  3  85 rr                sta varq
004FA0  3  A5 rr                lda charx
004FA2  3  85 rr                sta dispx
004FA4  3  A5 rr                lda chary
004FA6  3  85 rr                sta dispy
004FA8  3  A5 rr                lda varq
004FAA  3  20 5E 1C             jsr pattr
004FAD  3  A5 rr                lda varq
004FAF  3  18                   clc
004FB0  3  69 01                adc #1
004FB2  3  85 rr                sta varq
004FB4  3  A5 rr                lda charx
004FB6  3  85 rr                sta dispx
004FB8  3  A5 rr                lda chary
004FBA  3  85 rr                sta dispy
004FBC  3  A5 rr                lda varq
004FBE  3  20 5E 1C             jsr pattr
004FC1  3  A5 rr                lda varq
004FC3  3  18                   clc
004FC4  3  69 01                adc #1
004FC6  3  85 rr                sta varq
004FC8  3  A5 rr                lda varp
004FCA  3  18                   clc
004FCB  3  69 01                adc #1
004FCD  3  85 rr                sta varp
004FCF  3  C6 rr                dec loopa
004FD1  3  F0 03                beq :+
004FD3  3  4C 5C 4F             jmp o00475
004FD6  3               :
004FD6  3  A5 rr                lda scno
004FD8  3  18                   clc
004FD9  3  69 01                adc #1
004FDB  3  85 rr                sta scno
004FDD  3  20 46 25             jsr nwscr
004FE0  3  A5 rr                lda scno
004FE2  3  85 rr                sta varm
004FE4  3  A5 rr                lda scno
004FE6  3  38                   sec
004FE7  3  E9 01                sbc #1
004FE9  3  85 rr                sta scno
004FEB  3  20 46 25             jsr nwscr
004FEE  3  A9 04                lda #4
004FF0  3  C5 rr                cmp scno
004FF2  3  F0 03                beq *+5
004FF4  3  4C 17 50             jmp o00861
004FF7  3  A9 17                lda #23
004FF9  3  85 rr                sta chary
004FFB  3  A9 00                lda #0
004FFD  3  85 rr                sta charx
004FFF  3  A9 1A                lda #26
005001  3  85 rr                sta loopa
005003  3  A5 rr        o00821: lda charx
005005  3  85 rr                sta dispx
005007  3  A5 rr                lda chary
005009  3  85 rr                sta dispy
00500B  3  A9 1A                lda #26
00500D  3  20 5E 1C             jsr pattr
005010  3  C6 rr                dec loopa
005012  3  F0 03                beq :+
005014  3  4C 03 50             jmp o00821
005017  3               :
005017  3  A9 08        o00861: lda #8
005019  3  85 rr                sta z80_d
00501B  3  20 36 20             jsr random
00501E  3  85 rr                sta z80_h
005020  3  20 A3 18             jsr imul
005023  3  A5 rr                lda z80_h
005025  3  85 rr                sta varrnd
005027  3  A5 rr                lda varrnd
005029  3  85 rr                sta varo
00502B  3  A9 08                lda #8
00502D  3  85 rr                sta z80_d
00502F  3  20 36 20             jsr random
005032  3  85 rr                sta z80_h
005034  3  20 A3 18             jsr imul
005037  3  A5 rr                lda z80_h
005039  3  85 rr                sta varrnd
00503B  3  A5 rr                lda varo
00503D  3  C5 rr                cmp varrnd
00503F  3  F0 03                beq *+5
005041  3  4C 97 50             jmp o01111
005044  3  A9 08                lda #8
005046  3  85 rr                sta z80_d
005048  3  20 36 20             jsr random
00504B  3  85 rr                sta z80_h
00504D  3  20 A3 18             jsr imul
005050  3  A5 rr                lda z80_h
005052  3  85 rr                sta varrnd
005054  3  A5 rr                lda varo
005056  3  C5 rr                cmp varrnd
005058  3  F0 03                beq *+5
00505A  3  4C 90 50             jmp o01097
00505D  3  A9 08                lda #8
00505F  3  85 rr                sta z80_d
005061  3  20 36 20             jsr random
005064  3  85 rr                sta z80_h
005066  3  20 A3 18             jsr imul
005069  3  A5 rr                lda z80_h
00506B  3  85 rr                sta varrnd
00506D  3  A5 rr                lda varo
00506F  3  C5 rr                cmp varrnd
005071  3  F0 03                beq *+5
005073  3  4C 89 50             jmp o01083
005076  3  A9 08                lda #8
005078  3  85 rr                sta z80_d
00507A  3  20 36 20             jsr random
00507D  3  85 rr                sta z80_h
00507F  3  20 A3 18             jsr imul
005082  3  A5 rr                lda z80_h
005084  3  85 rr                sta varrnd
005086  3  4C 8D 50             jmp o01092
005089  3  A5 rr        o01083: lda varrnd
00508B  3  85 rr                sta varh
00508D  3  4C 94 50     o01092: jmp o01106
005090  3  A5 rr        o01097: lda varrnd
005092  3  85 rr                sta varh
005094  3  4C 9B 50     o01106: jmp o01120
005097  3  A5 rr        o01111: lda varrnd
005099  3  85 rr                sta varh
00509B  3  A5 rr        o01120: lda varo
00509D  3  C5 rr                cmp varh
00509F  3  F0 03                beq *+5
0050A1  3  4C C3 50             jmp o01202
0050A4  3  A9 02                lda #2
0050A6  3  85 rr                sta z80_c
0050A8  3  A5 rr                lda varh
0050AA  3  18                   clc
0050AB  3  65 rr                adc z80_c
0050AD  3  85 rr                sta varh
0050AF  3  A9 07                lda #7
0050B1  3  C5 rr                cmp varh
0050B3  3  90 03                bcc *+5
0050B5  3  4C C3 50             jmp o01202
0050B8  3  A9 07                lda #7
0050BA  3  85 rr                sta z80_c
0050BC  3  A5 rr                lda varh
0050BE  3  38                   sec
0050BF  3  E5 rr                sbc z80_c
0050C1  3  85 rr                sta varh
0050C3  3  A5 rr        o01202: lda varo
0050C5  3  0A                   asl a
0050C6  3  0A                   asl a
0050C7  3  0A                   asl a
0050C8  3  0A                   asl a
0050C9  3  85 rr                sta varo
0050CB  3  A5 rr                lda varo
0050CD  3  85 rr                sta z80_c
0050CF  3  A5 rr                lda varh
0050D1  3  18                   clc
0050D2  3  65 rr                adc z80_c
0050D4  3  85 rr                sta varh
0050D6  3  A9 05                lda #5
0050D8  3  85 rr                sta varg
0050DA  3  A9 00                lda #0
0050DC  3  85 rr                sta charx
0050DE  3  A9 17                lda #23
0050E0  3  85 rr                sta chary
0050E2  3  A9 00                lda #0
0050E4  3  C5 rr                cmp scno
0050E6  3  F0 03                beq *+5
0050E8  3  4C 2A 51             jmp o01418
0050EB  3  A5 rr                lda charx
0050ED  3  85 rr                sta dispx
0050EF  3  A5 rr                lda chary
0050F1  3  85 rr                sta dispy
0050F3  3  A9 00                lda #0
0050F5  3  20 5E 1C             jsr pattr
0050F8  3  A9 0C                lda #12
0050FA  3  85 rr                sta loopa
0050FC  3  A5 rr        o01326: lda charx
0050FE  3  85 rr                sta dispx
005100  3  A5 rr                lda chary
005102  3  85 rr                sta dispy
005104  3  A9 01                lda #1
005106  3  20 5E 1C             jsr pattr
005109  3  A5 rr                lda charx
00510B  3  85 rr                sta dispx
00510D  3  A5 rr                lda chary
00510F  3  85 rr                sta dispy
005111  3  A9 00                lda #0
005113  3  20 5E 1C             jsr pattr
005116  3  C6 rr                dec loopa
005118  3  F0 03                beq :+
00511A  3  4C FC 50             jmp o01326
00511D  3               :
00511D  3  A5 rr                lda charx
00511F  3  85 rr                sta dispx
005121  3  A5 rr                lda chary
005123  3  85 rr                sta dispy
005125  3  A9 01                lda #1
005127  3  20 5E 1C             jsr pattr
00512A  3  A9 01        o01418: lda #1
00512C  3  C5 rr                cmp scno
00512E  3  F0 03                beq *+5
005130  3  4C 8C 51             jmp o01614
005133  3  A9 06                lda #6
005135  3  85 rr                sta loopa
005137  3  A5 rr        o01443: lda charx
005139  3  85 rr                sta dispx
00513B  3  A5 rr                lda chary
00513D  3  85 rr                sta dispy
00513F  3  A9 00                lda #0
005141  3  20 5E 1C             jsr pattr
005144  3  A5 rr                lda charx
005146  3  85 rr                sta dispx
005148  3  A5 rr                lda chary
00514A  3  85 rr                sta dispy
00514C  3  A9 00                lda #0
00514E  3  20 5E 1C             jsr pattr
005151  3  A5 rr                lda charx
005153  3  85 rr                sta dispx
005155  3  A5 rr                lda chary
005157  3  85 rr                sta dispy
005159  3  A9 01                lda #1
00515B  3  20 5E 1C             jsr pattr
00515E  3  A5 rr                lda charx
005160  3  85 rr                sta dispx
005162  3  A5 rr                lda chary
005164  3  85 rr                sta dispy
005166  3  A9 01                lda #1
005168  3  20 5E 1C             jsr pattr
00516B  3  C6 rr                dec loopa
00516D  3  F0 03                beq :+
00516F  3  4C 37 51             jmp o01443
005172  3               :
005172  3  A5 rr                lda charx
005174  3  85 rr                sta dispx
005176  3  A5 rr                lda chary
005178  3  85 rr                sta dispy
00517A  3  A9 00                lda #0
00517C  3  20 5E 1C             jsr pattr
00517F  3  A5 rr                lda charx
005181  3  85 rr                sta dispx
005183  3  A5 rr                lda chary
005185  3  85 rr                sta dispy
005187  3  A9 00                lda #0
005189  3  20 5E 1C             jsr pattr
00518C  3  A9 02        o01614: lda #2
00518E  3  C5 rr                cmp scno
005190  3  F0 03                beq *+5
005192  3  4C EE 51             jmp o01810
005195  3  A9 06                lda #6
005197  3  85 rr                sta loopa
005199  3  A5 rr        o01639: lda charx
00519B  3  85 rr                sta dispx
00519D  3  A5 rr                lda chary
00519F  3  85 rr                sta dispy
0051A1  3  A9 00                lda #0
0051A3  3  20 5E 1C             jsr pattr
0051A6  3  A5 rr                lda charx
0051A8  3  85 rr                sta dispx
0051AA  3  A5 rr                lda chary
0051AC  3  85 rr                sta dispy
0051AE  3  A9 00                lda #0
0051B0  3  20 5E 1C             jsr pattr
0051B3  3  A5 rr                lda charx
0051B5  3  85 rr                sta dispx
0051B7  3  A5 rr                lda chary
0051B9  3  85 rr                sta dispy
0051BB  3  A9 01                lda #1
0051BD  3  20 5E 1C             jsr pattr
0051C0  3  A5 rr                lda charx
0051C2  3  85 rr                sta dispx
0051C4  3  A5 rr                lda chary
0051C6  3  85 rr                sta dispy
0051C8  3  A9 01                lda #1
0051CA  3  20 5E 1C             jsr pattr
0051CD  3  C6 rr                dec loopa
0051CF  3  F0 03                beq :+
0051D1  3  4C 99 51             jmp o01639
0051D4  3               :
0051D4  3  A5 rr                lda charx
0051D6  3  85 rr                sta dispx
0051D8  3  A5 rr                lda chary
0051DA  3  85 rr                sta dispy
0051DC  3  A9 00                lda #0
0051DE  3  20 5E 1C             jsr pattr
0051E1  3  A5 rr                lda charx
0051E3  3  85 rr                sta dispx
0051E5  3  A5 rr                lda chary
0051E7  3  85 rr                sta dispy
0051E9  3  A9 00                lda #0
0051EB  3  20 5E 1C             jsr pattr
0051EE  3  A9 03        o01810: lda #3
0051F0  3  C5 rr                cmp scno
0051F2  3  F0 03                beq *+5
0051F4  3  4C D2 52             jmp o02268
0051F7  3  A9 02                lda #2
0051F9  3  85 rr                sta loopa
0051FB  3  A5 rr        o01835: lda charx
0051FD  3  85 rr                sta dispx
0051FF  3  A5 rr                lda chary
005201  3  85 rr                sta dispy
005203  3  A9 01                lda #1
005205  3  20 5E 1C             jsr pattr
005208  3  A5 rr                lda charx
00520A  3  85 rr                sta dispx
00520C  3  A5 rr                lda chary
00520E  3  85 rr                sta dispy
005210  3  A9 00                lda #0
005212  3  20 5E 1C             jsr pattr
005215  3  A5 rr                lda charx
005217  3  85 rr                sta dispx
005219  3  A5 rr                lda chary
00521B  3  85 rr                sta dispy
00521D  3  A9 00                lda #0
00521F  3  20 5E 1C             jsr pattr
005222  3  A5 rr                lda charx
005224  3  85 rr                sta dispx
005226  3  A5 rr                lda chary
005228  3  85 rr                sta dispy
00522A  3  A9 00                lda #0
00522C  3  20 5E 1C             jsr pattr
00522F  3  A5 rr                lda charx
005231  3  85 rr                sta dispx
005233  3  A5 rr                lda chary
005235  3  85 rr                sta dispy
005237  3  A9 01                lda #1
005239  3  20 5E 1C             jsr pattr
00523C  3  A5 rr                lda charx
00523E  3  85 rr                sta dispx
005240  3  A5 rr                lda chary
005242  3  85 rr                sta dispy
005244  3  A9 00                lda #0
005246  3  20 5E 1C             jsr pattr
005249  3  A5 rr                lda charx
00524B  3  85 rr                sta dispx
00524D  3  A5 rr                lda chary
00524F  3  85 rr                sta dispy
005251  3  A9 01                lda #1
005253  3  20 5E 1C             jsr pattr
005256  3  A5 rr                lda charx
005258  3  85 rr                sta dispx
00525A  3  A5 rr                lda chary
00525C  3  85 rr                sta dispy
00525E  3  A9 01                lda #1
005260  3  20 5E 1C             jsr pattr
005263  3  A5 rr                lda charx
005265  3  85 rr                sta dispx
005267  3  A5 rr                lda chary
005269  3  85 rr                sta dispy
00526B  3  A9 01                lda #1
00526D  3  20 5E 1C             jsr pattr
005270  3  A5 rr                lda charx
005272  3  85 rr                sta dispx
005274  3  A5 rr                lda chary
005276  3  85 rr                sta dispy
005278  3  A9 00                lda #0
00527A  3  20 5E 1C             jsr pattr
00527D  3  C6 rr                dec loopa
00527F  3  F0 03                beq :+
005281  3  4C FB 51             jmp o01835
005284  3               :
005284  3  A5 rr                lda charx
005286  3  85 rr                sta dispx
005288  3  A5 rr                lda chary
00528A  3  85 rr                sta dispy
00528C  3  A9 01                lda #1
00528E  3  20 5E 1C             jsr pattr
005291  3  A5 rr                lda charx
005293  3  85 rr                sta dispx
005295  3  A5 rr                lda chary
005297  3  85 rr                sta dispy
005299  3  A9 00                lda #0
00529B  3  20 5E 1C             jsr pattr
00529E  3  A5 rr                lda charx
0052A0  3  85 rr                sta dispx
0052A2  3  A5 rr                lda chary
0052A4  3  85 rr                sta dispy
0052A6  3  A9 00                lda #0
0052A8  3  20 5E 1C             jsr pattr
0052AB  3  A5 rr                lda charx
0052AD  3  85 rr                sta dispx
0052AF  3  A5 rr                lda chary
0052B1  3  85 rr                sta dispy
0052B3  3  A9 00                lda #0
0052B5  3  20 5E 1C             jsr pattr
0052B8  3  A5 rr                lda charx
0052BA  3  85 rr                sta dispx
0052BC  3  A5 rr                lda chary
0052BE  3  85 rr                sta dispy
0052C0  3  A9 01                lda #1
0052C2  3  20 5E 1C             jsr pattr
0052C5  3  A5 rr                lda charx
0052C7  3  85 rr                sta dispx
0052C9  3  A5 rr                lda chary
0052CB  3  85 rr                sta dispy
0052CD  3  A9 00                lda #0
0052CF  3  20 5E 1C             jsr pattr
0052D2  3  60           o02268: rts
0052D3  3               .out .sprintf("EVENT 14 SIZE = %d", (* - evnt14))
0052D3  3               
0052D3  3               evnt15:
0052D3  3  60                   rts
0052D4  3               .out .sprintf("EVENT 15 SIZE = %d", (* - evnt15))
0052D4  3               
0052D4  3               evnt16:
0052D4  3  60                   rts
0052D5  3               .out .sprintf("EVENT 16 SIZE = %d", (* - evnt16))
0052D5  3               
0052D5  3               evnt17:
0052D5  3  60                   rts
0052D6  3               .out .sprintf("EVENT 17 SIZE = %d", (* - evnt17))
0052D6  3               
0052D6  3               evnt18:
0052D6  3  60                   rts
0052D7  3               .out .sprintf("EVENT 18 SIZE = %d", (* - evnt18))
0052D7  3               
0052D7  3               evnt19:
0052D7  3  60                   rts
0052D8  3               .out .sprintf("EVENT 19 SIZE = %d", (* - evnt19))
0052D8  3               
0052D8  3               evnt20:
0052D8  3  60                   rts
0052D9  3               .out .sprintf("EVENT 20 SIZE = %d", (* - evnt20))
0052D9  3               
0052D9  3  60           ptcusr: rts
0052DA  3               script_end:
0052DA  3               
0052DA  3               .out .sprintf("TOTAL SCRIPT SIZE = %d", (* - script_start))
0052DA  3               
0052DA  3               data_start:
0052DA  3               msgdat:
0052DA  3  47 41 4D 45          .byte "GAME",141
0052DE  3  8D           
0052DF  3  4F 56 45 52          .byte "OVER",141
0052E3  3  8D           
0052E4  3  53 43 4F 52          .byte "SCORE",141
0052E8  3  45 8D        
0052EA  3  42 4F 4D 42          .byte "BOMBS",13
0052EE  3  53 0D        
0052F0  3  8D                   .byte 141
0052F1  3  46 4C 4F 4F          .byte "FLOOR",141
0052F5  3  52 8D        
0052F7  3  53 41 56 45          .byte "SAVED",141
0052FB  3  44 8D        
0052FD  3  31 53 54 8D          .byte "1ST",141
005301  3  32 4E 44 8D          .byte "2ND",141
005305  3  33 52 44 8D          .byte "3RD",141
005309  3  34 54 48 8D          .byte "4TH",141
00530D  3  35 54 48 8D          .byte "5TH",141
005311  3  36 54 48 8D          .byte "6TH",141
005315  3  37 54 48 8D          .byte "7TH",141
005319  3  38 54 48 8D          .byte "8TH",141
00531D  3  48 49 47 48          .byte "HIGH",141
005321  3  8D           
005322  3  50 4C 41 59          .byte "PLAY",141
005326  3  8D           
005327  3  2D 54 45 52          .byte "-TERRAPINS-",141
00532B  3  52 41 50 49  
00532F  3  4E 53 2D 8D  
005333  3  48 4F 57 2A          .byte "HOW*MANY*KIDTERRAPINS",141
005337  3  4D 41 4E 59  
00533B  3  2A 4B 49 44  
005349  3  43 41 4E 2A          .byte "CAN*YOU*RESCUE*?",141
00534D  3  59 4F 55 2A  
005351  3  52 45 53 43  
00535A  3  4F 52 49 47          .byte "ORIGINAL*ARCADE*GAME*1981",141
00535E  3  49 4E 41 4C  
005362  3  2A 41 52 43  
005374  3  5A 58 2A 47          .byte "ZX*GAME*BY*HIGHRISE*2017",141
005378  3  41 4D 45 2A  
00537C  3  42 59 2A 48  
00538D  3  50 52 45 53          .byte "PRESS*FIRE*TO*PLAY",141
005391  3  53 2A 46 49  
005395  3  52 45 2A 54  
0053A0  3  28 62 63 64          .byte "(bcdefghijklmn",141
0053A4  3  65 66 67 68  
0053A8  3  69 6A 6B 6C  
0053AF  3  48 49 47 48          .byte "HIGH",141
0053B3  3  8D           
0053B4  3  2A 2A 2A 8D          .byte "***",141
0053B8  3  43 4F 4E 47          .byte "CONGRATULATIONS",141
0053BC  3  52 41 54 55  
0053C0  3  4C 41 54 49  
0053C8  3  41 2A 54 4F          .byte "A*TOUGHER*CHALLENGE*AWAITS",141
0053CC  3  55 47 48 45  
0053D0  3  52 2A 43 48  
0053E3  3  4B 45 59 42          .byte "KEYBOARD",141
0053E7  3  4F 41 52 44  
0053EB  3  8D           
0053EC  3  4B 45 4D 50          .byte "KEMPSTON",141
0053F0  3  53 54 4F 4E  
0053F4  3  8D           
0053F5  3  53 49 4E 43          .byte "SINCLAIR",141
0053F9  3  4C 41 49 52  
0053FD  3  8D           
0053FE  3  43 4F 4E 54          .byte "CONTROL:",141
005402  3  52 4F 4C 3A  
005406  3  8D           
005407  3  21 27                .byte "!",39
005409  3  23 24 25 26          .byte "#$%&",141
00540D  3  8D           
00540E  3               nummsg:
00540E  3  20                   .byte 32
00540F  3               .out .sprintf("MESSAGE SIZE = %d", (* - msgdat))
00540F  3               
00540F  3               chgfx:
00540F  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0
005413  3  00 00 00 00  
005417  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0
00541B  3  00 00 00 00  
00541F  3  00 FF FF 55          .byte 0,255,255,85,170,0,255,0
005423  3  AA 00 FF 00  
005427  3  6A 72 6A 72          .byte 106,114,106,114,106,114,106,114
00542B  3  6A 72 6A 72  
00542F  3  EA F2 EA 52          .byte 234,242,234,82,170,6,252,1
005433  3  AA 06 FC 01  
005437  3  6A 75 6A 75          .byte 106,117,106,117,106,112,63,128
00543B  3  6A 70 3F 80  
00543F  3  80 3F 7F 75          .byte 128,63,127,117,106,117,106,117
005443  3  6A 75 6A 75  
005447  3  01 FC FE 56          .byte 1,252,254,86,170,82,170,82
00544B  3  AA 52 AA 52  
00544F  3  6A 72 6A 72          .byte 106,114,106,114,106,118,60,129
005453  3  6A 76 3C 81  
005457  3  81 3C 6A 72          .byte 129,60,106,114,106,114,106,114
00545B  3  6A 72 6A 72  
00545F  3  01 FC FE 56          .byte 1,252,254,86,170,6,252,1
005463  3  AA 06 FC 01  
005467  3  80 3F 7F 55          .byte 128,63,127,85,106,64,63,128
00546B  3  6A 40 3F 80  
00546F  3  6A FF FF 55          .byte 106,255,255,85,170,0,255,0
005473  3  AA 00 FF 00  
005477  3  00 FF FF 55          .byte 0,255,255,85,170,0,255,118
00547B  3  AA 00 FF 76  
00547F  3  01 03 07 0F          .byte 1,3,7,15,31,63,127,255
005483  3  1F 3F 7F FF  
005487  3  00 00 7E 40          .byte 0,0,126,64,126,2,126,0
00548B  3  7E 02 7E 00  
00548F  3  80 00 BF A1          .byte 128,0,191,161,161,161,161,0
005493  3  A1 A1 A1 00  
005497  3  00 00 7E 40          .byte 0,0,126,64,64,64,126,0
00549B  3  40 40 7E 00  
00549F  3  80 80 BF 81          .byte 128,128,191,129,191,161,191,0
0054A3  3  BF A1 BF 00  
0054A7  3  40 00 5F 50          .byte 64,0,95,80,80,80,80,0
0054AB  3  50 50 50 00  
0054AF  3  03 03 03 03          .byte 3,3,3,3,3,3,3,3
0054B3  3  03 03 03 03  
0054B7  3  60 60 60 60          .byte 96,96,96,96,96,96,96,96
0054BB  3  60 60 60 60  
0054BF  3  00 00 00 00          .byte 0,0,0,0,0,0,255,255
0054C3  3  00 00 FF FF  
0054C7  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0
0054CB  3  00 00 00 00  
0054CF  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0
0054D3  3  00 00 00 00  
0054D7  3  18 18 18 18          .byte 24,24,24,24,24,24,24,24
0054DB  3  18 18 18 18  
0054DF  3  00 48 00 20          .byte 0,72,0,32,2,128,0,36
0054E3  3  02 80 00 24  
0054E7  3  88 88 88 88          .byte 136,136,136,136,136,136,136,136
0054EB  3  88 88 88 88  
0054EF  3  60 60 60 60          .byte 96,96,96,96,96,96,224,224
0054F3  3  60 60 E0 E0  
0054F7  3  CE AA CC AA          .byte 206,170,204,170,202,0,0,0
0054FB  3  CA 00 00 00  
0054FF  3  D1 91 D5 95          .byte 209,145,213,149,223,0,0,0
005503  3  DF 00 00 00  
005507  3  6C 4A 6A 4A          .byte 108,74,106,74,108,0,0,0
00550B  3  6C 00 00 00  
00550F  3  5E 52 52 52          .byte 94,82,82,82,82,0,0,0
005513  3  52 00 00 00  
005517  3  7B 4A 7A 4A          .byte 123,74,122,74,75,0,0,0
00551B  3  4B 00 00 00  
00551F  3  DC 12 12 52          .byte 220,18,18,82,220,0,0,0
005523  3  DC 00 00 00  
005527  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0
00552B  3  00 00 00 00  
00552F  3  FF 87 02 02          .byte 255,135,2,2,201,201,200,201
005533  3  C9 C9 C8 C9  
005537  3  FF FF CE 04          .byte 255,255,206,4,181,165,132,156
00553B  3  B5 A5 84 9C  
00553F  3  FF FF 73 21          .byte 255,255,115,33,173,41,33,225
005543  3  AD 29 21 E1  
005547  3  FF FF 9B 0A          .byte 255,255,155,10,106,74,10,26
00554B  3  6A 4A 0A 1A  
00554F  3  FF FC 28 28          .byte 255,252,40,40,11,73,77,76
005553  3  0B 49 4D 4C  
005557  3  C8 C8 CB CF          .byte 200,200,203,207,255,255,255,255
00555B  3  FF FF FF FF  
00555F  3  04 94 B5 FF          .byte 4,148,181,255,255,255,255,255
005563  3  FF FF FF FF  
005567  3  25 A5 AD FF          .byte 37,165,173,255,255,255,255,255
00556B  3  FF FF FF FF  
00556F  3  32 32 76 FF          .byte 50,50,118,255,255,255,255,255
005573  3  FF FF FF FF  
005577  3  6A 6A E8 F9          .byte 106,106,232,249,255,255,255,255
00557B  3  FF FF FF FF  
00557F  3  FF FF FF FE          .byte 255,255,255,254,254,252,248,252
005583  3  FE FC F8 FC  
005587  3  FF FC E4 48          .byte 255,252,228,72,208,80,128,0
00558B  3  D0 50 80 00  
00558F  3  00 00 00 01          .byte 0,0,0,1,3,6,12,16
005593  3  03 06 0C 10  
005597  3  00 00 FE C3          .byte 0,0,254,195,8,17,55,126
00559B  3  08 11 37 7E  
00559F  3  FF 0F 03 01          .byte 255,15,3,1,21,11,0,28
0055A3  3  15 0B 00 1C  
0055A7  3  FF FC F8 F8          .byte 255,252,248,248,248,240,241,243
0055AB  3  F8 F0 F1 F3  
0055AF  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0
0055B3  3  00 00 00 00  
0055B7  3  FF FF FC FC          .byte 255,255,252,252,248,248,240,240
0055BB  3  F8 F8 F0 F0  
0055BF  3  FF 07 07 01          .byte 255,7,7,1,0,48,120,232
0055C3  3  00 30 78 E8  
0055C7  3  F0 E0 C0 C0          .byte 240,224,192,192,224,224,248,224
0055CB  3  E0 E0 F8 E0  
0055CF  3  F3 F3 F3 F0          .byte 243,243,243,240,240,248,252,255
0055D3  3  F0 F8 FC FF  
0055D7  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0
0055DB  3  00 00 00 00  
0055DF  3  E0 E0 E0 E0          .byte 224,224,224,224,224,224,240,248
0055E3  3  E0 E0 F0 F8  
0055E7  3  C8 98 F8 70          .byte 200,152,248,112,0,0,1,3
0055EB  3  00 00 01 03  
0055EF  3  FC E0 E0 C0          .byte 252,224,224,192,128,0,0,128
0055F3  3  80 00 00 80  
0055F7  3  F1 E0 E0 E0          .byte 241,224,224,224,224,240,240,248
0055FB  3  E0 F0 F0 F8  
0055FF  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0
005603  3  00 00 00 00  
005607  3  00 00 00 00          .byte 0,0,0,0,0,0,16,62
00560B  3  00 00 10 3E  
00560F  3  81 00 00 00          .byte 129,0,0,0,0,0,0,0
005613  3  00 00 00 00  
005617  3  C0 20 20 00          .byte 192,32,32,0,0,0,0,0
00561B  3  00 00 00 00  
00561F  3  FC FE FF FF          .byte 252,254,255,255,255,255,255,255
005623  3  FF FF FF FF  
005627  3  00 01 07 8F          .byte 0,1,7,143,223,255,255,255
00562B  3  DF FF FF FF  
00562F  3  FF FF FF D1          .byte 255,255,255,209,129,193,255,255
005633  3  81 C1 FF FF  
005637  3  00 C0 F3 FE          .byte 0,192,243,254,192,128,0,0
00563B  3  C0 80 00 00  
00563F  3  20 E0 80 00          .byte 32,224,128,0,3,7,13,26
005643  3  03 07 0D 1A  
005647  3  FF FF FF FF          .byte 255,255,255,255,255,255,240,224
00564B  3  FF FF F0 E0  
00564F  3  9F 0F 0F 07          .byte 159,15,15,7,135,131,65,33
005653  3  87 83 41 21  
005657  3  80 80 C0 F8          .byte 128,128,192,248,255,254,255,255
00565B  3  FF FE FF FF  
00565F  3  01 47 04 18          .byte 1,71,4,24,224,0,0,7
005663  3  E0 00 00 07  
005667  3  E5 02 05 0A          .byte 229,2,5,10,21,43,119,255
00566B  3  15 2B 77 FF  
00566F  3  E1 DF C1 C1          .byte 225,223,193,193,225,223,193,193
005673  3  E1 DF C1 C1  
005677  3  10 08 80 80          .byte 16,8,128,128,128,64,0,0
00567B  3  80 40 00 00  
00567F  3  EA 41 00 01          .byte 234,65,0,1,34,37,107,255
005683  3  22 25 6B FF  
005687  3  FF FE AA D4          .byte 255,254,170,212,160,192,64,170
00568B  3  A0 C0 40 AA  
00568F  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0
005693  3  00 00 00 00  
005697  3  E1 FF FF FF          .byte 225,255,255,255,255,255,255,255
00569B  3  FF FF FF FF  
00569F  3  FF FD EA D4          .byte 255,253,234,212,168,212,168,212
0056A3  3  A8 D4 A8 D4  
0056A7  3  F8 70 E0 C0          .byte 248,112,224,192,234,128,128,128
0056AB  3  EA 80 80 80  
0056AF  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0
0056B3  3  00 00 00 00  
0056B7  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0
0056BB  3  00 00 00 00  
0056BF  3  00 FE C3 00          .byte 0,254,195,0,0,0,0,0
0056C3  3  00 00 00 00  
0056C7  3  08 1C 41 1C          .byte 8,28,65,28,54,42,54,73
0056CB  3  36 2A 36 49  
0056CF  3  00 0F FE C3          .byte 0,15,254,195,0,0,0,0
0056D3  3  00 00 00 00  
0056D7  3  00 00 08 11          .byte 0,0,8,17,55,126,254,255
0056DB  3  37 7E FE FF  
0056DF  3               bprop:
0056DF  3  00                   .byte 0
0056E0  3  00                   .byte 0
0056E1  3  02                   .byte 2
0056E2  3  02                   .byte 2
0056E3  3  02                   .byte 2
0056E4  3  02                   .byte 2
0056E5  3  02                   .byte 2
0056E6  3  02                   .byte 2
0056E7  3  02                   .byte 2
0056E8  3  02                   .byte 2
0056E9  3  02                   .byte 2
0056EA  3  02                   .byte 2
0056EB  3  06                   .byte 6
0056EC  3  02                   .byte 2
0056ED  3  00                   .byte 0
0056EE  3  00                   .byte 0
0056EF  3  00                   .byte 0
0056F0  3  00                   .byte 0
0056F1  3  00                   .byte 0
0056F2  3  00                   .byte 0
0056F3  3  00                   .byte 0
0056F4  3  00                   .byte 0
0056F5  3  00                   .byte 0
0056F6  3  00                   .byte 0
0056F7  3  06                   .byte 6
0056F8  3  00                   .byte 0
0056F9  3  00                   .byte 0
0056FA  3  00                   .byte 0
0056FB  3  00                   .byte 0
0056FC  3  00                   .byte 0
0056FD  3  00                   .byte 0
0056FE  3  00                   .byte 0
0056FF  3  00                   .byte 0
005700  3  00                   .byte 0
005701  3  00                   .byte 0
005702  3  02                   .byte 2
005703  3  00                   .byte 0
005704  3  00                   .byte 0
005705  3  00                   .byte 0
005706  3  00                   .byte 0
005707  3  00                   .byte 0
005708  3  00                   .byte 0
005709  3  00                   .byte 0
00570A  3  00                   .byte 0
00570B  3  00                   .byte 0
00570C  3  00                   .byte 0
00570D  3  00                   .byte 0
00570E  3  00                   .byte 0
00570F  3  00                   .byte 0
005710  3  00                   .byte 0
005711  3  00                   .byte 0
005712  3  00                   .byte 0
005713  3  00                   .byte 0
005714  3  00                   .byte 0
005715  3  00                   .byte 0
005716  3  00                   .byte 0
005717  3  00                   .byte 0
005718  3  00                   .byte 0
005719  3  00                   .byte 0
00571A  3  00                   .byte 0
00571B  3  00                   .byte 0
00571C  3  00                   .byte 0
00571D  3  00                   .byte 0
00571E  3  00                   .byte 0
00571F  3  00                   .byte 0
005720  3  00                   .byte 0
005721  3  00                   .byte 0
005722  3  00                   .byte 0
005723  3  00                   .byte 0
005724  3  00                   .byte 0
005725  3  00                   .byte 0
005726  3  00                   .byte 0
005727  3  00                   .byte 0
005728  3  00                   .byte 0
005729  3  00                   .byte 0
00572A  3  00                   .byte 0
00572B  3  00                   .byte 0
00572C  3  00                   .byte 0
00572D  3  00                   .byte 0
00572E  3  00                   .byte 0
00572F  3  00                   .byte 0
005730  3  00                   .byte 0
005731  3  00                   .byte 0
005732  3  00                   .byte 0
005733  3  00                   .byte 0
005734  3  00                   .byte 0
005735  3  00                   .byte 0
005736  3  00                   .byte 0
005737  3  00                   .byte 0
005738  3  00                   .byte 0
005739  3               .out .sprintf("BLOCKS SIZE = %d", (* - chgfx))
005739  3               
005739  3               sprgfx:
005739  3  01 C0 02 A2          .byte 1,192,2,162,3,230,112,14,59,228,7,112,13,216,26,172,23,116,26,172,29,220,26,172,15,120,22,183,57,142,97,0
00573D  3  03 E6 70 0E  
005741  3  3B E4 07 70  
005759  3  01 C0 22 A0          .byte 1,192,34,160,51,227,56,14,19,228,7,112,13,216,26,172,23,116,26,172,29,220,26,172,15,122,118,183,57,195,0,129
00575D  3  33 E3 38 0E  
005761  3  13 E4 07 70  
005779  3  01 C0 02 A0          .byte 1,192,2,160,99,224,56,14,19,231,7,112,13,216,26,172,23,116,26,172,29,220,26,172,47,120,118,180,96,206,64,67
00577D  3  63 E0 38 0E  
005781  3  13 E7 07 70  
005799  3  60 80 39 CE          .byte 96,128,57,206,22,183,15,120,26,172,29,220,26,172,23,116,26,172,13,216,7,112,59,228,112,14,3,230,2,162,1,192
00579D  3  16 B7 0F 78  
0057A1  3  1A AC 1D DC  
0057B9  3  00 41 38 C3          .byte 0,65,56,195,118,183,15,122,26,172,29,220,26,172,23,116,26,172,13,216,7,112,19,228,56,14,51,227,34,160,1,192
0057BD  3  76 B7 0F 7A  
0057C1  3  1A AC 1D DC  
0057D9  3  41 03 61 8E          .byte 65,3,97,142,118,180,47,120,26,172,29,220,26,172,23,116,26,172,13,216,7,112,19,231,56,14,99,224,2,160,1,192
0057DD  3  76 B4 2F 78  
0057E1  3  1A AC 1D DC  
0057F9  3  00 00 80 08          .byte 0,0,128,8,192,24,111,152,94,208,53,96,59,182,213,117,110,215,21,117,59,182,53,96,94,200,111,156,96,14,32,0
0057FD  3  C0 18 6F 98  
005801  3  5E D0 35 60  
005819  3  00 00 20 00          .byte 0,0,32,0,96,14,111,156,94,200,53,96,59,182,85,117,238,215,85,117,59,182,53,96,30,200,47,152,112,12,224,4
00581D  3  60 0E 6F 9C  
005821  3  5E C8 35 60  
005839  3  00 00 E0 04          .byte 0,0,224,4,112,12,47,152,30,200,53,96,59,182,21,117,110,215,213,117,59,182,53,96,94,200,111,152,192,24,128,16
00583D  3  70 0C 2F 98  
005841  3  1E C8 35 60  
005859  3  00 00 10 01          .byte 0,0,16,1,24,3,25,246,11,122,6,172,109,220,174,171,235,118,174,168,109,220,6,172,19,122,57,246,112,6,0,4
00585D  3  18 03 19 F6  
005861  3  0B 7A 06 AC  
005879  3  00 00 00 04          .byte 0,0,0,4,112,6,57,246,19,122,6,172,109,220,174,170,235,119,174,170,109,220,6,172,19,120,25,244,48,14,32,7
00587D  3  70 06 39 F6  
005881  3  13 7A 06 AC  
005899  3  00 00 20 07          .byte 0,0,32,7,48,14,25,244,19,120,6,172,109,220,174,168,235,118,174,171,109,220,6,172,19,122,25,246,24,3,8,1
00589D  3  30 0E 19 F4  
0058A1  3  13 78 06 AC  
0058B9  3  01 C0 02 A2          .byte 1,192,2,162,3,230,112,14,59,228,5,208,15,120,28,28,30,188,22,52,29,92,31,252,15,120,22,183,57,142,97,0
0058BD  3  03 E6 70 0E  
0058C1  3  3B E4 05 D0  
0058D9  3  01 C0 22 A0          .byte 1,192,34,160,51,227,56,14,19,228,5,208,15,120,30,60,28,156,22,52,29,92,31,252,15,122,118,183,57,195,0,129
0058DD  3  33 E3 38 0E  
0058E1  3  13 E4 05 D0  
0058F9  3  01 C0 02 A0          .byte 1,192,2,160,99,224,56,14,19,231,5,208,15,120,28,28,30,188,22,52,29,92,31,252,47,120,118,180,96,206,64,67
0058FD  3  63 E0 38 0E  
005901  3  13 E7 05 D0  
005919  3  60 80 39 CE          .byte 96,128,57,206,22,183,15,120,31,252,29,92,22,52,30,188,28,28,15,120,5,208,59,228,112,14,3,230,2,162,1,192
00591D  3  16 B7 0F 78  
005921  3  1F FC 1D 5C  
005939  3  00 41 38 C3          .byte 0,65,56,195,118,183,15,122,31,252,29,92,22,52,30,188,28,28,15,120,5,208,19,228,56,14,51,227,34,160,1,192
00593D  3  76 B7 0F 7A  
005941  3  1F FC 1D 5C  
005959  3  41 03 61 8E          .byte 65,3,97,142,118,180,47,120,31,252,29,92,22,52,28,156,30,60,15,120,5,208,19,231,56,14,99,224,2,160,1,192
00595D  3  76 B4 2F 78  
005961  3  1F FC 1D 5C  
005979  3  00 00 80 08          .byte 0,0,128,8,192,24,111,152,95,208,63,224,59,86,220,117,105,55,28,117,59,86,63,224,95,200,111,156,96,14,32,0
00597D  3  C0 18 6F 98  
005981  3  5F D0 3F E0  
005999  3  10 00 30 00          .byte 16,0,48,0,48,14,47,156,31,200,63,224,58,214,92,117,233,55,92,117,58,214,63,224,31,200,47,152,112,12,224,4
00599D  3  30 0E 2F 9C  
0059A1  3  1F C8 3F E0  
0059B9  3  00 00 E0 04          .byte 0,0,224,4,112,12,47,152,31,200,63,224,59,86,28,117,105,55,220,117,59,86,63,224,95,200,111,152,192,24,128,16
0059BD  3  70 0C 2F 98  
0059C1  3  1F C8 3F E0  
0059D9  3  00 00 10 01          .byte 0,0,16,1,24,3,25,246,11,250,7,252,106,220,174,59,236,150,174,56,106,220,7,252,19,250,57,246,112,6,0,4
0059DD  3  18 03 19 F6  
0059E1  3  0B FA 07 FC  
0059F9  3  00 08 00 0C          .byte 0,8,0,12,112,12,57,244,19,248,7,252,107,92,174,58,236,151,174,58,107,92,7,252,19,248,25,244,48,14,32,7
0059FD  3  70 0C 39 F4  
005A01  3  13 F8 07 FC  
005A19  3  00 00 20 07          .byte 0,0,32,7,48,14,25,244,19,248,7,252,106,220,174,56,236,150,174,59,106,220,7,252,19,250,25,246,24,3,8,1
005A1D  3  30 0E 19 F4  
005A21  3  13 F8 07 FC  
005A39  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,1,0,5,64,3,128,14,224,3,128,5,64,1,0,0,0,0,0,0,0,0,0,0,0
005A3D  3  00 00 00 00  
005A41  3  01 00 05 40  
005A59  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,1,0,5,64,3,128,15,224,3,128,5,64,1,0,0,0,0,0,0,0,0,0,0,0
005A5D  3  00 00 00 00  
005A61  3  01 00 05 40  
005A79  3  00 00 00 00          .byte 0,0,0,0,3,96,54,182,75,105,12,24,15,248,15,248,55,246,95,253,31,252,23,244,11,232,13,208,3,96,0,0
005A7D  3  03 60 36 B6  
005A81  3  4B 69 0C 18  
005A99  3  00 00 00 00          .byte 0,0,0,0,3,96,7,240,11,104,12,24,63,254,79,249,87,245,31,252,31,252,23,244,11,236,21,210,19,98,48,3
005A9D  3  03 60 07 F0  
005AA1  3  0B 68 0C 18  
005AB9  3  00 00 00 00          .byte 0,0,0,0,99,99,22,180,11,104,12,24,15,248,15,248,23,244,31,252,31,252,55,246,75,233,77,209,35,98,0,0
005ABD  3  63 63 16 B4  
005AC1  3  0B 68 0C 18  
005AD9  3  00 00 03 60          .byte 0,0,3,96,5,208,11,232,23,244,31,252,95,253,55,246,31,252,15,248,12,24,75,105,54,182,3,96,0,0,0,0
005ADD  3  05 D0 0B E8  
005AE1  3  17 F4 1F FC  
005AF9  3  00 00 43 61          .byte 0,0,67,97,69,209,43,234,23,244,31,252,31,252,87,245,95,253,47,250,12,24,11,104,7,240,3,96,0,0,0,0
005AFD  3  45 D1 2B EA  
005B01  3  17 F4 1F FC  
005B19  3  00 00 23 62          .byte 0,0,35,98,69,209,75,233,55,246,31,252,31,252,23,244,31,252,15,248,12,24,11,104,22,180,99,99,0,0,0,0
005B1D  3  45 D1 4B E9  
005B21  3  37 F6 1F FC  
005B39  3  00 00 04 10          .byte 0,0,4,16,2,8,15,8,22,240,47,232,95,220,127,212,63,200,127,212,95,220,47,232,22,240,15,8,2,8,4,16
005B3D  3  02 08 0F 08  
005B41  3  16 F0 2F E8  
005B59  3  00 00 03 00          .byte 0,0,3,0,192,128,47,0,22,240,47,232,95,220,127,220,63,200,127,220,95,220,47,232,22,240,47,0,192,128,3,0
005B5D  3  C0 80 2F 00  
005B61  3  16 F0 2F E8  
005B79  3  00 00 30 04          .byte 0,0,48,4,72,4,15,8,22,240,47,232,95,220,127,212,63,200,127,212,95,220,47,232,22,240,15,8,72,4,48,4
005B7D  3  48 04 0F 08  
005B81  3  16 F0 2F E8  
005B99  3  00 00 08 20          .byte 0,0,8,32,16,64,16,240,15,104,23,244,59,250,43,254,19,252,43,254,59,250,23,244,15,104,16,240,16,64,8,32
005B9D  3  10 40 10 F0  
005BA1  3  0F 68 17 F4  
005BB9  3  00 00 00 C0          .byte 0,0,0,192,1,3,0,244,15,104,23,244,59,250,59,254,19,252,59,254,59,250,23,244,15,104,0,244,1,3,0,192
005BBD  3  01 03 00 F4  
005BC1  3  0F 68 17 F4  
005BD9  3  00 00 20 0C          .byte 0,0,32,12,32,18,16,240,15,104,23,244,59,250,43,254,19,252,43,254,59,250,23,244,15,104,16,240,32,18,32,12
005BDD  3  20 12 10 F0  
005BE1  3  0F 68 17 F4  
005BF9  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,7,224,15,240,31,248,63,252,127,254,63,252,33,204,33,132,33,132,63,132,63,132,63,132
005BFD  3  00 00 00 00  
005C01  3  07 E0 0F F0  
005C19  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
005C1D  3  00 00 00 00  
005C21  3  00 00 00 00  
005C39  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,160,3,192,1,64,1,224,2,128,0,0,0,0,0,0,0,0,0,0,0,0
005C3D  3  00 00 00 00  
005C41  3  00 00 00 A0  
005C59  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,2,128,1,224,1,64,3,192,0,160,0,0,0,0,0,0,0,0,0,0,0,0
005C5D  3  00 00 00 00  
005C61  3  00 00 02 80  
005C79  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,1,32,1,192,3,96,1,192,2,64,0,0,0,0,0,0,0,0,0,0,0,0
005C7D  3  00 00 00 00  
005C81  3  00 00 01 20  
005C99  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,2,64,1,192,3,96,1,192,1,32,0,0,0,0,0,0,0,0,0,0,0,0
005C9D  3  00 00 00 00  
005CA1  3  00 00 02 40  
005CB9  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,19,192,5,160,1,128,8,16
005CBD  3  00 00 00 00  
005CC1  3  00 00 00 00  
005CD9  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,192,21,160,1,128,4,32
005CDD  3  00 00 00 00  
005CE1  3  00 00 00 00  
005CF9  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,200,5,160,1,128,8,16
005CFD  3  00 00 00 00  
005D01  3  00 00 00 00  
005D19  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,192,5,168,1,128,4,32
005D1D  3  00 00 00 00  
005D21  3  00 00 00 00  
005D39  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,192,26,160,55,112,106,168,221,211,74,165,32,70,48,96
005D3D  3  00 00 00 00  
005D41  3  00 00 00 00  
005D59  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,192,26,160,55,112,106,168,93,211,170,165,80,134,24,192
005D5D  3  00 00 00 00  
005D61  3  00 00 00 00  
005D79  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,192,26,160,55,112,106,168,93,211,162,133,72,38,12,48
005D7D  3  00 00 00 00  
005D81  3  00 00 00 00  
005D99  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,3,64,12,176,23,104,58,187,21,229,43,6,116,48,32,16,144,0,24,0
005D9D  3  00 00 00 00  
005DA1  3  00 00 00 00  
005DB9  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,7,12,12,148,51,216,44,128,91,48,102,24,156,0,216,0,160,0,96,0,144,0,24,0
005DBD  3  00 00 00 00  
005DC1  3  07 0C 0C 94  
005DD9  3  07 C0 0F E0          .byte 7,192,15,224,13,96,25,48,25,48,31,240,30,240,15,224,69,68,226,142,56,56,7,192,56,56,224,14,64,4,0,0
005DDD  3  0D 60 19 30  
005DE1  3  19 30 1F F0  
005DF9  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
005DFD  3  00 00 00 00  
005E01  3  00 00 00 00  
005E19  3               frmlst:
005E19  3  00 03                .byte 0,3
005E1B  3  03 03                .byte 3,3
005E1D  3  06 03                .byte 6,3
005E1F  3  09 03                .byte 9,3
005E21  3  0C 03                .byte 12,3
005E23  3  0F 03                .byte 15,3
005E25  3  12 03                .byte 18,3
005E27  3  15 03                .byte 21,3
005E29  3  18 02                .byte 24,2
005E2B  3  1A 03                .byte 26,3
005E2D  3  1D 03                .byte 29,3
005E2F  3  20 03                .byte 32,3
005E31  3  23 03                .byte 35,3
005E33  3  26 02                .byte 38,2
005E35  3  28 02                .byte 40,2
005E37  3  2A 02                .byte 42,2
005E39  3  2C 02                .byte 44,2
005E3B  3  2E 02                .byte 46,2
005E3D  3  30 05                .byte 48,5
005E3F  3  35 02 37 00          .byte 53,2,55,0
005E43  3               .out .sprintf("SPRITES SIZE = %d", (* - sprgfx))
005E43  3               
005E43  3               scdat:
005E43  3  4E 02 09 00          .word 590,9,9,9,198,307,9
005E47  3  09 00 09 00  
005E4B  3  C6 00 33 01  
005E51  3  01 00 01 00          .byte 1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,1,0,1,0,1,0
005E55  3  01 00 01 00  
005E59  3  01 00 01 00  
005E72  3  01 00 01 00          .byte 1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1,0,6,2,2,7,1,0,9,0,1,9,24,23
005E76  3  01 00 01 00  
005E7A  3  01 00 01 00  
005E93  3  09 00 01 09          .byte 9,0,1,9,1,0,6,2,2,7,1,0,0,1,3,24,23,3,0,1,3,1,0,3,23,23,3,1,0,3,0,1,3
005E97  3  01 00 06 02  
005E9B  3  02 07 01 00  
005EB4  3  18 17 03 00          .byte 24,23,3,0,1,1,0,8,23,23,8,1,0,3,0,1,5,2,2,4,0,1,3,1,0,8,23,23,8,1,0,0,1
005EB8  3  01 01 00 08  
005EBC  3  17 17 08 01  
005ED5  3  00 01 00 01          .byte 0,1,0,1,0,1,3,1,0,1,0,1,0,1,0,3,0,1,0,1,0,1,0,1,1,0,1,0,1,0,1,0,3
005ED9  3  00 01 03 01  
005EDD  3  00 01 00 01  
005EF6  3  00 01 00 01          .byte 0,1,0,1,0,1,0,1,3,1,0,1,0,1,0,1,0,0,1,6,255,2,5,4,1,0,9,0,1,9,1,0,5
005EFA  3  00 01 00 01  
005EFE  3  03 01 00 01  
005F17  3  FF 02 05 07          .byte 255,2,5,7,0,1,1,0,3,0,1,0,1,0,1,0,1,3,1,0,3,0,1,0,1,0,1,0,1,3,1,0,0
005F1B  3  00 01 01 00  
005F1F  3  03 00 01 00  
005F38  3  01 03 01 00          .byte 1,3,1,0,1,0,1,0,1,0,3,0,1,3,1,0,1,0,1,0,1,0,3,0,1,1,0,8,0,1,11,2,2
005F3C  3  01 00 01 00  
005F40  3  01 00 03 00  
005F59  3  07 00 01 03          .byte 7,0,1,3,1,0,3,0,1,6,2,2,10,0,1,8,1,0,0,1,0,1,0,1,24,23,3,1,0,3,0,1,3
005F5D  3  01 00 03 00  
005F61  3  01 06 02 02  
005F7A  3  01 00 03 18          .byte 1,0,3,24,23,0,1,0,1,0,1,1,0,1,0,1,0,23,23,3,0,1,3,1,0,3,0,1,3,23,23,1,0
005F7E  3  17 00 01 00  
005F82  3  01 00 01 01  
005F9B  3  01 00 01 00          .byte 1,0,1,0,0,1,9,1,0,11,2,2,4,1,0,3,0,1,3,1,0,5,2,2,10,1,0,9,0,1,1,0,3
005F9F  3  00 01 09 01  
005FA3  3  00 0B 02 02  
005FBC  3  00 01 00 01          .byte 0,1,0,1,0,1,0,1,3,1,0,3,0,1,0,1,0,1,0,1,3,1,0,0,1,3,1,0,1,0,1,0,1
005FC0  3  00 01 00 01  
005FC4  3  03 01 00 03  
005FDD  3  00 03 00 01          .byte 0,3,0,1,3,1,0,1,0,1,0,1,0,3,0,1,1,0,5,255,2,5,7,0,1,8,1,0,8,0,1,6,255,2,5
005FE1  3  03 01 00 01  
005FE5  3  00 01 00 01  
006000  3  04 01 00 00          .byte 4,1,0,0,1,0,1,0,1,0,1,3,1,0,1,0,1,0,1,0,3,0,1,0,1,0,1,0,1,1,0,1,0
006004  3  01 00 01 00  
006008  3  01 00 01 03  
006021  3  01 00 01 00          .byte 1,0,1,0,3,0,1,0,1,0,1,0,1,3,1,0,1,0,1,0,1,0,0,1,9,24,23,9,0,1,3,1,0
006025  3  03 00 01 00  
006029  3  01 00 01 00  
006042  3  06 02 02 07          .byte 6,2,2,7,1,0,3,0,1,9,24,23,9,0,1,1,0,3,23,23,3,1,0,3,0,1,3,24,23,3,0,1,3
006046  3  01 00 03 00  
00604A  3  01 09 18 17  
006063  3  01 00 03 17          .byte 1,0,3,23,23,3,1,0,0,1,5,2,2,4,0,1,8,1,0,8,23,23,8,1,0,8,0,1,5,2,2,4,0
006067  3  17 03 01 00  
00606B  3  00 01 05 02  
006084  3  01 01 00 01          .byte 1,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0
006088  3  00 01 00 01  
00608C  3  00 01 00 01  
00609F  3  FF 01 00 FF          .byte 255,1,0,255,1,0,255,1,86
0060A3  3  01 00 FF 01  
0060A7  3  56           
0060A8  3  FF 01 00 FF          .byte 255,1,0,255,1,0,255,1,86
0060AC  3  01 00 FF 01  
0060B0  3  56           
0060B1  3  FF 01 00 FF          .byte 255,1,0,255,1,0,255,1,86
0060B5  3  01 00 FF 01  
0060B9  3  56           
0060BA  3  FF 17 3D 0E          .byte 255,23,61,14,255,27,10,255,23,14,14,1,255,27,10,255,23,13,14,1,1,255,27,10,255,23,13,1,1,1,255,27,10
0060BE  3  FF 1B 0A FF  
0060C2  3  17 0E 0E 01  
0060DB  3  FF 17 0D 01          .byte 255,23,13,1,1,1,255,27,10,255,23,13,1,1,1,255,27,10,255,23,13,1,1,1,255,27,10,255,23,13,1,1,1
0060DF  3  01 01 FF 1B  
0060E3  3  0A FF 17 0D  
0060FC  3  FF 1B 0A FF          .byte 255,27,10,255,23,13,1,1,1,255,27,10,255,23,13,1,1,1,255,27,10,255,23,13,1,1,1,255,27,10,255,23,13
006100  3  17 0D 01 01  
006104  3  01 FF 1B 0A  
00611D  3  01 01 01 FF          .byte 1,1,1,255,27,10,255,23,13,1,1,1,255,27,10,255,23,13,1,1,1,255,27,10,255,23,13,1,1,1,255,27,10
006121  3  1B 0A FF 17  
006125  3  0D 01 01 01  
00613E  3  FF 17 0D 01          .byte 255,23,13,1,1,1,255,27,10,255,23,13,1,1,1,255,27,10,255,23,13,1,1,1,15,16,17,18,19,255,27,5,255,23,13
006142  3  01 01 FF 1B  
006146  3  0A FF 17 0D  
006161  3  01 01 01 17          .byte 1,1,1,23,23,25,23,23,255,27,5,255,23,13,1,1,1,23,23,25,23,23,255,27,5,255,23,6,255,26,26
006165  3  17 19 17 17  
006169  3  FF 1B 05 FF  
006180  3  FF 17 6D 14          .byte 255,23,109,20,22,22,28,23,23,20,22,22,28,23,23,20,22,22,28,255,23,10,20,23,23,21,23,23,20,23,23,21,23,23
006184  3  16 16 1C 17  
006188  3  17 14 16 16  
0061A2  3  14 17 17 15          .byte 20,23,23,21,255,23,10,20,22,22,28,23,23,20,22,22,28,23,23,20,22,22,28,255,23,10,20,23,23,21,23,23,20
0061A6  3  FF 17 0A 14  
0061AA  3  16 16 1C 17  
0061C3  3  17 17 15 17          .byte 23,23,21,23,23,20,23,23,21,255,23,10,20,22,22,28,23,23,20,22,22,28,23,23,20,22,22,28,255,23,10,20,23,23
0061C7  3  17 14 17 17  
0061CB  3  15 FF 17 0A  
0061E5  3  15 17 17 14          .byte 21,23,23,20,23,23,21,23,23,20,23,23,21,255,23,10,20,22,22,28,23,23,20,22,22,28,23,23,20,22,22,28,255,23,10
0061E9  3  17 17 15 17  
0061ED  3  17 14 17 17  
006208  3  14 17 17 15          .byte 20,23,23,21,23,23,20,23,23,21,23,23,20,23,23,21,255,23,10,20,22,22,28,23,23,20,22,22,28,23,23,20,22,22
00620C  3  17 17 14 17  
006210  3  17 15 17 17  
00622A  3  1C FF 17 0A          .byte 28,255,23,10,20,23,23,21,23,23,20,23,23,21,23,23,20,23,23,21,255,23,10,20,22,22,28,23,23,20,22,22,28
00622E  3  14 17 17 15  
006232  3  17 17 14 17  
00624B  3  17 17 14 16          .byte 23,23,20,22,22,28,255,23,10,20,23,23,21,23,23,20,23,23,21,23,23,20,23,23,21,255,23,10,20,22,22,28,23,23
00624F  3  16 1C FF 17  
006253  3  0A 14 17 17  
00626D  3  14 16 16 1C          .byte 20,22,22,28,23,23,20,22,22,28,255,23,10,20,23,23,21,23,23,20,23,23,21,23,23,20,23,23,21,255,23,10,20
006271  3  17 17 14 16  
006275  3  16 1C FF 17  
00628E  3  16 16 1C 17          .byte 22,22,28,23,23,20,22,22,28,23,23,20,22,22,28,255,23,10,20,23,23,21,23,23,20,23,23,21,23,23,20,23,23
006292  3  17 14 16 16  
006296  3  1C 17 17 14  
0062AF  3  15 FF 17 53          .byte 21,255,23,83
0062B3  3  FF 17 00 FF          .byte 255,23,0,255,23,0,255,23,86
0062B7  3  17 00 FF 17  
0062BB  3  56           
0062BC  3               numsc:
0062BC  3  07                   .byte 7
0062BD  3               .out .sprintf("SCREENS SIZE = %d", (* - scdat))
0062BD  3               
0062BD  3               nmedat:
0062BD  3  00 00 B0 00          .byte 0,0,176,0,8,9,0,192,8,9,0,0,255
0062C1  3  08 09 00 C0  
0062C5  3  08 09 00 00  
0062CA  3  00 00 B0 00          .byte 0,0,176,0,8,10,0,192,8,9,0,0,255
0062CE  3  08 0A 00 C0  
0062D2  3  08 09 00 00  
0062D7  3  00 00 A8 00          .byte 0,0,168,0,8,10,0,0,8,10,0,192,255
0062DB  3  08 0A 00 00  
0062DF  3  08 0A 00 C0  
0062E4  3  00 00 B0 00          .byte 0,0,176,0,8,10,0,0,8,11,0,96,8,10,0,192,255
0062E8  3  08 0A 00 00  
0062EC  3  08 0B 00 60  
0062F5  3  07 10 00 80          .byte 7,16,0,128,7,16,0,88,7,18,160,0,255
0062F9  3  07 10 00 58  
0062FD  3  07 12 A0 00  
006302  3  05 00 50 60          .byte 5,0,80,96,5,9,144,48,5,9,120,96,5,9,144,144,255
006306  3  05 09 90 30  
00630A  3  05 09 78 60  
006313  3  05 10 28 48          .byte 5,16,40,72,5,16,40,0,5,16,40,144,255
006317  3  05 10 28 00  
00631B  3  05 10 28 90  
006320  3               .out .sprintf("POSITIONS SIZE = %d", (* - nmedat))
006320  3               
006320  3               NUMOBJ = 9
006320  3               objdta:
006320  3  00 00 3F FC          .byte 0,0,63,252,95,250,120,30,112,14,113,142,115,206,127,206,127,142,126,30,126,126,127,254,126,126,94,122,63,252,0,0,0,24,24,0,24,24
006324  3  5F FA 78 1E  
006328  3  70 0E 71 8E  
006346  3  00 00 3F FC          .byte 0,0,63,252,95,250,120,30,112,14,113,142,115,206,127,206,127,142,126,30,126,126,127,254,126,126,94,122,63,252,0,0,0,0,0,0,0,0
00634A  3  5F FA 78 1E  
00634E  3  70 0E 71 8E  
00636C  3  00 00 3F FC          .byte 0,0,63,252,95,250,120,30,112,14,113,142,115,206,127,206,127,142,126,30,126,126,127,254,126,126,94,122,63,252,0,0,0,0,0,0,0,0
006370  3  5F FA 78 1E  
006374  3  70 0E 71 8E  
006392  3  00 00 3F FC          .byte 0,0,63,252,95,250,120,30,112,14,113,142,115,206,127,206,127,142,126,30,126,126,127,254,126,126,94,122,63,252,0,0,0,0,0,0,0,0
006396  3  5F FA 78 1E  
00639A  3  70 0E 71 8E  
0063B8  3  00 00 3F FC          .byte 0,0,63,252,95,250,120,30,112,14,113,142,115,206,127,206,127,142,126,30,126,126,127,254,126,126,94,122,63,252,0,0,0,0,0,0,0,0
0063BC  3  5F FA 78 1E  
0063C0  3  70 0E 71 8E  
0063DE  3  00 00 3F FC          .byte 0,0,63,252,95,250,120,30,112,14,113,142,115,206,127,206,127,142,126,30,126,126,127,254,126,126,94,122,63,252,0,0,0,0,0,0,0,0
0063E2  3  5F FA 78 1E  
0063E6  3  70 0E 71 8E  
006404  3  00 00 3F FC          .byte 0,0,63,252,95,250,120,30,112,14,113,142,115,206,127,206,127,142,126,30,126,126,127,254,126,126,94,122,63,252,0,0,0,0,0,0,0,0
006408  3  5F FA 78 1E  
00640C  3  70 0E 71 8E  
00642A  3  00 00 3F FC          .byte 0,0,63,252,95,250,120,30,112,14,113,142,115,206,127,206,127,142,126,30,126,126,127,254,126,126,94,122,63,252,0,0,0,0,0,0,0,0
00642E  3  5F FA 78 1E  
006432  3  70 0E 71 8E  
006450  3  00 00 00 00          .byte 0,0,0,0,1,0,17,16,9,32,0,0,3,128,58,184,3,128,0,0,9,32,17,16,1,0,0,0,0,0,0,0,255,0,0,255,0,0
006454  3  01 00 11 10  
006458  3  09 20 00 00  
006476  3               .out .sprintf("OBJECTS SIZE = %d", (* - objdta))
006476  3               
006476  3               font:
006476  3  9E 87 C9 C9          .byte 158,135,201,201,201,201,201,0
00647A  3  C9 C9 C9 00  
00647E  3  40 9C 84 88          .byte 64,156,132,136,144,156,64,0
006482  3  90 9C 40 00  
006486  3  00 EE 4A 4A          .byte 0,238,74,74,74,78,0,0
00648A  3  4A 4E 00 00  
00648E  3  00 75 45 47          .byte 0,117,69,71,69,117,0,0
006492  3  45 75 00 00  
006496  3  00 77 55 75          .byte 0,119,85,117,85,85,0,0
00649A  3  55 55 00 00  
00649E  3  00 77 44 47          .byte 0,119,68,71,84,119,0,0
0064A2  3  54 77 00 00  
0064A6  3  40 20 20 20          .byte 64,32,32,32,32,32,64,0
0064AA  3  20 20 40 00  
0064AE  3  00 08 10 00          .byte 0,8,16,0,0,0,0,0
0064B2  3  00 00 00 00  
0064B6  3  EE 8A EE 28          .byte 238,138,238,40,232,0,0,0
0064BA  3  E8 00 00 00  
0064BE  3  20 10 10 10          .byte 32,16,16,16,16,16,16,32
0064C2  3  10 10 10 20  
0064C6  3  00 00 00 00          .byte 0,0,0,0,0,0,0,0
0064CA  3  00 00 00 00  
0064CE  3  00 00 08 08          .byte 0,0,8,8,62,8,8,0
0064D2  3  3E 08 08 00  
0064D6  3  00 00 00 00          .byte 0,0,0,0,0,8,8,16
0064DA  3  00 08 08 10  
0064DE  3  00 00 00 00          .byte 0,0,0,0,62,0,0,0
0064E2  3  3E 00 00 00  
0064E6  3  00 00 00 00          .byte 0,0,0,0,0,24,24,0
0064EA  3  00 18 18 00  
0064EE  3  00 00 02 04          .byte 0,0,2,4,8,16,32,0
0064F2  3  08 10 20 00  
0064F6  3  00 7E 42 42          .byte 0,126,66,66,70,70,126,0
0064FA  3  46 46 7E 00  
0064FE  3  00 18 08 08          .byte 0,24,8,8,24,24,24,0
006502  3  18 18 18 00  
006506  3  00 7E 42 02          .byte 0,126,66,2,126,96,126,0
00650A  3  7E 60 7E 00  
00650E  3  00 7C 44 1E          .byte 0,124,68,30,6,70,126,0
006512  3  06 46 7E 00  
006516  3  00 7C 44 44          .byte 0,124,68,68,68,126,12,0
00651A  3  44 7E 0C 00  
00651E  3  00 7E 40 7E          .byte 0,126,64,126,6,70,126,0
006522  3  06 46 7E 00  
006526  3  00 7E 40 7E          .byte 0,126,64,126,70,70,126,0
00652A  3  46 46 7E 00  
00652E  3  00 7C 04 04          .byte 0,124,4,4,12,12,12,0
006532  3  0C 0C 0C 00  
006536  3  00 3C 24 7E          .byte 0,60,36,126,70,70,126,0
00653A  3  46 46 7E 00  
00653E  3  00 7E 42 42          .byte 0,126,66,66,126,6,6,0
006542  3  7E 06 06 00  
006546  3  00 00 00 10          .byte 0,0,0,16,0,0,16,0
00654A  3  00 00 10 00  
00654E  3  00 00 10 00          .byte 0,0,16,0,0,16,16,32
006552  3  00 10 10 20  
006556  3  00 00 04 08          .byte 0,0,4,8,16,8,4,0
00655A  3  10 08 04 00  
00655E  3  00 00 00 3E          .byte 0,0,0,62,0,62,0,0
006562  3  00 3E 00 00  
006566  3  00 00 10 08          .byte 0,0,16,8,4,8,16,0
00656A  3  04 08 10 00  
00656E  3  00 7E 02 3E          .byte 0,126,2,62,48,0,48,0
006572  3  30 00 30 00  
006576  3  00 3C 4A 56          .byte 0,60,74,86,94,64,60,0
00657A  3  5E 40 3C 00  
00657E  3  00 3C 24 24          .byte 0,60,36,36,126,98,98,0
006582  3  7E 62 62 00  
006586  3  00 7C 44 7E          .byte 0,124,68,126,98,98,126,0
00658A  3  62 62 7E 00  
00658E  3  00 7E 42 40          .byte 0,126,66,64,96,98,126,0
006592  3  60 62 7E 00  
006596  3  00 7E 42 42          .byte 0,126,66,66,98,98,126,0
00659A  3  62 62 7E 00  
00659E  3  00 7E 40 7C          .byte 0,126,64,124,96,96,126,0
0065A2  3  60 60 7E 00  
0065A6  3  00 7E 40 7C          .byte 0,126,64,124,96,96,96,0
0065AA  3  60 60 60 00  
0065AE  3  00 7E 42 40          .byte 0,126,66,64,102,98,126,0
0065B2  3  66 62 7E 00  
0065B6  3  00 42 42 7E          .byte 0,66,66,126,98,98,98,0
0065BA  3  62 62 62 00  
0065BE  3  00 08 08 08          .byte 0,8,8,8,24,24,24,0
0065C2  3  18 18 18 00  
0065C6  3  00 04 04 04          .byte 0,4,4,4,70,70,124,0
0065CA  3  46 46 7C 00  
0065CE  3  00 44 44 7E          .byte 0,68,68,126,98,98,98,0
0065D2  3  62 62 62 00  
0065D6  3  00 20 20 20          .byte 0,32,32,32,48,48,62,0
0065DA  3  30 30 3E 00  
0065DE  3  00 7E 4A 4A          .byte 0,126,74,74,106,106,106,0
0065E2  3  6A 6A 6A 00  
0065E6  3  00 7E 42 42          .byte 0,126,66,66,98,98,98,0
0065EA  3  62 62 62 00  
0065EE  3  00 7E 46 42          .byte 0,126,70,66,66,66,126,0
0065F2  3  42 42 7E 00  
0065F6  3  00 7E 42 42          .byte 0,126,66,66,126,96,96,0
0065FA  3  7E 60 60 00  
0065FE  3  00 7E 42 42          .byte 0,126,66,66,66,78,126,0
006602  3  42 4E 7E 00  
006606  3  00 7C 44 44          .byte 0,124,68,68,126,98,98,0
00660A  3  7E 62 62 00  
00660E  3  00 7E 40 7E          .byte 0,126,64,126,6,70,126,0
006612  3  06 46 7E 00  
006616  3  00 7C 10 10          .byte 0,124,16,16,24,24,24,0
00661A  3  18 18 18 00  
00661E  3  00 42 42 42          .byte 0,66,66,66,98,98,126,0
006622  3  62 62 7E 00  
006626  3  00 62 62 62          .byte 0,98,98,98,102,36,60,0
00662A  3  66 24 3C 00  
00662E  3  00 4A 4A 4A          .byte 0,74,74,74,106,106,126,0
006632  3  6A 6A 7E 00  
006636  3  00 42 42 3C          .byte 0,66,66,60,98,98,98,0
00663A  3  62 62 62 00  
00663E  3  00 42 42 7E          .byte 0,66,66,126,24,24,24,0
006642  3  18 18 18 00  
006646  3  00 7E 06 3C          .byte 0,126,6,60,112,96,126,0
00664A  3  70 60 7E 00  
00664E  3  CD E8 7B 3A          .byte 205,232,123,58,48,125,119,201
006652  3  30 7D 77 C9  
006656  3  CD C8 EB 7E          .byte 205,200,235,126,50,48,125,201
00665A  3  32 30 7D C9  
00665E  3  06 00 3A 2F          .byte 6,0,58,47,125,71,33,35
006662  3  7D 47 21 23  
006666  3  F8 09 C9 FC          .byte 248,9,201,252,48,48,48,0
00666A  3  30 30 30 00  
00666E  3  00 00 00 00          .byte 0,0,0,0,0,0,0,255
006672  3  00 00 00 FF  
006676  3  00 3A 2D 7D          .byte 0,58,45,125,103,58,46,125
00667A  3  67 3A 2E 7D  
00667E  3  6F 11 01 00          .byte 111,17,1,0,205,181,3,201
006682  3  CD B5 03 C9  
006686  3  DA 92 D2 92          .byte 218,146,210,146,218,0,0,0
00668A  3  DA 00 00 00  
00668E  3  E8 A8 E8 A8          .byte 232,168,232,168,172,0,0,0
006692  3  AC 00 00 00  
006696  3  EA 4A 4E 4A          .byte 234,74,78,74,74,0,0,0
00669A  3  4A 00 00 00  
00669E  3  A7 42 42 42          .byte 167,66,66,66,162,0,0,0
0066A2  3  A2 00 00 00  
0066A6  3  73 52 52 52          .byte 115,82,82,82,115,0,0,0
0066AA  3  73 00 00 00  
0066AE  3  0E 88 8E 82          .byte 14,136,142,130,46,0,0,0
0066B2  3  2E 00 00 00  
0066B6  3  EE AA EE A8          .byte 238,170,238,168,168,0,0,0
0066BA  3  A8 00 00 00  
0066BE  3  95 95 F5 95          .byte 149,149,245,149,149,0,0,0
0066C2  3  95 00 00 00  
0066C6  3  B8 29 B3 29          .byte 184,41,179,41,168,0,0,0
0066CA  3  A8 00 00 00  
0066CE  3  31 21 A1 21          .byte 49,33,161,33,53,0,0,0
0066D2  3  35 00 00 00  
0066D6  3  5D 55 D5 55          .byte 93,85,213,85,93,0,0,0
0066DA  3  5D 00 00 00  
0066DE  3  17 15 57 55          .byte 23,21,87,85,245,0,0,0
0066E2  3  F5 00 00 00  
0066E6  3  76 55 65 55          .byte 118,85,101,85,86,0,0,0
0066EA  3  56 00 00 00  
0066EE  3  EE 3A 2F 7D          .byte 238,58,47,125,50,73,175,201
0066F2  3  32 49 AF C9  
0066F6  3  AD 06 09 77          .byte 173,6,9,119,35,16,252,201
0066FA  3  23 10 FC C9  
0066FE  3  30 30 30 30          .byte 48,48,48,48,48,48,205,153
006702  3  30 30 CD 99  
006706  3  7C C9 CD 99          .byte 124,201,205,153,124,205,185,124
00670A  3  7C CD B9 7C  
00670E  3  C9 06 05 21          .byte 201,6,5,33,176,91,17,192
006712  3  B0 5B 11 C0  
006716  3  86 AF 1A BE          .byte 134,175,26,190,202,171,124,210
00671A  3  CA AB 7C D2  
00671E  3  B0 7C C9 2C          .byte 176,124,201,44,28,16,242,201
006722  3  1C 10 F2 C9  
006726  3  77 2C 1C 1A          .byte 119,44,28,26,16,250,195,171
00672A  3  10 FA C3 AB  
00672E  3  7C 3E 02 CD          .byte 124,62,2,205,1,22,62,22
006732  3  01 16 3E 16  
006736  3  D7 3A 31 7D          .byte 215,58,49,125,215,58,50,125
00673A  3  D7 3A 32 7D  
00673E  3  D7 06 05 11          .byte 215,6,5,17,176,91,26,215
006742  3  B0 5B 1A D7  
006746  3  13 10 FB C9          .byte 19,16,251,201,124,96,124,0
00674A  3  7C 60 7C 00  
00674E  3  EE 3A 2A 7D          .byte 238,58,42,125,50,5,125,201
006752  3  32 05 7D C9  
006756  3  00 08 08 08          .byte 0,8,8,8,8,8,8,0
00675A  3  08 08 08 00  
00675E  3  00 70 10 1C          .byte 0,112,16,28,16,16,112,0
006762  3  10 10 70 00  
006766  3  00 14 28 00          .byte 0,20,40,0,0,0,0,0
00676A  3  00 00 00 00  
00676E  3  7E 81 BD A1          .byte 126,129,189,161,161,189,129,126
006772  3  A1 BD 81 7E  
006776  3               .out .sprintf("FONT SIZE = %d", (* - font))
006776  3               
006776  3  42 61 68 48  keys:   .byte 66,97,104,72,98,16,55,48,49,17,18
00677A  3  62 10 37 30  
00677E  3  31 11 12     
006781  3               .out .sprintf("KEYS SIZE = %d", (* - keys))
006781  3               
006781  3               data_end:
006781  3               .out .sprintf("TOTAL DATA SIZE = %d", (* - data_start))
006781  3               
006781  2               
006781  1               
006781  1               end_asm:
006781  1               
006781  1               ;----------------------------------------------------------------------
006781  1               ; RELOCATION OF BEEB CODE FROM LOAD ADDRESS
006781  1               ;----------------------------------------------------------------------
006781  1               
006781  1               relocate:
006781  1               ; Issue *TAPE otherwise DFS goes mental that we've overwritten workspace from &E00 - &1100
006781  1               
006781  1  A9 8C            lda #$8C
006783  1  A2 0C            ldx #$0C
006785  1  A0 00            ldy #$00
006787  1  20 F4 FF         jsr OSBYTE					; *FX &8C,0,0 - *TAPE 1200
00678A  1               
00678A  1               ; Other one off initialisation could happen here...
00678A  1               
00678A  1               ; Relocate all code down to &E00
00678A  1  A2 5A        	ldx #>(end_asm - start_asm) + 1
00678C  1  A0 00        	ldy #0
00678E  1               reloop:
00678E  1  B9 00 12     	lda load_address, y
006791  1  99 00 0E     	sta asm_code, y
006794  1  C8           	iny
006795  1  D0 F7        	bne reloop
006797  1  EE 90 6B     	inc reloop + 2 + load_address - asm_code
00679A  1  EE 93 6B     	inc reloop + 5 + load_address - asm_code
00679D  1  CA           	dex
00679E  1  D0 EE        	bne reloop
0067A0  1  4C 03 0E     	jmp boot_game
0067A0  1               
